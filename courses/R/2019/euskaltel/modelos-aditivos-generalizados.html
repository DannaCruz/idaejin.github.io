<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> 8 Modelos Aditivos Generalizados | Introducción al software estadístico R</title>
  <meta name="description" content="Material del curso de Formación en R Euskaltel">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content=" 8 Modelos Aditivos Generalizados | Introducción al software estadístico R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Material del curso de Formación en R Euskaltel" />
  <meta name="github-repo" content="idaejin/xxx" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content=" 8 Modelos Aditivos Generalizados | Introducción al software estadístico R" />
  
  <meta name="twitter:description" content="Material del curso de Formación en R Euskaltel" />
  

<meta name="author" content="Dae-Jin Lee &lt; dlee@bcamath.org &gt;">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="regresion-logistica.html">
<link rel="next" href="analisis-de-componentes-principales-clasificacion-y-clustering.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Curso de formación en R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Información y pre-requisitos</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introducción al software estadístico <code>R</code></a><ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#algunas-cuestiones-a-tener-en-cuenta-sobre-r"><i class="fa fa-check"></i><b>2.1</b> Algunas cuestiones a tener en cuenta sobre <code>R</code></a></li>
<li class="chapter" data-level="2.2" data-path="intro.html"><a href="intro.html#rstudio"><i class="fa fa-check"></i><b>2.2</b> Rstudio</a></li>
<li class="chapter" data-level="2.3" data-path="intro.html"><a href="intro.html#instalar-un-paquete-de-r"><i class="fa fa-check"></i><b>2.3</b> Instalar un paquete de <code>R</code></a></li>
<li class="chapter" data-level="2.4" data-path="intro.html"><a href="intro.html#empezando-con-r"><i class="fa fa-check"></i><b>2.4</b> Empezando con <code>R</code></a></li>
<li class="chapter" data-level="2.5" data-path="intro.html"><a href="intro.html#cargar-librerias-en-r"><i class="fa fa-check"></i><b>2.5</b> Cargar librerías en <code>R</code></a></li>
<li class="chapter" data-level="2.6" data-path="intro.html"><a href="intro.html#lectura-de-datos"><i class="fa fa-check"></i><b>2.6</b> Lectura de datos</a></li>
<li class="chapter" data-level="2.7" data-path="intro.html"><a href="intro.html#importar-datos"><i class="fa fa-check"></i><b>2.7</b> Importar datos</a></li>
<li class="chapter" data-level="2.8" data-path="intro.html"><a href="intro.html#exportar-datos"><i class="fa fa-check"></i><b>2.8</b> Exportar datos</a></li>
<li class="chapter" data-level="2.9" data-path="intro.html"><a href="intro.html#vectores"><i class="fa fa-check"></i><b>2.9</b> Vectores</a></li>
<li class="chapter" data-level="2.10" data-path="intro.html"><a href="intro.html#estadistica-basica"><i class="fa fa-check"></i><b>2.10</b> Estadística básica</a></li>
<li class="chapter" data-level="2.11" data-path="intro.html"><a href="intro.html#vectores-caracteres-y-variables-factor"><i class="fa fa-check"></i><b>2.11</b> Vectores caracteres y variables factor</a></li>
<li class="chapter" data-level="2.12" data-path="intro.html"><a href="intro.html#data-frames"><i class="fa fa-check"></i><b>2.12</b> Data frames</a><ul>
<li class="chapter" data-level="2.12.1" data-path="intro.html"><a href="intro.html#trabajando-con-data-frames"><i class="fa fa-check"></i><b>2.12.1</b> Trabajando con data frames</a></li>
</ul></li>
<li class="chapter" data-level="2.13" data-path="intro.html"><a href="intro.html#vectores-logicos"><i class="fa fa-check"></i><b>2.13</b> Vectores lógicos</a></li>
<li class="chapter" data-level="2.14" data-path="intro.html"><a href="intro.html#trabajando-con-vectores"><i class="fa fa-check"></i><b>2.14</b> Trabajando con vectores</a></li>
<li class="chapter" data-level="2.15" data-path="intro.html"><a href="intro.html#matrices-y-arrays"><i class="fa fa-check"></i><b>2.15</b> Matrices y arrays</a></li>
<li class="chapter" data-level="2.16" data-path="intro.html"><a href="intro.html#factores"><i class="fa fa-check"></i><b>2.16</b> Factores</a></li>
<li class="chapter" data-level="2.17" data-path="intro.html"><a href="intro.html#indexando-vectores-con-condiciones-logicas"><i class="fa fa-check"></i><b>2.17</b> Indexando vectores con condiciones lógicas</a></li>
<li class="chapter" data-level="2.18" data-path="intro.html"><a href="intro.html#valores-faltantes"><i class="fa fa-check"></i><b>2.18</b> Valores faltantes</a></li>
<li class="chapter" data-level="2.19" data-path="intro.html"><a href="intro.html#trabajando-con-data-frames-1"><i class="fa fa-check"></i><b>2.19</b> Trabajando con data frames</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="basic.html"><a href="basic.html"><i class="fa fa-check"></i><b>3</b> Análisis de datos básico en <code>R</code></a><ul>
<li class="chapter" data-level="3.1" data-path="basic.html"><a href="basic.html#graficos-sencillos"><i class="fa fa-check"></i><b>3.1</b> Gráficos sencillos</a></li>
<li class="chapter" data-level="3.2" data-path="basic.html"><a href="basic.html#scatterplots"><i class="fa fa-check"></i><b>3.2</b> Scatterplots</a></li>
<li class="chapter" data-level="3.3" data-path="basic.html"><a href="basic.html#mas-opciones-graficas"><i class="fa fa-check"></i><b>3.3</b> Más opciones gráficas</a></li>
<li class="chapter" data-level="3.4" data-path="basic.html"><a href="basic.html#tablas-de-clasificacion-cruzada-o-de-contigencia"><i class="fa fa-check"></i><b>3.4</b> Tablas de clasificación cruzada o de contigencia</a></li>
<li class="chapter" data-level="3.5" data-path="basic.html"><a href="basic.html#datos-cualitativos"><i class="fa fa-check"></i><b>3.5</b> Datos cualitativos</a></li>
<li class="chapter" data-level="3.6" data-path="basic.html"><a href="basic.html#datos-cuantitativos"><i class="fa fa-check"></i><b>3.6</b> Datos cuantitativos</a><ul>
<li class="chapter" data-level="3.6.1" data-path="basic.html"><a href="basic.html#distribuciones-de-frecuencias"><i class="fa fa-check"></i><b>3.6.1</b> Distribuciones de frecuencias</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="introduccion-a-la-programacion-basica-con-r.html"><a href="introduccion-a-la-programacion-basica-con-r.html"><i class="fa fa-check"></i><b>4</b> Introducción a la programación básica con <code>R</code></a><ul>
<li class="chapter" data-level="4.1" data-path="introduccion-a-la-programacion-basica-con-r.html"><a href="introduccion-a-la-programacion-basica-con-r.html#condicionales"><i class="fa fa-check"></i><b>4.1</b> Condicionales</a></li>
<li class="chapter" data-level="4.2" data-path="introduccion-a-la-programacion-basica-con-r.html"><a href="introduccion-a-la-programacion-basica-con-r.html#operadores-logicos"><i class="fa fa-check"></i><b>4.2</b> Operadores Lógicos</a></li>
<li class="chapter" data-level="4.3" data-path="introduccion-a-la-programacion-basica-con-r.html"><a href="introduccion-a-la-programacion-basica-con-r.html#if"><i class="fa fa-check"></i><b>4.3</b> <code>if</code></a></li>
<li class="chapter" data-level="4.4" data-path="introduccion-a-la-programacion-basica-con-r.html"><a href="introduccion-a-la-programacion-basica-con-r.html#ifelse"><i class="fa fa-check"></i><b>4.4</b> <code>ifelse</code></a></li>
<li class="chapter" data-level="4.5" data-path="introduccion-a-la-programacion-basica-con-r.html"><a href="introduccion-a-la-programacion-basica-con-r.html#loops-o-bucles"><i class="fa fa-check"></i><b>4.5</b> Loops o Bucles</a><ul>
<li class="chapter" data-level="4.5.1" data-path="introduccion-a-la-programacion-basica-con-r.html"><a href="introduccion-a-la-programacion-basica-con-r.html#for"><i class="fa fa-check"></i><b>4.5.1</b> <code>for</code></a></li>
<li class="chapter" data-level="4.5.2" data-path="introduccion-a-la-programacion-basica-con-r.html"><a href="introduccion-a-la-programacion-basica-con-r.html#while"><i class="fa fa-check"></i><b>4.5.2</b> <code>while</code></a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="introduccion-a-la-programacion-basica-con-r.html"><a href="introduccion-a-la-programacion-basica-con-r.html#famila-de-funciones-apply"><i class="fa fa-check"></i><b>4.6</b> Famila de funciones <code>apply</code></a></li>
<li class="chapter" data-level="4.7" data-path="introduccion-a-la-programacion-basica-con-r.html"><a href="introduccion-a-la-programacion-basica-con-r.html#other-loops"><i class="fa fa-check"></i><b>4.7</b> Other Loops</a></li>
<li class="chapter" data-level="4.8" data-path="introduccion-a-la-programacion-basica-con-r.html"><a href="introduccion-a-la-programacion-basica-con-r.html#improving-speed-performance-of-loops"><i class="fa fa-check"></i><b>4.8</b> Improving Speed Performance of Loops</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="distribuciones-de-probabilidad-en-r.html"><a href="distribuciones-de-probabilidad-en-r.html"><i class="fa fa-check"></i><b>5</b> Distribuciones de probabilidad en R</a><ul>
<li class="chapter" data-level="5.1" data-path="distribuciones-de-probabilidad-en-r.html"><a href="distribuciones-de-probabilidad-en-r.html#distribucion-binomial-binnp"><i class="fa fa-check"></i><b>5.1</b> Distribución binomial <span class="math inline">\(Bin(n,p)\)</span></a></li>
<li class="chapter" data-level="5.2" data-path="distribuciones-de-probabilidad-en-r.html"><a href="distribuciones-de-probabilidad-en-r.html#distribucion-de-poisson-poislambda"><i class="fa fa-check"></i><b>5.2</b> Distribución de Poisson <span class="math inline">\(Pois(\lambda)\)</span></a><ul>
<li class="chapter" data-level="5.2.1" data-path="distribuciones-de-probabilidad-en-r.html"><a href="distribuciones-de-probabilidad-en-r.html#aproximacion-de-binomial-como-poisson"><i class="fa fa-check"></i><b>5.2.1</b> Aproximación de Binomial como Poisson</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="distribuciones-de-probabilidad-en-r.html"><a href="distribuciones-de-probabilidad-en-r.html#distribution-exponencial-explambda"><i class="fa fa-check"></i><b>5.3</b> Distribution Exponencial <span class="math inline">\(Exp(\lambda)\)</span></a></li>
<li class="chapter" data-level="5.4" data-path="distribuciones-de-probabilidad-en-r.html"><a href="distribuciones-de-probabilidad-en-r.html#distribution-normal-mathcalnmusigma2"><i class="fa fa-check"></i><b>5.4</b> Distribution Normal <span class="math inline">\(\mathcal{N}(\mu,\sigma^2)\)</span></a></li>
<li class="chapter" data-level="5.5" data-path="distribuciones-de-probabilidad-en-r.html"><a href="distribuciones-de-probabilidad-en-r.html#distribucion-uniforme-uab"><i class="fa fa-check"></i><b>5.5</b> Distribución Uniforme <span class="math inline">\(U(a,b)\)</span></a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="modelos-lineales-y-analisis-de-la-varianza.html"><a href="modelos-lineales-y-analisis-de-la-varianza.html"><i class="fa fa-check"></i><b>6</b> Modelos lineales y análisis de la varianza</a><ul>
<li class="chapter" data-level="6.1" data-path="modelos-lineales-y-analisis-de-la-varianza.html"><a href="modelos-lineales-y-analisis-de-la-varianza.html#principios-de-la-modelizacion-estadistica"><i class="fa fa-check"></i><b>6.1</b> Principios de la modelización estadística</a><ul>
<li class="chapter" data-level="6.1.1" data-path="modelos-lineales-y-analisis-de-la-varianza.html"><a href="modelos-lineales-y-analisis-de-la-varianza.html#identificar-y-caracterizar-variables"><i class="fa fa-check"></i><b>6.1.1</b> Identificar y Caracterizar Variables</a></li>
<li class="chapter" data-level="6.1.2" data-path="modelos-lineales-y-analisis-de-la-varianza.html"><a href="modelos-lineales-y-analisis-de-la-varianza.html#tipos-de-variables-y-tipo-de-modelo"><i class="fa fa-check"></i><b>6.1.2</b> Tipos de variables y tipo de modelo</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="modelos-lineales-y-analisis-de-la-varianza.html"><a href="modelos-lineales-y-analisis-de-la-varianza.html#el-modelo-lineal-general"><i class="fa fa-check"></i><b>6.2</b> El modelo lineal general</a></li>
<li class="chapter" data-level="6.3" data-path="modelos-lineales-y-analisis-de-la-varianza.html"><a href="modelos-lineales-y-analisis-de-la-varianza.html#definicion-de-modelos-en-r"><i class="fa fa-check"></i><b>6.3</b> Definición de modelos en <code>R</code></a><ul>
<li class="chapter" data-level="6.3.1" data-path="modelos-lineales-y-analisis-de-la-varianza.html"><a href="modelos-lineales-y-analisis-de-la-varianza.html#ejemplo-datos-de-precios-de-viviendas-en-boston"><i class="fa fa-check"></i><b>6.3.1</b> Ejemplo: Datos de precios de viviendas en Boston</a></li>
<li class="chapter" data-level="6.3.2" data-path="modelos-lineales-y-analisis-de-la-varianza.html"><a href="modelos-lineales-y-analisis-de-la-varianza.html#regresion-lineal-multiple"><i class="fa fa-check"></i><b>6.3.2</b> Regresión lineal múltiple</a></li>
<li class="chapter" data-level="6.3.3" data-path="modelos-lineales-y-analisis-de-la-varianza.html"><a href="modelos-lineales-y-analisis-de-la-varianza.html#modelos-con-interacciones"><i class="fa fa-check"></i><b>6.3.3</b> Modelos con interacciones</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="regresion-logistica.html"><a href="regresion-logistica.html"><i class="fa fa-check"></i><b>7</b> Regresión logística</a><ul>
<li class="chapter" data-level="7.1" data-path="regresion-logistica.html"><a href="regresion-logistica.html#ejemplo-datos-de-credito-en-alemania-credit-scoring"><i class="fa fa-check"></i><b>7.1</b> Ejemplo: Datos de crédito en Alemania (<em>Credit scoring</em>)</a></li>
<li class="chapter" data-level="7.2" data-path="regresion-logistica.html"><a href="regresion-logistica.html#ejemplo-predecir-el-salario-de-los-trabajadores"><i class="fa fa-check"></i><b>7.2</b> Ejemplo: Predecir el salario de los trabajadores</a></li>
<li class="chapter" data-level="7.3" data-path="regresion-logistica.html"><a href="regresion-logistica.html#ejemplo-datos-de-los-supervivientes-del-titanic"><i class="fa fa-check"></i><b>7.3</b> Ejemplo: Datos de los supervivientes del Titanic</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="modelos-aditivos-generalizados.html"><a href="modelos-aditivos-generalizados.html"><i class="fa fa-check"></i><b>8</b> Modelos Aditivos Generalizados</a><ul>
<li class="chapter" data-level="8.1" data-path="modelos-aditivos-generalizados.html"><a href="modelos-aditivos-generalizados.html#suavizado"><i class="fa fa-check"></i><b>8.1</b> Suavizado</a><ul>
<li class="chapter" data-level="8.1.1" data-path="modelos-aditivos-generalizados.html"><a href="modelos-aditivos-generalizados.html#regresion-polinomial"><i class="fa fa-check"></i><b>8.1.1</b> Regresión polinomial</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="modelos-aditivos-generalizados.html"><a href="modelos-aditivos-generalizados.html#gams"><i class="fa fa-check"></i><b>8.2</b> GAMs</a><ul>
<li class="chapter" data-level="8.2.1" data-path="modelos-aditivos-generalizados.html"><a href="modelos-aditivos-generalizados.html#ejemplo-salarios"><i class="fa fa-check"></i><b>8.2.1</b> Ejemplo: Salarios</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="modelos-aditivos-generalizados.html"><a href="modelos-aditivos-generalizados.html#modelos-semi-parametricos"><i class="fa fa-check"></i><b>8.3</b> Modelos semi-paramétricos</a><ul>
<li class="chapter" data-level="8.3.1" data-path="modelos-aditivos-generalizados.html"><a href="modelos-aditivos-generalizados.html#ejemplo"><i class="fa fa-check"></i><b>8.3.1</b> Ejemplo:</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="modelos-aditivos-generalizados.html"><a href="modelos-aditivos-generalizados.html#ejemplo-calidad-del-aire"><i class="fa fa-check"></i><b>8.4</b> Ejemplo: Calidad del Aire</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="analisis-de-componentes-principales-clasificacion-y-clustering.html"><a href="analisis-de-componentes-principales-clasificacion-y-clustering.html"><i class="fa fa-check"></i><b>9</b> Análisis de Componentes Principales, Clasificación y Clustering</a></li>
<li class="chapter" data-level="10" data-path="introduccion-al-machine-learning.html"><a href="introduccion-al-machine-learning.html"><i class="fa fa-check"></i><b>10</b> Introducción al machine learning</a></li>
<li class="chapter" data-level="11" data-path="extras.html"><a href="extras.html"><i class="fa fa-check"></i><b>11</b> Extras</a></li>
<li class="divider"></li>
<li><a href="http://idaejin.github.io/" target="blank">Mi página personal</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introducción al software estadístico <code>R</code></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="modelos-aditivos-generalizados" class="section level1">
<h1><span class="header-section-number"> 8</span> Modelos Aditivos Generalizados</h1>
<div id="suavizado" class="section level2">
<h2><span class="header-section-number">8.1</span> Suavizado</h2>
<p><strong>Suavizado Scatterplot</strong></p>
<p>Consiste en resaltar la <em>tendencia subyacente</em> en los datos. La tendencia subyacente sería una función como: <span class="math display">\[
f(x) = \mathbb{E}(y|x)
\]</span> que también se puede escribir como: <span class="math display">\[
y_i = f(x_i) + \epsilon_i,\qquad \mathbb{E}(\epsilon_i)=0,
\]</span> en cuyo caso el problema se denomina a menudo como <em>regresión no-paramétrica</em>, donde <span class="math inline">\(f(\cdot)\)</span> es una función <em>suave</em> no conocida que se estima a partir de los datos <span class="math inline">\((x_i,y_i)\)</span> </p>
<p>Existen varios métodos para suavizar una gráfica de dispersión, incluyendo <em>splines</em>, <em>regresión kernel</em>, <em>medias móviles</em>, <em>loess</em> o su versión ponderada <em>lowess</em>.</p>
<p>El conjunto de datos <code>lidar</code> consta de 221 observaciones de un experimento de detección y alcance de luz (LIDAR).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(SemiPar)
<span class="co">#library(car)</span>
<span class="kw">data</span>(lidar)
<span class="kw">plot</span>(logratio<span class="op">~</span>range,<span class="dt">data=</span>lidar)</code></pre></div>
<p><img src="cursoR_Euskaltel_files/figure-html/unnamed-chunk-1-1.png" width="672" style="display: block; margin: auto;" /></p>
<div id="regresion-polinomial" class="section level3">
<h3><span class="header-section-number">8.1.1</span> Regresión polinomial</h3>
<p>Consiste en transformar la variable explicativa <span class="math inline">\(X\)</span>, incluyendo polinomios de grado <span class="math inline">\(p\)</span> tales que: <span class="math display">\[
y = \beta_0 + \beta_1 X_1 + \beta_2 X_2 + \beta_p X^p + \epsilon \quad \epsilon\sim\mathcal{N}(0,\sigma^2)
\]</span></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(lattice)
cols. &lt;-<span class="st"> </span><span class="kw">rainbow</span>(<span class="dv">5</span>)
range.seq &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="kw">min</span>(lidar<span class="op">$</span>range),<span class="kw">max</span>(lidar<span class="op">$</span>range),<span class="dt">l=</span><span class="dv">200</span>)
<span class="kw">plot</span>(logratio<span class="op">~</span>range,<span class="dt">data=</span>lidar,<span class="dt">cex=</span>.<span class="dv">5</span>,<span class="dt">pch=</span><span class="dv">19</span>,<span class="dt">col=</span><span class="st">&quot;grey&quot;</span>,<span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">380</span>,<span class="dv">725</span>),<span class="dt">ylim=</span><span class="kw">c</span>(<span class="op">-</span><span class="fl">0.90</span>,<span class="fl">0.05</span>))
<span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>){
  <span class="kw">lines</span>(range.seq,<span class="kw">predict</span>(<span class="kw">lm</span>(logratio<span class="op">~</span><span class="kw">poly</span>(range,i),<span class="dt">data=</span>lidar),<span class="kw">data.frame</span>(<span class="dt">range=</span>range.seq)),<span class="dt">lwd=</span><span class="dv">2</span>,<span class="dt">col=</span>cols.[i])
}
<span class="kw">legend</span>(<span class="st">&quot;bottomleft&quot;</span>,<span class="kw">c</span>(<span class="st">&quot;p = 1&quot;</span>,<span class="st">&quot;p = 2&quot;</span>,<span class="st">&quot;p = 3&quot;</span>,<span class="st">&quot;p = 4&quot;</span>,<span class="st">&quot;p = 5&quot;</span>),<span class="dt">col=</span>cols.,<span class="dt">lty=</span><span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,<span class="dt">lwd=</span><span class="dv">4</span>)</code></pre></div>
<p><img src="cursoR_Euskaltel_files/figure-html/unnamed-chunk-2-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Podemos tratar estas relaciones no lineales de manera efectiva a través de técnicas más flexibles.</p>
<p><strong>Regresión local:</strong></p>
<p>LOESS y LOWESS son dos métodos de regresión no-paramétrica muy relacionados que combinan múltiples modelos de regresión en un modo basado en k-neast-neighbor.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">attach</span>(lidar)
span &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>)
<span class="kw">plot</span>(logratio<span class="op">~</span>range,<span class="dt">data=</span>lidar,<span class="dt">cex=</span>.<span class="dv">5</span>,<span class="dt">pch=</span><span class="dv">19</span>,<span class="dt">col=</span><span class="st">&quot;grey&quot;</span>,<span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">380</span>,<span class="dv">725</span>),<span class="dt">ylim=</span><span class="kw">c</span>(<span class="op">-</span><span class="fl">0.90</span>,<span class="fl">0.05</span>))
cols &lt;-<span class="st"> </span><span class="kw">rainbow</span>(<span class="kw">length</span>(span))
<span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(span)){
  <span class="kw">lines</span>(<span class="kw">loess.smooth</span>(range,logratio,<span class="dt">span=</span>span[i], <span class="dt">degree=</span><span class="dv">2</span>),<span class="dt">col=</span>cols.[i],<span class="dt">lwd=</span><span class="fl">2.5</span>,<span class="dt">lty=</span>i)
}
<span class="kw">legend</span>(<span class="st">&quot;bottomleft&quot;</span>,<span class="kw">paste</span>(<span class="st">&quot;span = &quot;</span>,<span class="kw">round</span>(span,<span class="dv">3</span>)),<span class="dt">col=</span>cols.,<span class="dt">lwd=</span><span class="fl">2.5</span>,<span class="dt">lty=</span><span class="dv">1</span><span class="op">:</span><span class="dv">6</span>)</code></pre></div>
<p><img src="cursoR_Euskaltel_files/figure-html/unnamed-chunk-3-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Un suavizado <em>kernel</em> es de la forma: <span class="math display">\[
\hat{y}_i = \frac{\sum_{j=1}^n y_i K\left( \frac{x_i-x_j}{b}\right)}{\sum_{j=1}^n K\left( \frac{x_i-x_j}{b}\right)},
\]</span> donde <span class="math inline">\(b\)</span> es un parámetro de <em>ancho de banda</em> (<em>bandwidth</em>), y <span class="math inline">\(K\)</span> una función del núcleo/<em>kernel</em>, como en la estimación de densidad. Hay diferentes opciones para el kernel <span class="math inline">\(K\)</span> (por ejemplo: Gaussian), el parámetro de elección crítico es el ancho de banda <em>b</em>.</p>
<p>En <code>R</code> la función <code>ksmooth</code> en <code>library(stats)</code> permite el suavizado tipo kernel (otras opciones son <code>locpoly</code> en <code>library(KernSmooth)</code>)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">attach</span>(lidar)
b &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">50</span>,<span class="dv">120</span>,<span class="dv">1000</span>)
<span class="kw">plot</span>(logratio<span class="op">~</span>range,<span class="dt">data=</span>lidar,<span class="dt">cex=</span>.<span class="dv">5</span>,<span class="dt">pch=</span><span class="dv">19</span>,<span class="dt">col=</span><span class="st">&quot;grey&quot;</span>,<span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">380</span>,<span class="dv">725</span>),<span class="dt">ylim=</span><span class="kw">c</span>(<span class="op">-</span><span class="fl">0.90</span>,<span class="fl">0.05</span>))
cols. &lt;-<span class="st"> </span><span class="kw">rainbow</span>(<span class="kw">length</span>(b))
<span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(b)){
  <span class="kw">lines</span>(<span class="kw">ksmooth</span>(range,logratio,<span class="dt">x.points=</span>range,<span class="st">&quot;normal&quot;</span>, <span class="dt">bandwidth=</span>b[i]),<span class="dt">col=</span>cols.[i],<span class="dt">lwd=</span><span class="fl">2.5</span>,<span class="dt">lty=</span>i)
}
<span class="kw">legend</span>(<span class="st">&quot;bottomleft&quot;</span>,<span class="kw">paste</span>(<span class="st">&quot;bandwidth = &quot;</span>,b),<span class="dt">col=</span>cols.,<span class="dt">lwd=</span><span class="fl">2.5</span>,<span class="dt">lty=</span><span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)</code></pre></div>
<p><img src="cursoR_Euskaltel_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
</div>
</div>
<div id="gams" class="section level2">
<h2><span class="header-section-number">8.2</span> GAMs</h2>
<p>Los GAMs (del inglés <em>generalized additive models</em>) son una generalización de los GLMs para incorporar formas no lineales de los predictores (plines, Polinomios, o funciones Step, etc…).</p>
<p><span class="math display">\[ y     \sim \mbox{ExpoFam}(\mu,\sigma^2,...)\]</span> <span class="math display">\[ \mu   = \mathbb{E}[y]\]</span> <span class="math display">\[ g(\mu)= \eta = \beta_0 + f(x_1) + f(x_2) + ... + f(x_p)\]</span></p>
<p>Ahora usamos las funciones <em>suaves</em> <span class="math inline">\(f(\cdot)\)</span> de nuestras variables predictoras, que pueden tomar formas más flexibles. Se supone que los valores observados son de alguna distribución de la familia exponencial, y <span class="math inline">\(\mu\)</span> está relacionado con los predictores a través de una función <em>enlace</em> (<em>o link</em>).</p>
<p>En este curso se estudiará la implementación de GAMs en <code>R</code> usando el paquete <code>mgcv</code> y funciones de base tipo spline.</p>
<p>Cargaremos la librería <code>mgcv</code>, y la función <code>gam</code>:</p>
<p>** La función <code>gam</code></p>
<p>La sintaxis es:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(mgcv)
fit.gam &lt;-<span class="st"> </span><span class="kw">gam</span>(y <span class="op">~</span><span class="st"> </span><span class="kw">s</span>(x))</code></pre></div>
<p>En general, la sintaxis es</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">gam</span>(formula,<span class="dt">method=</span><span class="st">&quot;...&quot;</span>,<span class="dt">select=</span><span class="st">&quot;...&quot;</span>,<span class="dt">family=</span><span class="kw">gaussian</span>())</code></pre></div>
<p>Los argumentos principales para esta función se deben especificar como una <code>formula</code>:</p>
<ul>
<li>La primera opción es la base utilizada para representar los términos suaves <code>s(x)</code> (ver <code>?s</code> o <code>?smooth.terms</code>). El tipo de función base se puede modificar utilizando <code>bs</code> dentro de <code>s(x,bs=&quot;ps&quot;)</code>:</li>
</ul>
<table>
<thead>
<tr class="header">
<th><strong><code>bs</code></strong></th>
<th><strong>Descripción</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>&quot;tp&quot;</code></td>
<td>Thin Plate Regression Splines</td>
</tr>
<tr class="even">
<td><code>&quot;ts&quot;</code></td>
<td>Thin Plate Regression Splines with Shrinkage</td>
</tr>
<tr class="odd">
<td><code>&quot;cr&quot;</code></td>
<td>Cubic regression spline</td>
</tr>
<tr class="even">
<td><code>&quot;crs&quot;</code></td>
<td>Cubic regression spline with Shrinkage</td>
</tr>
<tr class="odd">
<td><code>&quot;cc&quot;</code></td>
<td>Cyclic cubic regression spline</td>
</tr>
<tr class="even">
<td><code>&quot;ps&quot;</code></td>
<td>P-splines (ver <code>?p.spline</code>)</td>
</tr>
</tbody>
</table>
<p>El resto de argumentos es:</p>
<ul>
<li><code>m</code> El orden de la penalización.</li>
<li><code>k</code> la dimensión de la base utilizada para representar el término de suavizado. <code>k</code> debe ser mayor que <code>m</code>).</li>
<li><code>by</code> una variable numérica o factorial de la misma dimensión que cada covariable.</li>
<li><code>sp</code> cualquier parámetro de suavizado suministrado para el término de suavizado.</li>
<li>etc …</li>
</ul>
<p>Para más opciones ver <code>?gam</code>, i.e. <code>method</code> para la selección del parámetro de alisamiento (en general, los métodos basados en la verosimilitud/likelihood tienden a ser más robustos)</p>
<ul>
<li><code>method=</code> elegir entre <code>&quot;REML&quot;</code>, <code>&quot;ML&quot;</code> <code>&quot;GCV.Cp&quot;</code>, <code>&quot;GACV.Cp&quot;</code></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(fit.gam)</code></pre></div>
<p><code>gam.check</code> produce algunos gráficos de residuos básicos, y proporciona alguna información relacionada con el proceso de ajuste.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">gam.check</span>(fit.gam)</code></pre></div>
<p>Other residual plots should be examined, e.g.:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="kw">fitted</span>(fit.gam),<span class="kw">residuals</span>(fit.gam))</code></pre></div>
<div id="ejemplo-salarios" class="section level3">
<h3><span class="header-section-number">8.2.1</span> Ejemplo: Salarios</h3>
<p>Salarios y otros datos para un grupo de 3.000 trabajadores varones en la región del Atlántico Medio.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#ISLR package contains the &#39;Wage&#39; Dataset</span>
<span class="kw">require</span>(ISLR)
<span class="kw">attach</span>(Wage) <span class="co">#Mid-Atlantic Wage Data</span>
?Wage <span class="co"># To search more on the dataset</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(mgcv)</code></pre></div>
<pre><code>## Loading required package: nlme</code></pre>
<pre><code>## This is mgcv 1.8-27. For overview type &#39;help(&quot;mgcv-package&quot;)&#39;.</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gam1 &lt;-<span class="st"> </span><span class="kw">gam</span>(wage<span class="op">~</span><span class="kw">s</span>(age,<span class="dt">k=</span><span class="dv">6</span>)<span class="op">+</span><span class="kw">s</span>(year,<span class="dt">k=</span><span class="dv">6</span>)<span class="op">+</span>education,<span class="dt">data =</span> Wage)
<span class="kw">summary</span>(gam1)</code></pre></div>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## wage ~ s(age, k = 6) + s(year, k = 6) + education
## 
## Parametric coefficients:
##                             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)                   85.456      2.153  39.692  &lt; 2e-16 ***
## education2. HS Grad           10.978      2.428   4.521  6.4e-06 ***
## education3. Some College      23.530      2.558   9.197  &lt; 2e-16 ***
## education4. College Grad      38.159      2.543  15.005  &lt; 2e-16 ***
## education5. Advanced Degree   62.559      2.760  22.668  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##           edf Ref.df     F  p-value    
## s(age)  4.435  4.840 46.69  &lt; 2e-16 ***
## s(year) 1.101  1.195 11.11 0.000379 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =   0.29   Deviance explained = 29.2%
## GCV = 1240.7  Scale est. = 1236.3    n = 3000</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)) <span class="co">#to partition the Plotting Window</span>
<span class="kw">plot</span>(gam1,<span class="dt">se =</span> <span class="ot">TRUE</span>) </code></pre></div>
<p><img src="cursoR_Euskaltel_files/figure-html/unnamed-chunk-12-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Con <code>all.terms = TRUE</code> podemos representar la parte paramétrica:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))
<span class="kw">plot</span>(gam1,<span class="dt">all.terms=</span><span class="ot">TRUE</span>,<span class="dt">scheme=</span><span class="dv">1</span>)</code></pre></div>
<p><img src="cursoR_Euskaltel_files/figure-html/unnamed-chunk-13-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Recordemos que la librería <code>visreg</code> permite visualizar modelos de regresión:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(visreg)
<span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))
<span class="kw">visreg</span>(gam1)</code></pre></div>
<p><img src="cursoR_Euskaltel_files/figure-html/unnamed-chunk-14-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="modelos-semi-parametricos" class="section level2">
<h2><span class="header-section-number">8.3</span> Modelos semi-paramétricos</h2>
<p>Los modelos semi-paramétricos permiten combinar componentes lineales (paramétricos) y no paramétricos, por ejemplo:</p>
<p><span class="math display">\[
\boldsymbol{y} = \beta_0 + \beta_1\boldsymbol{x}_1 + ... + \beta_{j-1}\boldsymbol{x}_{j-1} + f(\boldsymbol{x}_j) + \boldsymbol{\epsilon} 
\]</span></p>
<p>El procedimiento de ajuste es el mismo que se muestra en las secciones anteriores. Simplemente los efectos paramétricos están incluidos en la parte de efectos fijos, <span class="math inline">\(\boldsymbol{X}\)</span>. Un caso interesado es cuando la parte paramétrica incluye una variable factorial con dos o más niveles. Como vimos en el caso lineal, podemos considerar diferentes situaciones: términos suaves paralelos (efecto aditivo) o términos suaves no paralelos (efecto de interacción). Además, podemos considerar la misma cantidad de alisamiento o una cantidad diferente.</p>
<p><strong>Datos de cebollas</strong></p>
<p>Para ilustrar un caso simple de un modelo semi-paramétrico, consideramos los <code>data(onions)</code> en la <code>library(SemiPar)</code>. Los datos consisten en 84 observaciones de un experimento que involucra la producción de cebollas en dos localidades del sur de Australia. Las variables son:</p>
<ul>
<li><p><code>dens</code> densidad de área de las plantas (plantas por metro cuadrado)</p></li>
<li><p><code>yield</code> rendimiento de la cebolla (gramos por planta).</p></li>
<li><p><code>location</code> localización: <code>0=Purnong Landing</code>, <code>1=Virginia</code>.</p></li>
</ul>
<p>La siguiente figura muestra que para una mayor densidad de plantas el rendimiento de Purnong Landing de onios es mayor.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(SemiPar)
<span class="kw">data</span>(onions)
<span class="kw">attach</span>(onions)
points.cols &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;red&quot;</span>,<span class="st">&quot;blue&quot;</span>)
<span class="kw">plot</span>(dens,<span class="kw">log</span>(yield),<span class="dt">col=</span>points.cols[location<span class="op">+</span><span class="dv">1</span>],<span class="dt">pch=</span><span class="dv">16</span>)
<span class="kw">legend</span>(<span class="st">&quot;topright&quot;</span>,<span class="kw">c</span>(<span class="st">&quot;Purnong Landing&quot;</span>,<span class="st">&quot;Virginia&quot;</span>),<span class="dt">col=</span>points.cols,<span class="dt">pch=</span><span class="kw">rep</span>(<span class="dv">16</span>,<span class="dv">2</span>))</code></pre></div>
<p><img src="cursoR_Euskaltel_files/figure-html/unnamed-chunk-15-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>El modelo lineal es:</p>
<p><span class="math display">\[
\log(\text{yield}_i) = \beta_0 + \beta_1\text{location}_{ij} + \beta_2 \text{dens}_i + \epsilon_i
\]</span></p>
<p>donde</p>
<p><span class="math display">\[
\text{location}_{ij} = 
\left\{
\begin{array}{cl}
0 &amp; \mbox{si la $i$-ésima observación es de Purnong Landing} \\
1 &amp; \mbox{si la $i$-ésima observación es de Virginia}
\end{array}
\right.
\]</span></p>
<p>La figura sugiere un término no lineal para <code>dens</code>, por lo tanto, un modelo mejor sería:</p>
<p><span class="math display">\[
\log(\text{yield}_i) = \beta_0 + \beta_1\text{location}_{ij} + f(\text{dens}_i) + \epsilon_i
\]</span></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># create a factor for location</span>
L &lt;-<span class="st"> </span><span class="kw">factor</span>(location)

<span class="kw">levels</span>(L) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Purnong Landing&quot;</span>,<span class="st">&quot;Virginia&quot;</span>)

<span class="co"># fit a gam with location factor</span>
fit1 &lt;-<span class="st"> </span><span class="kw">gam</span>(<span class="kw">log</span>(yield) <span class="op">~</span><span class="st"> </span>L <span class="op">+</span><span class="st"> </span><span class="kw">s</span>(dens,<span class="dt">k=</span><span class="dv">20</span>,<span class="dt">m=</span><span class="dv">2</span>,<span class="dt">bs=</span><span class="st">&quot;ps&quot;</span>), 
            <span class="dt">method=</span><span class="st">&quot;REML&quot;</span>, <span class="dt">select=</span><span class="ot">TRUE</span>)

<span class="kw">summary</span>(fit1)</code></pre></div>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## log(yield) ~ L + s(dens, k = 20, m = 2, bs = &quot;ps&quot;)
## 
## Parametric coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  4.85011    0.01688  287.39   &lt;2e-16 ***
## LVirginia   -0.33284    0.02409  -13.82   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##           edf Ref.df     F p-value    
## s(dens) 4.568     19 72.76  &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  0.946   Deviance explained = 94.9%
## -REML = -54.242  Scale est. = 0.011737  n = 84</code></pre>
<p>La siguiente figura muestra las curvas ajustadas para cada ubicación con el modelo <code>fit1</code>, asumimos que ambas curvas son paralelas.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">L.P &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="kw">levels</span>(L)[<span class="dv">1</span>],<span class="dv">100</span>)
L.V &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="kw">levels</span>(L)[<span class="dv">2</span>],<span class="dv">100</span>)
dens.g &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="kw">min</span>(dens),<span class="kw">max</span>(dens),<span class="dt">l=</span><span class="dv">100</span>)
fit1.P &lt;-<span class="st"> </span><span class="kw">predict</span>(fit1,<span class="dt">newdata=</span><span class="kw">data.frame</span>(<span class="dt">L=</span>L.P,<span class="dt">dens=</span>dens.g),<span class="dt">se.fit=</span><span class="ot">TRUE</span>)
fit1.V &lt;-<span class="st"> </span><span class="kw">predict</span>(fit1,<span class="dt">newdata=</span><span class="kw">data.frame</span>(<span class="dt">L=</span>L.V,<span class="dt">dens=</span>dens.g),<span class="dt">se.fit=</span><span class="ot">TRUE</span>)

<span class="kw">plot</span>(dens,<span class="kw">log</span>(yield),<span class="dt">col=</span>points.cols[location<span class="op">+</span><span class="dv">1</span>],<span class="dt">pch=</span><span class="dv">16</span>,<span class="dt">cex=</span>.<span class="dv">55</span>)
<span class="kw">lines</span>(dens.g,fit1.P<span class="op">$</span>fit,<span class="dt">col=</span><span class="dv">2</span>,<span class="dt">lwd=</span><span class="dv">2</span>)
<span class="kw">lines</span>(dens.g,fit1.P<span class="op">$</span>fit<span class="op">+</span><span class="fl">1.96</span><span class="op">*</span>fit1.P<span class="op">$</span>se.fit,<span class="dt">col=</span><span class="dv">2</span>,<span class="dt">lwd=</span><span class="dv">2</span>,<span class="dt">lty=</span><span class="dv">2</span>)
<span class="kw">lines</span>(dens.g,fit1.P<span class="op">$</span>fit<span class="op">-</span><span class="fl">1.96</span><span class="op">*</span>fit1.P<span class="op">$</span>se.fit,<span class="dt">col=</span><span class="dv">2</span>,<span class="dt">lwd=</span><span class="dv">2</span>,<span class="dt">lty=</span><span class="dv">2</span>)
<span class="kw">lines</span>(dens.g,fit1.V<span class="op">$</span>fit,<span class="dt">col=</span><span class="dv">4</span>,<span class="dt">lwd=</span><span class="dv">2</span>)
<span class="kw">lines</span>(dens.g,fit1.V<span class="op">$</span>fit<span class="op">+</span><span class="fl">1.96</span><span class="op">*</span>fit1.V<span class="op">$</span>se.fit,<span class="dt">col=</span><span class="dv">4</span>,<span class="dt">lwd=</span><span class="dv">2</span>,<span class="dt">lty=</span><span class="dv">2</span>)
<span class="kw">lines</span>(dens.g,fit1.V<span class="op">$</span>fit<span class="op">-</span><span class="fl">1.96</span><span class="op">*</span>fit1.V<span class="op">$</span>se.fit,<span class="dt">col=</span><span class="dv">4</span>,<span class="dt">lwd=</span><span class="dv">2</span>,<span class="dt">lty=</span><span class="dv">2</span>)</code></pre></div>
<p><img src="cursoR_Euskaltel_files/figure-html/unnamed-chunk-17-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Asumir curvas paralelas para ambas localizaciones implica que la disminución del rendimiento a medida que aumenta la densidad es la misma en ambas localizaciones. En lugar de ajustar un modelo de efectos aditivos, podemos ajustar un modelo de efectos con interacción, como por ejemplo:</p>
<p><span class="math display">\[
\log(\text{yield}_i) =\beta_0 + \beta_1 \beta_1\text{location}_{ij} +  f(\text{dens}_i)_{L(j)} + \epsilon_i
\]</span></p>
<p>donde</p>
<p><span class="math display">\[
L(j) = 
\left\{
\begin{array}{cl}
0 &amp; \mbox{si la $i$-ésima observación es de Purnong Landing} \\
1 &amp; \mbox{si la $i$-ésima observación es de Virginia}
\end{array}
\right.
\]</span></p>
<p>El opción <code>by=</code> dentro de <code>s()</code> permite incluir interacciones curva factor:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fit2 &lt;-<span class="st"> </span><span class="kw">gam</span>(<span class="kw">log</span>(yield) <span class="op">~</span><span class="st"> </span>L <span class="op">+</span><span class="st"> </span><span class="kw">s</span>(dens,<span class="dt">k=</span><span class="dv">20</span>,<span class="dt">m=</span><span class="dv">2</span>,<span class="dt">bs=</span><span class="st">&quot;ps&quot;</span>,<span class="dt">by=</span>L), 
            <span class="dt">method=</span><span class="st">&quot;REML&quot;</span>, <span class="dt">select=</span><span class="ot">TRUE</span>)
<span class="kw">summary</span>(fit2)</code></pre></div>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## log(yield) ~ L + s(dens, k = 20, m = 2, bs = &quot;ps&quot;, by = L)
## 
## Parametric coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  4.84407    0.01603  302.12   &lt;2e-16 ***
## LVirginia   -0.33003    0.02271  -14.54   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##                            edf Ref.df     F p-value    
## s(dens):LPurnong Landing 3.097     18 37.62  &lt;2e-16 ***
## s(dens):LVirginia        4.728     17 52.10  &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  0.952   Deviance explained = 95.7%
## -REML = -53.616  Scale est. = 0.01045   n = 84</code></pre>
<p>Which model is better?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">AIC</span>(fit1)</code></pre></div>
<pre><code>## [1] -125.2307</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">AIC</span>(fit2)</code></pre></div>
<pre><code>## [1] -131.1844</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fit1<span class="op">$</span>sp</code></pre></div>
<pre><code>##     s(dens)1     s(dens)2 
## 164.66124239   0.00147493</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fit2<span class="op">$</span>sp</code></pre></div>
<pre><code>## s(dens):LPurnong Landing1 s(dens):LPurnong Landing2 
##              4.264039e+02              1.604648e-03 
##        s(dens):LVirginia1        s(dens):LVirginia2 
##              6.437458e+01              1.053443e-03</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plot the smooth effects </span>
<span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))
<span class="kw">plot</span>(fit2, <span class="dt">se=</span><span class="ot">TRUE</span>)

<span class="co"># In the same plot</span>
fit2.P &lt;-<span class="st"> </span><span class="kw">predict</span>(fit2,<span class="dt">newdata=</span><span class="kw">data.frame</span>(<span class="dt">L=</span>L.P,<span class="dt">dens=</span>dens.g),<span class="dt">se.fit=</span><span class="ot">TRUE</span>)
fit2.V &lt;-<span class="st"> </span><span class="kw">predict</span>(fit2,<span class="dt">newdata=</span><span class="kw">data.frame</span>(<span class="dt">L=</span>L.V,<span class="dt">dens=</span>dens.g),<span class="dt">se.fit=</span><span class="ot">TRUE</span>)

<span class="kw">plot</span>(dens,<span class="kw">log</span>(yield),<span class="dt">col=</span>points.cols[location<span class="op">+</span><span class="dv">1</span>],<span class="dt">pch=</span><span class="dv">16</span>,<span class="dt">cex=</span>.<span class="dv">55</span>)
<span class="kw">lines</span>(dens.g,fit2.P<span class="op">$</span>fit,<span class="dt">col=</span><span class="dv">2</span>,<span class="dt">lwd=</span><span class="dv">2</span>)
<span class="kw">lines</span>(dens.g,fit2.P<span class="op">$</span>fit<span class="op">+</span><span class="fl">1.96</span><span class="op">*</span>fit1.P<span class="op">$</span>se.fit,<span class="dt">col=</span><span class="dv">2</span>,<span class="dt">lwd=</span><span class="dv">2</span>,<span class="dt">lty=</span><span class="dv">2</span>)
<span class="kw">lines</span>(dens.g,fit2.P<span class="op">$</span>fit<span class="op">-</span><span class="fl">1.96</span><span class="op">*</span>fit1.P<span class="op">$</span>se.fit,<span class="dt">col=</span><span class="dv">2</span>,<span class="dt">lwd=</span><span class="dv">2</span>,<span class="dt">lty=</span><span class="dv">2</span>)
<span class="kw">lines</span>(dens.g,fit2.V<span class="op">$</span>fit,<span class="dt">col=</span><span class="dv">4</span>,<span class="dt">lwd=</span><span class="dv">2</span>)
<span class="kw">lines</span>(dens.g,fit2.V<span class="op">$</span>fit<span class="op">+</span><span class="fl">1.96</span><span class="op">*</span>fit2.V<span class="op">$</span>se.fit,<span class="dt">col=</span><span class="dv">4</span>,<span class="dt">lwd=</span><span class="dv">2</span>,<span class="dt">lty=</span><span class="dv">2</span>)
<span class="kw">lines</span>(dens.g,fit2.V<span class="op">$</span>fit<span class="op">-</span><span class="fl">1.96</span><span class="op">*</span>fit2.V<span class="op">$</span>se.fit,<span class="dt">col=</span><span class="dv">4</span>,<span class="dt">lwd=</span><span class="dv">2</span>,<span class="dt">lty=</span><span class="dv">2</span>)</code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-20"></span>
<img src="cursoR_Euskaltel_files/figure-html/unnamed-chunk-20-1.png" alt="*Fitted curves by location*" width="768" />
<p class="caption">
Figure 8.1: <em>Fitted curves by location</em>
</p>
</div>
<div id="ejemplo" class="section level3">
<h3><span class="header-section-number">8.3.1</span> Ejemplo:</h3>
<p>Continuémos con el ejemplo <code>Wage</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gam2 &lt;-<span class="st"> </span><span class="kw">gam</span>(wage <span class="op">~</span><span class="st"> </span>jobclass <span class="op">+</span><span class="st"> </span><span class="kw">s</span>(age,<span class="dt">k=</span><span class="dv">6</span>)<span class="op">+</span><span class="kw">s</span>(year,<span class="dt">k=</span><span class="dv">6</span>)<span class="op">+</span>education,<span class="dt">data =</span> Wage)
gam3 &lt;-<span class="st"> </span><span class="kw">gam</span>(wage <span class="op">~</span><span class="st"> </span>jobclass <span class="op">+</span><span class="st"> </span><span class="kw">s</span>(age,<span class="dt">by=</span>jobclass,<span class="dt">k=</span><span class="dv">6</span>)<span class="op">+</span><span class="kw">s</span>(year,<span class="dt">k=</span><span class="dv">6</span>)<span class="op">+</span>education,<span class="dt">data =</span> Wage)
<span class="kw">summary</span>(gam2)</code></pre></div>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## wage ~ jobclass + s(age, k = 6) + s(year, k = 6) + education
## 
## Parametric coefficients:
##                             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)                   84.184      2.186  38.511  &lt; 2e-16 ***
## jobclass2. Information         4.317      1.352   3.193  0.00142 ** 
## education2. HS Grad           10.751      2.426   4.432 9.67e-06 ***
## education3. Some College      22.741      2.567   8.861  &lt; 2e-16 ***
## education4. College Grad      36.847      2.572  14.325  &lt; 2e-16 ***
## education5. Advanced Degree   60.594      2.824  21.458  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##           edf Ref.df     F p-value    
## s(age)  4.408  4.825 45.57 &lt; 2e-16 ***
## s(year) 1.000  1.000 14.29 0.00016 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  0.292   Deviance explained = 29.5%
## GCV = 1237.3  Scale est. = 1232.6    n = 3000</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(gam3)</code></pre></div>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## wage ~ jobclass + s(age, by = jobclass, k = 6) + s(year, k = 6) + 
##     education
## 
## Parametric coefficients:
##                             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)                   84.039      2.186  38.453  &lt; 2e-16 ***
## jobclass2. Information         4.284      1.352   3.169  0.00154 ** 
## education2. HS Grad           10.733      2.425   4.427  9.9e-06 ***
## education3. Some College      22.796      2.564   8.892  &lt; 2e-16 ***
## education4. College Grad      36.940      2.571  14.367  &lt; 2e-16 ***
## education5. Advanced Degree   60.621      2.822  21.482  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##                                 edf Ref.df     F  p-value    
## s(age):jobclass1. Industrial  2.980  3.607 33.95  &lt; 2e-16 ***
## s(age):jobclass2. Information 4.551  4.901 20.27  &lt; 2e-16 ***
## s(year)                       1.000  1.000 14.27 0.000162 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  0.293   Deviance explained = 29.6%
## GCV = 1237.2  Scale est. = 1231.3    n = 3000</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))
<span class="kw">plot</span>(gam2,<span class="dt">all.terms=</span><span class="ot">TRUE</span>,<span class="dt">scheme=</span><span class="dv">1</span>)</code></pre></div>
<p><img src="cursoR_Euskaltel_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(gam3,<span class="dt">all.terms=</span><span class="ot">TRUE</span>,<span class="dt">scheme=</span><span class="dv">1</span>)</code></pre></div>
<p><img src="cursoR_Euskaltel_files/figure-html/unnamed-chunk-21-2.png" width="672" /><img src="cursoR_Euskaltel_files/figure-html/unnamed-chunk-21-3.png" width="672" /></p>
<p><strong>Ejercicio:</strong> Selecciona un modelo GAM.</p>
</div>
</div>
<div id="ejemplo-calidad-del-aire" class="section level2">
<h2><span class="header-section-number">8.4</span> Ejemplo: Calidad del Aire</h2>
<p>Revisemos los datos <code>?airquality</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(airquality)
<span class="kw">pairs</span>(airquality, <span class="dt">panel =</span> panel.smooth)</code></pre></div>
<p><img src="cursoR_Euskaltel_files/figure-html/unnamed-chunk-22-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Una simple gráfica de dispersión muestra que algunas de las variables tienen una relación no lineal.</p>
<p>Consideremos un modelo lineal para la variable de respuesta <code>Ozone</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">airq.lm &lt;-<span class="st"> </span><span class="kw">lm</span>(Ozone <span class="op">~</span><span class="st"> </span>Temp <span class="op">+</span><span class="st"> </span>Wind <span class="op">+</span><span class="st"> </span>Solar.R, <span class="dt">data=</span>airquality)
<span class="kw">summary</span>(airq.lm)</code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Ozone ~ Temp + Wind + Solar.R, data = airquality)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -40.485 -14.219  -3.551  10.097  95.619 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -64.34208   23.05472  -2.791  0.00623 ** 
## Temp          1.65209    0.25353   6.516 2.42e-09 ***
## Wind         -3.33359    0.65441  -5.094 1.52e-06 ***
## Solar.R       0.05982    0.02319   2.580  0.01124 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 21.18 on 107 degrees of freedom
##   (42 observations deleted due to missingness)
## Multiple R-squared:  0.6059, Adjusted R-squared:  0.5948 
## F-statistic: 54.83 on 3 and 107 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>Veamos los resultados gráficamente:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))
<span class="kw">termplot</span>(airq.lm,<span class="dt">se=</span><span class="ot">TRUE</span>)</code></pre></div>
<p><img src="cursoR_Euskaltel_files/figure-html/unnamed-chunk-24-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>También podemos graficar los residuos del modelo para comprobar las hipótesis del modelo.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))
<span class="kw">plot</span>(airq.lm,<span class="dt">which=</span><span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)</code></pre></div>
<p><img src="cursoR_Euskaltel_files/figure-html/unnamed-chunk-25-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>La falta de normalidad en los residuos se debe a la asimetría de la variable de respuesta <code>Ozone</code>, podemos aplicar una transformación <code>log</code> para conseguir asimetría, es decir:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))
<span class="kw">hist</span>(airquality<span class="op">$</span>Ozone, <span class="dt">main=</span><span class="st">&quot;Ozone&quot;</span>)
<span class="kw">hist</span>(<span class="kw">log</span>(airquality<span class="op">$</span>Ozone), <span class="dt">main =</span><span class="st">&quot;log(Ozone)&quot;</span>)</code></pre></div>
<p><img src="cursoR_Euskaltel_files/figure-html/unnamed-chunk-26-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Ahora podemos ajustar un modelo lineal del <span class="math inline">\(\log(Ozono)\)</span>, ¿el modelo se ve más adecuado?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lairq.lm &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">log</span>(Ozone)<span class="op">~</span><span class="st"> </span>Temp <span class="op">+</span><span class="st"> </span>Wind <span class="op">+</span><span class="st"> </span>Solar.R, <span class="dt">data=</span>airquality)
<span class="kw">summary</span>(lairq.lm)</code></pre></div>
<pre><code>## 
## Call:
## lm(formula = log(Ozone) ~ Temp + Wind + Solar.R, data = airquality)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -2.06193 -0.29970 -0.00231  0.30756  1.23578 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -0.2621323  0.5535669  -0.474 0.636798    
## Temp         0.0491711  0.0060875   8.077 1.07e-12 ***
## Wind        -0.0615625  0.0157130  -3.918 0.000158 ***
## Solar.R      0.0025152  0.0005567   4.518 1.62e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.5086 on 107 degrees of freedom
##   (42 observations deleted due to missingness)
## Multiple R-squared:  0.6644, Adjusted R-squared:  0.655 
## F-statistic: 70.62 on 3 and 107 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(lairq.lm)</code></pre></div>
<p><img src="cursoR_Euskaltel_files/figure-html/unnamed-chunk-27-1.png" width="672" /><img src="cursoR_Euskaltel_files/figure-html/unnamed-chunk-27-2.png" width="672" /><img src="cursoR_Euskaltel_files/figure-html/unnamed-chunk-27-3.png" width="672" /><img src="cursoR_Euskaltel_files/figure-html/unnamed-chunk-27-4.png" width="672" /></p>
<p>Ajustando un modelo lineal podemos concluir que puede haber alguna heterokedasticidad que no se tenga en cuenta en el modelo. Sin embargo, la causa más posible es que la relación entre la variable de respuesta y las covariables está lejos de ser lineal.</p>
<p>Ajustemos un modelo GAM, en primer lugar con una sola variable, es decir:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(mgcv)
airq.gam1 &lt;-<span class="st"> </span><span class="kw">gam</span>(<span class="kw">log</span>(Ozone) <span class="op">~</span><span class="st"> </span><span class="kw">s</span>(Wind,<span class="dt">bs=</span><span class="st">&quot;ps&quot;</span>,<span class="dt">m=</span><span class="dv">2</span>,<span class="dt">k=</span><span class="dv">10</span>), 
                 <span class="dt">method=</span><span class="st">&quot;REML&quot;</span>, <span class="dt">select=</span><span class="ot">TRUE</span>,<span class="dt">data=</span>airquality)
<span class="kw">summary</span>(airq.gam1)</code></pre></div>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## log(Ozone) ~ s(Wind, bs = &quot;ps&quot;, m = 2, k = 10)
## 
## Parametric coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   3.4185     0.0655   52.19   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##           edf Ref.df     F  p-value    
## s(Wind) 2.565      9 6.453 2.76e-12 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  0.336   Deviance explained =   35%
## -REML = 128.69  Scale est. = 0.49769   n = 116</code></pre>
<p>Los resultados muestran que el efecto suave <code>s(Wind)</code> es significativo (con un valor aproximado de <span class="math inline">\(p\)</span> cercano a cero y <code>edf</code> <span class="math inline">\(2.56\)</span>). La siguiente figura muestra el efecto de viento suave. El incremento de la velocidad del viento disminuye los niveles de ozono (dramáticamente hasta 10mph). Tener en cuenta que incluyendo el intercepto, los efectos suaves se centran en cero.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(airq.gam1,<span class="dt">residuals=</span><span class="ot">TRUE</span>,<span class="dt">scheme=</span><span class="dv">1</span>)</code></pre></div>
<p><img src="cursoR_Euskaltel_files/figure-html/unnamed-chunk-29-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">gam.check</span>(airq.gam1)</code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-30"></span>
<img src="cursoR_Euskaltel_files/figure-html/unnamed-chunk-30-1.png" alt="*Check plots by `gam.check`*" width="768" />
<p class="caption">
Figure 8.2: <em>Check plots by <code>gam.check</code></em>
</p>
</div>
<pre><code>## 
## Method: REML   Optimizer: outer newton
## full convergence after 8 iterations.
## Gradient range [-1.455961e-06,1.183099e-06]
## (score 128.6926 &amp; scale 0.4976891).
## Hessian positive definite, eigenvalue range [0.4379927,57.51548].
## Model rank =  10 / 10 
## 
## Basis dimension (k) checking results. Low p-value (k-index&lt;1) may
## indicate that k is too low, especially if edf is close to k&#39;.
## 
##           k&#39;  edf k-index p-value    
## s(Wind) 9.00 2.56    0.69  &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Nótese que, en el modelo <code>airq.gam1</code> usamos <code>k=10</code> nodos, la variable <code>Wind</code> tiene valores únicos de <span class="math inline">\(31\)</span>, y por lo tanto 10 nodos deberían ser suficientes. Ajustamos un modelo para los residuos del modelo gam ajustado</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">resids &lt;-<span class="st"> </span><span class="kw">residuals</span>(airq.gam1)
resids.gam &lt;-<span class="st"> </span><span class="kw">gam</span>(resids<span class="op">~</span><span class="kw">s</span>(Wind,<span class="dt">k=</span><span class="dv">20</span>,<span class="dt">m=</span><span class="dv">2</span>),<span class="dt">method=</span><span class="st">&quot;REML&quot;</span>,
                  <span class="dt">select=</span><span class="ot">TRUE</span>,<span class="dt">data=</span>airq.gam1<span class="op">$</span>model)
<span class="kw">summary</span>(resids.gam)</code></pre></div>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## resids ~ s(Wind, k = 20, m = 2)
## 
## Parametric coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept) 1.137e-15  6.477e-02       0        1
## 
## Approximate significance of smooth terms:
##               edf Ref.df F p-value
## s(Wind) 7.419e-05     19 0       1
## 
## R-sq.(adj) =  -5.66e-07   Deviance explained = 7.89e-06%
## -REML = 124.14  Scale est. = 0.48659   n = 116</code></pre>
<p>Los resultados muestran que no hay una variabilidad no-explicada entre la variable y los residuos. Por lo tanto, podemos concluir que no necesitamos más nodos. La siguiente figura apoya esta afirmación.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(resids.gam)</code></pre></div>
<p><img src="cursoR_Euskaltel_files/figure-html/unnamed-chunk-32-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Ahora añadimos la funcion <code>Temp</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">airq.gam2 &lt;-<span class="st"> </span><span class="kw">gam</span>(<span class="kw">log</span>(Ozone)<span class="op">~</span><span class="kw">s</span>(Wind,<span class="dt">bs=</span><span class="st">&quot;ps&quot;</span>,<span class="dt">m=</span><span class="dv">2</span>,<span class="dt">k=</span><span class="dv">10</span>)<span class="op">+</span><span class="kw">s</span>(Temp,<span class="dt">bs=</span><span class="st">&quot;ps&quot;</span>,<span class="dt">m=</span><span class="dv">2</span>,<span class="dt">k=</span><span class="dv">10</span>),
                 <span class="dt">method=</span><span class="st">&quot;REML&quot;</span>,<span class="dt">select=</span><span class="ot">TRUE</span>,<span class="dt">data=</span>airquality)
<span class="kw">summary</span>(airq.gam2)</code></pre></div>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## log(Ozone) ~ s(Wind, bs = &quot;ps&quot;, m = 2, k = 10) + s(Temp, bs = &quot;ps&quot;, 
##     m = 2, k = 10)
## 
## Parametric coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  3.41852    0.04963   68.89   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##           edf Ref.df      F  p-value    
## s(Wind) 2.068      9  1.353 0.000981 ***
## s(Temp) 3.990      9 10.496  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  0.619   Deviance explained = 63.9%
## -REML = 101.64  Scale est. = 0.28568   n = 116</code></pre>
<p>Por tanto el efecto de <code>Temp</code> es significativo.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))
<span class="kw">plot</span>(airq.gam2,<span class="dt">residuals=</span><span class="ot">TRUE</span>,<span class="dt">scheme=</span><span class="dv">1</span>)</code></pre></div>
<p><img src="cursoR_Euskaltel_files/figure-html/unnamed-chunk-34-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Podemos comparar ambos modelos utilizando la función <code>anova</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">anova</span>(airq.gam1,airq.gam2)</code></pre></div>
<pre><code>## Analysis of Deviance Table
## 
## Model 1: log(Ozone) ~ s(Wind, bs = &quot;ps&quot;, m = 2, k = 10)
## Model 2: log(Ozone) ~ s(Wind, bs = &quot;ps&quot;, m = 2, k = 10) + s(Temp, bs = &quot;ps&quot;, 
##     m = 2, k = 10)
##   Resid. Df Resid. Dev     Df Deviance
## 1    111.16     55.958                
## 2    105.98     31.123 5.1832   24.835</code></pre>
<p>Podemos también comparar el criterio AIC:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">AIC</span>(airq.gam1)</code></pre></div>
<pre><code>## [1] 255.0315</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">AIC</span>(airq.gam2)</code></pre></div>
<pre><code>## [1] 195.6561</code></pre>
<p>Incluimos la variable <code>Solar.R</code> que contiene valores faltantes (<code>NA</code>’s).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sum</span>(<span class="kw">is.na</span>(airquality<span class="op">$</span>Solar.R))</code></pre></div>
<pre><code>## [1] 7</code></pre>
<p>Para comparar el modelo anterior <code>airq.gam2</code> y el nuevo modelo que incluye <code>Solar.R</code> utilizaremos los mismos datos, por lo que omitiremos los valores que faltan y volveremos a ajustar los modelos.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">new.airquality &lt;-<span class="st"> </span><span class="kw">na.omit</span>(airquality)

airq.gam22=<span class="kw">gam</span>(<span class="kw">log</span>(Ozone)<span class="op">~</span><span class="kw">s</span>(Wind,<span class="dt">bs=</span><span class="st">&quot;ps&quot;</span>,<span class="dt">m=</span><span class="dv">2</span>,<span class="dt">k=</span><span class="dv">10</span>)<span class="op">+</span><span class="kw">s</span>(Temp,<span class="dt">bs=</span><span class="st">&quot;ps&quot;</span>,<span class="dt">m=</span><span class="dv">2</span>,<span class="dt">k=</span><span class="dv">10</span>),
               <span class="dt">method=</span><span class="st">&quot;REML&quot;</span>,<span class="dt">select=</span><span class="ot">TRUE</span>,<span class="dt">data=</span>new.airquality)

airq.gam3=<span class="kw">gam</span>(<span class="kw">log</span>(Ozone)<span class="op">~</span><span class="kw">s</span>(Wind,<span class="dt">bs=</span><span class="st">&quot;ps&quot;</span>,<span class="dt">m=</span><span class="dv">2</span>,<span class="dt">k=</span><span class="dv">10</span>)<span class="op">+</span><span class="kw">s</span>(Temp,<span class="dt">bs=</span><span class="st">&quot;ps&quot;</span>,<span class="dt">m=</span><span class="dv">2</span>,<span class="dt">k=</span><span class="dv">10</span>)<span class="op">+</span><span class="kw">s</span>(Solar.R,<span class="dt">bs=</span><span class="st">&quot;ps&quot;</span>,<span class="dt">m=</span><span class="dv">2</span>,<span class="dt">k=</span><span class="dv">20</span>),
              <span class="dt">method=</span><span class="st">&quot;REML&quot;</span>,<span class="dt">select=</span><span class="ot">TRUE</span>,<span class="dt">data=</span>new.airquality)

<span class="kw">summary</span>(airq.gam22)</code></pre></div>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## log(Ozone) ~ s(Wind, bs = &quot;ps&quot;, m = 2, k = 10) + s(Temp, bs = &quot;ps&quot;, 
##     m = 2, k = 10)
## 
## Parametric coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  3.41593    0.05128   66.61   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##            edf Ref.df     F  p-value    
## s(Wind) 2.1879      9 1.919    1e-04 ***
## s(Temp) 0.9874      9 8.601 7.73e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  0.611   Deviance explained = 62.2%
## -REML = 95.215  Scale est. = 0.29194   n = 111</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(airq.gam3)</code></pre></div>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## log(Ozone) ~ s(Wind, bs = &quot;ps&quot;, m = 2, k = 10) + s(Temp, bs = &quot;ps&quot;, 
##     m = 2, k = 10) + s(Solar.R, bs = &quot;ps&quot;, m = 2, k = 20)
## 
## Parametric coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  3.41593    0.04586   74.49   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##              edf Ref.df     F  p-value    
## s(Wind)    2.318      9 2.255 2.44e-05 ***
## s(Temp)    1.852      9 6.128 1.12e-12 ***
## s(Solar.R) 2.145     19 1.397 1.23e-06 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  0.689   Deviance explained = 70.7%
## -REML = 86.106  Scale est. = 0.23342   n = 111</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">AIC</span>(airq.gam22)</code></pre></div>
<pre><code>## [1] 185.7769</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">AIC</span>(airq.gam3)</code></pre></div>
<pre><code>## [1] 166.0423</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))
<span class="kw">plot</span>(airq.gam3,<span class="dt">residuals=</span><span class="ot">TRUE</span>)</code></pre></div>
<p><img src="cursoR_Euskaltel_files/figure-html/unnamed-chunk-39-1.png" width="672" style="display: block; margin: auto;" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="regresion-logistica.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="analisis-de-componentes-principales-clasificacion-y-clustering.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"download": ["cursoR_Euskaltel.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
