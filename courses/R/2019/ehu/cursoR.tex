\documentclass[]{book}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
\else % if luatex or xelatex
  \ifxetex
    \usepackage{mathspec}
  \else
    \usepackage{fontspec}
  \fi
  \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
\fi
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{%
\usepackage{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\usepackage{hyperref}
\hypersetup{unicode=true,
            pdftitle={Introducción al software estadístico R},
            pdfauthor={Dae-Jin Lee \textless{} dlee@bcamath.org \textgreater{}},
            pdfborder={0 0 0},
            breaklinks=true}
\urlstyle{same}  % don't use monospace font for urls
\usepackage{natbib}
\bibliographystyle{apalike}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\usepackage{longtable,booktabs}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
\IfFileExists{parskip.sty}{%
\usepackage{parskip}
}{% else
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
% Redefines (sub)paragraphs to behave more like sections
\ifx\paragraph\undefined\else
\let\oldparagraph\paragraph
\renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
\let\oldsubparagraph\subparagraph
\renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

%%% Use protect on footnotes to avoid problems with footnotes in titles
\let\rmarkdownfootnote\footnote%
\def\footnote{\protect\rmarkdownfootnote}

%%% Change title format to be more compact
\usepackage{titling}

% Create subtitle command for use in maketitle
\providecommand{\subtitle}[1]{
  \posttitle{
    \begin{center}\large#1\end{center}
    }
}

\setlength{\droptitle}{-2em}

  \title{Introducción al software estadístico \texttt{R}}
    \pretitle{\vspace{\droptitle}\centering\huge}
  \posttitle{\par}
    \author{Dae-Jin Lee \textless{}
\href{mailto:dlee@bcamath.org}{\nolinkurl{dlee@bcamath.org}}
\textgreater{}}
    \preauthor{\centering\large\emph}
  \postauthor{\par}
      \predate{\centering\large\emph}
  \postdate{\par}
    \date{Noviembre 2019}

\usepackage{booktabs}
\usepackage[spanish]{babel}
\usepackage{amsthm}
\makeatletter
\def\thm@space@setup{%
  \thm@preskip=8pt plus 2pt minus 4pt
  \thm@postskip=\thm@preskip
}
\makeatother

\begin{document}
\maketitle

{
\setcounter{tocdepth}{1}
\tableofcontents
}
\chapter{Información y
pre-requisitos}\label{informaciuxf3n-y-pre-requisitos}

\begin{itemize}
\item
  \textbf{Requisitos:}

  \begin{itemize}
  \tightlist
  \item
    Última versión del software \texttt{R} (https://www.r-project.org)
  \item
    \texttt{Rstudio} (https://www.rstudio.com).
  \end{itemize}
\end{itemize}

~

~

\begin{itemize}
\tightlist
\item
  \textbf{Objetivos del curso}
\end{itemize}

El curso proporcionará conocimientos básicos y habilidades para utilizar
el software estadístico \texttt{R} como entorno de trabajo y análisis de
datos. Para ello, el curso ofrecerá una visión general de las
herramientas ofrecidas por \texttt{R}, por ejemplo, desde el manejo de
matrices y conjuntos de datos, a representaciones gráficas, pruebas y
análisis estadísticos, programación en \texttt{R} y técnicas de
modelización estadística y aprendizaje automático.

El objetivo es que al final del curso todos se hayan familiarizado con
el software estadístico \texttt{R}.

~

\begin{itemize}
\item
  \textbf{Material complementario (en inglés)}

  \begin{itemize}
  \item
    \href{https://www.calvin.edu/~scofield/courses/m143/materials/RcmdsFromClass.pdf}{Table
    of useful \texttt{R} commands}
  \item
    \href{https://www.rstudio.com/wp-content/uploads/2016/10/r-cheat-sheet-3.pdf}{Base
    \texttt{R} cheatsheet}
  \item
    \href{http://www.webpages.uidaho.edu/~stevel/251/comR.pdf}{Not so
    short list of \texttt{R} commands}
  \item
    \href{http://r4ds.had.co.nz/}{Additional material: \texttt{R} for
    Data Science} or \href{http://courses.had.co.nz/}{here}
  \item
    Some interesting links:

    \begin{itemize}
    \item
      \href{http://kbroman.org/pages/talks.html}{Karl Broman's talks}
    \item
      \href{http://genomicsclass.github.io/book/pages/plots_to_avoid.html}{Plots
      to avoid}
    \item
      \href{http://rseek.org/}{RSeek} - a Google search engine for R
      documentation and help. A MUST see!
    \end{itemize}
  \end{itemize}
\end{itemize}

\chapter{\texorpdfstring{Introducción al software estadístico
\texttt{R}}{Introducción al software estadístico R}}\label{intro}

\texttt{R} es un entorno y lenguaje de programación orientado al
análisis estadístico, al cálculo, manipulación de datos, y
representaciones gráficas. Es multiplataforma y parte del sistema GNU y
se distribuye con licencia GNU-GPL.

Más información
\href{https://es.wikipedia.org/wiki/R_(lenguaje_de_programaci\%C3\%B3n)}{aquí}.
~

\section{\texorpdfstring{Algunas cuestiones a tener en cuenta sobre
\texttt{R}}{Algunas cuestiones a tener en cuenta sobre R}}\label{algunas-cuestiones-a-tener-en-cuenta-sobre-r}

\begin{itemize}
\item
  \texttt{R} distingue mayúsculas y minúsculas.
\item
  Para asignar contenido a un objeto usamos \texttt{\textless{}-}. Por
  ejemplo, \texttt{x\ \textless{}-\ 10} asigna a \texttt{x} el valor
  \texttt{10}. También podemos usar \texttt{=}.
\item
  Para ver el contenido de un objeto simplemente escribimos su nombre.
\item
  Para usar los comandos escribimos el nombre del comando seguido de sus
  argumentos entre paréntesis. Por ejemplo, \texttt{ls()}da una lista de
  los objetos en el área de trabajo. Como no usamos argumentos
  (diferentes a los que el comando tenga por defecto) no escribimos nada
  en el paréntesis.
\item
  Para obtener ayuda usamos el comando \texttt{help}. Por ejemplo,
  \texttt{help(mean)} para obtener ayuda sobre el comando \texttt{mean}
  que calcula la media.
\end{itemize}

\section{Rstudio}\label{rstudio}

RStudio es un \emph{IDE} (\emph{Integrated Development Environment}, o
Entorno de Desarrollo Integrado) de código abierto para \texttt{R}, que
permite interactuar con \texttt{R} de manera muy simple.

Entre otras ventajas, Rstudio utiliza diferentes colores para las
distintas clases de objetos de \texttt{R}, permite autocompletar código,
incluye un sistema de menús de ayuda muy completo, cuenta con un potente
sistema para la gestión, descarga y construcción de librerías, dispone
de un depurador de código que detecta posibles errores de sintaxis, es
multiplataforma (existen versiones para Windows, Linux y Mac).

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{figures/rstudio_ide} 

}

\caption{Interfaz RStudio}\label{fig:rstudio}
\end{figure}

A la izquierda, la consola donde se ejecutan los comandos de \texttt{R}.

A la derecha, en la parte superior, tenemos una ventana que muestra
nuestro entorno (environment) de trabajo, en el que iremos viendo las
variables y funciones que vayamos cargando, creando, etc. Obsérvese que
esta ventana tiene algunos iconos que permiten guardar el contenido de
la memoria, cargar el contenido de la memoria de una sesión de trabajo
anterior, importar archivos de datos que se hayan guardado como texto, y
limpiar el contenido de la memoria.

A la derecha, en la parte inferior, se muestra el contenido de nuestro
directorio home donde R arranca por defecto. Observemos que esta ventana
tiene varias pestañas:

\begin{itemize}
\tightlist
\item
  \textbf{Files:} archivos en el directorio actual.
\item
  \textbf{Plots:} en esta ventana se irán mostrando los gráficos que
  generemos con el programa.
\item
  \textbf{Packages:} permite ver qué librerías (colecciones de funciones
  que extienen la funcionalidad de \texttt{R}) tenemos instaladas;
  asimismo nos permite descargar e instalar nuevas librerías.
\item
  \textbf{Help:} permite acceder a ayuda sobre `R.
\item
  \textbf{Viewer:} Permite acceder a contenido web local.
\end{itemize}

\section{\texorpdfstring{Instalar un paquete de
\texttt{R}}{Instalar un paquete de R}}\label{instalar-un-paquete-de-r}

\begin{itemize}
\tightlist
\item
  Desde la consola
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{install.packages}\NormalTok{(}\StringTok{"< Nombre del paquete >"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Ejemplo:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{install.packages}\NormalTok{(}\StringTok{"DAAG"}\NormalTok{)}
\CommentTok{# Varios paquetes con el comando c("< Paquete 1 >","< Paquete 2 >")}
\KeywordTok{install.packages}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{"DAAG"}\NormalTok{,}\StringTok{"psych"}\NormalTok{,}\StringTok{"gdata"}\NormalTok{,}\StringTok{"foreign"}\NormalTok{,}\StringTok{"Hmisc"}\NormalTok{,}\StringTok{"xlsx"}\NormalTok{,}
                   \StringTok{"MASS"}\NormalTok{,}\StringTok{"calibrate"}\NormalTok{,}\StringTok{"corrplot"}\NormalTok{,}\StringTok{"fields"}\NormalTok{,}\StringTok{"RColorBrewer"}\NormalTok{,}
                   \StringTok{"ggplot2"}\NormalTok{,}\StringTok{"lattice"}\NormalTok{,}\StringTok{"visreg"}\NormalTok{,}
                   \StringTok{"car"}\NormalTok{,}\StringTok{"InformationValue"}\NormalTok{,}\StringTok{"ROCR"}\NormalTok{)) }
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Desde Rstudio: \texttt{Packages\ \textgreater{}\ Install}
\end{itemize}

\section{\texorpdfstring{Empezando con
\texttt{R}}{Empezando con R}}\label{empezando-con-r}

\begin{itemize}
\tightlist
\item
  Obtener el directorio de trabajo o \emph{working directory}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{getwd}\NormalTok{() }
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  listar los objetos en el espacio de trabajo o \emph{workspace}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ls}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Definir el \emph{working directory}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{setwd}\NormalTok{(}\StringTok{"/Users/dlee"}\NormalTok{) }
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\item
  Desde Rstudio:
  \texttt{Files\ \textgreater{}\ Click\ en\ ...\ \textgreater{}\ More\ \textgreater{}\ Set\ as\ workind\ directory}
\item
  Ver los últimos comandos utilizados en la consola
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{history}\NormalTok{() }\CommentTok{# mostrar los últimos 25 comandos}
\KeywordTok{history}\NormalTok{(}\DataTypeTok{max.show=}\OtherTok{Inf}\NormalTok{) }\CommentTok{# mostrar todos los comandos anteriores}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Guardar el historial de comandos
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{savehistory}\NormalTok{(}\DataTypeTok{file=}\StringTok{"myfile"}\NormalTok{) }\CommentTok{# el valor por defecto es ".Rhistory"}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Cargar los commandos guardados en una sesión anterior
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{loadhistory}\NormalTok{(}\DataTypeTok{file=}\StringTok{"myfile"}\NormalTok{) }\CommentTok{# el valor por defecto es ".Rhistory"}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Salvar todo el \textbf{workspace} en un fichero \texttt{.RData}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{save.image}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Guardar objectos especificos a un fichero (si no se especifica la ruta
  en el ordenador, se guardará en el directorio actual de trabajo).
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{save}\NormalTok{(}\OperatorTok{<}\NormalTok{object list}\OperatorTok{>}\NormalTok{,}\DataTypeTok{file=}\StringTok{"myfile.RData"}\NormalTok{) }
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Cargar un \emph{workspace} en la sesión
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{load}\NormalTok{(}\StringTok{"myfile.RData"}\NormalTok{) }
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Salir de \texttt{R}. Por defecto \texttt{R} pregunta si deseas guardar
  la sesión.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{q}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\section{\texorpdfstring{Cargar librerías en
\texttt{R}}{Cargar librerías en R}}\label{cargar-libreruxedas-en-r}

\begin{itemize}
\tightlist
\item
  Una vez instalada la librería, tenemos que cargarla con el comando
  \texttt{library} o \texttt{require}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(DAAG) }\CommentTok{# o require(DAAG)}
\end{Highlighting}
\end{Shaded}

\section{Lectura de datos}\label{lectura-de-datos}

Consola de \texttt{R}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\FloatTok{7.82}\NormalTok{,}\FloatTok{8.00}\NormalTok{,}\FloatTok{7.95}\NormalTok{) }\CommentTok{# c de "combinar"}
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 7.82 8.00 7.95
\end{verbatim}

Otra forma es mediante la función \texttt{scan()}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x <-}\StringTok{ }\KeywordTok{scan}\NormalTok{()  }\CommentTok{# introducir números seguidos de ENTER y terminar con un ENTER}
\DecValTok{1}\OperatorTok{:}\StringTok{ }\FloatTok{7.82}
\DecValTok{2}\OperatorTok{:}\StringTok{ }\FloatTok{8.00}
\DecValTok{3}\OperatorTok{:}\StringTok{ }\FloatTok{7.95}
\DecValTok{4}\OperatorTok{:}\StringTok{ }
\NormalTok{Read }\DecValTok{3}\NormalTok{ items}
\end{Highlighting}
\end{Shaded}

Para crear un vector de caracteres \texttt{""}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{id <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"John"}\NormalTok{,}\StringTok{"Paul"}\NormalTok{,}\StringTok{"George"}\NormalTok{,}\StringTok{"Ringo"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

To read a character vector

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{id <-}\StringTok{ }\KeywordTok{scan}\NormalTok{(,}\StringTok{""}\NormalTok{)}
\DecValTok{1}\OperatorTok{:}\StringTok{ }\NormalTok{John}
\DecValTok{2}\OperatorTok{:}\StringTok{ }\NormalTok{Paul}
\DecValTok{3}\OperatorTok{:}\StringTok{ }\NormalTok{George}
\DecValTok{4}\OperatorTok{:}\StringTok{ }\NormalTok{Ringo}
\DecValTok{5}\OperatorTok{:}\StringTok{ }
\NormalTok{Read }\DecValTok{4}\NormalTok{ items  }
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{id}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "John"   "Paul"   "George" "Ringo"
\end{verbatim}

\section{Importar datos}\label{importar-datos}

En ocasiones, necesitaremos leer datos de un fichero independiente.
Existen varias formas de hacerlo:

\begin{itemize}
\tightlist
\item
  \texttt{scan()} (\texttt{?scan} ver la ayuda)
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# creamos el fichero ex.txt}
\KeywordTok{cat}\NormalTok{(}\StringTok{"Example:"}\NormalTok{, }\StringTok{"2 3 5 7"}\NormalTok{, }\StringTok{"11 13 17"}\NormalTok{, }\DataTypeTok{file =} \StringTok{"ex.txt"}\NormalTok{, }\DataTypeTok{sep =} \StringTok{"}\CharTok{\textbackslash{}n}\StringTok{"}\NormalTok{) }
\KeywordTok{scan}\NormalTok{(}\StringTok{"ex.txt"}\NormalTok{, }\DataTypeTok{skip =} \DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1]  2  3  5  7 11 13 17
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{scan}\NormalTok{(}\StringTok{"ex.txt"}\NormalTok{, }\DataTypeTok{skip =} \DecValTok{1}\NormalTok{, }\DataTypeTok{nlines =} \DecValTok{1}\NormalTok{) }\CommentTok{# only 1 line after the skipped one}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2 3 5 7
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{unlink}\NormalTok{(}\StringTok{"ex.data"}\NormalTok{) }\CommentTok{# tidy up}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\item
  Existen diferentes formatos (\texttt{.txt}, \texttt{.csv},
  \texttt{.xls}, \texttt{.xlsx}, \texttt{SAS}, \texttt{Stata},
  etc\ldots{})
\item
  Algunas librerías de \texttt{R} para importar datos:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(gdata)}
\KeywordTok{library}\NormalTok{(foreign)}
\end{Highlighting}
\end{Shaded}

\bigskip

\begin{itemize}
\tightlist
\item
  Generalmente leeros datos en formato \texttt{.txt} o \texttt{.csv}
\end{itemize}

Vamos a crear una carpeta que llamaremos \texttt{data} y descargaremos
los datos \texttt{cardata} en el siguiente
\href{http://idaejin.github.io/courses/R/data/cardata.zip}{enlace}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mydata1 <-}\StringTok{ }\KeywordTok{read.table}\NormalTok{(}\StringTok{"data/cardata.txt"}\NormalTok{) }
\NormalTok{mydata2 <-}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\StringTok{"data/cardata.csv"}\NormalTok{)  }
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Otros formatos \texttt{.xls} and \texttt{.xlsx}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(gdata)}
\NormalTok{mydata3 <-}\StringTok{ }\KeywordTok{read.xls}\NormalTok{ (}\StringTok{"cardata/cardata.xls"}\NormalTok{, sheet <-}\StringTok{ }\DecValTok{1}\NormalTok{, }\DataTypeTok{header =} \OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Minitab, SPSS, SAS or Stata
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(foreign)                   }
\NormalTok{mydata =}\StringTok{ }\KeywordTok{read.mtp}\NormalTok{(}\StringTok{"mydata.mtp"}\NormalTok{)  }\CommentTok{# Minitab}
\NormalTok{mydata =}\StringTok{ }\KeywordTok{read.spss}\NormalTok{(}\StringTok{"myfile"}\NormalTok{, }\DataTypeTok{to.data.frame=}\OtherTok{TRUE}\NormalTok{) }\CommentTok{# SPSS}
\NormalTok{mydata =}\StringTok{ }\KeywordTok{read.dta}\NormalTok{(}\StringTok{"mydata.dta"}\NormalTok{) }\CommentTok{# Stata}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  O también
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(Hmisc)}
\NormalTok{mydata =}\StringTok{ }\KeywordTok{spss.get}\NormalTok{(}\StringTok{"mydata.por"}\NormalTok{, }\DataTypeTok{use.value.labels=}\OtherTok{TRUE}\NormalTok{)  }\CommentTok{# SPSS}
\end{Highlighting}
\end{Shaded}

\section{Exportar datos}\label{exportar-datos}

\begin{itemize}
\item
  Existen diferentes maneras de exportar datos desde \texttt{R} en
  diferentes formatos. Para SPSS, SAS y Stata. Por ejemplo, mediante la
  librería \texttt{foreign}. En Excel, la librería \texttt{xlsx}.
\item
  Texto delimitado por tabulaciones:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mtcars}
\NormalTok{?mtcars    }
\KeywordTok{write.table}\NormalTok{(mtcars, }\StringTok{"cardata.txt"}\NormalTok{, }\DataTypeTok{sep=}\StringTok{"}\CharTok{\textbackslash{}t}\StringTok{"}\NormalTok{) }
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Hoja de cálculo de Excel:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(xlsx)}
\KeywordTok{write.xlsx}\NormalTok{(mydata, }\StringTok{"mydata.xlsx"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\section{Vectores}\label{vectores}

\begin{itemize}
\tightlist
\item
  Crear dos vectores
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weight<-}\KeywordTok{c}\NormalTok{(}\DecValTok{60}\NormalTok{,}\DecValTok{72}\NormalTok{,}\DecValTok{57}\NormalTok{,}\DecValTok{90}\NormalTok{,}\DecValTok{95}\NormalTok{,}\DecValTok{72}\NormalTok{)  }
\KeywordTok{class}\NormalTok{(weight)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "numeric"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{height<-}\KeywordTok{c}\NormalTok{(}\FloatTok{1.75}\NormalTok{,}\FloatTok{1.80}\NormalTok{,}\FloatTok{1.65}\NormalTok{,}\FloatTok{1.90}\NormalTok{,}\FloatTok{1.74}\NormalTok{,}\FloatTok{1.91}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  calcular el Body Mass Index (\emph{índice de masa corporal})
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{bmi<-}\StringTok{ }\NormalTok{weight}\OperatorTok{/}\NormalTok{height}\OperatorTok{^}\DecValTok{2}
\NormalTok{bmi}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 19.59184 22.22222 20.93664 24.93075 31.37799 19.73630
\end{verbatim}

\section{Estadística básica}\label{estaduxedstica-buxe1sica}

\begin{itemize}
\tightlist
\item
  mean, median, st dev, variance
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{mean}\NormalTok{(weight) }
\KeywordTok{median}\NormalTok{(weight)}
\KeywordTok{sd}\NormalTok{(weight)}
\KeywordTok{var}\NormalTok{(weight)}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Resumen de un vector
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{summary}\NormalTok{(weight)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   57.00   63.00   72.00   74.33   85.50   95.00
\end{verbatim}

\begin{itemize}
\tightlist
\item
  o también
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{min}\NormalTok{(weight)}
\KeywordTok{max}\NormalTok{(weight)}
\KeywordTok{range}\NormalTok{(weight)}
\KeywordTok{sum}\NormalTok{(weight)}
\KeywordTok{length}\NormalTok{(weight)}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Cuantiles y percentiles
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{quantile}\NormalTok{(weight) }\CommentTok{# por defecto cuantil 25%, 50% y 75%}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   0%  25%  50%  75% 100% 
## 57.0 63.0 72.0 85.5 95.0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{quantile}\NormalTok{(weight,}\KeywordTok{c}\NormalTok{(}\FloatTok{0.32}\NormalTok{,}\FloatTok{0.57}\NormalTok{,}\FloatTok{0.98}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  32%  57%  98% 
## 67.2 72.0 94.5
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Covarianza y correlación
\end{itemize}

La covarianza (\(\sigma_{xy}\)) indica el grado de variacion conjunta de
dos variables aleatorias respecto a sus medias

\begin{itemize}
\tightlist
\item
  Si \(\sigma_{xy}> 0\), hay dependencia directa (positiva), es decir, a
  grandes valores de \(x\) corresponden grandes valores de \(y\).
\item
  Si \(\sigma_{xy}= 0\), hay una covarianza 0 se interpreta como la no
  existencia de una relación lineal entre las dos variables estudiadas.
\item
  Si \(\sigma_{xy}< 0\)m hay dependencia inversa o negativa, es decir, a
  grandes valores de \(x\) corresponden pequeños valores de \(y\).
\end{itemize}

\[
\rm{Cov}(x,y) = \frac{1}{n}\sum_{i=1}^{n}(x_i - \bar{x})(y_i - \bar{y})
\]

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{cov}\NormalTok{(weight,height)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.6773333
\end{verbatim}

El \emph{coeficiente de correlación} mide la relacion lineal (positiva o
negativa) entre dos variables. Formalmente es el cociente entre la
covarianza y el producto de las desviaciones típicas de ambas variables.
Siendo \(\sigma_x\) y \(\sigma_y\) las desviaciones estandar y
\(\sigma_xy\) la covarianza entre \(x\) e \(y\).

\[
      \rho_{xy}  = \frac{\sigma_{xy}}{\sigma_x~\sigma_y}
\]

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{cor}\NormalTok{(weight,height)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.437934
\end{verbatim}

\section{Vectores caracteres y variables
factor}\label{vectores-caracteres-y-variables-factor}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{subject <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"John"}\NormalTok{,}\StringTok{"Peter"}\NormalTok{,}\StringTok{"Chris"}\NormalTok{,}\StringTok{"Tony"}\NormalTok{,}\StringTok{"Mary"}\NormalTok{,}\StringTok{"Jane"}\NormalTok{)}
\NormalTok{sex <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"MALE"}\NormalTok{,}\StringTok{"MALE"}\NormalTok{,}\StringTok{"MALE"}\NormalTok{,}\StringTok{"MALE"}\NormalTok{,}\StringTok{"FEMALE"}\NormalTok{,}\StringTok{"FEMALE"}\NormalTok{)}
\KeywordTok{class}\NormalTok{(subject)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "character"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{table}\NormalTok{(sex)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## sex
## FEMALE   MALE 
##      2      4
\end{verbatim}

\section{Data frames}\label{data-frames}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Dat <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(subject,sex,weight,height)}
\CommentTok{# añadir el bmi a Dat}
\NormalTok{Dat}\OperatorTok{$}\NormalTok{bmi <-}\StringTok{ }\NormalTok{bmi  }\CommentTok{# o Dat$bmi <- weight/height^2}
\KeywordTok{class}\NormalTok{(Dat)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "data.frame"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{str}\NormalTok{(Dat) }\CommentTok{# Ver la estructura del data.frame}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 'data.frame':    6 obs. of  5 variables:
##  $ subject: Factor w/ 6 levels "Chris","Jane",..: 3 5 1 6 4 2
##  $ sex    : Factor w/ 2 levels "FEMALE","MALE": 2 2 2 2 1 1
##  $ weight : num  60 72 57 90 95 72
##  $ height : num  1.75 1.8 1.65 1.9 1.74 1.91
##  $ bmi    : num  19.6 22.2 20.9 24.9 31.4 ...
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# cambiar el nombre de las filas}
\KeywordTok{rownames}\NormalTok{(Dat)<-}\KeywordTok{c}\NormalTok{(}\StringTok{"A"}\NormalTok{,}\StringTok{"B"}\NormalTok{,}\StringTok{"C"}\NormalTok{,}\StringTok{"D"}\NormalTok{,}\StringTok{"E"}\NormalTok{,}\StringTok{"F"}\NormalTok{)}

\CommentTok{# Acceder a los elementos del data.frame}
\NormalTok{Dat[,}\DecValTok{1}\NormalTok{]     }\CommentTok{# columna 1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] John  Peter Chris Tony  Mary  Jane 
## Levels: Chris Jane John Mary Peter Tony
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Dat[,}\DecValTok{1}\OperatorTok{:}\DecValTok{3}\NormalTok{]   }\CommentTok{# columnas 1 a 3}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   subject    sex weight
## A    John   MALE     60
## B   Peter   MALE     72
## C   Chris   MALE     57
## D    Tony   MALE     90
## E    Mary FEMALE     95
## F    Jane FEMALE     72
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Dat[}\DecValTok{1}\OperatorTok{:}\DecValTok{2}\NormalTok{,]   }\CommentTok{# filas 1 a 2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   subject  sex weight height      bmi
## A    John MALE     60   1.75 19.59184
## B   Peter MALE     72   1.80 22.22222
\end{verbatim}

\subsection{Trabajando con data
frames}\label{trabajando-con-data-frames}

\textbf{Ejemplo: analizar datos por grupos}

\begin{itemize}
\tightlist
\item
  Obtener el peso (\texttt{weight}), altura (\texttt{height}) y
  \texttt{bmi} por \texttt{FEMALES} y \texttt{MALES}:
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Seleccionado cada grupo y calculando la media por grupos
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Dat[sex}\OperatorTok{==}\StringTok{"MALE"}\NormalTok{,]}
\NormalTok{Dat[sex}\OperatorTok{==}\StringTok{"FEMALE"}\NormalTok{,]}

\KeywordTok{mean}\NormalTok{(Dat[sex}\OperatorTok{==}\StringTok{"MALE"}\NormalTok{,}\DecValTok{3}\NormalTok{])  }\CommentTok{# weight average of MALEs}
\KeywordTok{mean}\NormalTok{(Dat[sex}\OperatorTok{==}\StringTok{"MALE"}\NormalTok{,}\StringTok{"weight"}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\tightlist
\item
  Mediante la función \texttt{apply} por columnas
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{apply}\NormalTok{(Dat[sex}\OperatorTok{==}\StringTok{"FEMALE"}\NormalTok{,}\DecValTok{3}\OperatorTok{:}\DecValTok{5}\NormalTok{],}\DecValTok{2}\NormalTok{,mean)}
\KeywordTok{apply}\NormalTok{(Dat[sex}\OperatorTok{==}\StringTok{"MALE"}\NormalTok{,}\DecValTok{3}\OperatorTok{:}\DecValTok{5}\NormalTok{],}\DecValTok{2}\NormalTok{,mean)}

\CommentTok{# podemos utilizar la función apply con cualquier función}
\KeywordTok{apply}\NormalTok{(Dat[sex}\OperatorTok{==}\StringTok{"FEMALE"}\NormalTok{,}\DecValTok{3}\OperatorTok{:}\DecValTok{5}\NormalTok{],}\DecValTok{2}\NormalTok{,}\ControlFlowTok{function}\NormalTok{(x)\{x}\OperatorTok{+}\DecValTok{2}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{2}
\tightlist
\item
  función \texttt{by} o \texttt{colMeans}
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# 'by' divide los datos en factores y realiza }
\CommentTok{#   los cálculos para cada grupo}
\KeywordTok{by}\NormalTok{(Dat[,}\DecValTok{3}\OperatorTok{:}\DecValTok{5}\NormalTok{],sex, colMeans) }
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{3}
\tightlist
\item
  función \texttt{aggregate}
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# otra opción}
\KeywordTok{aggregate}\NormalTok{(Dat[,}\DecValTok{3}\OperatorTok{:}\DecValTok{5}\NormalTok{], }\DataTypeTok{by=}\KeywordTok{list}\NormalTok{(sex),mean) }
\end{Highlighting}
\end{Shaded}

\section{Vectores lógicos}\label{vectores-luxf3gicos}

\begin{itemize}
\tightlist
\item
  Elegir los individuos con \texttt{BMI\textgreater{}22}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{bmi}
\NormalTok{bmi}\OperatorTok{>}\DecValTok{22}
\KeywordTok{as.numeric}\NormalTok{(bmi}\OperatorTok{>}\DecValTok{22}\NormalTok{) }\CommentTok{# convierte a numerico 0/1}
\KeywordTok{which}\NormalTok{(bmi}\OperatorTok{>}\DecValTok{22}\NormalTok{)  }\CommentTok{# nos devuelve la posicion del valor donde bmi>22}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  ¿Qué valores están entre 20 y 25?
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{bmi }\OperatorTok{>}\StringTok{ }\DecValTok{20} \OperatorTok{&}\StringTok{ }\NormalTok{bmi }\OperatorTok{<}\StringTok{ }\DecValTok{25}
\KeywordTok{which}\NormalTok{(bmi }\OperatorTok{>}\StringTok{ }\DecValTok{20} \OperatorTok{&}\StringTok{ }\NormalTok{bmi }\OperatorTok{<}\StringTok{ }\DecValTok{25}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\section{Trabajando con vectores}\label{trabajando-con-vectores}

\begin{itemize}
\tightlist
\item
  Concatenar
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{7}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\NormalTok{y <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{15}\NormalTok{, }\DecValTok{12}\NormalTok{)}
\NormalTok{z <-}\StringTok{ }\KeywordTok{c}\NormalTok{(x,y)  }\CommentTok{# concatena x e y}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Lista de 2 vectores
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{zz <-}\StringTok{ }\KeywordTok{list}\NormalTok{(x,y) }\CommentTok{# crea una lista}
\KeywordTok{unlist}\NormalTok{(zz) }\CommentTok{# deshace la lista convirtiéndola en un vector concatenado}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1]  2  3  5  2  7  1 10 15 12
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Subconjunto de vectores
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x[}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{4}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2 5 2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x[}\OperatorTok{-}\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{6}\NormalTok{)] }\CommentTok{# simbolo - omite los elementos }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2 5 2 7
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Secuencias
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{9}\NormalTok{) }\CommentTok{# ó 1:9}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1 2 3 4 5 6 7 8 9
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{9}\NormalTok{,}\DataTypeTok{by=}\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1 2 3 4 5 6 7 8 9
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{9}\NormalTok{,}\DataTypeTok{by=}\FloatTok{0.5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] 1.0 1.5 2.0 2.5 3.0 3.5 4.0 4.5 5.0 5.5 6.0 6.5 7.0 7.5 8.0 8.5 9.0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{9}\NormalTok{,}\DataTypeTok{length=}\DecValTok{20}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] 1.000000 1.421053 1.842105 2.263158 2.684211 3.105263 3.526316
##  [8] 3.947368 4.368421 4.789474 5.210526 5.631579 6.052632 6.473684
## [15] 6.894737 7.315789 7.736842 8.157895 8.578947 9.000000
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Réplicas
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{oops <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{7}\NormalTok{,}\DecValTok{9}\NormalTok{,}\DecValTok{13}\NormalTok{)}
\KeywordTok{rep}\NormalTok{(oops,}\DecValTok{3}\NormalTok{)   }\CommentTok{# repite el vector "oops" 3 veces}
\KeywordTok{rep}\NormalTok{(oops,}\DecValTok{1}\OperatorTok{:}\DecValTok{3}\NormalTok{) }\CommentTok{# repite cada elemento del vector las veces indicadas}

\KeywordTok{rep}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{5}\NormalTok{), }\DecValTok{4}\NormalTok{)}
\KeywordTok{rep}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{2}\NormalTok{,}\KeywordTok{c}\NormalTok{(}\DecValTok{10}\NormalTok{,}\DecValTok{15}\NormalTok{))}

\KeywordTok{rep}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{"MALE"}\NormalTok{,}\StringTok{"FEMALE"}\NormalTok{),}\KeywordTok{c}\NormalTok{(}\DecValTok{4}\NormalTok{,}\DecValTok{2}\NormalTok{)) }\CommentTok{# también funciona con caracteres}
\KeywordTok{c}\NormalTok{(}\KeywordTok{rep}\NormalTok{(}\StringTok{"MALE"}\NormalTok{,}\DecValTok{3}\NormalTok{), }\KeywordTok{rep}\NormalTok{(}\StringTok{"FEMALE"}\NormalTok{,}\DecValTok{2}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\section{Matrices y arrays}\label{matrices-y-arrays}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x<-}\StringTok{ }\DecValTok{1}\OperatorTok{:}\DecValTok{12}
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1]  1  2  3  4  5  6  7  8  9 10 11 12
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{dim}\NormalTok{(x)<-}\KeywordTok{c}\NormalTok{(}\DecValTok{3}\NormalTok{,}\DecValTok{4}\NormalTok{)  }\CommentTok{# 3 filas y 4 columnas}

\NormalTok{X <-}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{12}\NormalTok{,}\DataTypeTok{nrow=}\DecValTok{3}\NormalTok{,}\DataTypeTok{byrow=}\OtherTok{TRUE}\NormalTok{)}
\NormalTok{X}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      [,1] [,2] [,3] [,4]
## [1,]    1    2    3    4
## [2,]    5    6    7    8
## [3,]    9   10   11   12
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{X <-}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{12}\NormalTok{,}\DataTypeTok{nrow=}\DecValTok{3}\NormalTok{,}\DataTypeTok{byrow=}\OtherTok{FALSE}\NormalTok{)}
\NormalTok{X}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      [,1] [,2] [,3] [,4]
## [1,]    1    4    7   10
## [2,]    2    5    8   11
## [3,]    3    6    9   12
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# rownames, colnames}

\KeywordTok{rownames}\NormalTok{(X) <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"A"}\NormalTok{,}\StringTok{"B"}\NormalTok{,}\StringTok{"C"}\NormalTok{)}
\NormalTok{X}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   [,1] [,2] [,3] [,4]
## A    1    4    7   10
## B    2    5    8   11
## C    3    6    9   12
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{colnames}\NormalTok{(X) <-}\StringTok{ }\NormalTok{LETTERS[}\DecValTok{4}\OperatorTok{:}\DecValTok{7}\NormalTok{]}
\NormalTok{X}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   D E F  G
## A 1 4 7 10
## B 2 5 8 11
## C 3 6 9 12
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{colnames}\NormalTok{(X) <-}\StringTok{ }\NormalTok{month.abb[}\DecValTok{4}\OperatorTok{:}\DecValTok{7}\NormalTok{]}
\NormalTok{X}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   Apr May Jun Jul
## A   1   4   7  10
## B   2   5   8  11
## C   3   6   9  12
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Concatenar filas y columnas \texttt{rbind()}, \texttt{cbind()}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Y <-}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\FloatTok{0.1}\OperatorTok{*}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{12}\NormalTok{),}\DecValTok{3}\NormalTok{,}\DecValTok{4}\NormalTok{)}

\KeywordTok{cbind}\NormalTok{(X,Y)  }\CommentTok{# bind column-wise}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   Apr May Jun Jul                
## A   1   4   7  10 0.1 0.4 0.7 1.0
## B   2   5   8  11 0.2 0.5 0.8 1.1
## C   3   6   9  12 0.3 0.6 0.9 1.2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{rbind}\NormalTok{(X,Y)  }\CommentTok{# bind row-wise}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   Apr May Jun  Jul
## A 1.0 4.0 7.0 10.0
## B 2.0 5.0 8.0 11.0
## C 3.0 6.0 9.0 12.0
##   0.1 0.4 0.7  1.0
##   0.2 0.5 0.8  1.1
##   0.3 0.6 0.9  1.2
\end{verbatim}

\section{Factores}\label{factores}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{gender<-}\KeywordTok{c}\NormalTok{(}\KeywordTok{rep}\NormalTok{(}\StringTok{"female"}\NormalTok{,}\DecValTok{691}\NormalTok{),}\KeywordTok{rep}\NormalTok{(}\StringTok{"male"}\NormalTok{,}\DecValTok{692}\NormalTok{))}
\KeywordTok{class}\NormalTok{(gender)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "character"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# cambiar vector a factor (por ejemplo a una categoria)}
\NormalTok{gender<-}\StringTok{ }\KeywordTok{factor}\NormalTok{(gender)}
\KeywordTok{levels}\NormalTok{(gender)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "female" "male"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{summary}\NormalTok{(gender)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## female   male 
##    691    692
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{table}\NormalTok{(gender)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## gender
## female   male 
##    691    692
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{status<-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{4}\NormalTok{,}\DecValTok{5}\NormalTok{)    }\CommentTok{# Crear vector numerico, }
                           \CommentTok{#    transformarlo a niveles.}
\NormalTok{fstatus <-}\StringTok{ }\KeywordTok{factor}\NormalTok{(status, }\DataTypeTok{levels=}\DecValTok{0}\OperatorTok{:}\DecValTok{5}\NormalTok{)}
\KeywordTok{levels}\NormalTok{(fstatus) <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"student"}\NormalTok{,}\StringTok{"engineer"}\NormalTok{,}
                     \StringTok{"unemployed"}\NormalTok{,}\StringTok{"lawyer"}\NormalTok{,}\StringTok{"economist"}\NormalTok{,}\StringTok{"dentist"}\NormalTok{)}

\NormalTok{Dat}\OperatorTok{$}\NormalTok{status <-}\StringTok{ }\NormalTok{fstatus}
\NormalTok{Dat}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   subject    sex weight height      bmi     status
## A    John   MALE     60   1.75 19.59184    student
## B   Peter   MALE     72   1.80 22.22222     lawyer
## C   Chris   MALE     57   1.65 20.93664 unemployed
## D    Tony   MALE     90   1.90 24.93075   engineer
## E    Mary FEMALE     95   1.74 31.37799  economist
## F    Jane FEMALE     72   1.91 19.73630    dentist
\end{verbatim}

\section{Indexando vectores con condiciones
lógicas}\label{indexando-vectores-con-condiciones-luxf3gicas}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{4}\NormalTok{,}\DecValTok{5}\NormalTok{)}
\NormalTok{b <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\OtherTok{TRUE}\NormalTok{,}\OtherTok{FALSE}\NormalTok{,}\OtherTok{FALSE}\NormalTok{,}\OtherTok{TRUE}\NormalTok{,}\OtherTok{FALSE}\NormalTok{)}

\KeywordTok{max}\NormalTok{(a[b])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{sum}\NormalTok{(a[b])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 5
\end{verbatim}

\section{Valores faltantes}\label{valores-faltantes}

En \texttt{R}, los valores faltante (o \emph{missing values}) se
representan como \texttt{NA} (\emph{not available}). Los valores
imposibles (e.g., valores dividos por cero) se representan con el
simbolo \texttt{NaN} (\emph{not a number}).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{4}\NormalTok{,}\OtherTok{NA}\NormalTok{)}
\KeywordTok{sum}\NormalTok{(a)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] NA
\end{verbatim}

El argumento \texttt{na.rm=TRUE} excluye los valores \texttt{NA} en el
cálculo de algunos valores

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{sum}\NormalTok{(a,}\DataTypeTok{na.rm=}\OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 10
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{4}\NormalTok{,}\OtherTok{NA}\NormalTok{)}
\KeywordTok{is.na}\NormalTok{(a) }\CommentTok{# YES or NO}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] FALSE FALSE FALSE FALSE  TRUE
\end{verbatim}

La función \texttt{complete.cases()} devuelve un vector lógico que
indica los casos completos.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{complete.cases}\NormalTok{(a)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1]  TRUE  TRUE  TRUE  TRUE FALSE
\end{verbatim}

La función \texttt{na.omit()} devuelve un objeto sin los elementos
\texttt{NA}.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{na.omit}\NormalTok{(a) }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1 2 3 4
## attr(,"na.action")
## [1] 5
## attr(,"class")
## [1] "omit"
\end{verbatim}

\texttt{NA} en data frames:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{require}\NormalTok{(graphics)}
\NormalTok{?airquality}
\KeywordTok{pairs}\NormalTok{(airquality, }\DataTypeTok{panel =}\NormalTok{ panel.smooth, }\DataTypeTok{main =} \StringTok{"airquality data"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{cursoR_files/figure-latex/airquality-01-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ok <-}\StringTok{ }\KeywordTok{complete.cases}\NormalTok{(airquality)}
\NormalTok{airquality[ok,]}
\end{Highlighting}
\end{Shaded}

\section{Trabajando con data frames}\label{trabajando-con-data-frames-1}

\begin{itemize}
\tightlist
\item
  Los data frame se utilizand para guardas tablas de datos. Contiene
  elementos de la misma longitud.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mtcars}
\NormalTok{?mtcars       }\CommentTok{# help(mtcars)}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Observemos las primeras filas
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{head}\NormalTok{(mtcars)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                    mpg cyl disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4
## Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1
## Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1
## Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2
## Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Estructura de un data frame
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{str}\NormalTok{(mtcars) }\CommentTok{# visualiza la estructura del marco de datos}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 'data.frame':    32 obs. of  11 variables:
##  $ mpg : num  21 21 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 ...
##  $ cyl : num  6 6 4 6 8 6 8 4 4 6 ...
##  $ disp: num  160 160 108 258 360 ...
##  $ hp  : num  110 110 93 110 175 105 245 62 95 123 ...
##  $ drat: num  3.9 3.9 3.85 3.08 3.15 2.76 3.21 3.69 3.92 3.92 ...
##  $ wt  : num  2.62 2.88 2.32 3.21 3.44 ...
##  $ qsec: num  16.5 17 18.6 19.4 17 ...
##  $ vs  : num  0 0 1 1 0 1 0 1 1 1 ...
##  $ am  : num  1 1 1 0 0 0 0 0 0 0 ...
##  $ gear: num  4 4 4 3 3 3 3 4 4 4 ...
##  $ carb: num  4 4 1 1 2 1 4 2 2 4 ...
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Select a car model:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mtcars[}\StringTok{"Mazda RX4"}\NormalTok{,] }\CommentTok{# usando nombres de las filas y las columnas}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##           mpg cyl disp  hp drat   wt  qsec vs am gear carb
## Mazda RX4  21   6  160 110  3.9 2.62 16.46  0  1    4    4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mtcars[}\KeywordTok{c}\NormalTok{(}\StringTok{"Datsun 710"}\NormalTok{, }\StringTok{"Camaro Z28"}\NormalTok{),] }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##             mpg cyl disp  hp drat   wt  qsec vs am gear carb
## Datsun 710 22.8   4  108  93 3.85 2.32 18.61  1  1    4    1
## Camaro Z28 13.3   8  350 245 3.73 3.84 15.41  0  0    3    4
\end{verbatim}

\begin{itemize}
\tightlist
\item
  O variables concretas
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mtcars[,}\KeywordTok{c}\NormalTok{(}\StringTok{"mpg"}\NormalTok{,}\StringTok{"am"}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                      mpg am
## Mazda RX4           21.0  1
## Mazda RX4 Wag       21.0  1
## Datsun 710          22.8  1
## Hornet 4 Drive      21.4  0
## Hornet Sportabout   18.7  0
## Valiant             18.1  0
## Duster 360          14.3  0
## Merc 240D           24.4  0
## Merc 230            22.8  0
## Merc 280            19.2  0
## Merc 280C           17.8  0
## Merc 450SE          16.4  0
## Merc 450SL          17.3  0
## Merc 450SLC         15.2  0
## Cadillac Fleetwood  10.4  0
## Lincoln Continental 10.4  0
## Chrysler Imperial   14.7  0
## Fiat 128            32.4  1
## Honda Civic         30.4  1
## Toyota Corolla      33.9  1
## Toyota Corona       21.5  0
## Dodge Challenger    15.5  0
## AMC Javelin         15.2  0
## Camaro Z28          13.3  0
## Pontiac Firebird    19.2  0
## Fiat X1-9           27.3  1
## Porsche 914-2       26.0  1
## Lotus Europa        30.4  1
## Ford Pantera L      15.8  1
## Ferrari Dino        19.7  1
## Maserati Bora       15.0  1
## Volvo 142E          21.4  1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(psych)}
\KeywordTok{describe}\NormalTok{(mtcars)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                                                    25%        50% 
##  352.00000   39.60853   84.20792    0.00000    2.42875    4.00000 
##        75%                       
##   18.97500  472.00000 -341.00000
\end{verbatim}

\chapter{\texorpdfstring{Análisis de datos básico en
\texttt{R}}{Análisis de datos básico en R}}\label{basic}

\section{Gráficos sencillos}\label{gruxe1ficos-sencillos}

\begin{itemize}
\tightlist
\item
  Scatterplot
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{attach}\NormalTok{(mtcars)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## The following object is masked from Auto (pos = 3):
## 
##     mpg
\end{verbatim}

\begin{verbatim}
## The following objects are masked from mtcars (pos = 11):
## 
##     am, carb, cyl, disp, drat, gear, hp, mpg, qsec, vs, wt
\end{verbatim}

\begin{verbatim}
## The following object is masked from Auto (pos = 18):
## 
##     mpg
\end{verbatim}

\begin{verbatim}
## The following object is masked from package:ggplot2:
## 
##     mpg
\end{verbatim}

\begin{verbatim}
## The following objects are masked from mtcars (pos = 48):
## 
##     am, carb, cyl, disp, drat, gear, hp, mpg, qsec, vs, wt
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot}\NormalTok{(wt, mpg, }\DataTypeTok{main=}\StringTok{"Scatterplot Example"}\NormalTok{,}
   \DataTypeTok{xlab=}\StringTok{"Car Weight "}\NormalTok{, }\DataTypeTok{ylab=}\StringTok{"Miles Per Gallon "}\NormalTok{, }\DataTypeTok{pch=}\DecValTok{19}\NormalTok{) }
\end{Highlighting}
\end{Shaded}

\includegraphics{cursoR_files/figure-latex/mtcars-01-1.pdf}

\begin{itemize}
\tightlist
\item
  Matriz scatterplot
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{pairs}\NormalTok{(}\OperatorTok{~}\NormalTok{mpg}\OperatorTok{+}\NormalTok{disp}\OperatorTok{+}\NormalTok{drat}\OperatorTok{+}\NormalTok{wt,}\DataTypeTok{data=}\NormalTok{mtcars,}
   \DataTypeTok{main=}\StringTok{"Simple Scatterplot Matrix"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{cursoR_files/figure-latex/mtcars-02-1.pdf}

\begin{itemize}
\tightlist
\item
  Barplot o diagrama de barras
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tab <-}\StringTok{ }\KeywordTok{table}\NormalTok{(mtcars[,}\KeywordTok{c}\NormalTok{(}\StringTok{"cyl"}\NormalTok{)])}
\KeywordTok{barplot}\NormalTok{(tab)}
\end{Highlighting}
\end{Shaded}

\includegraphics{cursoR_files/figure-latex/barplot-02 -1.pdf}

\begin{itemize}
\tightlist
\item
  Piechart o diagrama de tarta
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{pie}\NormalTok{(tab)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/pie-02-1} \end{center}

\textbf{Ejercicio:}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  El \texttt{data.frame} \texttt{VADeaths} contiene las tasas de
  mortalidad por cada 1000 habitantes en Virginia (EEUU) en 1940
\end{enumerate}

\begin{itemize}
\tightlist
\item
  Las tasas de mortalidad se miden cada 1000 habitantes por año. Se
  encuentran clasificadas por grupo de edad (filas) y grupo de población
  (columnas). Los grupos de edad son: 50-54, 55-59, 60-64, 65-69, 70-74
  y los grupos de población: \texttt{Rural/Male}, \texttt{Rural/Female},
  \texttt{Urban/Male} and \texttt{Urban/Female}.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{data}\NormalTok{(VADeaths)}
\NormalTok{VADeaths}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##       Rural Male Rural Female Urban Male Urban Female
## 50-54       11.7          8.7       15.4          8.4
## 55-59       18.1         11.7       24.3         13.6
## 60-64       26.9         20.3       37.0         19.3
## 65-69       41.0         30.9       54.6         35.1
## 70-74       66.0         54.3       71.1         50.0
\end{verbatim}

\begin{itemize}
\item
  Calcula la media para cada grupo de edad.

  \begin{itemize}
  \tightlist
  \item
    \textbf{Result:}
  \end{itemize}
\end{itemize}

\begin{verbatim}
##  50-54  55-59  60-64  65-69  70-74 
## 11.050 16.925 25.875 40.400 60.350
\end{verbatim}

\begin{itemize}
\item
  Calcula la media para cada grupo de población.

  \begin{itemize}
  \tightlist
  \item
    \textbf{Resultado:}
  \end{itemize}
\end{itemize}

\begin{verbatim}
##   Rural Male Rural Female   Urban Male Urban Female 
##        32.74        25.18        40.48        25.28
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\tightlist
\item
  El \texttt{data.frame} \texttt{rainforest} contiene diferentes
  variables de \texttt{species}
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(DAAG)}
\NormalTok{rainforest}
\NormalTok{?rainforest}
\KeywordTok{names}\NormalTok{(rainforest)}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\item
  Crear una tabla de conteos para cada \texttt{species} y realiza un
  gráfico descriptivo.

  \begin{itemize}
  \tightlist
  \item
    \textbf{Resultado:}
  \end{itemize}
\end{itemize}

\begin{verbatim}
## 
## Acacia mabellae      C. fraseri  Acmena smithii   B. myrtifolia 
##              16              12              26              11
\end{verbatim}

\includegraphics{cursoR_files/figure-latex/rain-02 -1.pdf}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{2}
\tightlist
\item
  El \texttt{data.frame} \texttt{Acmena} est? creado a partir de
  \texttt{rainforest} mediante la función \texttt{subset}.
\end{enumerate}

\begin{itemize}
\tightlist
\item
  Realiza un gráfico que relacione la biomasa de la madera
  (\texttt{wood}) y el di?metro a la altura del pecho (\texttt{dbh}).
  Utiliza tambi?n la escala logarítmica.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Acmena <-}\StringTok{ }\KeywordTok{subset}\NormalTok{(rainforest, species }\OperatorTok{==}\StringTok{ "Acmena smithii"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{cursoR_files/figure-latex/wood-02-1.pdf}

\begin{itemize}
\tightlist
\item
  Calcula un histograma de la variable \texttt{dbh} mediante la función
  \texttt{hist}
\end{itemize}

\includegraphics{cursoR_files/figure-latex/acmena-02 -1.pdf}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{3}
\item
  Crea un vector de n?meros enteros positivos impares the longitud 100 y
  calcula los valores entre 60 y 80.

  \begin{itemize}
  \tightlist
  \item
    \textbf{Result:}
  \end{itemize}
\end{enumerate}

\begin{verbatim}
##  [1] 61 63 65 67 69 71 73 75 77 79
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{\linethickness}\end{center}

\section{Scatterplots}\label{scatterplots}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(MASS)}
\KeywordTok{data}\NormalTok{(}\StringTok{"mammals"}\NormalTok{)}
\NormalTok{?mammals}
\KeywordTok{head}\NormalTok{(mammals)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                    body brain
## Arctic fox        3.385  44.5
## Owl monkey        0.480  15.5
## Mountain beaver   1.350   8.1
## Cow             465.000 423.0
## Grey wolf        36.330 119.5
## Goat             27.660 115.0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{attach}\NormalTok{(mammals)}
\NormalTok{species <-}\StringTok{ }\KeywordTok{row.names}\NormalTok{(mammals)}
\NormalTok{x <-}\StringTok{ }\NormalTok{body}
\NormalTok{y <-}\StringTok{ }\NormalTok{brain}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(calibrate)}
\CommentTok{# scatterplot}
\KeywordTok{plot}\NormalTok{(x,y, }\DataTypeTok{xlab =} \StringTok{"body weight in kgr"}\NormalTok{, }\DataTypeTok{ylab =} \StringTok{"brain weight in gr"}\NormalTok{, }
     \DataTypeTok{main=}\StringTok{"Body vs Brain weight }\CharTok{\textbackslash{}n}\StringTok{ for 62 Species of Land Mammals"}\NormalTok{,}\DataTypeTok{xlim=}\KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{8500}\NormalTok{))}
\KeywordTok{textxy}\NormalTok{(x,y,}\DataTypeTok{labs=}\NormalTok{species,}\DataTypeTok{col =} \StringTok{"blue"}\NormalTok{,}\DataTypeTok{cex=}\FloatTok{0.85}\NormalTok{) }
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/calibrate-02-1} \end{center}

Identificar un punto en el scatterplot

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{identify}\NormalTok{(x,y,species)}
\end{Highlighting}
\end{Shaded}

En escala logarítmica

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot}\NormalTok{(}\KeywordTok{log}\NormalTok{(x),}\KeywordTok{log}\NormalTok{(y), }\DataTypeTok{xlab =} \StringTok{"log body weight in kgr"}\NormalTok{, }\DataTypeTok{ylab =} \StringTok{"log brain weight in gr"}\NormalTok{, }
     \DataTypeTok{main=}\StringTok{"log Body vs log Brain weight }\CharTok{\textbackslash{}n}\StringTok{ for 62 Species of Land Mammals"}\NormalTok{)}
\KeywordTok{textxy}\NormalTok{(}\KeywordTok{log}\NormalTok{(x),}\KeywordTok{log}\NormalTok{(y),}\DataTypeTok{labs=}\NormalTok{species,}\DataTypeTok{col =} \StringTok{"blue"}\NormalTok{,}\DataTypeTok{cex=}\FloatTok{0.85}\NormalTok{) }
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/body-weight-02-1} \end{center}

Identificar un punto en la escala logarítmica

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{identify}\NormalTok{(}\KeywordTok{log}\NormalTok{(x),}\KeywordTok{log}\NormalTok{(y),species)}
\end{Highlighting}
\end{Shaded}

\section{Más opciones gráficas}\label{muxe1s-opciones-gruxe1ficas}

\textbf{Varios conjuntos de datos en un sólo gráfico}

Una vez realizado un \texttt{plot}, el comando \texttt{points} permite
añadir nuevas observaciones.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{1234}\NormalTok{)}
\NormalTok{ x <-}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{,}\DataTypeTok{sd=}\DecValTok{5}\NormalTok{,}\DataTypeTok{mean=}\DecValTok{20}\NormalTok{)}
\NormalTok{ y <-}\StringTok{ }\FloatTok{2.5}\OperatorTok{*}\NormalTok{x }\OperatorTok{-}\StringTok{ }\FloatTok{1.0} \OperatorTok{+}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{,}\DataTypeTok{sd=}\DecValTok{9}\NormalTok{,}\DataTypeTok{mean=}\DecValTok{0}\NormalTok{)}
 \KeywordTok{cor}\NormalTok{(x,y)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.7512194
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
 \KeywordTok{plot}\NormalTok{(x,y,}\DataTypeTok{xlab=}\StringTok{"Independent"}\NormalTok{,}\DataTypeTok{ylab=}\StringTok{"Dependent"}\NormalTok{,}\DataTypeTok{main=}\StringTok{"Random plot"}\NormalTok{)}
\NormalTok{ x1 <-}\StringTok{ }\KeywordTok{runif}\NormalTok{(}\DecValTok{8}\NormalTok{,}\DecValTok{15}\NormalTok{,}\DecValTok{25}\NormalTok{)}
\NormalTok{ y1 <-}\StringTok{ }\FloatTok{2.5}\OperatorTok{*}\NormalTok{x1 }\OperatorTok{-}\StringTok{ }\FloatTok{1.0} \OperatorTok{+}\StringTok{ }\KeywordTok{runif}\NormalTok{(}\DecValTok{8}\NormalTok{,}\OperatorTok{-}\DecValTok{6}\NormalTok{,}\DecValTok{6}\NormalTok{)}
 \KeywordTok{points}\NormalTok{(x1,y1,}\DataTypeTok{col=}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/rnorm-example-02-1} \end{center}

con la leyenda

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{1234}\NormalTok{)}
\NormalTok{x2 <-}\StringTok{ }\KeywordTok{runif}\NormalTok{(}\DecValTok{8}\NormalTok{,}\DecValTok{15}\NormalTok{,}\DecValTok{25}\NormalTok{)}
\NormalTok{y2 <-}\StringTok{ }\FloatTok{2.5}\OperatorTok{*}\NormalTok{x2 }\OperatorTok{-}\StringTok{ }\FloatTok{1.0} \OperatorTok{+}\StringTok{ }\KeywordTok{runif}\NormalTok{(}\DecValTok{8}\NormalTok{,}\OperatorTok{-}\DecValTok{6}\NormalTok{,}\DecValTok{6}\NormalTok{)}
 \KeywordTok{plot}\NormalTok{(x,y,}\DataTypeTok{xlab=}\StringTok{"Independent"}\NormalTok{,}\DataTypeTok{ylab=}\StringTok{"Dependent"}\NormalTok{,}\DataTypeTok{main=}\StringTok{"Random plot"}\NormalTok{)}
 \KeywordTok{points}\NormalTok{(x1,y1,}\DataTypeTok{col=}\DecValTok{2}\NormalTok{,}\DataTypeTok{pch=}\DecValTok{3}\NormalTok{)}
 \KeywordTok{points}\NormalTok{(x2,y2,}\DataTypeTok{col=}\DecValTok{4}\NormalTok{,}\DataTypeTok{pch=}\DecValTok{5}\NormalTok{)}
 \KeywordTok{legend}\NormalTok{(}\StringTok{"topleft"}\NormalTok{,}\KeywordTok{c}\NormalTok{(}\StringTok{"Original"}\NormalTok{,}\StringTok{"one"}\NormalTok{,}\StringTok{"two"}\NormalTok{),}\DataTypeTok{col=}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{4}\NormalTok{),}\DataTypeTok{pch=}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{5}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/rnorm-example-02b-1} \end{center}

\textbf{Varios gráficos en un sola imagen}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{1234}\NormalTok{)}
 \KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{))}
 \KeywordTok{boxplot}\NormalTok{(}\KeywordTok{rnorm}\NormalTok{(}\DecValTok{100}\NormalTok{),}\DataTypeTok{main=}\StringTok{"first plot"}\NormalTok{)}
 \KeywordTok{boxplot}\NormalTok{(}\KeywordTok{rgamma}\NormalTok{(}\DecValTok{100}\NormalTok{,}\DecValTok{2}\NormalTok{),}\DataTypeTok{main=}\StringTok{"second plot"}\NormalTok{, }\DataTypeTok{horizontal=}\OtherTok{TRUE}\NormalTok{,}\DataTypeTok{col=}\StringTok{"bisque"}\NormalTok{)}
 \KeywordTok{plot}\NormalTok{(}\KeywordTok{rnorm}\NormalTok{(}\DecValTok{100}\NormalTok{),}\DataTypeTok{xlab=}\StringTok{"third plot"}\NormalTok{,}
      \DataTypeTok{ylab=}\StringTok{"y-label"}\NormalTok{,}\DataTypeTok{main=}\StringTok{"x-label"}\NormalTok{)}
 \KeywordTok{hist}\NormalTok{(}\KeywordTok{rnorm}\NormalTok{(}\DecValTok{100}\NormalTok{),}\DataTypeTok{main=}\StringTok{"fourth plot"}\NormalTok{,}\DataTypeTok{col=}\StringTok{"lightgrey"}\NormalTok{)}
 \KeywordTok{hist}\NormalTok{(}\KeywordTok{rexp}\NormalTok{(}\DecValTok{100}\NormalTok{),}\DataTypeTok{main=}\StringTok{"fifth plot"}\NormalTok{,}\DataTypeTok{col=}\StringTok{"blue"}\NormalTok{)}
 \KeywordTok{plot}\NormalTok{(}\KeywordTok{rnorm}\NormalTok{(}\DecValTok{100}\NormalTok{),}\KeywordTok{rexp}\NormalTok{(}\DecValTok{100}\NormalTok{),}\DataTypeTok{main=}\StringTok{"sixth plot"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/parfrow-02-1} \end{center}

\textbf{Relaciones entre variables}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{uData <-}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(}\DecValTok{20}\NormalTok{)}
\NormalTok{vData <-}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(}\DecValTok{20}\NormalTok{,}\DataTypeTok{mean=}\DecValTok{5}\NormalTok{)}
\NormalTok{wData <-}\StringTok{ }\NormalTok{uData }\OperatorTok{+}\StringTok{ }\DecValTok{2}\OperatorTok{*}\NormalTok{vData }\OperatorTok{+}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(}\DecValTok{20}\NormalTok{,}\DataTypeTok{sd=}\FloatTok{0.5}\NormalTok{)}
\NormalTok{xData <-}\StringTok{ }\OperatorTok{-}\DecValTok{2}\OperatorTok{*}\NormalTok{uData}\OperatorTok{+}\KeywordTok{rnorm}\NormalTok{(}\DecValTok{20}\NormalTok{,}\DataTypeTok{sd=}\FloatTok{0.1}\NormalTok{)}
\NormalTok{yData <-}\StringTok{  }\DecValTok{3}\OperatorTok{*}\NormalTok{vData}\OperatorTok{+}\KeywordTok{rnorm}\NormalTok{(}\DecValTok{20}\NormalTok{,}\DataTypeTok{sd=}\FloatTok{2.5}\NormalTok{)}
\NormalTok{d <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{u=}\NormalTok{uData,}\DataTypeTok{v=}\NormalTok{vData,}\DataTypeTok{w=}\NormalTok{wData,}\DataTypeTok{x=}\NormalTok{xData,}\DataTypeTok{y=}\NormalTok{yData)}
\KeywordTok{pairs}\NormalTok{(d)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/pairs-02-1} \end{center}

\textbf{Gráfico de correlaciones}

La función \texttt{corrplot} de la librer?a \texttt{corrplot} permite
visualizar una matriz de correlaciones calculada mediante la función
\texttt{cor}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(corrplot)}
\NormalTok{M <-}\StringTok{ }\KeywordTok{cor}\NormalTok{(d)}
\KeywordTok{corrplot}\NormalTok{(M, }\DataTypeTok{method=}\StringTok{"circle"}\NormalTok{,}\DataTypeTok{type=}\StringTok{"upper"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{cursoR_files/figure-latex/corr-02-1.pdf}

\textbf{Gráficos de superficies: \texttt{image}, \texttt{contour} y
\texttt{persp}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x <-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{2}\OperatorTok{*}\NormalTok{pi,}\DataTypeTok{by=}\NormalTok{pi}\OperatorTok{/}\DecValTok{50}\NormalTok{)}
\NormalTok{y <-}\StringTok{ }\NormalTok{x}
\NormalTok{xg <-}\StringTok{ }\NormalTok{(x}\OperatorTok{*}\DecValTok{0}\OperatorTok{+}\DecValTok{1}\NormalTok{) }\OperatorTok{%*%}\StringTok{ }\KeywordTok{t}\NormalTok{(y)}
\NormalTok{yg <-}\StringTok{ }\NormalTok{(x) }\OperatorTok{%*%}\StringTok{ }\KeywordTok{t}\NormalTok{(y}\OperatorTok{*}\DecValTok{0}\OperatorTok{+}\DecValTok{1}\NormalTok{)}
\NormalTok{f <-}\StringTok{ }\KeywordTok{sin}\NormalTok{(xg}\OperatorTok{*}\NormalTok{yg)}

\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{))}
\KeywordTok{image}\NormalTok{(x,y,f)}
\KeywordTok{contour}\NormalTok{(x,y,f)}
\KeywordTok{contour}\NormalTok{(x,y,f,}\DataTypeTok{nlevels=}\DecValTok{4}\NormalTok{)}
\KeywordTok{image}\NormalTok{(x,y,f,}\DataTypeTok{col=}\KeywordTok{grey.colors}\NormalTok{(}\DecValTok{100}\NormalTok{))}
\KeywordTok{contour}\NormalTok{(x,y,f,}\DataTypeTok{nlevels=}\DecValTok{4}\NormalTok{,}\DataTypeTok{add=}\OtherTok{TRUE}\NormalTok{,}\DataTypeTok{col=}\StringTok{"red"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{cursoR_files/figure-latex/image-02-1.pdf}

Podemos utilizar la función \texttt{persp}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{persp}\NormalTok{(x,y,f,}\DataTypeTok{theta=}\OperatorTok{-}\DecValTok{30}\NormalTok{,}\DataTypeTok{phi=}\DecValTok{55}\NormalTok{,}\DataTypeTok{col=}\StringTok{"lightgrey"}\NormalTok{,}\DataTypeTok{shade=}\NormalTok{.}\DecValTok{01}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/persp-02-1} \end{center}

o representar imágenes

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(fields)}
\KeywordTok{data}\NormalTok{(lennon)}
\KeywordTok{image}\NormalTok{(lennon,}\DataTypeTok{col=}\KeywordTok{grey}\NormalTok{(}\KeywordTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DataTypeTok{l=}\DecValTok{256}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\includegraphics{cursoR_files/figure-latex/fields-02-1.pdf}

\section{Tablas de clasificación cruzada o de
contigencia}\label{tablas-de-clasificaciuxf3n-cruzada-o-de-contigencia}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(MASS)}
\KeywordTok{data}\NormalTok{(quine)}
\KeywordTok{head}\NormalTok{(quine)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   Eth Sex Age Lrn Days
## 1   A   M  F0  SL    2
## 2   A   M  F0  SL   11
## 3   A   M  F0  SL   14
## 4   A   M  F0  AL    5
## 5   A   M  F0  AL    5
## 6   A   M  F0  AL   13
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{attach}\NormalTok{(quine)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## The following objects are masked from quine (pos = 11):
## 
##     Age, Days, Eth, Lrn, Sex
\end{verbatim}

\begin{verbatim}
## The following objects are masked from quine (pos = 40):
## 
##     Age, Days, Eth, Lrn, Sex
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{table}\NormalTok{(Sex)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Sex
##  F  M 
## 80 66
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{table}\NormalTok{(Sex,Age)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    Age
## Sex F0 F1 F2 F3
##   F 10 32 19 19
##   M 17 14 21 14
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# or xtabs}
\KeywordTok{xtabs}\NormalTok{(}\OperatorTok{~}\NormalTok{Sex}\OperatorTok{+}\NormalTok{Age,}\DataTypeTok{data=}\NormalTok{quine)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    Age
## Sex F0 F1 F2 F3
##   F 10 32 19 19
##   M 17 14 21 14
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{xtabs}\NormalTok{(}\OperatorTok{~}\NormalTok{Sex}\OperatorTok{+}\NormalTok{Age}\OperatorTok{+}\NormalTok{Eth,}\DataTypeTok{data=}\NormalTok{quine)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## , , Eth = A
## 
##    Age
## Sex F0 F1 F2 F3
##   F  5 15  9  9
##   M  8  5 11  7
## 
## , , Eth = N
## 
##    Age
## Sex F0 F1 F2 F3
##   F  5 17 10 10
##   M  9  9 10  7
\end{verbatim}

\textbf{Cálculos sobre tablas de contigencia}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{tapply}\NormalTok{(Days,Age,mean)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##       F0       F1       F2       F3 
## 14.85185 11.15217 21.05000 19.60606
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{tapply}\NormalTok{(Days,}\KeywordTok{list}\NormalTok{(Sex,Age),mean)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##         F0       F1       F2       F3
## F 18.70000 12.96875 18.42105 14.00000
## M 12.58824  7.00000 23.42857 27.21429
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{tapply}\NormalTok{(Days,}\KeywordTok{list}\NormalTok{(Sex,Age),}\ControlFlowTok{function}\NormalTok{(x) }\KeywordTok{sqrt}\NormalTok{(}\KeywordTok{var}\NormalTok{(x)}\OperatorTok{/}\KeywordTok{length}\NormalTok{(x)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##         F0       F1       F2       F3
## F 4.208589 2.329892 5.299959 2.940939
## M 3.768151 1.418093 3.766122 4.569582
\end{verbatim}

\section{Datos cualitativos}\label{datos-cualitativos}

Supongamos unos datos cualquiera de las variables \texttt{treatment} y
\texttt{improvement} de pacientes a una enfermedad determinada.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{treatment <-}\StringTok{ }\KeywordTok{factor}\NormalTok{(}\KeywordTok{rep}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{), }\KeywordTok{c}\NormalTok{(}\DecValTok{43}\NormalTok{, }\DecValTok{41}\NormalTok{)), }\DataTypeTok{levels =} \KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{),}
                    \DataTypeTok{labels =} \KeywordTok{c}\NormalTok{(}\StringTok{"placebo"}\NormalTok{, }\StringTok{"treated"}\NormalTok{))}
\NormalTok{improved <-}\StringTok{ }\KeywordTok{factor}\NormalTok{(}\KeywordTok{rep}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{), }\KeywordTok{c}\NormalTok{(}\DecValTok{29}\NormalTok{, }\DecValTok{7}\NormalTok{, }\DecValTok{7}\NormalTok{, }\DecValTok{13}\NormalTok{, }\DecValTok{7}\NormalTok{, }\DecValTok{21}\NormalTok{)),}
                   \DataTypeTok{levels =} \KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{),}
                   \DataTypeTok{labels =} \KeywordTok{c}\NormalTok{(}\StringTok{"none"}\NormalTok{, }\StringTok{"some"}\NormalTok{, }\StringTok{"marked"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

Tabla de contigencia

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{xtabs}\NormalTok{(}\OperatorTok{~}\NormalTok{treatment}\OperatorTok{+}\NormalTok{improved)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##          improved
## treatment none some marked
##   placebo   29    7      7
##   treated   13    7     21
\end{verbatim}

De manera gráfica,

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{spineplot}\NormalTok{(improved }\OperatorTok{~}\StringTok{ }\NormalTok{treatment)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/spine-02-1} \end{center}

El conjunto de datos de \texttt{R}, \texttt{UCBAdmissions}contiene los
datos agregadps de los solicitantes a universidad de Berkeley a los seis
departamentos más grandes en 1973 clasificados por sexo y admisión.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{data}\NormalTok{(}\StringTok{"UCBAdmissions"}\NormalTok{)}
\NormalTok{?UCBAdmissions}
\KeywordTok{apply}\NormalTok{(UCBAdmissions, }\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{1}\NormalTok{), sum)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##         Admit
## Gender   Admitted Rejected
##   Male       1198     1493
##   Female      557     1278
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{prop.table}\NormalTok{(}\KeywordTok{apply}\NormalTok{(UCBAdmissions, }\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{1}\NormalTok{), sum))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##         Admit
## Gender    Admitted  Rejected
##   Male   0.2646929 0.3298719
##   Female 0.1230667 0.2823685
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ftable}\NormalTok{(UCBAdmissions)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                 Dept   A   B   C   D   E   F
## Admit    Gender                             
## Admitted Male        512 353 120 138  53  22
##          Female       89  17 202 131  94  24
## Rejected Male        313 207 205 279 138 351
##          Female       19   8 391 244 299 317
\end{verbatim}

Con \texttt{ftable} podemos presentar la información con mayor claridad

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ftable}\NormalTok{(}\KeywordTok{round}\NormalTok{(}\KeywordTok{prop.table}\NormalTok{(UCBAdmissions), }\DecValTok{3}\NormalTok{),}
       \DataTypeTok{row.vars=}\StringTok{"Dept"}\NormalTok{, }\DataTypeTok{col.vars =} \KeywordTok{c}\NormalTok{(}\StringTok{"Gender"}\NormalTok{, }\StringTok{"Admit"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      Gender     Male            Female         
##      Admit  Admitted Rejected Admitted Rejected
## Dept                                           
## A              0.113    0.069    0.020    0.004
## B              0.078    0.046    0.004    0.002
## C              0.027    0.045    0.045    0.086
## D              0.030    0.062    0.029    0.054
## E              0.012    0.030    0.021    0.066
## F              0.005    0.078    0.005    0.070
\end{verbatim}

Resulta más intereseante mostrar la información por género
\texttt{Gender} y \texttt{Dept} combinados (dimensiones 2 y 3 del
array). Nótese que las tasas de admisión por \texttt{male} y
\texttt{female} son más o menos similares en todos los departamentos,
excepto en ``A'', donde las tasas de las mujeres es mayor.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# prop.table(UCBAdmissions, c(2,3))}
\KeywordTok{ftable}\NormalTok{(}\KeywordTok{round}\NormalTok{(}\KeywordTok{prop.table}\NormalTok{(UCBAdmissions, }\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{)), }\DecValTok{2}\NormalTok{),}
       \DataTypeTok{row.vars=}\StringTok{"Dept"}\NormalTok{, }\DataTypeTok{col.vars =} \KeywordTok{c}\NormalTok{(}\StringTok{"Gender"}\NormalTok{, }\StringTok{"Admit"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      Gender     Male            Female         
##      Admit  Admitted Rejected Admitted Rejected
## Dept                                           
## A               0.62     0.38     0.82     0.18
## B               0.63     0.37     0.68     0.32
## C               0.37     0.63     0.34     0.66
## D               0.33     0.67     0.35     0.65
## E               0.28     0.72     0.24     0.76
## F               0.06     0.94     0.07     0.93
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{## Data aggregated over departments}
\KeywordTok{apply}\NormalTok{(UCBAdmissions, }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{), sum)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##           Gender
## Admit      Male Female
##   Admitted 1198    557
##   Rejected 1493   1278
\end{verbatim}

Gráficamente

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{spineplot}\NormalTok{(}\KeywordTok{margin.table}\NormalTok{(UCBAdmissions, }\KeywordTok{c}\NormalTok{(}\DecValTok{3}\NormalTok{, }\DecValTok{2}\NormalTok{)),}
           \DataTypeTok{main =} \StringTok{"Applications at UCB"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/spine-UCB-02-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{spineplot}\NormalTok{(}\KeywordTok{margin.table}\NormalTok{(UCBAdmissions, }\KeywordTok{c}\NormalTok{(}\DecValTok{3}\NormalTok{, }\DecValTok{1}\NormalTok{)),}
           \DataTypeTok{main =} \StringTok{"Admissions at UCB"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/spine-UCB-02-2} \end{center}

Estos datos ilustran la denominada \emph{paradoja de Simpson}. Este
hecho ha sido analizado como un posible caso de discriminación por sexo
en las tasas de admisión en Berkeley. De los 2691 hombres que
solicitaron se admitidos, 1198 (44.5\%) fueron admitidos, comparado con
las 1835 mujeres de las cuales tan sólo 557 (30.4\%) fueron admitidas.
Se podr?a por tanto concluir que los hombres tienes tasas de admisión
mayores que las mujeres.
\href{https://en.wikipedia.org/wiki/Simpson\%27s_paradox\#UC_Berkeley_gender_bias}{Wikipedia:
Gender Bias UC Berkeley}.

Otro ejemplo de la Paradoja de Simpson:

\begin{center}\includegraphics{cursoR_files/figure-latex/simpson-02-1} \end{center}

\section{Datos cuantitativos}\label{datos-cuantitativos}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{head}\NormalTok{(faithful)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   eruptions waiting
## 1     3.600      79
## 2     1.800      54
## 3     3.333      74
## 4     2.283      62
## 5     4.533      85
## 6     2.883      55
\end{verbatim}

Consideremos los datos del geyser Old Faithful en el parque nacional de
Yellowstone, EEUU.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot}\NormalTok{(faithful)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/old-02-1} \end{center}

\subsection{Distribuciones de
frecuencias}\label{distribuciones-de-frecuencias}

Vamos a utilizar el conjunto de datos \texttt{faithful}, para ilustrar
el concepto de distribuci?n de frecuencias que consistir? en crear una
series de categor?as o intervalos, en los que contaremos el n?mero de
observaciones en cada categor?a.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{duration <-}\StringTok{ }\NormalTok{faithful}\OperatorTok{$}\NormalTok{eruptions}
\KeywordTok{range}\NormalTok{(duration)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1.6 5.1
\end{verbatim}

Crearemos los sub-intervalos entre \texttt{{[}1.6,\ 5.1{]}} y la
secuencia \texttt{\{\ 1.5,\ 2.0,\ 2.5,\ ...\ \}}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{breaks <-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\FloatTok{1.5}\NormalTok{,}\FloatTok{5.5}\NormalTok{,}\DataTypeTok{by=}\FloatTok{0.5}\NormalTok{)}
\NormalTok{breaks}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1.5 2.0 2.5 3.0 3.5 4.0 4.5 5.0 5.5
\end{verbatim}

La función \texttt{cut} nos permite divider el rango en los intervalos
que especifiquemos, con el argumento \texttt{right=FALSE}, consideramos
el intervalo cerrado por la derecha.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{duration.cut =}\StringTok{ }\KeywordTok{cut}\NormalTok{(duration, breaks, }\DataTypeTok{right=}\OtherTok{FALSE}\NormalTok{) }
\end{Highlighting}
\end{Shaded}

Con \texttt{table} generamos las frecuencias

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{duration.freq =}\StringTok{ }\KeywordTok{table}\NormalTok{(duration.cut) }
\NormalTok{duration.freq}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## duration.cut
## [1.5,2) [2,2.5) [2.5,3) [3,3.5) [3.5,4) [4,4.5) [4.5,5) [5,5.5) 
##      51      41       5       7      30      73      61       4
\end{verbatim}

Con \texttt{hist} podemos realizarlo de manera autom?tica:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{freq <-}\StringTok{ }\KeywordTok{hist}\NormalTok{(duration)}
\NormalTok{freq}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## $breaks
## [1] 1.5 2.0 2.5 3.0 3.5 4.0 4.5 5.0 5.5
## 
## $counts
## [1] 55 37  5  9 34 75 54  3
## 
## $density
## [1] 0.40441176 0.27205882 0.03676471 0.06617647 0.25000000 0.55147059
## [7] 0.39705882 0.02205882
## 
## $mids
## [1] 1.75 2.25 2.75 3.25 3.75 4.25 4.75 5.25
## 
## $xname
## [1] "duration"
## 
## $equidist
## [1] TRUE
## 
## attr(,"class")
## [1] "histogram"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{freq <-}\StringTok{ }\KeywordTok{hist}\NormalTok{(duration,}\DataTypeTok{breaks =}\NormalTok{ breaks)}
\end{Highlighting}
\end{Shaded}

\includegraphics{cursoR_files/figure-latex/old-hist-02-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{hist}\NormalTok{(duration,}\DecValTok{50}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{cursoR_files/figure-latex/old-hist-02-2.pdf}

\textbf{Estimación de densidad} construye una estimación dada una
distribucion de probabilidad para una muestra dada.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{require}\NormalTok{(graphics)}
\NormalTok{d <-}\StringTok{ }\KeywordTok{density}\NormalTok{(faithful}\OperatorTok{$}\NormalTok{eruptions)}
\NormalTok{d}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
##  density.default(x = faithful$eruptions)
## 
## Data: faithful$eruptions (272 obs.); Bandwidth 'bw' = 0.3348
## 
##        x                y            
##  Min.   :0.5957   Min.   :0.0002262  
##  1st Qu.:1.9728   1st Qu.:0.0514171  
##  Median :3.3500   Median :0.1447010  
##  Mean   :3.3500   Mean   :0.1813462  
##  3rd Qu.:4.7272   3rd Qu.:0.3086071  
##  Max.   :6.1043   Max.   :0.4842095
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot}\NormalTok{(d)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/dens-02-1} \end{center}

En dos dimensiones:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(gplots)}
\NormalTok{h2 <-}\StringTok{ }\KeywordTok{hist2d}\NormalTok{(faithful, }\DataTypeTok{nbins=}\DecValTok{30}\NormalTok{,}\DataTypeTok{xlab=}\StringTok{"Duration in minutes"}\NormalTok{,}\DataTypeTok{ylab=}\StringTok{"Waiting"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{cursoR_files/figure-latex/hist2d-02-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{h2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## ----------------------------
## 2-D Histogram Object
## ----------------------------
## 
## Call: hist2d(x = faithful, nbins = 30, xlab = "Duration in minutes", 
##     ylab = "Waiting")
## 
## Number of data points:  272 
## Number of grid bins:  30 x 30 
## X range: ( 1.6 , 5.1 )
## Y range: ( 43 , 96 )
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{names}\NormalTok{(h2)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "counts"   "x.breaks" "y.breaks" "x"        "y"        "nobs"    
## [7] "call"
\end{verbatim}

Frecuencias relativas

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{duration.relfreq <-}\StringTok{ }\NormalTok{duration.freq }\OperatorTok{/}\StringTok{ }\KeywordTok{nrow}\NormalTok{(faithful) }
\NormalTok{tab <-}\StringTok{ }\KeywordTok{cbind}\NormalTok{(duration.freq, duration.relfreq) }
\KeywordTok{apply}\NormalTok{(tab,}\DecValTok{2}\NormalTok{,sum)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    duration.freq duration.relfreq 
##              272                1
\end{verbatim}

Distribución de frecuencias acumuladas:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{cumsum}\NormalTok{(duration.freq)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1.5,2) [2,2.5) [2.5,3) [3,3.5) [3.5,4) [4,4.5) [4.5,5) [5,5.5) 
##      51      92      97     104     134     207     268     272
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{cumsum}\NormalTok{(duration.relfreq)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   [1.5,2)   [2,2.5)   [2.5,3)   [3,3.5)   [3.5,4)   [4,4.5)   [4.5,5) 
## 0.1875000 0.3382353 0.3566176 0.3823529 0.4926471 0.7610294 0.9852941 
##   [5,5.5) 
## 1.0000000
\end{verbatim}

\textbf{Estimación bivariante tipo kernel}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{data}\NormalTok{(}\StringTok{"faithful"}\NormalTok{)}
\KeywordTok{attach}\NormalTok{(faithful)}
\NormalTok{Dens2d<-}\KeywordTok{kde2d}\NormalTok{(eruptions,waiting)}
\KeywordTok{image}\NormalTok{(Dens2d,}\DataTypeTok{xlab=}\StringTok{"eruptions"}\NormalTok{,}\DataTypeTok{ylab=}\StringTok{"waiting"}\NormalTok{)}
\KeywordTok{contour}\NormalTok{(Dens2d,}\DataTypeTok{add=}\OtherTok{TRUE}\NormalTok{,}\DataTypeTok{col=}\StringTok{"black"}\NormalTok{,}\DataTypeTok{lwd=}\DecValTok{2}\NormalTok{,}\DataTypeTok{nlevels=}\DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/kde-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{detach}\NormalTok{(}\StringTok{"faithful"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\textbf{Gráficos \texttt{persp}}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{persp}\NormalTok{(Dens2d,}\DataTypeTok{phi=}\DecValTok{30}\NormalTok{,}\DataTypeTok{theta=}\DecValTok{20}\NormalTok{,}\DataTypeTok{d=}\DecValTok{5}\NormalTok{,}\DataTypeTok{xlab=}\StringTok{"eruptions"}\NormalTok{,}\DataTypeTok{ylab=}\StringTok{"waiting"}\NormalTok{,}\DataTypeTok{zlab=}\StringTok{""}\NormalTok{,}\DataTypeTok{shade=}\NormalTok{.}\DecValTok{2}\NormalTok{,}\DataTypeTok{col=}\StringTok{"lightblue"}\NormalTok{,}\DataTypeTok{expand=}\NormalTok{.}\DecValTok{85}\NormalTok{,}\DataTypeTok{ticktype =} \StringTok{"detailed"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/dens2d-1} \end{center}

\chapter{\texorpdfstring{Introducción a la programación básica con
\texttt{R}}{Introducción a la programación básica con R}}\label{introducciuxf3n-a-la-programaciuxf3n-buxe1sica-con-r}

\section{Condicionales}\label{condicionales}

\textbf{Comparaciones}

\begin{itemize}
\tightlist
\item
  equal: \texttt{==}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
  \StringTok{"hola"} \OperatorTok{==}\StringTok{ "hola"}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
  \StringTok{"hola"} \OperatorTok{==}\StringTok{ "Hola"}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
   \DecValTok{1} \OperatorTok{==}\StringTok{ }\DecValTok{2}\OperatorTok{-}\DecValTok{1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] TRUE
\end{verbatim}

\begin{itemize}
\tightlist
\item
  not equal: \texttt{!=}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{    a <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{4}\NormalTok{,}\DecValTok{5}\NormalTok{)}
\NormalTok{    b <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{5}\NormalTok{) }
\NormalTok{    a }\OperatorTok{==}\StringTok{ }\NormalTok{b}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1]  TRUE  TRUE FALSE  TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{    a }\OperatorTok{!=}\StringTok{ }\NormalTok{b}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] FALSE FALSE  TRUE FALSE
\end{verbatim}

\begin{itemize}
\tightlist
\item
  mayor/menor que: \texttt{\textgreater{}} \texttt{\textless{}}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{1}\NormalTok{)}
\NormalTok{a <-}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{)}
\NormalTok{b <-}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{)}
\NormalTok{a}\OperatorTok{<}\NormalTok{b}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1]  TRUE  TRUE  TRUE FALSE  TRUE  TRUE FALSE  TRUE  TRUE  TRUE
\end{verbatim}

\begin{itemize}
\tightlist
\item
  mayor/menor que o igual: \texttt{\textgreater{}=}
  \texttt{\textless{}=}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{2}\NormalTok{)}
\NormalTok{a <-}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{)}
\NormalTok{b <-}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{)}
\NormalTok{a }\OperatorTok{>=}\StringTok{ }\NormalTok{b}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] FALSE FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE  TRUE FALSE
\end{verbatim}

\begin{itemize}
\tightlist
\item
  \texttt{which}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{3}\NormalTok{)}
\KeywordTok{which}\NormalTok{(a}\OperatorTok{>}\NormalTok{b)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 3 6 9
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{LETTERS}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "A" "B" "C" "D" "E" "F" "G" "H" "I" "J" "K" "L" "M" "N" "O" "P" "Q"
## [18] "R" "S" "T" "U" "V" "W" "X" "Y" "Z"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{which}\NormalTok{(LETTERS}\OperatorTok{==}\StringTok{"R"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 18
\end{verbatim}

\begin{itemize}
\tightlist
\item
  \texttt{which.min} o \texttt{which.max}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{4}\NormalTok{)}
\NormalTok{a <-}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{)}
\NormalTok{a}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1]  0.2167549 -0.5424926  0.8911446  0.5959806  1.6356180  0.6892754
##  [7] -1.2812466 -0.2131445  1.8965399  1.7768632
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{which.min}\NormalTok{(a)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 7
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{which.max}\NormalTok{(a)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 9
\end{verbatim}

\begin{itemize}
\tightlist
\item
  \texttt{is.na}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ a[}\DecValTok{2}\NormalTok{] <-}\StringTok{ }\OtherTok{NA}
\KeywordTok{is.na}\NormalTok{(a)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{which}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(a))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2
\end{verbatim}

\section{Operadores Lógicos}\label{operadores-luxf3gicos}

\begin{itemize}
\tightlist
\item
  and: \texttt{\&}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{z =}\StringTok{ }\DecValTok{1}\OperatorTok{:}\DecValTok{6}
\KeywordTok{which}\NormalTok{(}\DecValTok{2} \OperatorTok{<}\StringTok{ }\NormalTok{z }\OperatorTok{&}\StringTok{ }\NormalTok{z }\OperatorTok{>}\StringTok{ }\DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 4 5 6
\end{verbatim}

\begin{itemize}
\tightlist
\item
  or: \texttt{\textbar{}}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{z =}\StringTok{ }\DecValTok{1}\OperatorTok{:}\DecValTok{6}
\NormalTok{(z }\OperatorTok{>}\StringTok{ }\DecValTok{2}\NormalTok{) }\OperatorTok{&}\StringTok{ }\NormalTok{(z }\OperatorTok{<}\StringTok{ }\DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] FALSE FALSE  TRUE  TRUE FALSE FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{which}\NormalTok{((z }\OperatorTok{>}\StringTok{ }\DecValTok{2}\NormalTok{) }\OperatorTok{&}\StringTok{ }\NormalTok{(z }\OperatorTok{<}\StringTok{ }\DecValTok{5}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 3 4
\end{verbatim}

\begin{itemize}
\tightlist
\item
  not: \texttt{!}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\OtherTok{TRUE}\NormalTok{,}\OtherTok{FALSE}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{6}\NormalTok{)}
\NormalTok{y <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\OtherTok{FALSE}\NormalTok{,}\OtherTok{TRUE}\NormalTok{,}\OtherTok{FALSE}\NormalTok{,}\OtherTok{TRUE}\NormalTok{)}

\OperatorTok{!}\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] FALSE  TRUE  TRUE FALSE
\end{verbatim}

\textbf{Ejemplo:}

\begin{itemize}
\tightlist
\item
  \texttt{\&\&} vs \texttt{\&}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x}\OperatorTok{&}\NormalTok{y}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] FALSE FALSE FALSE  TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x}\OperatorTok{&&}\NormalTok{y}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] FALSE
\end{verbatim}

\begin{itemize}
\tightlist
\item
  \texttt{\textbar{}\textbar{}} vs \texttt{\textbar{}}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x}\OperatorTok{||}\NormalTok{y}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x}\OperatorTok{|}\NormalTok{y}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1]  TRUE  TRUE FALSE  TRUE
\end{verbatim}

\section{\texorpdfstring{\texttt{if}}{if}}\label{if}

\texttt{if(cond1=true)\ \{\ cmd1\ \}\ else\ \{\ cmd2\ \}}

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{if}\NormalTok{(}\DecValTok{1}\OperatorTok{==}\DecValTok{0}\NormalTok{) \{}
    \KeywordTok{print}\NormalTok{(}\DecValTok{1}\NormalTok{)}
\NormalTok{\} }\ControlFlowTok{else}\NormalTok{ \{}
    \KeywordTok{print}\NormalTok{(}\DecValTok{2}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2
\end{verbatim}

\section{\texorpdfstring{\texttt{ifelse}}{ifelse}}\label{ifelse}

\texttt{ifelse(test,\ true\_value,\ false\_value)}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x <-}\StringTok{ }\DecValTok{1}\OperatorTok{:}\DecValTok{10} \CommentTok{# Creates sample data}
\KeywordTok{ifelse}\NormalTok{(x}\OperatorTok{<}\DecValTok{5} \OperatorTok{|}\StringTok{ }\NormalTok{x}\OperatorTok{>}\DecValTok{8}\NormalTok{, x, }\DecValTok{0}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1]  1  2  3  4  0  0  0  0  9 10
\end{verbatim}

\section{Loops o Bucles}\label{loops-o-bucles}

Los más empleados en \texttt{R} son \texttt{for}, \texttt{while} y
\texttt{apply}. Los menos habituales \texttt{repeat}. La función
\texttt{break} sirve para salir de un bucle loop.

\subsection{\texorpdfstring{\texttt{for}}{for}}\label{for}

Sintaxis

\begin{verbatim}
for(variable in sequence) {
    statements
}
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{for}\NormalTok{ (j }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\DecValTok{5}\NormalTok{)}
\NormalTok{\{}
  \KeywordTok{print}\NormalTok{(j}\OperatorTok{^}\DecValTok{2}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1
## [1] 4
## [1] 9
## [1] 16
## [1] 25
\end{verbatim}

Repetir el bucle guardando los resultados en un vector \texttt{x}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{n =}\StringTok{ }\DecValTok{5}
\NormalTok{x =}\StringTok{ }\OtherTok{NULL}  \CommentTok{# creates a NULL object}
\ControlFlowTok{for}\NormalTok{ (j }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\NormalTok{n)}
\NormalTok{\{}
\NormalTok{  x[j] =}\StringTok{ }\NormalTok{j}\OperatorTok{^}\DecValTok{2}
\NormalTok{\}}
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1]  1  4  9 16 25
\end{verbatim}

Generamos el lanzamiento de un dado

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{nsides =}\StringTok{ }\DecValTok{6}
\NormalTok{ntrials =}\StringTok{ }\DecValTok{1000}
\NormalTok{trials =}\StringTok{ }\OtherTok{NULL}
\ControlFlowTok{for}\NormalTok{ (j }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\NormalTok{ntrials)}
\NormalTok{\{}
\NormalTok{  trials[j] =}\StringTok{ }\KeywordTok{sample}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\NormalTok{nsides,}\DecValTok{1}\NormalTok{)  }\CommentTok{# We get one sample at a time}
\NormalTok{\}}
\KeywordTok{mean}\NormalTok{(trials}\OperatorTok{^}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 14.563
\end{verbatim}

\textbf{Ejemplo:}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x <-}\StringTok{ }\DecValTok{1}\OperatorTok{:}\DecValTok{10}
\NormalTok{z <-}\StringTok{ }\OtherTok{NULL}
\ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \KeywordTok{seq}\NormalTok{(}\DataTypeTok{along=}\NormalTok{x)) \{}
    \ControlFlowTok{if}\NormalTok{ (x[i]}\OperatorTok{<}\DecValTok{5}\NormalTok{) \{}
\NormalTok{        z <-}\StringTok{ }\KeywordTok{c}\NormalTok{(z,x[i]}\OperatorTok{-}\DecValTok{1}\NormalTok{) }
\NormalTok{    \} }\ControlFlowTok{else}\NormalTok{ \{}
        \KeywordTok{stop}\NormalTok{(}\StringTok{"values need to be <5"}\NormalTok{)}
\NormalTok{    \}}
\NormalTok{\}}
\NormalTok{## Error: values need to be <5}
\NormalTok{z}
\NormalTok{## [1] 0 1 2 3}
\end{Highlighting}
\end{Shaded}

\subsection{\texorpdfstring{\texttt{while}}{while}}\label{while}

Similar al bucle \texttt{for}, pero las iteraciones están controladas
por una condición.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{z <-}\StringTok{ }\DecValTok{0}
\ControlFlowTok{while}\NormalTok{(z }\OperatorTok{<}\StringTok{ }\DecValTok{5}\NormalTok{) \{}
\NormalTok{    z <-}\StringTok{ }\NormalTok{z }\OperatorTok{+}\StringTok{ }\DecValTok{2}
    \KeywordTok{print}\NormalTok{(z) }
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2
## [1] 4
## [1] 6
\end{verbatim}

\chapter{Distribuciones de probabilidad en
R}\label{distribuciones-de-probabilidad-en-r}

El paquete \texttt{stats} de \texttt{R} (que se instala por defecto al
instalar \texttt{R}, y se carga en memoria siempre que iniciamos sesión)
implementa numerosas funciones para la realización de cálculos asociados
a distintas distribuciones de probabilidad.

Entre las utilizadas más comúnmente podemos citar:

\textbf{Distribuciones discretas}:

\begin{longtable}[]{@{}ll@{}}
\toprule
Distribución & Nombre en \texttt{R}\tabularnewline
\midrule
\endhead
Binomial & \texttt{binom}\tabularnewline
Poisson & \texttt{pois}\tabularnewline
Geométrica & \texttt{geom}\tabularnewline
Hipergeométrica & \texttt{hyper}\tabularnewline
\bottomrule
\end{longtable}

~

\textbf{Distribuciones contínuas}:

\begin{longtable}[]{@{}ll@{}}
\toprule
Distribución & Nombre en \texttt{R}\tabularnewline
\midrule
\endhead
Uniforme & \texttt{unif}\tabularnewline
Normal & \texttt{norm}\tabularnewline
t-Student & \texttt{t}\tabularnewline
F-Fisher & \texttt{F}\tabularnewline
Chi-cuadrado & \texttt{chisq}\tabularnewline
\bottomrule
\end{longtable}

~

\begin{itemize}
\item
  Examinamos algunas de las operaciones básicas asociadas con las
  distribuciones de probabilidad.
\item
  Hay un gran número de distribuciones de probabilidad disponibles, pero
  sólo observamos unas pocas.
\item
  Para obtener una lista completa de las distribuciones disponibles en
  \texttt{R} puede utilizar el siguiente comando:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{help}\NormalTok{(}\StringTok{"Distributions"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\item
  Para cada distribución hay cuatro comandos. Los comandos para cada
  distribución están precedidos de una letra para indicar la
  funcionalidad:

  \begin{itemize}
  \tightlist
  \item
    \texttt{d}: devuelve la función de densidad de probabilidad
  \item
    \texttt{p}: devuelve la función de densidad acumulada
  \item
    \texttt{q}: returns the inverse cumulative density function
    (quantiles)
  \item
    \texttt{r}: devuelve los números generados aleatoriamente
  \end{itemize}
\end{itemize}

\section{\texorpdfstring{Distribución binomial
\(Bin(n,p)\)}{Distribución binomial Bin(n,p)}}\label{distribuciuxf3n-binomial-binnp}

\begin{itemize}
\tightlist
\item
  La distribución binomial es una distribución de probabilidad discreta.
  Describe el resultado de ensayos independientes de \(n\) en un
  experimento. Se supone que cada ensayo tiene sólo dos resultados, ya
  sea éxito o fracaso. Si la probabilidad de un ensayo exitoso es de
  \(p\), entonces la probabilidad de tener resultados exitosos de \(k\)
  en un experimento de ensayos independientes de \(n\) es dada por la
  \textbf{probabilidad de la función de masa}:
\end{itemize}

\[
{
f(k,n,p) = \mbox{Pr}(X=k)=\binom{n}{k} p^k (1-p)^{n-k}, \quad k=0,1,2,...,n
}
\]

La \textbf{función de distribución acumulativa} puede expresarse como:

\[
{
F(k;n,p) = \mbox{Pr}(X\leq k) = \sum_{i=0}^{k}\binom{n}{i} p^i (1-p)^{n-i}
}
\]

\begin{center}\includegraphics{cursoR_files/figure-latex/binom-03-1} \end{center}

with \emph{mean} \(np\) and \emph{variance} \(np(1-p)\).

\textbf{Pregunta:}

Suponga que hay doce preguntas de opción múltiple en un examen de
matemáticas. Cada pregunta tiene cinco posibles respuestas, y sólo una
de ellas es correcta. Encuentre la probabilidad de tener cuatro o menos
respuestas correctas si un estudiante intenta responder a cada pregunta
al azar.

\textbf{Solución:}

Dado que sólo una de cada cinco respuestas posibles es correcta, la
probabilidad de responder correctamente una pregunta al azar es de
\(1/5=0,2\). Podemos encontrar la probabilidad de tener exactamente 4
respuestas correctas por intentos aleatorios de la siguiente manera.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p =}\StringTok{ }\DecValTok{1}\OperatorTok{/}\DecValTok{5}
\NormalTok{n =}\StringTok{ }\DecValTok{12}
\NormalTok{k =}\StringTok{ }\DecValTok{4}
\KeywordTok{dbinom}\NormalTok{(k,}\DataTypeTok{size=}\NormalTok{n,}\DataTypeTok{prob=}\FloatTok{0.2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.1328756
\end{verbatim}

Para encontrar la probabilidad de tener cuatro o menos respuestas
correctas mediante intentos aleatorios, aplicamos la función
\texttt{dbinom\textquotesingle{}\ con}k=0,1,2,4`.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{prob <-}\StringTok{ }\OtherTok{NULL}
\ControlFlowTok{for}\NormalTok{(k }\ControlFlowTok{in} \DecValTok{0}\OperatorTok{:}\DecValTok{4}\NormalTok{)\{}
\NormalTok{prob <-}\StringTok{ }\KeywordTok{c}\NormalTok{(prob,}\KeywordTok{dbinom}\NormalTok{(k,n,p))}
\NormalTok{prob}
\NormalTok{\}}
\NormalTok{prob}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.06871948 0.20615843 0.28346784 0.23622320 0.13287555
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{sum}\NormalTok{(prob)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.9274445
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# or simply}
\KeywordTok{sum}\NormalTok{(}\KeywordTok{dbinom}\NormalTok{(}\DecValTok{0}\OperatorTok{:}\DecValTok{4}\NormalTok{,n,p))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.9274445
\end{verbatim}

Alternativamente, podemos usar la función de probabilidad acumulada para
la distribución binomial `pbinom'.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{pbinom}\NormalTok{(}\DecValTok{4}\NormalTok{,}\DataTypeTok{size=}\NormalTok{n,}\DataTypeTok{prob=}\FloatTok{0.2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.9274445
\end{verbatim}

\textbf{Solución:} La probabilidad de que cuatro o menos preguntas sean
contestadas correctamente al azar en un cuestionario de opción múltiple
de doce preguntas es del 92,7\%.

¿Cuál es la probabilidad de que 2 ó 3 preguntas sean respondidas
correctamente?

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{sum}\NormalTok{(}\KeywordTok{dbinom}\NormalTok{(}\DecValTok{2}\OperatorTok{:}\DecValTok{3}\NormalTok{,n,p))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.519691
\end{verbatim}

\textbf{Pregunta:}

Supongamos que la empresa \textbf{A} fabricó un producto \textbf{B} con
una probabilidad de 0,005 de ser defectuoso. Suponga que el producto
\textbf{B} se envía en una caja que contiene 25 \textbf{B} artículos.
¿Cuál es la probabilidad de que una caja elegida al azar contenga
exactamente un producto defectuoso?

\textbf{Solución:}

Pregunta reformulada: ¿Cuál es \(P(X = 1)\) cuando \(X\) tiene la
distribución \(Bin(25, 0.005)\)?

\[
  P(X=1) = \binom{25}{1} 0.005^{1} (1-0.005)^{(25-1)}
\]

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p=}\FloatTok{0.005}
\KeywordTok{choose}\NormalTok{(}\DecValTok{25}\NormalTok{,}\DecValTok{1}\NormalTok{)}\OperatorTok{*}\NormalTok{p}\OperatorTok{^}\DecValTok{1}\OperatorTok{*}\NormalTok{(}\DecValTok{1}\OperatorTok{-}\NormalTok{p)}\OperatorTok{^}\NormalTok{(}\DecValTok{25}\OperatorTok{-}\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.1108317
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# or}
\KeywordTok{dbinom}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{25}\NormalTok{,}\FloatTok{0.005}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.1108317
\end{verbatim}

¿Cuál es la probabilidad de que una caja elegida al azar no contenga más
de un artículo defectuoso?

\textbf{Solución:}

\[
P(X\leq 1) = P(X=0) + P(X=1)
\]

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{sum}\NormalTok{(}\KeywordTok{dbinom}\NormalTok{(}\DecValTok{0}\OperatorTok{:}\DecValTok{1}\NormalTok{,}\DecValTok{25}\NormalTok{,p))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.9930519
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# or}
\KeywordTok{pbinom}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{25}\NormalTok{,}\FloatTok{0.005}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.9930519
\end{verbatim}

\section{\texorpdfstring{Distribución de Poisson
\(Pois(\lambda)\)}{Distribución de Poisson Pois(\textbackslash{}lambda)}}\label{distribuciuxf3n-de-poisson-poislambda}

La distribución de Poisson es la distribución de probabilidad de
ocurrencias de eventos independientes en un intervalo. Si \(\lambda\) es
la ocurrencia media por intervalo, entonces la probabilidad de tener
ocurrencias \(k\) dentro de un intervalo dado es la función de masa de
probabilidad dada por:

\[
\mbox{Pr}(\mbox{$k$ eventos en el intervalo}) = \frac{\lambda^k e^{-\lambda}}{k!}
\] La \textbf{función de densidad acumulada} para la función de
probabilidad acumulativa de Poisson es

\[
P(X\leq x ~|~\lambda ) = \frac{e^{-\lambda} \lambda ^x}{x!}\quad \mbox{for $x=0,1,2,...$}
\]

\begin{center}\includegraphics{cursoR_files/figure-latex/pois-03-1} \end{center}

\textbf{Pregunta:}

Supongamos que el número de plantas individuales de una especie dada que
esperamos encontrar en un cuadrado de un metro cuadrado sigue la
distribución de Poisson con una media de \(\lambda= 10\). Encuentra la
probabilidad de encontrar exactamente 12 dólares por persona.

\textbf{Pregunta:}

Si hay doce coches cruzando un puente por minuto en promedio, encuentre
la probabilidad de tener diecisiete o más coches cruzando el puente en
un minuto en particular.

\subsection{Aproximación de Binomial como
Poisson}\label{aproximaciuxf3n-de-binomial-como-poisson}

\textbf{Example}

El cinco por ciento (5\%) de las bombillas del árbol de Navidad
fabricadas por una compañía son defectuosas. El Gerente de Control de
Calidad de la compañía está muy preocupado y por lo tanto toma muestras
aleatorias de 100 bulbos que salen de la línea de montaje. Sea \(X\) el
número en la muestra que está defectuoso. ¿Cuál es la probabilidad de
que la muestra contenga como máximo tres bulbos defectuosos?

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p =}\StringTok{ }\FloatTok{0.05}
\NormalTok{k =}\StringTok{ }\DecValTok{3}
\NormalTok{n =}\StringTok{ }\DecValTok{100}
\KeywordTok{pbinom}\NormalTok{(k,}\DataTypeTok{size=}\NormalTok{n,}\DataTypeTok{prob=}\NormalTok{p)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.2578387
\end{verbatim}

Se puede demostrar que la distribución Binomial puede ser aproximada con
la función de masa de probabilidad de Poisson cuando \(n\) es grande.
Usando la distribución de Poisson, la media \(\lambda = np\)

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lambda <-}\StringTok{ }\NormalTok{n}\OperatorTok{*}\NormalTok{p}
\KeywordTok{sum}\NormalTok{(}\KeywordTok{dpois}\NormalTok{(}\DecValTok{0}\OperatorTok{:}\DecValTok{3}\NormalTok{,lambda))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.2650259
\end{verbatim}

Es importante tener en cuenta que la aproximación de Poisson a la
distribución binomial funciona bien sólo cuando \(n\) es grande y \(p\)
es pequeño. En general, la aproximación funciona bien si \(n \geq 20\) y
\(p\leq0.05\), o si \(n\geq 100\) y \(p\leq 0.10\).

\section{\texorpdfstring{Distribution Exponencial
\(Exp(\lambda)\)}{Distribution Exponencial Exp(\textbackslash{}lambda)}}\label{distribution-exponencial-explambda}

\begin{itemize}
\item
  La distribución exponencial es la distribución de probabilidad que
  describe el tiempo entre eventos en un proceso de Poisson, es decir,
  un proceso en el que los eventos ocurren continua e independientemente
  a una tasa promedio constante.
\item
  Es un caso particular de la distribución gamma. Es el continuo análogo
  de la distribución geométrica, y tiene la propiedad clave de no tener
  memoria. Además de ser utilizado para el análisis de los procesos de
  Poisson, se encuentra en varios otros contextos.
\item
  La función de densidad de probabilidad (pdf) de una distribución
  exponencial como
\end{itemize}

\[
f(x;\lambda) =  \lambda \exp(-\lambda x)
\]

donde \(\lambda>0\) es la tasa del evento (también conocida como
parámetro de tasa, tasa de llegada, tasa de mortalidad, tasa de fracaso,
tasa de transición). La variable exponencial \(x \in[0,\\infty]\)

\begin{center}\includegraphics{cursoR_files/figure-latex/exp-03-1} \end{center}

\begin{itemize}
\tightlist
\item
  La función de distribución acumulada de la distribución exponencial es
\end{itemize}

\[
F(x) = \mbox{Pr}(X\leq x) = 
  \left\{
    \begin{array}{lcc}
      1- e^{-\lambda x} & & x\geq 0 \\
      0                 & & x < 0
    \end{array}
  \right.
\]

Con media \(\mathbb{E}(X) = 1/\lambda\), and
\(\mathbb{V}ar(X) = 1/\lambda^2\).

\textbf{Pregunta:}

Supongamos que la cantidad de tiempo que uno pasa en un banco se
distribuye exponencialmente con una media de 10 minutos,
\(\lambda=1/10\).

\begin{enumerate}
\def\labelenumi{\alph{enumi}.}
\tightlist
\item
  ¿Cuál es la probabilidad de que un cliente pase más de 15 minutos en
  el banco?
\item
  ¿Cuál es la probabilidad de que un cliente pase más de 15 minutos en
  el banco si aún está en el banco? después de 10 minutos?
\end{enumerate}

\textbf{Soluciones:}

\begin{enumerate}
\def\labelenumi{\alph{enumi}.}
\item
\end{enumerate}

\[
P(X>15)=e^{-15\lambda}=e^{-3/2}=0.2231
\]

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{pexp}\NormalTok{(}\DecValTok{15}\NormalTok{,}\DataTypeTok{rate=}\DecValTok{1}\OperatorTok{/}\DecValTok{10}\NormalTok{,}\DataTypeTok{lower.tail =} \OtherTok{FALSE}\NormalTok{) }\CommentTok{# or 1-pexp(15,rate=1/10)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.2231302
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\alph{enumi}.}
\setcounter{enumi}{1}
\tightlist
\item
  \[
  P(X>15 | X>10)=P(X>5)=e^{-1/2}=0.606
  \]
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{pexp}\NormalTok{(}\DecValTok{5}\NormalTok{,}\DataTypeTok{rate=}\DecValTok{1}\OperatorTok{/}\DecValTok{10}\NormalTok{,}\DataTypeTok{lower.tail =} \OtherTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.6065307
\end{verbatim}

\section{\texorpdfstring{Distribution Normal
\(\mathcal{N}(\mu,\sigma^2)\)}{Distribution Normal \textbackslash{}mathcal\{N\}(\textbackslash{}mu,\textbackslash{}sigma\^{}2)}}\label{distribution-normal-mathcalnmusigma2}

\begin{itemize}
\tightlist
\item
  La función de densidad de probabilidad de la distribución Normal es:
\end{itemize}

\[
f(x | \mu,\sigma^2) = \frac{1}{\sqrt{2\sigma^2\pi}} e ^{-\frac{(x-\mu)^2}{2\sigma^2}},
\] dónde

\begin{itemize}
\item
  \(\mu\) es la media de la distribución (también la mediana y el modo).
\item
  \(\sigma\) es la desviación estándar (\(\sigma>0\)).
\item
  \(\sigma^2\) es la variación.
\item
  El proceso para estandarizar la distribución Normal consiste en
  transformar la variable Normal \(N(\mu,\sigma)\) en \(N(0,1)\), es
  decir
\end{itemize}

\[
Z = \frac{X-\mu}{\sigma} \sim N(0,1)
\]

\begin{center}\includegraphics{cursoR_files/figure-latex/norm-03-1} \end{center}

\textbf{Pregunta:}

\(X\) es una variable normalmente distribuida con una media de
\(\mu = 30\) y una desviación estándar de \(\sigma = 4\). Encontrar

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\item
  \(P(x<40)\)
\item
  \(P(x>21)\)
\item
  \(P(30<x<35)\)
\end{enumerate}

\textbf{Solucion:}

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  Para \(x=40\), la \(z\) estandarizada es \((40-30)/4=2.5\) y por
  tanto:
\end{enumerate}

\[
P(X<40)=P(Z<2.5)=0.9938
\]

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{pnorm}\NormalTok{(}\FloatTok{2.5}\NormalTok{) }\CommentTok{# or }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.9937903
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{pnorm}\NormalTok{(}\DecValTok{40}\NormalTok{,}\DataTypeTok{mean=}\DecValTok{30}\NormalTok{,}\DataTypeTok{sd=}\DecValTok{4}\NormalTok{,}\DataTypeTok{lower.tail=}\OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.9937903
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\setcounter{enumi}{1}
\tightlist
\item
  \(P(x>21)\)
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{pnorm}\NormalTok{(}\DecValTok{21}\NormalTok{,}\DataTypeTok{mean=}\DecValTok{30}\NormalTok{,}\DataTypeTok{sd=}\DecValTok{4}\NormalTok{,}\DataTypeTok{lower.tail =} \OtherTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.9877755
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\setcounter{enumi}{2}
\tightlist
\item
  \(P(30<x<35)\)
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{pnorm}\NormalTok{(}\DecValTok{35}\NormalTok{,}\DataTypeTok{mean=}\DecValTok{30}\NormalTok{,}\DataTypeTok{sd=}\DecValTok{4}\NormalTok{,}\DataTypeTok{lower.tail =} \OtherTok{TRUE}\NormalTok{)}\OperatorTok{-}\KeywordTok{pnorm}\NormalTok{(}\DecValTok{30}\NormalTok{,}\DataTypeTok{mean=}\DecValTok{30}\NormalTok{,}\DataTypeTok{sd=}\DecValTok{4}\NormalTok{,}\DataTypeTok{lower.tail =} \OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.3943502
\end{verbatim}

\textbf{Pregunta:}

El ingreso a una determinada universidad se determina mediante un examen
nacional. Los resultados de esta prueba se distribuyen normalmente con
una media de 500 y una desviación estándar de 100. Tom quiere ser
admitido en esta universidad y sabe que debe obtener mejores resultados
que al menos el 70\% de los estudiantes que tomaron el examen. Tom toma
el examen y saca 585 puntos. ¿Será admitido en esta universidad?

\textbf{Solución:}

\texttt{\{r.\ hist-rnorm-03,\ fig.align=\textquotesingle{}center\textquotesingle{}\}\ N\ =\ 1000\ hist(rnorm(N,500,100),20,col="grey")\ abline(v=585,col=2)}

Es \(P(X<585)\) \textgreater{}70\%?

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{pnorm}\NormalTok{(}\DecValTok{585}\NormalTok{,}\DataTypeTok{mean=}\DecValTok{500}\NormalTok{,}\DataTypeTok{sd=}\DecValTok{100}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.8023375
\end{verbatim}

Tom obtuvo una puntuación mejor que el 80.23\% de los estudiantes que
tomaron el examen y será admitido en esta universidad.

\section{\texorpdfstring{Distribución Uniforme
\(U(a,b)\)}{Distribución Uniforme U(a,b)}}\label{distribuciuxf3n-uniforme-uab}

\begin{itemize}
\tightlist
\item
  La distribución uniforme continua es la distribución de probabilidad
  de la selección de números aleatorios del intervalo continuo entre a y
  b. Su función de densidad está definida por lo siguiente.
\end{itemize}

\[
f(x) = \left\{
\begin{aligned}
\frac{1}{a-b} & \quad a \leq x \leq b\\
0 ~~~~&\quad  \mbox{elsewhere}
\end{aligned}\right.
\]

\begin{itemize}
\tightlist
\item
  La función \texttt{runif()} puede ser usada para simular variables
  aleatorias uniformes independientes de \(n\). Por ejemplo, podemos
  generar 5 números aleatorios uniformes en \([0,1]\) como sigue:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{1234}\NormalTok{)}
\KeywordTok{runif}\NormalTok{(}\DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.1137034 0.6222994 0.6092747 0.6233794 0.8609154
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Para generar números uniformes en un intervalo del formulario
  \([a,b]\), usamos los argumentos \texttt{min=a}. y \texttt{max=b}. Por
  ejemplo:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{1234}\NormalTok{)}
\KeywordTok{runif}\NormalTok{(}\DecValTok{3}\NormalTok{, }\FloatTok{1.2}\NormalTok{, }\FloatTok{5.8}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1.723036 4.062577 4.002664
\end{verbatim}

da 3 números uniformes en \([1.2,5.8]\).

\begin{itemize}
\tightlist
\item
  En el siguiente ejemplo, asignaremos 100 números uniformes
  independientes en el intervalo \([1,5]\) a un objeto vectorial llamado
  \texttt{U}:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{1234}\NormalTok{)}
\NormalTok{U <-}\StringTok{ }\KeywordTok{runif}\NormalTok{(}\DecValTok{100}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{5}\NormalTok{)}
\KeywordTok{hist}\NormalTok{(U)}
\end{Highlighting}
\end{Shaded}

\includegraphics{cursoR_files/figure-latex/hist-runif-03-1.pdf}

\begin{itemize}
\tightlist
\item
  La función de densidad puede ser calculada usando \texttt{dunif()}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{curve}\NormalTok{(}\KeywordTok{dunif}\NormalTok{(x, }\DecValTok{1}\NormalTok{, }\DecValTok{5}\NormalTok{), }\DataTypeTok{from=}\DecValTok{0}\NormalTok{, }\DataTypeTok{to=}\DecValTok{6}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{cursoR_files/figure-latex/curve-runif-03-1.pdf}

La media de \(U\) es \(\mathbb{E}[U]=frac{1}{2}(a+b)\), la mediana es
\(\mathbb{Med}[U]=\frac{1}{2}(a+b)\) y la Varianza es
\(\mbox{Var}[U]=\frac{1}{12}(b-a)^2\).

\chapter{Modelos lineales y análisis de la
varianza}\label{modelos-lineales-y-anuxe1lisis-de-la-varianza}

\section{Principios de la modelización
estadística}\label{principios-de-la-modelizaciuxf3n-estaduxedstica}

\begin{itemize}
\item
  Dado un conjunto de variables, cada una de las cuales es un vector de
  lecturas de un rasgo específico de las muestras en un experimento.
\item
  \textbf{Problema:} ¿De qué manera una variable \(Y\) depende de otras
  variables \(X_1,...,X_n\) en el estudio?
\item
  Un \textbf{modelo estadístico} define una relación matemática entre
  los \(X_i\) y \(Y\). El modelo es una representación del real \(Y\)
  que pretende reemplazarlo en la medida de lo posible. Al menos el
  modelo debería capturar la dependencia de \(Y\) de los \(X_i\).
\end{itemize}

\subsection{Identificar y Caracterizar
Variables}\label{identificar-y-caracterizar-variables}

Este es el primer paso en el modelado:

\begin{itemize}
\item
  Qué variable es la variable de respuesta;
\item
  Qué variables son las variables explicativas;
\item
  ¿Son las variables explicativas continuas, categóricas o una mezcla de
  ambas?
\item
  ¿Cuál es la naturaleza de la variable de respuesta? ¿Es una medición
  contínua, un conteo, una proporción, una categoría o un tiempo hasta
  un evento?
\end{itemize}

\subsection{Tipos de variables y tipo de
modelo}\label{tipos-de-variables-y-tipo-de-modelo}

\begin{itemize}
\tightlist
\item
  En función de las variables explicativas:
\end{itemize}

\begin{longtable}[]{@{}ll@{}}
\toprule
\begin{minipage}[b]{0.31\columnwidth}\raggedright\strut
\textbf{Las variables explicativas}\strut
\end{minipage} & \begin{minipage}[b]{0.63\columnwidth}\raggedright\strut
\textbf{Modelo}\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.31\columnwidth}\raggedright\strut
Todas las variables explicativas continuas\strut
\end{minipage} & \begin{minipage}[t]{0.63\columnwidth}\raggedright\strut
Regresión\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.31\columnwidth}\raggedright\strut
Todas las variables explicativas categóricas\strut
\end{minipage} & \begin{minipage}[t]{0.63\columnwidth}\raggedright\strut
Análisis de varianza (ANOVA)\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.31\columnwidth}\raggedright\strut
Variables explicativas tanto continuas como categóricas\strut
\end{minipage} & \begin{minipage}[t]{0.63\columnwidth}\raggedright\strut
Regresión, Análisis de Covarianza (ANCOVA)\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

~

\begin{itemize}
\tightlist
\item
  En función de la variable respuesta:
\end{itemize}

\begin{longtable}[]{@{}ll@{}}
\toprule
\begin{minipage}[b]{0.36\columnwidth}\raggedright\strut
\emph{La variable de respuesta}\strut
\end{minipage} & \begin{minipage}[b]{0.59\columnwidth}\raggedright\strut
\emph{¿Qué tipo de datos es?}\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.36\columnwidth}\raggedright\strut
Continuo\strut
\end{minipage} & \begin{minipage}[t]{0.59\columnwidth}\raggedright\strut
Regresión normal, Anova, Ancova\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.36\columnwidth}\raggedright\strut
Proporción\strut
\end{minipage} & \begin{minipage}[t]{0.59\columnwidth}\raggedright\strut
Regresión logística\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.36\columnwidth}\raggedright\strut
Conteos\strut
\end{minipage} & \begin{minipage}[t]{0.59\columnwidth}\raggedright\strut
Modelos log-lineales (también conocidos como regresión de Poisson)\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.36\columnwidth}\raggedright\strut
Binario\strut
\end{minipage} & \begin{minipage}[t]{0.59\columnwidth}\raggedright\strut
Regresión logística binaria\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.36\columnwidth}\raggedright\strut
Tiempo hasta evento\strut
\end{minipage} & \begin{minipage}[t]{0.59\columnwidth}\raggedright\strut
Análisis de supervivencia\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

~

\section{El modelo lineal general}\label{el-modelo-lineal-general}

Los modelos lineales son una de las herramientas más importantes del
análisis cuantitativo. Los utilizamos cuando queremos predecir --o
explicar-- una variable dependiente a partir de una o más variables
independientes.

Se trata de un modelo para el \textbf{análisis de regresión}, que tiene
como objetivo determinar una función matemática que describa el
comportamiento de una variable dados los valores de otra u otras
variables.

En el \textbf{Análisis de regresión simple}, se pretende estudiar y
explicar el comportamiento de una variable que notamos \(y\), y que
llamaremos \textbf{variable respuesta}, \textbf{variable dependiente} o
\textbf{variable de interés}, a partir de otra variable, que notamos
\(x\), y que llamamos \textbf{variable explicativa}, \textbf{variable
independiente}, \textbf{covariable} o \textbf{regresor}. El principal
objetivo de la regresión es encontrar la función que mejor explique la
relación entre la variable dependiente y las independientes.

\begin{itemize}
\tightlist
\item
  Una forma muy general para el modelo sería
\end{itemize}

\[
      y = f(x_1,x_2,...,x_p) + \epsilon,
\]

donde \(f\) es una función desconocida y \(\epsilon\) es el error en
esta representación. Puesto que normalmente no tenemos suficientes datos
para intentar estimar \(f\) directamente (\emph{problema inverso}),
normalmente tenemos que asumir que tiene alguna forma restringida.

\begin{itemize}
\tightlist
\item
  La forma más simple y común es el \textbf{modelo lineal (LM)}.
\end{itemize}

\[
    y = \beta_0 + \beta_1 x_1 + \beta_2 x_z + \epsilon,
\]

donde \(\beta_i\) \(i=0,1,2\) son parámetros \emph{desconocidos}.
\(\beta_0\) se llama el término de intercepción. Por lo tanto, el
problema se reduce a la estimación de cuatro valores en lugar de los
complicados e infinitos \(f\) dimensionales.

\begin{itemize}
\tightlist
\item
  Un modelo lineal simple con una sola variable exploratoria se define
  como:
\end{itemize}

\[
         \hat{y} = \hat{\beta}_0 + \hat{\beta}_1 x
\]

donde \(\hat y\) son los valores ajustados para \(\hat{beta}_0\)
(intercepto) y \(\hat{\beta}_1\) (pendiente). Luego por un \(x_i\) dado
obtenemos un \(\hat{y}_i\) que se aproxima a \(y_i\)

Vamos a crear un ejemplo (con \(p=1\)):

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{1}\NormalTok{)}
\NormalTok{n <-}\StringTok{ }\DecValTok{50} 

\NormalTok{x <-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{,n)}
\NormalTok{ beta0 <-}\StringTok{ }\DecValTok{15}
\NormalTok{ beta1 <-}\StringTok{ }\FloatTok{0.5}

\NormalTok{sigma <-}\StringTok{ }\DecValTok{3} \CommentTok{# desviación típica de los errores}
\NormalTok{eps <-}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(n,}\DataTypeTok{mean=}\DecValTok{0}\NormalTok{,}\DataTypeTok{sd=}\DecValTok{3}\NormalTok{) }\CommentTok{# generar errores aleatorios gaussianos}

\CommentTok{# Generar datos aleatorios}
\NormalTok{ y <-}\StringTok{ }\NormalTok{beta0 }\OperatorTok{+}\StringTok{ }\NormalTok{beta1}\OperatorTok{*}\NormalTok{x  }\OperatorTok{+}\StringTok{  }\NormalTok{eps}
\end{Highlighting}
\end{Shaded}

Representamos los datos

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot}\NormalTok{(x,y,}\DataTypeTok{ylim =} \KeywordTok{c}\NormalTok{(}\DecValTok{8}\NormalTok{,}\DecValTok{45}\NormalTok{), }\DataTypeTok{cex=}\FloatTok{1.3}\NormalTok{, }\DataTypeTok{xlab =} \StringTok{"x"}\NormalTok{, }\DataTypeTok{ylab=}\StringTok{"y"}\NormalTok{,}\DataTypeTok{pch=}\DecValTok{19}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/plot-04-1} \end{center}

Un procedimiento matemático para encontrar la curva que mejor se ajusta
a un conjunto dado de puntos minimizando la suma de los cuadrados de los
residuos de los puntos de la línea ajustada. Ilustración de los mínimos
cuadrados de ajuste

\begin{center}\includegraphics{cursoR_files/figure-latex/plot-points-04-1} \end{center}

Podemos calcular directamente las cantidades de interés, es decir, la
solución ordinaria de mínimos cuadrados:

\[
\min_{\beta_0,\beta_1} = \sum_{i=1}^{n} (y_i - \hat{y}_i)^2  
\]

Donde

\(\hat{\beta}_1 = \frac{\sum_{i=1}^{n}x_iy_i}{\sum_{i=1}^n x_i^2}\) y
\(\hat{\beta}_0 = \bar{y} - \hat{\beta}_1\bar{x}\)

En forma matricial, con \(X=[1:x_1:...:x_p]\)

\[
\hat{\beta}  = (X^\prime X)^{-1} X^\prime y
\]

donde \(\hat{\beta} = (\hat{\beta}_0,\hat{\beta}_1)\)

\section{\texorpdfstring{Definición de modelos en
\texttt{R}}{Definición de modelos en R}}\label{definiciuxf3n-de-modelos-en-r}

Para completar una regresión lineal usando \texttt{R} primero es
necesario entender la sintaxis para definir los modelos.

\begin{itemize}
\item
  Un aspecto fundamental de los modelos es el uso de fórmulas modelo
  para especificar las variables involucradas en el modelo y las
  posibles interacciones entre las variables explicativas incluidas en
  el modelo.
\item
  Una fórmula modelo se introduce en una función que realiza una
  regresión lineal o anova, por ejemplo.
\item
  Mientras que una fórmula modelo se parece un poco a una fórmula
  matemática, los símbolos de la ``ecuación'' significan cosas
  diferentes a las del álgebra.
\end{itemize}

\begin{longtable}[]{@{}ccc@{}}
\toprule
\begin{minipage}[b]{0.17\columnwidth}\centering\strut
\textbf{Sintaxis}\strut
\end{minipage} & \begin{minipage}[b]{0.28\columnwidth}\centering\strut
\textbf{Modelo}\strut
\end{minipage} & \begin{minipage}[b]{0.46\columnwidth}\centering\strut
\textbf{Observaciones}\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.17\columnwidth}\centering\strut
\texttt{y\ \textasciitilde{}\ x}\strut
\end{minipage} & \begin{minipage}[t]{0.28\columnwidth}\centering\strut
\(y = \beta_0+\beta_1x\)\strut
\end{minipage} & \begin{minipage}[t]{0.46\columnwidth}\centering\strut
Línea recta con intercepto implícita\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.17\columnwidth}\centering\strut
\texttt{y\ \textasciitilde{}\ -1\ +\ x}\strut
\end{minipage} & \begin{minipage}[t]{0.28\columnwidth}\centering\strut
\(y = \beta_1x\)\strut
\end{minipage} & \begin{minipage}[t]{0.46\columnwidth}\centering\strut
Línea recta sin intercepción; es decir, un ajuste forzado (0,0)\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.17\columnwidth}\centering\strut
\texttt{y\ \textasciitilde{}\ x\ +\ I(x\^{}2)}\strut
\end{minipage} & \begin{minipage}[t]{0.28\columnwidth}\centering\strut
\(y = \beta_0+\beta_1x+\beta_2x^2\)\strut
\end{minipage} & \begin{minipage}[t]{0.46\columnwidth}\centering\strut
Modelo Polinomial; \texttt{I()} permite símbolos matemáticos\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.17\columnwidth}\centering\strut
\texttt{y\ \textasciitilde{}\ x\ +\ z}\strut
\end{minipage} & \begin{minipage}[t]{0.28\columnwidth}\centering\strut
\(y = \beta_0+\beta_1x+\beta_2z\)\strut
\end{minipage} & \begin{minipage}[t]{0.46\columnwidth}\centering\strut
Regresión Lineal Múltiple\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.17\columnwidth}\centering\strut
\texttt{y\ \textasciitilde{}\ x:z}\strut
\end{minipage} & \begin{minipage}[t]{0.28\columnwidth}\centering\strut
\(y = \beta_0+\beta_1xz\)\strut
\end{minipage} & \begin{minipage}[t]{0.46\columnwidth}\centering\strut
Modelo con interacción entre \(x\) y \(z\)\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.17\columnwidth}\centering\strut
\texttt{y\ \textasciitilde{}\ x*z}\strut
\end{minipage} & \begin{minipage}[t]{0.28\columnwidth}\centering\strut
\(y = \beta_0+\beta_1x+\beta_2z+\beta_3xz\)\strut
\end{minipage} & \begin{minipage}[t]{0.46\columnwidth}\centering\strut
Equivalente a \texttt{y\textasciitilde{}x+z+x:z}\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

\subsection{Ejemplo: Datos de precios de viviendas en
Boston}\label{ejemplo-datos-de-precios-de-viviendas-en-boston}

La librería \texttt{MASS} contiene el conjunto de datos de Boston, que
registra \texttt{medv} (valor mediano de la casa) de 506 vecindarios
alrededor de Boston. Trataremos de predecir el medv usando 13
predictores tales como \texttt{rm} (número promedio de habitaciones por
casa), \texttt{age} (edad promedio de las casas), y \texttt{lstat}
(porcentaje de hogares con bajo estatus socioeconómico).

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(MASS)}
\KeywordTok{data}\NormalTok{(}\StringTok{"Boston"}\NormalTok{)}
\NormalTok{?Boston}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Gráficos}
\KeywordTok{plot}\NormalTok{(Boston}\OperatorTok{$}\NormalTok{crim,Boston}\OperatorTok{$}\NormalTok{medv,}\DataTypeTok{col=}\DecValTok{1}\OperatorTok{+}\NormalTok{Boston}\OperatorTok{$}\NormalTok{chas)}
\KeywordTok{legend}\NormalTok{(}\StringTok{'topright'}\NormalTok{, }\DataTypeTok{legend =} \KeywordTok{levels}\NormalTok{(}\KeywordTok{factor}\NormalTok{(Boston}\OperatorTok{$}\NormalTok{chas)), }\DataTypeTok{col =} \DecValTok{1}\OperatorTok{:}\DecValTok{2}\NormalTok{, }\DataTypeTok{cex =} \FloatTok{0.8}\NormalTok{, }\DataTypeTok{pch =} \DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/boston_1-04-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot}\NormalTok{(Boston[Boston}\OperatorTok{$}\NormalTok{chas}\OperatorTok{==}\DecValTok{0}\NormalTok{,}\KeywordTok{c}\NormalTok{(}\StringTok{"crim"}\NormalTok{,}\StringTok{"medv"}\NormalTok{)],}\DataTypeTok{xlim=}\KeywordTok{range}\NormalTok{(Boston}\OperatorTok{$}\NormalTok{crim),}\DataTypeTok{ylim=}\KeywordTok{range}\NormalTok{(Boston}\OperatorTok{$}\NormalTok{medv),}\DataTypeTok{col=}\StringTok{"blue"}\NormalTok{,}\DataTypeTok{cex=}\NormalTok{.}\DecValTok{35}\NormalTok{)}
\KeywordTok{points}\NormalTok{(Boston[Boston}\OperatorTok{$}\NormalTok{chas}\OperatorTok{==}\DecValTok{1}\NormalTok{,}\KeywordTok{c}\NormalTok{(}\StringTok{"crim"}\NormalTok{,}\StringTok{"medv"}\NormalTok{)],}\DataTypeTok{col=}\StringTok{"red"}\NormalTok{,}\DataTypeTok{pch=}\DecValTok{2}\NormalTok{)}
\KeywordTok{legend}\NormalTok{(}\StringTok{"topright"}\NormalTok{,}\KeywordTok{c}\NormalTok{(}\StringTok{"CHAS = 0"}\NormalTok{, }\StringTok{"CHAS = 1"}\NormalTok{), }\DataTypeTok{col=}\KeywordTok{c}\NormalTok{(}\DecValTok{4}\NormalTok{,}\DecValTok{2}\NormalTok{),}\DataTypeTok{pch=}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/boston_1-04-2} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{attach}\NormalTok{(Boston)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## The following object is masked from Wage (pos = 8):
## 
##     age
\end{verbatim}

\begin{verbatim}
## The following objects are masked from Boston (pos = 11):
## 
##     age, black, chas, crim, dis, indus, lstat, medv, nox, ptratio,
##     rad, rm, tax, zn
\end{verbatim}

\begin{verbatim}
## The following object is masked from Wage (pos = 27):
## 
##     age
\end{verbatim}

\begin{verbatim}
## The following objects are masked from Boston (pos = 38):
## 
##     age, black, chas, crim, dis, indus, lstat, medv, nox, ptratio,
##     rad, rm, tax, zn
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{boxplot}\NormalTok{(crim)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/boston_1-04-3} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{boxplot}\NormalTok{(crim }\OperatorTok{~}\StringTok{ }\KeywordTok{factor}\NormalTok{(chas), }\DataTypeTok{data =}\NormalTok{ Boston,}\DataTypeTok{xlab=}\StringTok{"CHAS"}\NormalTok{,}\DataTypeTok{ylab=}\StringTok{"crim"}\NormalTok{,}\DataTypeTok{col=}\KeywordTok{c}\NormalTok{(}\DecValTok{4}\NormalTok{,}\DecValTok{2}\NormalTok{),}\DataTypeTok{varwidth=}\OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/boston_1-04-4} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{boxplot}\NormalTok{(medv }\OperatorTok{~}\StringTok{ }\KeywordTok{factor}\NormalTok{(chas), }\DataTypeTok{data =}\NormalTok{ Boston,}\DataTypeTok{xlab=}\StringTok{"CHAS"}\NormalTok{,}\DataTypeTok{ylab=}\StringTok{"crim"}\NormalTok{,}\DataTypeTok{col=}\KeywordTok{c}\NormalTok{(}\DecValTok{4}\NormalTok{,}\DecValTok{2}\NormalTok{),}\DataTypeTok{varwidth=}\OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/boston_1-04-5} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(ggplot2)}

\KeywordTok{qplot}\NormalTok{(crim,medv,}\DataTypeTok{data=}\NormalTok{Boston, }\DataTypeTok{colour=}\KeywordTok{factor}\NormalTok{(chas))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/boston_1-04-6} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{qplot}\NormalTok{(crim,medv,}\DataTypeTok{data=}\NormalTok{Boston, }\DataTypeTok{colour=}\NormalTok{tax)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/boston_1-04-7} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(lattice)}
\KeywordTok{xyplot}\NormalTok{(medv}\OperatorTok{~}\NormalTok{crim,}\DataTypeTok{groups=}\KeywordTok{factor}\NormalTok{(chas),}\DataTypeTok{auto.key =} \OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/boston_1-04-8} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{xyplot}\NormalTok{(medv}\OperatorTok{~}\NormalTok{crim}\OperatorTok{|}\KeywordTok{factor}\NormalTok{(chas),}\DataTypeTok{auto.key =} \OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/boston_1-04-9} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{names}\NormalTok{(Boston)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "crim"    "zn"      "indus"   "chas"    "nox"     "rm"      "age"    
##  [8] "dis"     "rad"     "tax"     "ptratio" "black"   "lstat"   "medv"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{str}\NormalTok{(Boston)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 'data.frame':    506 obs. of  14 variables:
##  $ crim   : num  0.00632 0.02731 0.02729 0.03237 0.06905 ...
##  $ zn     : num  18 0 0 0 0 0 12.5 12.5 12.5 12.5 ...
##  $ indus  : num  2.31 7.07 7.07 2.18 2.18 2.18 7.87 7.87 7.87 7.87 ...
##  $ chas   : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ nox    : num  0.538 0.469 0.469 0.458 0.458 0.458 0.524 0.524 0.524 0.524 ...
##  $ rm     : num  6.58 6.42 7.18 7 7.15 ...
##  $ age    : num  65.2 78.9 61.1 45.8 54.2 58.7 66.6 96.1 100 85.9 ...
##  $ dis    : num  4.09 4.97 4.97 6.06 6.06 ...
##  $ rad    : int  1 2 2 3 3 3 5 5 5 5 ...
##  $ tax    : num  296 242 242 222 222 222 311 311 311 311 ...
##  $ ptratio: num  15.3 17.8 17.8 18.7 18.7 18.7 15.2 15.2 15.2 15.2 ...
##  $ black  : num  397 397 393 395 397 ...
##  $ lstat  : num  4.98 9.14 4.03 2.94 5.33 ...
##  $ medv   : num  24 21.6 34.7 33.4 36.2 28.7 22.9 27.1 16.5 18.9 ...
\end{verbatim}

~

Comenzaremos usando la función \texttt{lm()} para encajar un modelo de
regresión lineal simple, con \texttt{medv} como respuesta y
\texttt{lstat} como predictor. La sintaxis básica de \texttt{lm()} es
\texttt{lm(y\textasciitilde{}x,data)}, donde \texttt{y} es la respuesta,
\texttt{x} es el predictor, y los datos son el conjunto de datos en el
que se guardan estas dos variables.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lm.fit <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(medv }\OperatorTok{~}\StringTok{ }\NormalTok{lstat, }\DataTypeTok{data=}\NormalTok{Boston)}
\end{Highlighting}
\end{Shaded}

~

Si escribimos \texttt{lm.fit}, se obtiene información básica sobre el
modelo. Para información más detallada, usamos \texttt{summary(lm.fit)}.
Esto nos da valores de \(p\) y errores estándar para los coeficientes,
así como la estadística \(R^2\) y el estadístico para el modelo.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lm.fit}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = medv ~ lstat, data = Boston)
## 
## Coefficients:
## (Intercept)        lstat  
##       34.55        -0.95
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{summary}\NormalTok{(lm.fit)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = medv ~ lstat, data = Boston)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -15.168  -3.990  -1.318   2.034  24.500 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(>|t|)    
## (Intercept) 34.55384    0.56263   61.41   <2e-16 ***
## lstat       -0.95005    0.03873  -24.53   <2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 6.216 on 504 degrees of freedom
## Multiple R-squared:  0.5441, Adjusted R-squared:  0.5432 
## F-statistic: 601.6 on 1 and 504 DF,  p-value: < 2.2e-16
\end{verbatim}

~

Podemos usar la función \texttt{names()} para averiguar qué otra
información se almacena en \texttt{lm.fit}. Aunque podemos extraer estas
cantidades por nombre - por ejemplo \texttt{lm.fit\$coefficients} - es
más seguro usar las funciones del extractor como \texttt{coef()} para
acceder a ellas.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{names}\NormalTok{(lm.fit)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "coefficients"  "residuals"     "effects"       "rank"         
##  [5] "fitted.values" "assign"        "qr"            "df.residual"  
##  [9] "xlevels"       "call"          "terms"         "model"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lm.fit}\OperatorTok{$}\NormalTok{coefficients}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## (Intercept)       lstat 
##  34.5538409  -0.9500494
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lm.fit[[}\DecValTok{1}\NormalTok{]]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## (Intercept)       lstat 
##  34.5538409  -0.9500494
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{coef}\NormalTok{(lm.fit)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## (Intercept)       lstat 
##  34.5538409  -0.9500494
\end{verbatim}

~

Para obtener un intervalo de confianza para las estimaciones del
coeficiente, podemos usar el comando \texttt{confint()}.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{confint}\NormalTok{(lm.fit, }\DataTypeTok{level =} \FloatTok{0.95}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                 2.5 %     97.5 %
## (Intercept) 33.448457 35.6592247
## lstat       -1.026148 -0.8739505
\end{verbatim}

~

Considere la posibilidad de construir un intervalo de confianza para
\(\beta_1\) utilizando la información proporcionada por el resumen de
\texttt{lm.fit}:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{summary}\NormalTok{(lm.fit)}\OperatorTok{$}\NormalTok{coefficients}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##               Estimate Std. Error   t value      Pr(>|t|)
## (Intercept) 34.5538409 0.56262735  61.41515 3.743081e-236
## lstat       -0.9500494 0.03873342 -24.52790  5.081103e-88
\end{verbatim}

~

La función \texttt{predict()} puede ser usada para producir intervalos
de confianza e intervalos de predicción para la predicción de
\texttt{medv} para un valor dado de \texttt{lstat}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{CI <-}\StringTok{ }\KeywordTok{predict}\NormalTok{(}\DataTypeTok{object =}\NormalTok{ lm.fit, }\DataTypeTok{newdata =} \KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{lstat =} \KeywordTok{c}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{10}\NormalTok{, }\DecValTok{15}\NormalTok{)), }
              \DataTypeTok{interval =} \StringTok{"confidence"}\NormalTok{)}
\NormalTok{CI}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##        fit      lwr      upr
## 1 29.80359 29.00741 30.59978
## 2 25.05335 24.47413 25.63256
## 3 20.30310 19.73159 20.87461
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{PI <-}\StringTok{ }\KeywordTok{predict}\NormalTok{(}\DataTypeTok{object =}\NormalTok{ lm.fit, }\DataTypeTok{newdata =} \KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{lstat =} \KeywordTok{c}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{10}\NormalTok{, }\DecValTok{15}\NormalTok{)), }
              \DataTypeTok{interval =} \StringTok{"predict"}\NormalTok{)}
\NormalTok{PI}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##        fit       lwr      upr
## 1 29.80359 17.565675 42.04151
## 2 25.05335 12.827626 37.27907
## 3 20.30310  8.077742 32.52846
\end{verbatim}

\emph{NOTA:}

Un \textbf{intervalo de predicción} es un intervalo asociado con una
variable aleatoria que aún no ha sido observada (predicción).

Un \textbf{intervalo de confianza} es un intervalo asociado a un
parámetro y es un concepto de frecuentista.

~

Por ejemplo, el intervalo de confianza del 95\% asociado con un valor
``stat'' de \(10\) es \((24.474132, 25.6325627)\) y el intervalo de
predicción del 95\% es \((12.8276263, 37.2790683)\). Como se esperaba,
los intervalos de confianza y predicción se centran en el mismo punto
(un valor predicho de 25,0533473 para medv cuando \texttt{lstat} es
igual a 10), pero estos últimos son sustancialmente más amplios.

~

Ahora trazaremos \texttt{medv} y \texttt{lstat} junto con la línea de
regresión de los mínimos cuadrados usando las funciones \texttt{plot()}
y \texttt{abline()}.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot}\NormalTok{(medv }\OperatorTok{~}\StringTok{ }\NormalTok{lstat, }\DataTypeTok{data =}\NormalTok{ Boston)}
\KeywordTok{abline}\NormalTok{(lm.fit)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/medv-05-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Or using ggplot2}
\KeywordTok{library}\NormalTok{(ggplot2)}
\KeywordTok{ggplot}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ Boston, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ lstat, }\DataTypeTok{y =}\NormalTok{ medv)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{() }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{geom_smooth}\NormalTok{(}\DataTypeTok{method =} \StringTok{"lm"}\NormalTok{) }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{theme_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/boston-05-1-1} \end{center}

Hay alguna evidencia de no linealidad en la relación entre
\texttt{lstat} y \texttt{medv}. Esta cuestión se discutirá más adelante.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot}\NormalTok{(medv }\OperatorTok{~}\StringTok{ }\NormalTok{lstat, }\DataTypeTok{data =}\NormalTok{ Boston,}\DataTypeTok{pch=}\DecValTok{15}\NormalTok{,}\DataTypeTok{cex=}\NormalTok{.}\DecValTok{65}\NormalTok{,}\DataTypeTok{col=}\StringTok{"lightgrey"}\NormalTok{)}
\KeywordTok{abline}\NormalTok{(lm.fit, }\DataTypeTok{lwd =} \DecValTok{3}\NormalTok{, }\DataTypeTok{col =} \StringTok{"red"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/boston-05-2-1} \end{center}

La \texttt{librería(visreg)} permite visualizar las funciones de
regresión

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# install.packages("visreg")}
\KeywordTok{library}\NormalTok{(visreg)}
\KeywordTok{visreg}\NormalTok{(lm.fit)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/boston-05-3-1} \end{center}

Opciones \texttt{pch}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{20}\NormalTok{, }\DecValTok{1}\OperatorTok{:}\DecValTok{20}\NormalTok{, }\DataTypeTok{pch =} \DecValTok{1}\OperatorTok{:}\DecValTok{20}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/pch-05-1} \end{center}

\textbf{Librería \texttt{ggplot2} con \texttt{lm}}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ Boston, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ lstat, }\DataTypeTok{y =}\NormalTok{ medv)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_smooth}\NormalTok{(}\DataTypeTok{method =} \StringTok{"lm"}\NormalTok{, }\DataTypeTok{color =} \StringTok{"red"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{theme_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/boston-05-4-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# thicker line}
\KeywordTok{ggplot}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ Boston, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ lstat, }\DataTypeTok{y =}\NormalTok{ medv)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_smooth}\NormalTok{(}\DataTypeTok{method =} \StringTok{"lm"}\NormalTok{, }\DataTypeTok{color =} \StringTok{"red"}\NormalTok{, }\DataTypeTok{size =} \DecValTok{2}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{theme_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/boston-05-4-2} \end{center}

~

A continuación examinamos algunas gráficos de diagnóstico. Se producen
automáticamente cuatro gráficas de diagnóstico aplicando la función
\texttt{plot()} directamente a la salida de \texttt{lm()}. En general,
este comando producirá un gráfico a la vez, y al presionar Enter se
generará el siguiente gráfico. Sin embargo, a menudo es conveniente ver
las cuatro parcelas juntas. Podemos lograr esto usando la función
\texttt{par()}, que le dice a \texttt{R} que divida la pantalla en
paneles separados para que se puedan ver múltiples gráficos
simultáneamente. Por ejemplo, \texttt{par(mfrow\ =\ c(2,\ 2))} divide la
región de trazado en una cuadrícula de paneles de 2\$ por 2\$.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow =} \KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{2}\NormalTok{))}
\KeywordTok{plot}\NormalTok{(lm.fit)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/boston-05-lm-1} \end{center}

~

Alternatively, we can compute the residuals from a linear regression fit
using the \texttt{residuals()} function. The function
\texttt{rstudent()} will return the studentized residuals, and we can
use this function to plot the residuals against the fitted values.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow =} \KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{))}
\KeywordTok{plot}\NormalTok{(}\KeywordTok{predict}\NormalTok{(lm.fit), }\KeywordTok{residuals}\NormalTok{(lm.fit))}
\KeywordTok{plot}\NormalTok{(}\KeywordTok{predict}\NormalTok{(lm.fit), }\KeywordTok{rstudent}\NormalTok{(lm.fit))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/boston-05-predict-1} \end{center}

~

La biblioteca \texttt{car} tiene una función \texttt{residualPlots} para
evaluar los residuos (calcula una prueba de curvatura para cada una de
las parcelas añadiendo un término cuadrático y probando que la
cuadrática sea cero). Ver \texttt{?residualPlots}.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(car)}
\KeywordTok{residualPlots}\NormalTok{(lm.fit)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/boston-05-resid-1} \end{center}

\begin{verbatim}
##            Test stat Pr(>|Test stat|)    
## lstat         11.627        < 2.2e-16 ***
## Tukey test    11.627        < 2.2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
\end{verbatim}

Sobre la base de las gráficos de los residuos, hay alguna evidencia de
no linealidad. Las estadísticas de apalancamiento pueden ser calculadas
para cualquier número de predictores usando la función
\texttt{hatvalues}. La función \texttt{influenceIndexPlot} del paquete
\texttt{car} crea cuatro gráficos de diagnóstico que incluyen un gráfico
de los valores de sombrero.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot}\NormalTok{(}\KeywordTok{hatvalues}\NormalTok{(lm.fit))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/boston-05-hat-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{which.max}\NormalTok{(}\KeywordTok{hatvalues}\NormalTok{(lm.fit))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 375 
## 375
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{influenceIndexPlot}\NormalTok{(lm.fit, }\DataTypeTok{id =} \DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning in applyDefaults(id, defaults = list(method = "y", n = 2, cex =
## 1, : unnamed id arguments, will be ignored
\end{verbatim}

\begin{center}\includegraphics{cursoR_files/figure-latex/boston-05-hat-2} \end{center}

\subsection{Regresión lineal
múltiple}\label{regresiuxf3n-lineal-muxfaltiple}

Los modelos de correlación lineal múltiple requieren de las mismas
condiciones que los modelos lineales simples más otras adicionales.

Para ajustar un modelo de regresión lineal múltiple usando mínimos
cuadrados, utilizamos de nuevo la función \texttt{lm()}. La sintaxis
\texttt{lm(y\ \textasciitilde{}\ x1\ +\ x2\ +\ x3)} se utiliza para
ajustar un modelo con tres predictores, \texttt{x1}, \texttt{x2}, y
\texttt{x3}. La función \texttt{summary()} produce ahora los
coeficientes de regresión para todos los predictores.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ls.fit <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(medv }\OperatorTok{~}\StringTok{ }\NormalTok{lstat }\OperatorTok{+}\StringTok{ }\NormalTok{age, }\DataTypeTok{data =}\NormalTok{ Boston)}
\KeywordTok{summary}\NormalTok{(ls.fit)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = medv ~ lstat + age, data = Boston)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -15.981  -3.978  -1.283   1.968  23.158 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(>|t|)    
## (Intercept) 33.22276    0.73085  45.458  < 2e-16 ***
## lstat       -1.03207    0.04819 -21.416  < 2e-16 ***
## age          0.03454    0.01223   2.826  0.00491 ** 
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 6.173 on 503 degrees of freedom
## Multiple R-squared:  0.5513, Adjusted R-squared:  0.5495 
## F-statistic:   309 on 2 and 503 DF,  p-value: < 2.2e-16
\end{verbatim}

~

El conjunto de datos \texttt{Boston} contiene 13 variables, por lo que
sería engorroso tener que escribirlas todas para poder realizar una
regresión utilizando todos los predictores. En su lugar, podemos
utilizar la siguiente abreviatura:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ls.fit <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(medv }\OperatorTok{~}\StringTok{ }\NormalTok{., }\DataTypeTok{data =}\NormalTok{ Boston)}
\KeywordTok{summary}\NormalTok{(ls.fit)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = medv ~ ., data = Boston)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -15.595  -2.730  -0.518   1.777  26.199 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(>|t|)    
## (Intercept)  3.646e+01  5.103e+00   7.144 3.28e-12 ***
## crim        -1.080e-01  3.286e-02  -3.287 0.001087 ** 
## zn           4.642e-02  1.373e-02   3.382 0.000778 ***
## indus        2.056e-02  6.150e-02   0.334 0.738288    
## chas         2.687e+00  8.616e-01   3.118 0.001925 ** 
## nox         -1.777e+01  3.820e+00  -4.651 4.25e-06 ***
## rm           3.810e+00  4.179e-01   9.116  < 2e-16 ***
## age          6.922e-04  1.321e-02   0.052 0.958229    
## dis         -1.476e+00  1.995e-01  -7.398 6.01e-13 ***
## rad          3.060e-01  6.635e-02   4.613 5.07e-06 ***
## tax         -1.233e-02  3.760e-03  -3.280 0.001112 ** 
## ptratio     -9.527e-01  1.308e-01  -7.283 1.31e-12 ***
## black        9.312e-03  2.686e-03   3.467 0.000573 ***
## lstat       -5.248e-01  5.072e-02 -10.347  < 2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 4.745 on 492 degrees of freedom
## Multiple R-squared:  0.7406, Adjusted R-squared:  0.7338 
## F-statistic: 108.1 on 13 and 492 DF,  p-value: < 2.2e-16
\end{verbatim}

~

Podemos acceder a los componentes individuales de un objeto de resumen
por nombre (escriea \texttt{?summary.lm} para ver qué hay disponible).
Por lo tanto \texttt{summary(lm.fit)\$r.sq} nos da los \(R^2\), y
\texttt{summary(lm.fit)\$sigma} nos da \(hat{sigma}\).

~

Si queremos realizar una regresión usando todas las variables pero
excepto una, podemos eliminarla usando \texttt{-}. Por ejemplo, en la
salida de regresión anterior, \texttt{age} tiene un alto valor p.~Así
que tal vez queramos hacer una regresión excluyendo este predictor. La
siguiente sintaxis resulta en una regresión usando todos los predictores
excepto \texttt{age}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ls.fit1 <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(medv }\OperatorTok{~}\StringTok{ }\NormalTok{. }\OperatorTok{-}\StringTok{ }\NormalTok{age, }\DataTypeTok{data =}\NormalTok{ Boston)}
\KeywordTok{summary}\NormalTok{(ls.fit1)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = medv ~ . - age, data = Boston)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -15.6054  -2.7313  -0.5188   1.7601  26.2243 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(>|t|)    
## (Intercept)  36.436927   5.080119   7.172 2.72e-12 ***
## crim         -0.108006   0.032832  -3.290 0.001075 ** 
## zn            0.046334   0.013613   3.404 0.000719 ***
## indus         0.020562   0.061433   0.335 0.737989    
## chas          2.689026   0.859598   3.128 0.001863 ** 
## nox         -17.713540   3.679308  -4.814 1.97e-06 ***
## rm            3.814394   0.408480   9.338  < 2e-16 ***
## dis          -1.478612   0.190611  -7.757 5.03e-14 ***
## rad           0.305786   0.066089   4.627 4.75e-06 ***
## tax          -0.012329   0.003755  -3.283 0.001099 ** 
## ptratio      -0.952211   0.130294  -7.308 1.10e-12 ***
## black         0.009321   0.002678   3.481 0.000544 ***
## lstat        -0.523852   0.047625 -10.999  < 2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 4.74 on 493 degrees of freedom
## Multiple R-squared:  0.7406, Adjusted R-squared:  0.7343 
## F-statistic: 117.3 on 12 and 493 DF,  p-value: < 2.2e-16
\end{verbatim}

\subsubsection{Interacciones}\label{interacciones}

Es fácil incluir términos de interacción en un modelo lineal usando la
función \texttt{lm()}. La sintaxis \texttt{lstat:black} indica a
\texttt{R} que incluya un término de interacción entre \texttt{lstat} y
\texttt{black}. La sintaxis \texttt{lstat*age} incluye simultáneamente
\texttt{lstat},\texttt{age}, y el término de interacción \texttt{lstat}
\(\times\)\texttt{age} como predictores; es una abreviatura de
\texttt{lstat\ +\ age\ +\ lstat:age}.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{summary}\NormalTok{(}\KeywordTok{lm}\NormalTok{(medv }\OperatorTok{~}\StringTok{ }\NormalTok{lstat}\OperatorTok{*}\NormalTok{age, }\DataTypeTok{data =}\NormalTok{ Boston))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = medv ~ lstat * age, data = Boston)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -15.806  -4.045  -1.333   2.085  27.552 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(>|t|)    
## (Intercept) 36.0885359  1.4698355  24.553  < 2e-16 ***
## lstat       -1.3921168  0.1674555  -8.313 8.78e-16 ***
## age         -0.0007209  0.0198792  -0.036   0.9711    
## lstat:age    0.0041560  0.0018518   2.244   0.0252 *  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 6.149 on 502 degrees of freedom
## Multiple R-squared:  0.5557, Adjusted R-squared:  0.5531 
## F-statistic: 209.3 on 3 and 502 DF,  p-value: < 2.2e-16
\end{verbatim}

\subsubsection{Transformaciones no lineales para los
predictores}\label{transformaciones-no-lineales-para-los-predictores}

La función \texttt{lm()} también puede acomodar transformaciones no
lineales de los predictores. Por ejemplo, dado un predictor \(X\)
podemos crear un predictor \(X^2\) usando \texttt{I(X\^{}2)}. La función
\texttt{I()} es necesaria ya que \texttt{\^{}} tiene un significado
especial en una fórmula; envolviendo como lo hacemos permite el uso
estándar en \texttt{R}, que es \texttt{I()} para elevar \(X\) a la
potencia 2. Ahora realizamos una regresión de \texttt{medv} sobre
\texttt{lstat} y \texttt{lstat}\(^2\).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lm.fit2 <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(medv }\OperatorTok{~}\StringTok{ }\NormalTok{lstat }\OperatorTok{+}\StringTok{ }\KeywordTok{I}\NormalTok{(lstat}\OperatorTok{^}\DecValTok{2}\NormalTok{), }\DataTypeTok{data =}\NormalTok{ Boston)}
\KeywordTok{summary}\NormalTok{(lm.fit2)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = medv ~ lstat + I(lstat^2), data = Boston)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -15.2834  -3.8313  -0.5295   2.3095  25.4148 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(>|t|)    
## (Intercept) 42.862007   0.872084   49.15   <2e-16 ***
## lstat       -2.332821   0.123803  -18.84   <2e-16 ***
## I(lstat^2)   0.043547   0.003745   11.63   <2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 5.524 on 503 degrees of freedom
## Multiple R-squared:  0.6407, Adjusted R-squared:  0.6393 
## F-statistic: 448.5 on 2 and 503 DF,  p-value: < 2.2e-16
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# plot}
\KeywordTok{visreg}\NormalTok{(lm.fit2)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/lm.fit2 -1} \end{center}

~

El valor p cercano a cero asociado con el término cuadrático sugiere que
conduce a un modelo mejorado. Usamos la función \texttt{anova()} para
cuantificar aún más hasta qué punto el ajuste cuadrático es superior al
ajuste lineal.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{anova}\NormalTok{(lm.fit, lm.fit2)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Analysis of Variance Table
## 
## Model 1: medv ~ lstat
## Model 2: medv ~ lstat + I(lstat^2)
##   Res.Df   RSS Df Sum of Sq     F    Pr(>F)    
## 1    504 19472                                 
## 2    503 15347  1    4125.1 135.2 < 2.2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
\end{verbatim}

~

Aquí el Modelo 1 (\texttt{lm.fit}) representa el submodelo lineal que
contiene sólo un predictor, \texttt{lstat}, mientras que el Modelo 2
(\texttt{lm.fit2}) corresponde al modelo cuadrático más grande que tiene
dos predictores, \texttt{lstat} y \texttt{lstat}\(^2\) . La función
\texttt{anova()} realiza una prueba de hipótesis comparando los dos
modelos. La hipótesis nula es que los dos modelos se ajustan a los datos
igualmente bien, y la hipótesis alternativa es que el modelo completo es
superior. Aquí la estadística F es \texttt{135.1998221} y el valor p
asociado es virtualmente cero. Esto proporciona una evidencia muy clara
de que el modelo que contiene los predictores \texttt{lstat} y
\texttt{lstat}\(^2\) es muy superior al modelo que sólo contiene el
predictor \texttt{lstat}. Esto no es sorprendente, ya que antes vimos
evidencia de no linealidad en la relación entre \texttt{medv} y
\texttt{lstat}. Si escribimos

~

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow =} \KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{))}
\KeywordTok{plot}\NormalTok{(lm.fit2)}
\end{Highlighting}
\end{Shaded}

\includegraphics{cursoR_files/figure-latex/lm.fit2-b -1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow =} \KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

entonces vemos que cuando el término \texttt{lstat}\(^2\) se incluye en
el modelo, hay poco patrón discernible en los residuos.

~

Para crear un ajuste cúbico, podemos incluir un predictor de la forma
\texttt{I(X\^{}3)}. Sin embargo, este enfoque puede empezar a ser
engorroso para los polinomios de orden superior. Un mejor enfoque
implica usar la función \texttt{poly()} para crear el polinomio dentro
de \texttt{lm()}. Por ejemplo, el siguiente comando produce un ajuste
polinómico de quinto orden:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lm.fit5 <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(medv }\OperatorTok{~}\StringTok{ }\KeywordTok{poly}\NormalTok{(lstat, }\DecValTok{5}\NormalTok{), }\DataTypeTok{data =}\NormalTok{ Boston)}
\KeywordTok{summary}\NormalTok{(lm.fit5)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = medv ~ poly(lstat, 5), data = Boston)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -13.5433  -3.1039  -0.7052   2.0844  27.1153 
## 
## Coefficients:
##                  Estimate Std. Error t value Pr(>|t|)    
## (Intercept)       22.5328     0.2318  97.197  < 2e-16 ***
## poly(lstat, 5)1 -152.4595     5.2148 -29.236  < 2e-16 ***
## poly(lstat, 5)2   64.2272     5.2148  12.316  < 2e-16 ***
## poly(lstat, 5)3  -27.0511     5.2148  -5.187 3.10e-07 ***
## poly(lstat, 5)4   25.4517     5.2148   4.881 1.42e-06 ***
## poly(lstat, 5)5  -19.2524     5.2148  -3.692 0.000247 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 5.215 on 500 degrees of freedom
## Multiple R-squared:  0.6817, Adjusted R-squared:  0.6785 
## F-statistic: 214.2 on 5 and 500 DF,  p-value: < 2.2e-16
\end{verbatim}

~

Esto sugiere que incluir términos polinómicos adicionales, hasta el
quinto orden, conduce a una mejora en el ajuste del modelo. Sin embargo,
una investigación adicional de los datos revela que ningún término
polinómico más allá del quinto orden tiene valores p significativos en
un ajuste de regresión.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(ggplot2)}
\KeywordTok{ggplot}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ Boston, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ lstat, }\DataTypeTok{y =}\NormalTok{ medv)) }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{geom_point}\NormalTok{() }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{theme_bw}\NormalTok{() }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{stat_smooth}\NormalTok{(}\DataTypeTok{method =} \StringTok{"lm"}\NormalTok{, }\DataTypeTok{formula =}\NormalTok{ y }\OperatorTok{~}\StringTok{ }\KeywordTok{poly}\NormalTok{(x, }\DecValTok{5}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/boston-05-poly-1} \end{center}

~

Por supuesto, no estamos restringidos a usar transformaciones
polinómicas de los predictores. Aquí probamos una transformación
logarítmica.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{summary}\NormalTok{(}\KeywordTok{lm}\NormalTok{(medv }\OperatorTok{~}\StringTok{ }\KeywordTok{log}\NormalTok{(rm), }\DataTypeTok{data =}\NormalTok{ Boston))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = medv ~ log(rm), data = Boston)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -19.487  -2.875  -0.104   2.837  39.816 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(>|t|)    
## (Intercept)  -76.488      5.028  -15.21   <2e-16 ***
## log(rm)       54.055      2.739   19.73   <2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 6.915 on 504 degrees of freedom
## Multiple R-squared:  0.4358, Adjusted R-squared:  0.4347 
## F-statistic: 389.3 on 1 and 504 DF,  p-value: < 2.2e-16
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ Boston, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =} \KeywordTok{log}\NormalTok{(rm), }\DataTypeTok{y =}\NormalTok{ medv)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{theme_bw}\NormalTok{() }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{stat_smooth}\NormalTok{(}\DataTypeTok{method =} \StringTok{"lm"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/boston-lm-04-1} \end{center}

\subsection{Modelos con interacciones}\label{modelos-con-interacciones}

Supongamos que el departamento de ventas de una empresa quiere estudiar
la influencia que tiene la publicidad a través de distintos canales
sobre el número de ventas de un producto. Se dispone de un conjunto de
datos que contiene los ingresos (en millones) conseguido por ventas en
200 regiones, así como la cantidad de presupuesto, también en millones,
destinado a anuncios por radio, TV y periódicos en cada una de ellas.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tv <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\FloatTok{230.1}\NormalTok{, }\FloatTok{44.5}\NormalTok{, }\FloatTok{17.2}\NormalTok{, }\FloatTok{151.5}\NormalTok{, }\FloatTok{180.8}\NormalTok{, }\FloatTok{8.7}\NormalTok{, }\FloatTok{57.5}\NormalTok{, }\FloatTok{120.2}\NormalTok{, }\FloatTok{8.6}\NormalTok{, }\FloatTok{199.8}\NormalTok{, }\FloatTok{66.1}\NormalTok{, }
    \FloatTok{214.7}\NormalTok{, }\FloatTok{23.8}\NormalTok{, }\FloatTok{97.5}\NormalTok{, }\FloatTok{204.1}\NormalTok{, }\FloatTok{195.4}\NormalTok{, }\FloatTok{67.8}\NormalTok{, }\FloatTok{281.4}\NormalTok{, }\FloatTok{69.2}\NormalTok{, }\FloatTok{147.3}\NormalTok{, }\FloatTok{218.4}\NormalTok{, }\FloatTok{237.4}\NormalTok{, }
    \FloatTok{13.2}\NormalTok{, }\FloatTok{228.3}\NormalTok{, }\FloatTok{62.3}\NormalTok{, }\FloatTok{262.9}\NormalTok{, }\FloatTok{142.9}\NormalTok{, }\FloatTok{240.1}\NormalTok{, }\FloatTok{248.8}\NormalTok{, }\FloatTok{70.6}\NormalTok{, }\FloatTok{292.9}\NormalTok{, }\FloatTok{112.9}\NormalTok{, }\FloatTok{97.2}\NormalTok{, }
    \FloatTok{265.6}\NormalTok{, }\FloatTok{95.7}\NormalTok{, }\FloatTok{290.7}\NormalTok{, }\FloatTok{266.9}\NormalTok{, }\FloatTok{74.7}\NormalTok{, }\FloatTok{43.1}\NormalTok{, }\DecValTok{228}\NormalTok{, }\FloatTok{202.5}\NormalTok{, }\DecValTok{177}\NormalTok{, }\FloatTok{293.6}\NormalTok{, }\FloatTok{206.9}\NormalTok{, }\FloatTok{25.1}\NormalTok{, }
    \FloatTok{175.1}\NormalTok{, }\FloatTok{89.7}\NormalTok{, }\FloatTok{239.9}\NormalTok{, }\FloatTok{227.2}\NormalTok{, }\FloatTok{66.9}\NormalTok{, }\FloatTok{199.8}\NormalTok{, }\FloatTok{100.4}\NormalTok{, }\FloatTok{216.4}\NormalTok{, }\FloatTok{182.6}\NormalTok{, }\FloatTok{262.7}\NormalTok{, }\FloatTok{198.9}\NormalTok{, }
    \FloatTok{7.3}\NormalTok{, }\FloatTok{136.2}\NormalTok{, }\FloatTok{210.8}\NormalTok{, }\FloatTok{210.7}\NormalTok{, }\FloatTok{53.5}\NormalTok{, }\FloatTok{261.3}\NormalTok{, }\FloatTok{239.3}\NormalTok{, }\FloatTok{102.7}\NormalTok{, }\FloatTok{131.1}\NormalTok{, }\DecValTok{69}\NormalTok{, }\FloatTok{31.5}\NormalTok{, }\FloatTok{139.3}\NormalTok{, }
    \FloatTok{237.4}\NormalTok{, }\FloatTok{216.8}\NormalTok{, }\FloatTok{199.1}\NormalTok{, }\FloatTok{109.8}\NormalTok{, }\FloatTok{26.8}\NormalTok{, }\FloatTok{129.4}\NormalTok{, }\FloatTok{213.4}\NormalTok{, }\FloatTok{16.9}\NormalTok{, }\FloatTok{27.5}\NormalTok{, }\FloatTok{120.5}\NormalTok{, }\FloatTok{5.4}\NormalTok{, }
    \DecValTok{116}\NormalTok{, }\FloatTok{76.4}\NormalTok{, }\FloatTok{239.8}\NormalTok{, }\FloatTok{75.3}\NormalTok{, }\FloatTok{68.4}\NormalTok{, }\FloatTok{213.5}\NormalTok{, }\FloatTok{193.2}\NormalTok{, }\FloatTok{76.3}\NormalTok{, }\FloatTok{110.7}\NormalTok{, }\FloatTok{88.3}\NormalTok{, }\FloatTok{109.8}\NormalTok{, }\FloatTok{134.3}\NormalTok{, }
    \FloatTok{28.6}\NormalTok{, }\FloatTok{217.7}\NormalTok{, }\FloatTok{250.9}\NormalTok{, }\FloatTok{107.4}\NormalTok{, }\FloatTok{163.3}\NormalTok{, }\FloatTok{197.6}\NormalTok{, }\FloatTok{184.9}\NormalTok{, }\FloatTok{289.7}\NormalTok{, }\FloatTok{135.2}\NormalTok{, }\FloatTok{222.4}\NormalTok{, }\FloatTok{296.4}\NormalTok{, }
    \FloatTok{280.2}\NormalTok{, }\FloatTok{187.9}\NormalTok{, }\FloatTok{238.2}\NormalTok{, }\FloatTok{137.9}\NormalTok{, }\DecValTok{25}\NormalTok{, }\FloatTok{90.4}\NormalTok{, }\FloatTok{13.1}\NormalTok{, }\FloatTok{255.4}\NormalTok{, }\FloatTok{225.8}\NormalTok{, }\FloatTok{241.7}\NormalTok{, }\FloatTok{175.7}\NormalTok{, }
    \FloatTok{209.6}\NormalTok{, }\FloatTok{78.2}\NormalTok{, }\FloatTok{75.1}\NormalTok{, }\FloatTok{139.2}\NormalTok{, }\FloatTok{76.4}\NormalTok{, }\FloatTok{125.7}\NormalTok{, }\FloatTok{19.4}\NormalTok{, }\FloatTok{141.3}\NormalTok{, }\FloatTok{18.8}\NormalTok{, }\DecValTok{224}\NormalTok{, }\FloatTok{123.1}\NormalTok{, }\FloatTok{229.5}\NormalTok{, }
    \FloatTok{87.2}\NormalTok{, }\FloatTok{7.8}\NormalTok{, }\FloatTok{80.2}\NormalTok{, }\FloatTok{220.3}\NormalTok{, }\FloatTok{59.6}\NormalTok{, }\FloatTok{0.7}\NormalTok{, }\FloatTok{265.2}\NormalTok{, }\FloatTok{8.4}\NormalTok{, }\FloatTok{219.8}\NormalTok{, }\FloatTok{36.9}\NormalTok{, }\FloatTok{48.3}\NormalTok{, }\FloatTok{25.6}\NormalTok{, }
    \FloatTok{273.7}\NormalTok{, }\DecValTok{43}\NormalTok{, }\FloatTok{184.9}\NormalTok{, }\FloatTok{73.4}\NormalTok{, }\FloatTok{193.7}\NormalTok{, }\FloatTok{220.5}\NormalTok{, }\FloatTok{104.6}\NormalTok{, }\FloatTok{96.2}\NormalTok{, }\FloatTok{140.3}\NormalTok{, }\FloatTok{240.1}\NormalTok{, }\FloatTok{243.2}\NormalTok{, }
    \DecValTok{38}\NormalTok{, }\FloatTok{44.7}\NormalTok{, }\FloatTok{280.7}\NormalTok{, }\DecValTok{121}\NormalTok{, }\FloatTok{197.6}\NormalTok{, }\FloatTok{171.3}\NormalTok{, }\FloatTok{187.8}\NormalTok{, }\FloatTok{4.1}\NormalTok{, }\FloatTok{93.9}\NormalTok{, }\FloatTok{149.8}\NormalTok{, }\FloatTok{11.7}\NormalTok{, }\FloatTok{131.7}\NormalTok{, }
    \FloatTok{172.5}\NormalTok{, }\FloatTok{85.7}\NormalTok{, }\FloatTok{188.4}\NormalTok{, }\FloatTok{163.5}\NormalTok{, }\FloatTok{117.2}\NormalTok{, }\FloatTok{234.5}\NormalTok{, }\FloatTok{17.9}\NormalTok{, }\FloatTok{206.8}\NormalTok{, }\FloatTok{215.4}\NormalTok{, }\FloatTok{284.3}\NormalTok{, }\DecValTok{50}\NormalTok{, }
    \FloatTok{164.5}\NormalTok{, }\FloatTok{19.6}\NormalTok{, }\FloatTok{168.4}\NormalTok{, }\FloatTok{222.4}\NormalTok{, }\FloatTok{276.9}\NormalTok{, }\FloatTok{248.4}\NormalTok{, }\FloatTok{170.2}\NormalTok{, }\FloatTok{276.7}\NormalTok{, }\FloatTok{165.6}\NormalTok{, }\FloatTok{156.6}\NormalTok{, }\FloatTok{218.5}\NormalTok{, }
    \FloatTok{56.2}\NormalTok{, }\FloatTok{287.6}\NormalTok{, }\FloatTok{253.8}\NormalTok{, }\DecValTok{205}\NormalTok{, }\FloatTok{139.5}\NormalTok{, }\FloatTok{191.1}\NormalTok{, }\DecValTok{286}\NormalTok{, }\FloatTok{18.7}\NormalTok{, }\FloatTok{39.5}\NormalTok{, }\FloatTok{75.5}\NormalTok{, }\FloatTok{17.2}\NormalTok{, }\FloatTok{166.8}\NormalTok{, }
    \FloatTok{149.7}\NormalTok{, }\FloatTok{38.2}\NormalTok{, }\FloatTok{94.2}\NormalTok{, }\DecValTok{177}\NormalTok{, }\FloatTok{283.6}\NormalTok{, }\FloatTok{232.1}\NormalTok{)}
\NormalTok{radio <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\FloatTok{37.8}\NormalTok{, }\FloatTok{39.3}\NormalTok{, }\FloatTok{45.9}\NormalTok{, }\FloatTok{41.3}\NormalTok{, }\FloatTok{10.8}\NormalTok{, }\FloatTok{48.9}\NormalTok{, }\FloatTok{32.8}\NormalTok{, }\FloatTok{19.6}\NormalTok{, }\FloatTok{2.1}\NormalTok{, }\FloatTok{2.6}\NormalTok{, }\FloatTok{5.8}\NormalTok{, }\DecValTok{24}\NormalTok{, }
    \FloatTok{35.1}\NormalTok{, }\FloatTok{7.6}\NormalTok{, }\FloatTok{32.9}\NormalTok{, }\FloatTok{47.7}\NormalTok{, }\FloatTok{36.6}\NormalTok{, }\FloatTok{39.6}\NormalTok{, }\FloatTok{20.5}\NormalTok{, }\FloatTok{23.9}\NormalTok{, }\FloatTok{27.7}\NormalTok{, }\FloatTok{5.1}\NormalTok{, }\FloatTok{15.9}\NormalTok{, }\FloatTok{16.9}\NormalTok{, }\FloatTok{12.6}\NormalTok{, }
    \FloatTok{3.5}\NormalTok{, }\FloatTok{29.3}\NormalTok{, }\FloatTok{16.7}\NormalTok{, }\FloatTok{27.1}\NormalTok{, }\DecValTok{16}\NormalTok{, }\FloatTok{28.3}\NormalTok{, }\FloatTok{17.4}\NormalTok{, }\FloatTok{1.5}\NormalTok{, }\DecValTok{20}\NormalTok{, }\FloatTok{1.4}\NormalTok{, }\FloatTok{4.1}\NormalTok{, }\FloatTok{43.8}\NormalTok{, }\FloatTok{49.4}\NormalTok{, }\FloatTok{26.7}\NormalTok{, }
    \FloatTok{37.7}\NormalTok{, }\FloatTok{22.3}\NormalTok{, }\FloatTok{33.4}\NormalTok{, }\FloatTok{27.7}\NormalTok{, }\FloatTok{8.4}\NormalTok{, }\FloatTok{25.7}\NormalTok{, }\FloatTok{22.5}\NormalTok{, }\FloatTok{9.9}\NormalTok{, }\FloatTok{41.5}\NormalTok{, }\FloatTok{15.8}\NormalTok{, }\FloatTok{11.7}\NormalTok{, }\FloatTok{3.1}\NormalTok{, }\FloatTok{9.6}\NormalTok{, }
    \FloatTok{41.7}\NormalTok{, }\FloatTok{46.2}\NormalTok{, }\FloatTok{28.8}\NormalTok{, }\FloatTok{49.4}\NormalTok{, }\FloatTok{28.1}\NormalTok{, }\FloatTok{19.2}\NormalTok{, }\FloatTok{49.6}\NormalTok{, }\FloatTok{29.5}\NormalTok{, }\DecValTok{2}\NormalTok{, }\FloatTok{42.7}\NormalTok{, }\FloatTok{15.5}\NormalTok{, }\FloatTok{29.6}\NormalTok{, }\FloatTok{42.8}\NormalTok{, }
    \FloatTok{9.3}\NormalTok{, }\FloatTok{24.6}\NormalTok{, }\FloatTok{14.5}\NormalTok{, }\FloatTok{27.5}\NormalTok{, }\FloatTok{43.9}\NormalTok{, }\FloatTok{30.6}\NormalTok{, }\FloatTok{14.3}\NormalTok{, }\DecValTok{33}\NormalTok{, }\FloatTok{5.7}\NormalTok{, }\FloatTok{24.6}\NormalTok{, }\FloatTok{43.7}\NormalTok{, }\FloatTok{1.6}\NormalTok{, }\FloatTok{28.5}\NormalTok{, }
    \FloatTok{29.9}\NormalTok{, }\FloatTok{7.7}\NormalTok{, }\FloatTok{26.7}\NormalTok{, }\FloatTok{4.1}\NormalTok{, }\FloatTok{20.3}\NormalTok{, }\FloatTok{44.5}\NormalTok{, }\DecValTok{43}\NormalTok{, }\FloatTok{18.4}\NormalTok{, }\FloatTok{27.5}\NormalTok{, }\FloatTok{40.6}\NormalTok{, }\FloatTok{25.5}\NormalTok{, }\FloatTok{47.8}\NormalTok{, }\FloatTok{4.9}\NormalTok{, }
    \FloatTok{1.5}\NormalTok{, }\FloatTok{33.5}\NormalTok{, }\FloatTok{36.5}\NormalTok{, }\DecValTok{14}\NormalTok{, }\FloatTok{31.6}\NormalTok{, }\FloatTok{3.5}\NormalTok{, }\DecValTok{21}\NormalTok{, }\FloatTok{42.3}\NormalTok{, }\FloatTok{41.7}\NormalTok{, }\FloatTok{4.3}\NormalTok{, }\FloatTok{36.3}\NormalTok{, }\FloatTok{10.1}\NormalTok{, }\FloatTok{17.2}\NormalTok{, }\FloatTok{34.3}\NormalTok{, }
    \FloatTok{46.4}\NormalTok{, }\DecValTok{11}\NormalTok{, }\FloatTok{0.3}\NormalTok{, }\FloatTok{0.4}\NormalTok{, }\FloatTok{26.9}\NormalTok{, }\FloatTok{8.2}\NormalTok{, }\DecValTok{38}\NormalTok{, }\FloatTok{15.4}\NormalTok{, }\FloatTok{20.6}\NormalTok{, }\FloatTok{46.8}\NormalTok{, }\DecValTok{35}\NormalTok{, }\FloatTok{14.3}\NormalTok{, }\FloatTok{0.8}\NormalTok{, }\FloatTok{36.9}\NormalTok{, }
    \DecValTok{16}\NormalTok{, }\FloatTok{26.8}\NormalTok{, }\FloatTok{21.7}\NormalTok{, }\FloatTok{2.4}\NormalTok{, }\FloatTok{34.6}\NormalTok{, }\FloatTok{32.3}\NormalTok{, }\FloatTok{11.8}\NormalTok{, }\FloatTok{38.9}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{49}\NormalTok{, }\DecValTok{12}\NormalTok{, }\FloatTok{39.6}\NormalTok{, }\FloatTok{2.9}\NormalTok{, }\FloatTok{27.2}\NormalTok{, }
    \FloatTok{33.5}\NormalTok{, }\FloatTok{38.6}\NormalTok{, }\DecValTok{47}\NormalTok{, }\DecValTok{39}\NormalTok{, }\FloatTok{28.9}\NormalTok{, }\FloatTok{25.9}\NormalTok{, }\FloatTok{43.9}\NormalTok{, }\DecValTok{17}\NormalTok{, }\FloatTok{35.4}\NormalTok{, }\FloatTok{33.2}\NormalTok{, }\FloatTok{5.7}\NormalTok{, }\FloatTok{14.8}\NormalTok{, }\FloatTok{1.9}\NormalTok{, }\FloatTok{7.3}\NormalTok{, }
    \DecValTok{49}\NormalTok{, }\FloatTok{40.3}\NormalTok{, }\FloatTok{25.8}\NormalTok{, }\FloatTok{13.9}\NormalTok{, }\FloatTok{8.4}\NormalTok{, }\FloatTok{23.3}\NormalTok{, }\FloatTok{39.7}\NormalTok{, }\FloatTok{21.1}\NormalTok{, }\FloatTok{11.6}\NormalTok{, }\FloatTok{43.5}\NormalTok{, }\FloatTok{1.3}\NormalTok{, }\FloatTok{36.9}\NormalTok{, }\FloatTok{18.4}\NormalTok{, }
    \FloatTok{18.1}\NormalTok{, }\FloatTok{35.8}\NormalTok{, }\FloatTok{18.1}\NormalTok{, }\FloatTok{36.8}\NormalTok{, }\FloatTok{14.7}\NormalTok{, }\FloatTok{3.4}\NormalTok{, }\FloatTok{37.6}\NormalTok{, }\FloatTok{5.2}\NormalTok{, }\FloatTok{23.6}\NormalTok{, }\FloatTok{10.6}\NormalTok{, }\FloatTok{11.6}\NormalTok{, }\FloatTok{20.9}\NormalTok{, }\FloatTok{20.1}\NormalTok{, }
    \FloatTok{7.1}\NormalTok{, }\FloatTok{3.4}\NormalTok{, }\FloatTok{48.9}\NormalTok{, }\FloatTok{30.2}\NormalTok{, }\FloatTok{7.8}\NormalTok{, }\FloatTok{2.3}\NormalTok{, }\DecValTok{10}\NormalTok{, }\FloatTok{2.6}\NormalTok{, }\FloatTok{5.4}\NormalTok{, }\FloatTok{5.7}\NormalTok{, }\DecValTok{43}\NormalTok{, }\FloatTok{21.3}\NormalTok{, }\FloatTok{45.1}\NormalTok{, }\FloatTok{2.1}\NormalTok{, }
    \FloatTok{28.7}\NormalTok{, }\FloatTok{13.9}\NormalTok{, }\FloatTok{12.1}\NormalTok{, }\FloatTok{41.1}\NormalTok{, }\FloatTok{10.8}\NormalTok{, }\FloatTok{4.1}\NormalTok{, }\DecValTok{42}\NormalTok{, }\FloatTok{35.6}\NormalTok{, }\FloatTok{3.7}\NormalTok{, }\FloatTok{4.9}\NormalTok{, }\FloatTok{9.3}\NormalTok{, }\DecValTok{42}\NormalTok{, }\FloatTok{8.6}\NormalTok{)}
\NormalTok{periodico <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\FloatTok{69.2}\NormalTok{, }\FloatTok{45.1}\NormalTok{, }\FloatTok{69.3}\NormalTok{, }\FloatTok{58.5}\NormalTok{, }\FloatTok{58.4}\NormalTok{, }\DecValTok{75}\NormalTok{, }\FloatTok{23.5}\NormalTok{, }\FloatTok{11.6}\NormalTok{, }\DecValTok{1}\NormalTok{, }\FloatTok{21.2}\NormalTok{, }\FloatTok{24.2}\NormalTok{, }
    \DecValTok{4}\NormalTok{, }\FloatTok{65.9}\NormalTok{, }\FloatTok{7.2}\NormalTok{, }\DecValTok{46}\NormalTok{, }\FloatTok{52.9}\NormalTok{, }\DecValTok{114}\NormalTok{, }\FloatTok{55.8}\NormalTok{, }\FloatTok{18.3}\NormalTok{, }\FloatTok{19.1}\NormalTok{, }\FloatTok{53.4}\NormalTok{, }\FloatTok{23.5}\NormalTok{, }\FloatTok{49.6}\NormalTok{, }\FloatTok{26.2}\NormalTok{, }\FloatTok{18.3}\NormalTok{, }
    \FloatTok{19.5}\NormalTok{, }\FloatTok{12.6}\NormalTok{, }\FloatTok{22.9}\NormalTok{, }\FloatTok{22.9}\NormalTok{, }\FloatTok{40.8}\NormalTok{, }\FloatTok{43.2}\NormalTok{, }\FloatTok{38.6}\NormalTok{, }\DecValTok{30}\NormalTok{, }\FloatTok{0.3}\NormalTok{, }\FloatTok{7.4}\NormalTok{, }\FloatTok{8.5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\FloatTok{45.7}\NormalTok{, }\FloatTok{35.1}\NormalTok{, }
    \DecValTok{32}\NormalTok{, }\FloatTok{31.6}\NormalTok{, }\FloatTok{38.7}\NormalTok{, }\FloatTok{1.8}\NormalTok{, }\FloatTok{26.4}\NormalTok{, }\FloatTok{43.3}\NormalTok{, }\FloatTok{31.5}\NormalTok{, }\FloatTok{35.7}\NormalTok{, }\FloatTok{18.5}\NormalTok{, }\FloatTok{49.9}\NormalTok{, }\FloatTok{36.8}\NormalTok{, }\FloatTok{34.6}\NormalTok{, }\FloatTok{3.6}\NormalTok{, }
    \FloatTok{39.6}\NormalTok{, }\FloatTok{58.7}\NormalTok{, }\FloatTok{15.9}\NormalTok{, }\DecValTok{60}\NormalTok{, }\FloatTok{41.4}\NormalTok{, }\FloatTok{16.6}\NormalTok{, }\FloatTok{37.7}\NormalTok{, }\FloatTok{9.3}\NormalTok{, }\FloatTok{21.4}\NormalTok{, }\FloatTok{54.7}\NormalTok{, }\FloatTok{27.3}\NormalTok{, }\FloatTok{8.4}\NormalTok{, }\FloatTok{28.9}\NormalTok{, }
    \FloatTok{0.9}\NormalTok{, }\FloatTok{2.2}\NormalTok{, }\FloatTok{10.2}\NormalTok{, }\DecValTok{11}\NormalTok{, }\FloatTok{27.2}\NormalTok{, }\FloatTok{38.7}\NormalTok{, }\FloatTok{31.7}\NormalTok{, }\FloatTok{19.3}\NormalTok{, }\FloatTok{31.3}\NormalTok{, }\FloatTok{13.1}\NormalTok{, }\FloatTok{89.4}\NormalTok{, }\FloatTok{20.7}\NormalTok{, }\FloatTok{14.2}\NormalTok{, }
    \FloatTok{9.4}\NormalTok{, }\FloatTok{23.1}\NormalTok{, }\FloatTok{22.3}\NormalTok{, }\FloatTok{36.9}\NormalTok{, }\FloatTok{32.5}\NormalTok{, }\FloatTok{35.6}\NormalTok{, }\FloatTok{33.8}\NormalTok{, }\FloatTok{65.7}\NormalTok{, }\DecValTok{16}\NormalTok{, }\FloatTok{63.2}\NormalTok{, }\FloatTok{73.4}\NormalTok{, }\FloatTok{51.4}\NormalTok{, }\FloatTok{9.3}\NormalTok{, }
    \DecValTok{33}\NormalTok{, }\DecValTok{59}\NormalTok{, }\FloatTok{72.3}\NormalTok{, }\FloatTok{10.9}\NormalTok{, }\FloatTok{52.9}\NormalTok{, }\FloatTok{5.9}\NormalTok{, }\DecValTok{22}\NormalTok{, }\FloatTok{51.2}\NormalTok{, }\FloatTok{45.9}\NormalTok{, }\FloatTok{49.8}\NormalTok{, }\FloatTok{100.9}\NormalTok{, }\FloatTok{21.4}\NormalTok{, }\FloatTok{17.9}\NormalTok{, }
    \FloatTok{5.3}\NormalTok{, }\DecValTok{59}\NormalTok{, }\FloatTok{29.7}\NormalTok{, }\FloatTok{23.2}\NormalTok{, }\FloatTok{25.6}\NormalTok{, }\FloatTok{5.5}\NormalTok{, }\FloatTok{56.5}\NormalTok{, }\FloatTok{23.2}\NormalTok{, }\FloatTok{2.4}\NormalTok{, }\FloatTok{10.7}\NormalTok{, }\FloatTok{34.5}\NormalTok{, }\FloatTok{52.7}\NormalTok{, }\FloatTok{25.6}\NormalTok{, }
    \FloatTok{14.8}\NormalTok{, }\FloatTok{79.2}\NormalTok{, }\FloatTok{22.3}\NormalTok{, }\FloatTok{46.2}\NormalTok{, }\FloatTok{50.4}\NormalTok{, }\FloatTok{15.6}\NormalTok{, }\FloatTok{12.4}\NormalTok{, }\FloatTok{74.2}\NormalTok{, }\FloatTok{25.9}\NormalTok{, }\FloatTok{50.6}\NormalTok{, }\FloatTok{9.2}\NormalTok{, }\FloatTok{3.2}\NormalTok{, }\FloatTok{43.1}\NormalTok{, }
    \FloatTok{8.7}\NormalTok{, }\DecValTok{43}\NormalTok{, }\FloatTok{2.1}\NormalTok{, }\FloatTok{45.1}\NormalTok{, }\FloatTok{65.6}\NormalTok{, }\FloatTok{8.5}\NormalTok{, }\FloatTok{9.3}\NormalTok{, }\FloatTok{59.7}\NormalTok{, }\FloatTok{20.5}\NormalTok{, }\FloatTok{1.7}\NormalTok{, }\FloatTok{12.9}\NormalTok{, }\FloatTok{75.6}\NormalTok{, }\FloatTok{37.9}\NormalTok{, }\FloatTok{34.4}\NormalTok{, }
    \FloatTok{38.9}\NormalTok{, }\DecValTok{9}\NormalTok{, }\FloatTok{8.7}\NormalTok{, }\FloatTok{44.3}\NormalTok{, }\FloatTok{11.9}\NormalTok{, }\FloatTok{20.6}\NormalTok{, }\DecValTok{37}\NormalTok{, }\FloatTok{48.7}\NormalTok{, }\FloatTok{14.2}\NormalTok{, }\FloatTok{37.7}\NormalTok{, }\FloatTok{9.5}\NormalTok{, }\FloatTok{5.7}\NormalTok{, }\FloatTok{50.5}\NormalTok{, }\FloatTok{24.3}\NormalTok{, }
    \FloatTok{45.2}\NormalTok{, }\FloatTok{34.6}\NormalTok{, }\FloatTok{30.7}\NormalTok{, }\FloatTok{49.3}\NormalTok{, }\FloatTok{25.6}\NormalTok{, }\FloatTok{7.4}\NormalTok{, }\FloatTok{5.4}\NormalTok{, }\FloatTok{84.8}\NormalTok{, }\FloatTok{21.6}\NormalTok{, }\FloatTok{19.4}\NormalTok{, }\FloatTok{57.6}\NormalTok{, }\FloatTok{6.4}\NormalTok{, }\FloatTok{18.4}\NormalTok{, }
    \FloatTok{47.4}\NormalTok{, }\DecValTok{17}\NormalTok{, }\FloatTok{12.8}\NormalTok{, }\FloatTok{13.1}\NormalTok{, }\FloatTok{41.8}\NormalTok{, }\FloatTok{20.3}\NormalTok{, }\FloatTok{35.2}\NormalTok{, }\FloatTok{23.7}\NormalTok{, }\FloatTok{17.6}\NormalTok{, }\FloatTok{8.3}\NormalTok{, }\FloatTok{27.4}\NormalTok{, }\FloatTok{29.7}\NormalTok{, }\FloatTok{71.8}\NormalTok{, }
    \DecValTok{30}\NormalTok{, }\FloatTok{19.6}\NormalTok{, }\FloatTok{26.6}\NormalTok{, }\FloatTok{18.2}\NormalTok{, }\FloatTok{3.7}\NormalTok{, }\FloatTok{23.4}\NormalTok{, }\FloatTok{5.8}\NormalTok{, }\DecValTok{6}\NormalTok{, }\FloatTok{31.6}\NormalTok{, }\FloatTok{3.6}\NormalTok{, }\DecValTok{6}\NormalTok{, }\FloatTok{13.8}\NormalTok{, }\FloatTok{8.1}\NormalTok{, }\FloatTok{6.4}\NormalTok{, }\FloatTok{66.2}\NormalTok{, }
    \FloatTok{8.7}\NormalTok{)}
\NormalTok{ventas <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\FloatTok{22.1}\NormalTok{, }\FloatTok{10.4}\NormalTok{, }\FloatTok{9.3}\NormalTok{, }\FloatTok{18.5}\NormalTok{, }\FloatTok{12.9}\NormalTok{, }\FloatTok{7.2}\NormalTok{, }\FloatTok{11.8}\NormalTok{, }\FloatTok{13.2}\NormalTok{, }\FloatTok{4.8}\NormalTok{, }\FloatTok{10.6}\NormalTok{, }\FloatTok{8.6}\NormalTok{, }\FloatTok{17.4}\NormalTok{, }
    \FloatTok{9.2}\NormalTok{, }\FloatTok{9.7}\NormalTok{, }\DecValTok{19}\NormalTok{, }\FloatTok{22.4}\NormalTok{, }\FloatTok{12.5}\NormalTok{, }\FloatTok{24.4}\NormalTok{, }\FloatTok{11.3}\NormalTok{, }\FloatTok{14.6}\NormalTok{, }\DecValTok{18}\NormalTok{, }\FloatTok{12.5}\NormalTok{, }\FloatTok{5.6}\NormalTok{, }\FloatTok{15.5}\NormalTok{, }\FloatTok{9.7}\NormalTok{, }\DecValTok{12}\NormalTok{, }
    \DecValTok{15}\NormalTok{, }\FloatTok{15.9}\NormalTok{, }\FloatTok{18.9}\NormalTok{, }\FloatTok{10.5}\NormalTok{, }\FloatTok{21.4}\NormalTok{, }\FloatTok{11.9}\NormalTok{, }\FloatTok{9.6}\NormalTok{, }\FloatTok{17.4}\NormalTok{, }\FloatTok{9.5}\NormalTok{, }\FloatTok{12.8}\NormalTok{, }\FloatTok{25.4}\NormalTok{, }\FloatTok{14.7}\NormalTok{, }\FloatTok{10.1}\NormalTok{, }
    \FloatTok{21.5}\NormalTok{, }\FloatTok{16.6}\NormalTok{, }\FloatTok{17.1}\NormalTok{, }\FloatTok{20.7}\NormalTok{, }\FloatTok{12.9}\NormalTok{, }\FloatTok{8.5}\NormalTok{, }\FloatTok{14.9}\NormalTok{, }\FloatTok{10.6}\NormalTok{, }\FloatTok{23.2}\NormalTok{, }\FloatTok{14.8}\NormalTok{, }\FloatTok{9.7}\NormalTok{, }\FloatTok{11.4}\NormalTok{, }\FloatTok{10.7}\NormalTok{, }
    \FloatTok{22.6}\NormalTok{, }\FloatTok{21.2}\NormalTok{, }\FloatTok{20.2}\NormalTok{, }\FloatTok{23.7}\NormalTok{, }\FloatTok{5.5}\NormalTok{, }\FloatTok{13.2}\NormalTok{, }\FloatTok{23.8}\NormalTok{, }\FloatTok{18.4}\NormalTok{, }\FloatTok{8.1}\NormalTok{, }\FloatTok{24.2}\NormalTok{, }\FloatTok{15.7}\NormalTok{, }\DecValTok{14}\NormalTok{, }\DecValTok{18}\NormalTok{, }
    \FloatTok{9.3}\NormalTok{, }\FloatTok{9.5}\NormalTok{, }\FloatTok{13.4}\NormalTok{, }\FloatTok{18.9}\NormalTok{, }\FloatTok{22.3}\NormalTok{, }\FloatTok{18.3}\NormalTok{, }\FloatTok{12.4}\NormalTok{, }\FloatTok{8.8}\NormalTok{, }\DecValTok{11}\NormalTok{, }\DecValTok{17}\NormalTok{, }\FloatTok{8.7}\NormalTok{, }\FloatTok{6.9}\NormalTok{, }\FloatTok{14.2}\NormalTok{, }\FloatTok{5.3}\NormalTok{, }
    \DecValTok{11}\NormalTok{, }\FloatTok{11.8}\NormalTok{, }\FloatTok{12.3}\NormalTok{, }\FloatTok{11.3}\NormalTok{, }\FloatTok{13.6}\NormalTok{, }\FloatTok{21.7}\NormalTok{, }\FloatTok{15.2}\NormalTok{, }\DecValTok{12}\NormalTok{, }\DecValTok{16}\NormalTok{, }\FloatTok{12.9}\NormalTok{, }\FloatTok{16.7}\NormalTok{, }\FloatTok{11.2}\NormalTok{, }\FloatTok{7.3}\NormalTok{, }\FloatTok{19.4}\NormalTok{, }
    \FloatTok{22.2}\NormalTok{, }\FloatTok{11.5}\NormalTok{, }\FloatTok{16.9}\NormalTok{, }\FloatTok{11.7}\NormalTok{, }\FloatTok{15.5}\NormalTok{, }\FloatTok{25.4}\NormalTok{, }\FloatTok{17.2}\NormalTok{, }\FloatTok{11.7}\NormalTok{, }\FloatTok{23.8}\NormalTok{, }\FloatTok{14.8}\NormalTok{, }\FloatTok{14.7}\NormalTok{, }\FloatTok{20.7}\NormalTok{, }
    \FloatTok{19.2}\NormalTok{, }\FloatTok{7.2}\NormalTok{, }\FloatTok{8.7}\NormalTok{, }\FloatTok{5.3}\NormalTok{, }\FloatTok{19.8}\NormalTok{, }\FloatTok{13.4}\NormalTok{, }\FloatTok{21.8}\NormalTok{, }\FloatTok{14.1}\NormalTok{, }\FloatTok{15.9}\NormalTok{, }\FloatTok{14.6}\NormalTok{, }\FloatTok{12.6}\NormalTok{, }\FloatTok{12.2}\NormalTok{, }\FloatTok{9.4}\NormalTok{, }
    \FloatTok{15.9}\NormalTok{, }\FloatTok{6.6}\NormalTok{, }\FloatTok{15.5}\NormalTok{, }\DecValTok{7}\NormalTok{, }\FloatTok{11.6}\NormalTok{, }\FloatTok{15.2}\NormalTok{, }\FloatTok{19.7}\NormalTok{, }\FloatTok{10.6}\NormalTok{, }\FloatTok{6.6}\NormalTok{, }\FloatTok{8.8}\NormalTok{, }\FloatTok{24.7}\NormalTok{, }\FloatTok{9.7}\NormalTok{, }\FloatTok{1.6}\NormalTok{, }\FloatTok{12.7}\NormalTok{, }
    \FloatTok{5.7}\NormalTok{, }\FloatTok{19.6}\NormalTok{, }\FloatTok{10.8}\NormalTok{, }\FloatTok{11.6}\NormalTok{, }\FloatTok{9.5}\NormalTok{, }\FloatTok{20.8}\NormalTok{, }\FloatTok{9.6}\NormalTok{, }\FloatTok{20.7}\NormalTok{, }\FloatTok{10.9}\NormalTok{, }\FloatTok{19.2}\NormalTok{, }\FloatTok{20.1}\NormalTok{, }\FloatTok{10.4}\NormalTok{, }\FloatTok{11.4}\NormalTok{, }
    \FloatTok{10.3}\NormalTok{, }\FloatTok{13.2}\NormalTok{, }\FloatTok{25.4}\NormalTok{, }\FloatTok{10.9}\NormalTok{, }\FloatTok{10.1}\NormalTok{, }\FloatTok{16.1}\NormalTok{, }\FloatTok{11.6}\NormalTok{, }\FloatTok{16.6}\NormalTok{, }\DecValTok{19}\NormalTok{, }\FloatTok{15.6}\NormalTok{, }\FloatTok{3.2}\NormalTok{, }\FloatTok{15.3}\NormalTok{, }\FloatTok{10.1}\NormalTok{, }
    \FloatTok{7.3}\NormalTok{, }\FloatTok{12.9}\NormalTok{, }\FloatTok{14.4}\NormalTok{, }\FloatTok{13.3}\NormalTok{, }\FloatTok{14.9}\NormalTok{, }\DecValTok{18}\NormalTok{, }\FloatTok{11.9}\NormalTok{, }\FloatTok{11.9}\NormalTok{, }\DecValTok{8}\NormalTok{, }\FloatTok{12.2}\NormalTok{, }\FloatTok{17.1}\NormalTok{, }\DecValTok{15}\NormalTok{, }\FloatTok{8.4}\NormalTok{, }\FloatTok{14.5}\NormalTok{, }
    \FloatTok{7.6}\NormalTok{, }\FloatTok{11.7}\NormalTok{, }\FloatTok{11.5}\NormalTok{, }\DecValTok{27}\NormalTok{, }\FloatTok{20.2}\NormalTok{, }\FloatTok{11.7}\NormalTok{, }\FloatTok{11.8}\NormalTok{, }\FloatTok{12.6}\NormalTok{, }\FloatTok{10.5}\NormalTok{, }\FloatTok{12.2}\NormalTok{, }\FloatTok{8.7}\NormalTok{, }\FloatTok{26.2}\NormalTok{, }\FloatTok{17.6}\NormalTok{, }
    \FloatTok{22.6}\NormalTok{, }\FloatTok{10.3}\NormalTok{, }\FloatTok{17.3}\NormalTok{, }\FloatTok{15.9}\NormalTok{, }\FloatTok{6.7}\NormalTok{, }\FloatTok{10.8}\NormalTok{, }\FloatTok{9.9}\NormalTok{, }\FloatTok{5.9}\NormalTok{, }\FloatTok{19.6}\NormalTok{, }\FloatTok{17.3}\NormalTok{, }\FloatTok{7.6}\NormalTok{, }\FloatTok{9.7}\NormalTok{, }\FloatTok{12.8}\NormalTok{, }
    \FloatTok{25.5}\NormalTok{, }\FloatTok{13.4}\NormalTok{)}

\NormalTok{datos <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(tv, radio, periodico, ventas)}
\end{Highlighting}
\end{Shaded}

El modelo lineal múltiple que se obtiene empleando las variables
\texttt{tv}, \texttt{radio} y \texttt{periodico} como predictores de
ventas es el siguiente:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{modelo <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(ventas }\OperatorTok{~}\StringTok{ }\NormalTok{tv }\OperatorTok{+}\StringTok{ }\NormalTok{radio }\OperatorTok{+}\StringTok{ }\NormalTok{periodico, }\DataTypeTok{data =}\NormalTok{ datos)}
\KeywordTok{summary}\NormalTok{(modelo)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = ventas ~ tv + radio + periodico, data = datos)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -8.8277 -0.8908  0.2418  1.1893  2.8292 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(>|t|)    
## (Intercept)  2.938889   0.311908   9.422   <2e-16 ***
## tv           0.045765   0.001395  32.809   <2e-16 ***
## radio        0.188530   0.008611  21.893   <2e-16 ***
## periodico   -0.001037   0.005871  -0.177     0.86    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 1.686 on 196 degrees of freedom
## Multiple R-squared:  0.8972, Adjusted R-squared:  0.8956 
## F-statistic: 570.3 on 3 and 196 DF,  p-value: < 2.2e-16
\end{verbatim}

De acuerdo al p-value obtenido para el coeficiente parcial de regresión
de \texttt{periodico}, esta variable no contribuye de forma
significativa al modelo. Como resultado de este análisis se concluye que
las variables \texttt{tv} y \texttt{radio} están asociadas con la
cantidad de ventas.

Con el comando \texttt{update()}, podemos actualizar el \texttt{modelo}.
Por ejemplo:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{modelo <-}\StringTok{ }\KeywordTok{update}\NormalTok{(modelo, .}\OperatorTok{~}\NormalTok{. }\OperatorTok{-}\NormalTok{periodico)}
\KeywordTok{summary}\NormalTok{(modelo)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = ventas ~ tv + radio, data = datos)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -8.7977 -0.8752  0.2422  1.1708  2.8328 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(>|t|)    
## (Intercept)  2.92110    0.29449   9.919   <2e-16 ***
## tv           0.04575    0.00139  32.909   <2e-16 ***
## radio        0.18799    0.00804  23.382   <2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 1.681 on 197 degrees of freedom
## Multiple R-squared:  0.8972, Adjusted R-squared:  0.8962 
## F-statistic: 859.6 on 2 and 197 DF,  p-value: < 2.2e-16
\end{verbatim}

Al ser un modelo con dos predictores continuos se puede representar en
3D

\begin{center}\includegraphics{cursoR_files/figure-latex/persp-04-1-1} \end{center}

El modelo lineal a partir del cual se han obtenido las conclusiones
asume que el efecto sobre las ventas debido a un incremento en el
presupuesto de uno de los medios de comunicación es independiente del
presupuesto gastado en los otros. Por ejemplo, el modelo lineal
considera que el efecto promedio sobre las ventas debido a aumentar en
una unidad el presupuesto de anuncios en TV es siempre de 0.04575,
independientemente de la cantidad invertida en anuncios por radio. Sin
embargo, la representación gráfica muestra que el modelo tiende a
sobrevalorar las ventas cuando el presupuesto es muy alto en uno de los
medios pero muy bajo en el otro. Por contra, los valores de ventas
predichos por el modelo están por debajo de las ventas reales cuando el
presupuesto está repartido de forma equitativa entre ambos medios. Este
comportamiento sugiere que existe interacción entre los predictores, por
lo que el efecto de cada uno de ellos sobre la variable respuesta
depende en cierta medida del valor que tome el otro predictor.

Tal y como se ha definido previamente, un modelo lineal con dos
predictores sigue la ecuación:

\[
Y={\beta}_0+ \beta_1 X_1+ \beta_2 X_2+ \epsilon
\]

De acuerdo a esta definición, el incremento de una unidad en el
predictor \(X_1\) produce un incremento promedio de la variable \(Y\) de
\(\beta_1\). Modificaciones en el predictor \(X_2\) no alteran este
hecho, y lo mismo ocurre con \(X_2\) respecto a \(X_1\). Para que el
modelo pueda contemplar la interacción se introduce un tercer predictor,
que se construye con el producto de los predictores \(X_1\) y \(X_2\).

\[
Y=\beta_0+\beta_1 X_1+\beta_2 X_2+ \beta_3 X_1X_2+\epsilon
\] La reorganización de los términos resulta en:

\[
  Y=\beta_0+(\beta_1+\beta_3 X_2)X_1+\beta_2X_2+\epsilon
\] El efecto de \(X_1\) sobre \(Y\) ya no es constante, sino que depende
del valor que tome \(X_2\).

En \texttt{R} se puede introducir interacción entre predictores de dos
formas, indicando los predictores individuales y entre cuales se quiere
evaluar la interacción, o bien de forma directa.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{modelo_interaccion <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(}\DataTypeTok{formula =}\NormalTok{ ventas }\OperatorTok{~}\StringTok{ }\NormalTok{tv }\OperatorTok{+}\StringTok{ }\NormalTok{radio }\OperatorTok{+}\StringTok{ }\NormalTok{tv}\OperatorTok{:}\NormalTok{radio, }\DataTypeTok{data =}\NormalTok{ datos)}
\KeywordTok{summary}\NormalTok{(modelo_interaccion)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = ventas ~ tv + radio + tv:radio, data = datos)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -6.3366 -0.4028  0.1831  0.5948  1.5246 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(>|t|)    
## (Intercept) 6.750e+00  2.479e-01  27.233   <2e-16 ***
## tv          1.910e-02  1.504e-03  12.699   <2e-16 ***
## radio       2.886e-02  8.905e-03   3.241   0.0014 ** 
## tv:radio    1.086e-03  5.242e-05  20.727   <2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.9435 on 196 degrees of freedom
## Multiple R-squared:  0.9678, Adjusted R-squared:  0.9673 
## F-statistic:  1963 on 3 and 196 DF,  p-value: < 2.2e-16
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# O tambien}
\CommentTok{# lm(formula = ventas ~ tv * radio, data = datos) es equivalente.}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/persp-05-2-1} \end{center}

Los resultados muestran una evidencia clara de que la interacción
\texttt{tv:radio} es significativa y de que el modelo que incorpora la
interacción (Adjusted R-squared = 0.9673) es superior al modelo que solo
contemplaba el efecto de los predictores por separado (Adjusted
R-squared = 0.8956).

Se puede emplear un ANOVA para realizar un test de hipótesis y obtener
un p-value que evalúe la hipótesis nula de que ambos modelos se ajustan
a los datos igual de bien.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{anova}\NormalTok{(modelo, modelo_interaccion)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Analysis of Variance Table
## 
## Model 1: ventas ~ tv + radio
## Model 2: ventas ~ tv + radio + tv:radio
##   Res.Df    RSS Df Sum of Sq      F    Pr(>F)    
## 1    197 556.91                                  
## 2    196 174.48  1    382.43 429.59 < 2.2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
\end{verbatim}

En los modelos de regresión lineal múltiple que incorporan interacciones
entre predictores hay que tener en cuenta que si se incorpora al modelo
una interacción entre predictores, se deben incluir siempre los
predictores individuales que participan en la interacción,
independientemente de que su p-value sega significativo o no.

La interacción entre predictores no está limitada a predictores
cuantitativos, también puede crearse interacción entre predictor
cuantitativo y cualitativo.

\chapter{Regresión logística}\label{regresiuxf3n-loguxedstica}

Una regresión logística se utiliza típicamente cuando hay una variable
de resultado dicotómica (como ganar o perder), y una variable predictiva
continua que está relacionada con la probabilidad o ``odds'' de la
variable de resultado. También se puede utilizar con predictores
categóricos y con múltiples predictores.

~

Si usamos una regresión lineal para modelar una variable dicotómica
(como \(Y\)), es posible que el modelo resultante no restrinja los \(Y\)
pronosticados dentro de \(0\) y \(1\). Además, otros supuestos de
regresión lineal como la normalidad del error pueden ser violados. Así
que en vez de eso, modelamos las probabilidades del evento de \$log
(logit) o logit, donde, \(p\) es la probabilidad del evento.

\[
    z_i = \ln(\frac{p_i}{1-p_i}) =   \beta_0 + \beta_1 x_1 + ... + \beta_p x_p
\]

~

La ecuación anterior puede ser modelada usando \texttt{glm()} mediante
el argumento \texttt{family="binomial}. Pero estamos más interesados en
la probabilidad del evento que en las probabilidades logarítmicas del
evento. Por lo tanto, los valores pronosticados del modelo anterior, es
decir, las probabilidades logarítmicas del evento, pueden convertirse a
probabilidad de evento de la siguiente manera:

\[
  p_i =1-\frac{1}{1 + \exp(z_i)}
\]

A esto se le llama la \emph{logit-inversa}, \texttt{?plogis}.

~

El siguiente gráfico relaciona \texttt{p} y \texttt{logit(p)}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p <-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DataTypeTok{l=}\DecValTok{1000}\NormalTok{)}
\NormalTok{logitp <-}\StringTok{ }\KeywordTok{log}\NormalTok{(p}\OperatorTok{/}\NormalTok{(}\DecValTok{1}\OperatorTok{-}\NormalTok{p))}
\KeywordTok{plot}\NormalTok{(logitp,p,}\DataTypeTok{t=}\StringTok{'l'}\NormalTok{,}\DataTypeTok{xlab=}\StringTok{"log(p/1-p)"}\NormalTok{)}
\KeywordTok{abline}\NormalTok{(}\DataTypeTok{h=}\KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\FloatTok{0.5}\NormalTok{,}\DecValTok{1}\NormalTok{),}\DataTypeTok{v=}\DecValTok{0}\NormalTok{,}\DataTypeTok{col=}\StringTok{"grey"}\NormalTok{)}
\KeywordTok{points}\NormalTok{(}\DecValTok{0}\NormalTok{,}\FloatTok{0.5}\NormalTok{,}\DataTypeTok{pch=}\DecValTok{19}\NormalTok{,}\DataTypeTok{col=}\StringTok{"red"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/logit-06-1} \end{center}

\section{\texorpdfstring{Ejemplo: Datos de crédito en Alemania
(\emph{Credit
scoring})}{Ejemplo: Datos de crédito en Alemania (Credit scoring)}}\label{ejemplo-datos-de-cruxe9dito-en-alemania-credit-scoring}

Cuando un banco recibe una solicitud de préstamo, basada en el perfil
del solicitante, el banco tiene que tomar una decisión sobre si procede
o no con la aprobación del préstamo. Hay dos tipos de riesgos asociados
a la decisión del banco:

\begin{itemize}
\item
  Si el solicitante tiene un buen riesgo de crédito, es decir, es
  probable que pague el préstamo, entonces no aprobar el préstamo a la
  persona resulta en una pérdida de negocio para el banco.
\item
  Si el solicitante tiene un riesgo de crédito malo, es decir, no es
  probable que pague el préstamo, entonces la aprobación del préstamo a
  la persona resulta en una pérdida financiera para el banco.
\end{itemize}

~

El objetivo de este tipo de análisis es \textbf{minimizar el riesgo y
maximizar el beneficio del banco}.

Para minimizar las pérdidas desde la perspectiva del banco, el banco
necesita una regla de decisión sobre a quién dar la aprobación del
préstamo y a quién no. Los perfiles demográficos y socioeconómicos de un
solicitante son considerados por los administradores de préstamos antes
de que se tome una decisión sobre su solicitud de préstamo.

~

Los datos
\href{https://archive.ics.uci.edu/ml/datasets/statlog+(german+credit+data)}{German
Credit Data} contiene datos sobre 20 variables y la clasificación de si
un solicitante es considerado un \emph{Bueno} o un \emph{Malo} riesgo de
crédito para 1000 solicitantes de préstamos.

~

Se espera que un \emph{modelo predictivo} elaborado a partir de estos
datos sirva de guía al gerente del banco para tomar una decisión sobre
la aprobación de un préstamo a un posible solicitante en función de su
perfil.

\href{ftp.ics.uci.edu/pub/machine-learning-databases/statlog/german/german.doc}{Ver
descripción (en inglés)}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# German Credit Data}
\NormalTok{gcreditdata <-}\StringTok{ }\KeywordTok{read.table}\NormalTok{(}\StringTok{"https://archive.ics.uci.edu/ml/machine-learning-databases/statlog/german/german.data"}\NormalTok{, }\DataTypeTok{header =} \OtherTok{FALSE}\NormalTok{)}

\KeywordTok{colnames}\NormalTok{(gcreditdata)<-}\KeywordTok{c}\NormalTok{(}\StringTok{"account.status"}\NormalTok{,}\StringTok{"months"}\NormalTok{,}
                \StringTok{"credit.history"}\NormalTok{,}\StringTok{"purpose"}\NormalTok{,}\StringTok{"credit.amount"}\NormalTok{,}
                \StringTok{"savings"}\NormalTok{,}\StringTok{"employment"}\NormalTok{,}\StringTok{"installment.rate"}\NormalTok{,}\StringTok{"personal.status"}\NormalTok{,}
                \StringTok{"guarantors"}\NormalTok{,}\StringTok{"residence"}\NormalTok{,}\StringTok{"property"}\NormalTok{,}\StringTok{"age"}\NormalTok{,}\StringTok{"other.installments"}\NormalTok{,}
                \StringTok{"housing"}\NormalTok{,}\StringTok{"credit.cards"}\NormalTok{,}\StringTok{"job"}\NormalTok{,}\StringTok{"dependents"}\NormalTok{,}\StringTok{"phone"}\NormalTok{,}\StringTok{"foreign.worker"}\NormalTok{,}\StringTok{"credit.rating"}\NormalTok{)}

\KeywordTok{head}\NormalTok{(gcreditdata)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   account.status months credit.history purpose credit.amount savings
## 1            A11      6            A34     A43          1169     A65
## 2            A12     48            A32     A43          5951     A61
## 3            A14     12            A34     A46          2096     A61
## 4            A11     42            A32     A42          7882     A61
## 5            A11     24            A33     A40          4870     A61
## 6            A14     36            A32     A46          9055     A65
##   employment installment.rate personal.status guarantors residence
## 1        A75                4             A93       A101         4
## 2        A73                2             A92       A101         2
## 3        A74                2             A93       A101         3
## 4        A74                2             A93       A103         4
## 5        A73                3             A93       A101         4
## 6        A73                2             A93       A101         4
##   property age other.installments housing credit.cards  job dependents
## 1     A121  67               A143    A152            2 A173          1
## 2     A121  22               A143    A152            1 A173          1
## 3     A121  49               A143    A152            1 A172          2
## 4     A122  45               A143    A153            1 A173          2
## 5     A124  53               A143    A153            2 A173          2
## 6     A124  35               A143    A153            1 A172          2
##   phone foreign.worker credit.rating
## 1  A192           A201             1
## 2  A191           A201             2
## 3  A191           A201             1
## 4  A191           A201             1
## 5  A191           A201             2
## 6  A192           A201             1
\end{verbatim}

~

Cambie el nombre de algunos niveles de factor:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{table}\NormalTok{(gcreditdata}\OperatorTok{$}\NormalTok{credit.rating) }\CommentTok{# Good = 1 / Bad = 2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##   1   2 
## 700 300
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{gcreditdata}\OperatorTok{$}\NormalTok{credit.rating <-}\StringTok{ }\KeywordTok{ifelse}\NormalTok{(gcreditdata}\OperatorTok{$}\NormalTok{credit.rating}\OperatorTok{==}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{)}
\KeywordTok{table}\NormalTok{(gcreditdata}\OperatorTok{$}\NormalTok{credit.rating) }\CommentTok{# Good = 1 / Bad = 0}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##   0   1 
## 300 700
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{levels}\NormalTok{(gcreditdata}\OperatorTok{$}\NormalTok{account.status) <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"<0DM"}\NormalTok{,}\StringTok{"<200DM"}\NormalTok{,}\StringTok{">200DM"}\NormalTok{,}\StringTok{"NoStatus"}\NormalTok{)}
\KeywordTok{levels}\NormalTok{(gcreditdata}\OperatorTok{$}\NormalTok{credit.history) <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"No"}\NormalTok{,}\StringTok{"Allpaid"}\NormalTok{,}\StringTok{"Allpaidtillnow"}\NormalTok{,}\StringTok{"Delayinpaying"}\NormalTok{,}\StringTok{"Critical"}\NormalTok{)}
\KeywordTok{levels}\NormalTok{(gcreditdata}\OperatorTok{$}\NormalTok{purpose) <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"car(new)"}\NormalTok{,}\StringTok{"car(used)"}\NormalTok{,}\StringTok{"furniture/equipment"}\NormalTok{,}\StringTok{"radio/television"}\NormalTok{,}\StringTok{"domesticappliances"}\NormalTok{,}
\StringTok{"repairs"}\NormalTok{,}\StringTok{"education"}\NormalTok{,}\StringTok{"vacation-doesnotexist?"}\NormalTok{,}\StringTok{"retraining"}\NormalTok{,}\StringTok{"business"}\NormalTok{,}\StringTok{"others"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

~

Dividamos los datos en dos grupos (entrenamiento y prueba), 70\%/30\%.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{n<-}\StringTok{ }\KeywordTok{dim}\NormalTok{(gcreditdata)[}\DecValTok{1}\NormalTok{]}

\KeywordTok{set.seed}\NormalTok{(}\DecValTok{1234}\NormalTok{) }\CommentTok{# select a random sample with}
\NormalTok{ train <-}\StringTok{ }\KeywordTok{sample}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\NormalTok{n , }\FloatTok{0.7}\OperatorTok{*}\NormalTok{n)}
 
\NormalTok{ gcreditdata.test <-}\StringTok{ }\NormalTok{gcreditdata[}\OperatorTok{-}\NormalTok{train,]}
\NormalTok{gcreditdata.train <-}\StringTok{ }\NormalTok{gcreditdata[train,]}

\NormalTok{ytrain <-}\StringTok{ }\NormalTok{gcreditdata}\OperatorTok{$}\NormalTok{credit.rating[train]}
\NormalTok{ ytest <-}\StringTok{ }\NormalTok{gcreditdata}\OperatorTok{$}\NormalTok{credit.rating[}\OperatorTok{-}\NormalTok{train]}
\end{Highlighting}
\end{Shaded}

~

Un modelo logístico puede ser ajustado con la función \texttt{glm}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{m1 <-}\StringTok{ }\KeywordTok{glm}\NormalTok{(credit.rating }\OperatorTok{~}\StringTok{ }\NormalTok{. , }\DataTypeTok{family =}\NormalTok{ binomial, }\DataTypeTok{data=}\NormalTok{ gcreditdata.train)}
\KeywordTok{summary}\NormalTok{(m1)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## glm(formula = credit.rating ~ ., family = binomial, data = gcreditdata.train)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.8353  -0.6178   0.3415   0.6729   2.0514  
## 
## Coefficients:
##                                 Estimate Std. Error z value Pr(>|z|)    
## (Intercept)                    5.259e-01  1.371e+00   0.384 0.701257    
## account.status<200DM           3.532e-01  2.719e-01   1.299 0.193876    
## account.status>200DM           8.198e-01  4.626e-01   1.772 0.076353 .  
## account.statusNoStatus         1.487e+00  2.782e-01   5.344 9.08e-08 ***
## months                        -3.687e-02  1.156e-02  -3.189 0.001428 ** 
## credit.historyAllpaid         -1.347e-01  6.539e-01  -0.206 0.836779    
## credit.historyAllpaidtillnow   5.296e-01  4.975e-01   1.065 0.287038    
## credit.historyDelayinpaying    7.156e-01  5.575e-01   1.284 0.199266    
## credit.historyCritical         1.439e+00  5.073e-01   2.837 0.004559 ** 
## purposecar(used)               1.838e+00  4.856e-01   3.786 0.000153 ***
## purposefurniture/equipment     1.095e+00  9.231e-01   1.186 0.235728    
## purposeradio/television        8.879e-01  3.289e-01   2.700 0.006944 ** 
## purposedomesticappliances      9.928e-01  3.107e-01   3.196 0.001395 ** 
## purposerepairs                 5.399e-01  9.006e-01   0.599 0.548881    
## purposeeducation              -4.889e-01  6.587e-01  -0.742 0.457933    
## purposevacation-doesnotexist? -1.800e-01  4.648e-01  -0.387 0.698616    
## purposeretraining              2.093e+00  1.266e+00   1.653 0.098417 .  
## purposebusiness                5.772e-01  3.985e-01   1.448 0.147489    
## credit.amount                 -1.107e-04  5.456e-05  -2.028 0.042526 *  
## savingsA62                     5.219e-01  3.548e-01   1.471 0.141326    
## savingsA63                     8.722e-01  5.710e-01   1.528 0.126623    
## savingsA64                     1.746e+00  6.533e-01   2.673 0.007514 ** 
## savingsA65                     1.354e+00  3.350e-01   4.042 5.30e-05 ***
## employmentA72                  1.729e-01  5.327e-01   0.324 0.745566    
## employmentA73                  2.462e-01  5.116e-01   0.481 0.630356    
## employmentA74                  1.182e+00  5.660e-01   2.089 0.036736 *  
## employmentA75                  4.924e-02  5.076e-01   0.097 0.922712    
## installment.rate              -4.157e-01  1.098e-01  -3.787 0.000152 ***
## personal.statusA92             5.279e-02  4.718e-01   0.112 0.910902    
## personal.statusA93             6.791e-01  4.577e-01   1.484 0.137906    
## personal.statusA94             2.017e-01  5.550e-01   0.363 0.716253    
## guarantorsA102                 1.880e-01  5.068e-01   0.371 0.710613    
## guarantorsA103                 1.024e+00  5.814e-01   1.761 0.078259 .  
## residence                      5.357e-02  1.047e-01   0.512 0.608926    
## propertyA122                  -4.618e-01  3.142e-01  -1.470 0.141584    
## propertyA123                  -4.679e-01  2.906e-01  -1.610 0.107366    
## propertyA124                  -7.642e-01  5.658e-01  -1.351 0.176834    
## age                            1.872e-02  1.172e-02   1.598 0.110121    
## other.installmentsA142        -1.259e-01  5.197e-01  -0.242 0.808648    
## other.installmentsA143         3.400e-01  2.892e-01   1.176 0.239669    
## housingA152                    5.768e-01  2.935e-01   1.965 0.049384 *  
## housingA153                    7.825e-01  6.261e-01   1.250 0.211387    
## credit.cards                  -3.720e-01  2.456e-01  -1.515 0.129882    
## jobA172                       -8.402e-01  8.307e-01  -1.011 0.311822    
## jobA173                       -9.497e-01  7.970e-01  -1.192 0.233388    
## jobA174                       -9.513e-01  8.262e-01  -1.152 0.249525    
## dependents                    -2.108e-01  3.080e-01  -0.685 0.493620    
## phoneA192                      4.876e-01  2.556e-01   1.908 0.056400 .  
## foreign.workerA202             9.540e-01  7.550e-01   1.264 0.206386    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 839.40  on 699  degrees of freedom
## Residual deviance: 596.11  on 651  degrees of freedom
## AIC: 694.11
## 
## Number of Fisher Scoring iterations: 5
\end{verbatim}

~

Variables significativas:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sig.var<-}\StringTok{ }\KeywordTok{summary}\NormalTok{(m1)}\OperatorTok{$}\NormalTok{coeff[}\OperatorTok{-}\DecValTok{1}\NormalTok{,}\DecValTok{4}\NormalTok{] }\OperatorTok{<}\FloatTok{0.01}
\KeywordTok{names}\NormalTok{(sig.var)[sig.var }\OperatorTok{==}\StringTok{ }\OtherTok{TRUE}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "account.statusNoStatus"    "months"                   
## [3] "credit.historyCritical"    "purposecar(used)"         
## [5] "purposeradio/television"   "purposedomesticappliances"
## [7] "savingsA64"                "savingsA65"               
## [9] "installment.rate"
\end{verbatim}

~

Con \texttt{predict} podemos predecir con el modelo logístico el
conjunto de test.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pred1<-}\StringTok{ }\KeywordTok{predict.glm}\NormalTok{(m1,}\DataTypeTok{newdata =}\NormalTok{ gcreditdata.test, }\DataTypeTok{type=}\StringTok{"response"}\NormalTok{)}
\NormalTok{result1<-}\StringTok{ }\KeywordTok{table}\NormalTok{(ytest, }\KeywordTok{floor}\NormalTok{(pred1}\OperatorTok{+}\FloatTok{0.5}\NormalTok{))}
\NormalTok{result1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      
## ytest   0   1
##     0  48  51
##     1  25 176
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{error1<-}\StringTok{ }\KeywordTok{sum}\NormalTok{(result1[}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{], result1[}\DecValTok{2}\NormalTok{,}\DecValTok{1}\NormalTok{])}\OperatorTok{/}\KeywordTok{sum}\NormalTok{(result1)}
\NormalTok{error1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.2533333
\end{verbatim}

~

Curva ROC con la librería \texttt{ROCR}:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(ROCR)}
\NormalTok{pred =}\StringTok{ }\NormalTok{ROCR}\OperatorTok{::}\KeywordTok{prediction}\NormalTok{(pred1,ytest)}
\NormalTok{perf <-}\StringTok{ }\KeywordTok{performance}\NormalTok{(pred, }\StringTok{"tpr"}\NormalTok{, }\StringTok{"fpr"}\NormalTok{)}
\KeywordTok{plot}\NormalTok{(perf)}
\end{Highlighting}
\end{Shaded}

\includegraphics{cursoR_files/figure-latex/ROCR-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{AUCLog1=}\KeywordTok{performance}\NormalTok{(pred, }\DataTypeTok{measure =} \StringTok{"auc"}\NormalTok{)}\OperatorTok{@}\NormalTok{y.values[[}\DecValTok{1}\NormalTok{]]}
\KeywordTok{cat}\NormalTok{(}\StringTok{"AUC: "}\NormalTok{,AUCLog1,}\StringTok{"n"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## AUC:  0.7699382 n
\end{verbatim}

\section{Ejemplo: Predecir el salario de los
trabajadores}\label{ejemplo-predecir-el-salario-de-los-trabajadores}

Consideremos los datos \texttt{adult.csv}. Intentaremos predecir la
variable de respuesta \texttt{ABOVE50k} (Salario \textgreater{}50k)
mediante una regresión logística basada en variables demográficas
explicativas.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{inputData <-}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\StringTok{"http://idaejin.github.io/courses/R/data/adult.csv"}\NormalTok{)}
\KeywordTok{head}\NormalTok{(inputData)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   AGE         WORKCLASS FNLWGT  EDUCATION EDUCATIONNUM       MARITALSTATUS
## 1  39         State-gov  77516  Bachelors           13       Never-married
## 2  50  Self-emp-not-inc  83311  Bachelors           13  Married-civ-spouse
## 3  38           Private 215646    HS-grad            9            Divorced
## 4  53           Private 234721       11th            7  Married-civ-spouse
## 5  28           Private 338409  Bachelors           13  Married-civ-spouse
## 6  37           Private 284582    Masters           14  Married-civ-spouse
##           OCCUPATION   RELATIONSHIP   RACE     SEX CAPITALGAIN CAPITALLOSS
## 1       Adm-clerical  Not-in-family  White    Male        2174           0
## 2    Exec-managerial        Husband  White    Male           0           0
## 3  Handlers-cleaners  Not-in-family  White    Male           0           0
## 4  Handlers-cleaners        Husband  Black    Male           0           0
## 5     Prof-specialty           Wife  Black  Female           0           0
## 6    Exec-managerial           Wife  White  Female           0           0
##   HOURSPERWEEK  NATIVECOUNTRY ABOVE50K
## 1           40  United-States        0
## 2           13  United-States        0
## 3           40  United-States        0
## 4           40  United-States        0
## 5           40           Cuba        0
## 6           40  United-States        0
\end{verbatim}

\textbf{Verificar sesgo de clase}

Idealmente, la proporción de eventos y no eventos en la variable \(Y\)
debería ser aproximadamente la misma. Por lo tanto, primero verifiquemos
la proporción de clases en la variable dependiente \texttt{ABOVE50K}.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{table}\NormalTok{(inputData}\OperatorTok{$}\NormalTok{ABOVE50K)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##     0     1 
## 24720  7841
\end{verbatim}

Claramente, existe un sesgo de clase, una condición observada cuando la
proporción de eventos es mucho menor que la proporción de no eventos.
Por lo tanto, debemos muestrear las observaciones en proporciones
aproximadamente iguales para obtener mejores modelos.

\textbf{Crear Muestras de Entrenamiento y Pruebas}

Una manera de abordar el problema del sesgo de clase es muestrear los 0
y 1 para los \texttt{trainingData} (muestra de entrenamiento) en
proporciones iguales. Al hacerlo, pondremos el resto de los
\texttt{inputData} no incluidos para la formación en \texttt{testData}
(muestra de validación). Como resultado, el tamaño de la muestra de
entrenamiento será menor que el de la validación, lo que está bien,
porque hay un gran número de observaciones (\texttt{\textgreater{}10K}).

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Create Training Data}
\NormalTok{ input_ones <-}\StringTok{ }\NormalTok{inputData[}\KeywordTok{which}\NormalTok{(inputData}\OperatorTok{$}\NormalTok{ABOVE50K }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{), ]  }\CommentTok{# all 1's}
\NormalTok{input_zeros <-}\StringTok{ }\NormalTok{inputData[}\KeywordTok{which}\NormalTok{(inputData}\OperatorTok{$}\NormalTok{ABOVE50K }\OperatorTok{==}\StringTok{ }\DecValTok{0}\NormalTok{), ]  }\CommentTok{# all 0's}

\KeywordTok{set.seed}\NormalTok{(}\DecValTok{100}\NormalTok{)  }\CommentTok{# for repeatability of samples}

\NormalTok{input_ones_training_rows <-}\StringTok{ }\KeywordTok{sample}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\KeywordTok{nrow}\NormalTok{(input_ones), }\FloatTok{0.7}\OperatorTok{*}\KeywordTok{nrow}\NormalTok{(input_ones))  }\CommentTok{# 1's for training}
\NormalTok{input_zeros_training_rows <-}\StringTok{ }\KeywordTok{sample}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\KeywordTok{nrow}\NormalTok{(input_zeros), }\FloatTok{0.7}\OperatorTok{*}\KeywordTok{nrow}\NormalTok{(input_ones))  }\CommentTok{# 0's for training. }

\CommentTok{# Pick as many 0's as 1's}
\NormalTok{training_ones <-}\StringTok{ }\NormalTok{input_ones[input_ones_training_rows, ]  }
\NormalTok{training_zeros <-}\StringTok{ }\NormalTok{input_zeros[input_zeros_training_rows, ]}
\NormalTok{trainingData <-}\StringTok{ }\KeywordTok{rbind}\NormalTok{(training_ones, training_zeros)  }\CommentTok{# row bind the 1's and 0's }

\CommentTok{# Create Test Data}
\NormalTok{ test_ones <-}\StringTok{ }\NormalTok{input_ones[}\OperatorTok{-}\NormalTok{input_ones_training_rows, ]}
\NormalTok{test_zeros <-}\StringTok{ }\NormalTok{input_zeros[}\OperatorTok{-}\NormalTok{input_zeros_training_rows, ]}

\NormalTok{testData <-}\StringTok{ }\KeywordTok{rbind}\NormalTok{(test_ones, test_zeros)  }\CommentTok{# row bind the 1's and 0's }
\end{Highlighting}
\end{Shaded}

\textbf{Construir modelos de Logit y predecir}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{logitMod <-}\StringTok{ }\KeywordTok{glm}\NormalTok{(ABOVE50K }\OperatorTok{~}\StringTok{ }\NormalTok{RELATIONSHIP }\OperatorTok{+}\StringTok{ }\NormalTok{AGE }\OperatorTok{+}\StringTok{ }\NormalTok{CAPITALGAIN }\OperatorTok{+}\StringTok{ }\NormalTok{OCCUPATION }\OperatorTok{+}\StringTok{ }\NormalTok{EDUCATIONNUM, }\DataTypeTok{data=}\NormalTok{trainingData, }\DataTypeTok{family=}\KeywordTok{binomial}\NormalTok{(}\DataTypeTok{link=}\StringTok{"logit"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{predicted <-}\StringTok{ }\KeywordTok{plogis}\NormalTok{(}\KeywordTok{predict}\NormalTok{(logitMod, testData))  }\CommentTok{# predicted scores}
\CommentTok{# or}
\NormalTok{predicted <-}\StringTok{ }\KeywordTok{predict}\NormalTok{(logitMod, testData, }\DataTypeTok{type=}\StringTok{"response"}\NormalTok{)  }\CommentTok{# predicted scores}
\end{Highlighting}
\end{Shaded}

~

Cuando usamos la función de predicción en este modelo, predecirá las
probabilidades de la variable \(Y\). Para convertirlo en una
probabilidad de predicción que esté entre 0 y 1, usamos el
\texttt{plogis()}.

~

\textbf{Decidir la probabilidad de corte de predicción óptima para el
modelo.}

El puntaje de probabilidad de la predicción de corte por defecto es de
\(0.5\) o la proporción de 1's y 0's en los datos de entrenamiento. Pero
a veces, afinar el corte de probabilidad puede mejorar la precisión
tanto en las muestras de desarrollo como en las de validación. La
función \texttt{InformationValue::optimalCutoff} proporciona formas de
encontrar el punto de corte óptimo para mejorar la predicción de 1, 0, 1
y 0 y reducir el error de clasificación. Permite calcular la puntuación
óptima que minimiza el error de clasificación para el modelo anterior.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(InformationValue)}
\NormalTok{optCutOff <-}\StringTok{ }\KeywordTok{optimalCutoff}\NormalTok{(testData}\OperatorTok{$}\NormalTok{ABOVE50K, predicted)[}\DecValTok{1}\NormalTok{] }
\NormalTok{optCutOff}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.89
\end{verbatim}

~

\textbf{Error de clasificación}

El error de clasificación errónea es el desajuste porcentual de los
valores predefinidos frente a los reales, independientemente de que sean
1 o 0. Cuanto menor sea el error de clasificación, mejor será su modelo.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{misClassError}\NormalTok{(testData}\OperatorTok{$}\NormalTok{ABOVE50K, predicted, }\DataTypeTok{threshold =}\NormalTok{ optCutOff)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.0892
\end{verbatim}

\textbf{ROC}

\textbf{Receiver Operating Characteristics} a curva traza el porcentaje
de verdaderos positivos pronosticados con precisión por un modelo logit
dado a medida que la probabilidad de corte de la predicción se reduce de
1 a 0. Para un buen modelo, a medida que se reduce el corte, debería
marcar más de 1 real como positivo y menos de 0 real como 1. Por lo
tanto, para un buen modelo, la curva debería subir bruscamente,
indicando que el TPR (eje Y) aumenta más rápido que el FPR (eje X) a
medida que disminuye la puntuación de corte. Cuanto mayor sea el área
bajo la curva ROC, mejor será la capacidad de predicción del modelo.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plotROC}\NormalTok{(testData}\OperatorTok{$}\NormalTok{ABOVE50K, predicted)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/plotROC-1} \end{center}

\textbf{Especificidad y sensibilidad}

La \textbf{Sensibilidad} (o \texttt{Tasa\ Verdaderos\ Positivos}) es el
porcentaje de 1's (reales) correctamente predichos por el modelo,
mientras que, \textbf{especificidad} es el porcentaje de 0's (reales)
correctamente predicho. \textbf{La especificidad} también puede
calcularse como \texttt{1-Tasa\ Falsos\ Positivos}.

\[
\text{Sensitivity}=\frac{\#\text{Actual 1's and Predicted as 1's}}{\# \text{of Actual 1's}}
\] \[
\text{Specificity}=\frac{\#\text{Actual 0's and Predicted as 0's}}{\# \text{of Actual 0's}}
\]

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{sensitivity}\NormalTok{(testData}\OperatorTok{$}\NormalTok{ABOVE50K, predicted, }\DataTypeTok{threshold =}\NormalTok{ optCutOff)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.3442414
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{specificity}\NormalTok{(testData}\OperatorTok{$}\NormalTok{ABOVE50K, predicted, }\DataTypeTok{threshold =}\NormalTok{ optCutOff)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.9800853
\end{verbatim}

Los números anteriores se calculan a partir de la muestra de validación
que no se utilizó para la formación del modelo. Así que, una tasa de
detección de la verdad de 34.42\% en los datos de prueba es bueno.

\textbf{Matriz de Confusión} Las columnas son reales, mientras que las
filas son predicciones.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{confusionMatrix}\NormalTok{(testData}\OperatorTok{$}\NormalTok{ABOVE50K, predicted, }\DataTypeTok{threshold =}\NormalTok{ optCutOff)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##       0    1
## 0 18849 1543
## 1   383  810
\end{verbatim}

\section{Ejemplo: Datos de los supervivientes del
Titanic}\label{ejemplo-datos-de-los-supervivientes-del-titanic}

El conjunto de datos es una colección de datos sobre algunos de los
pasajeros, y el objetivo es predecir la supervivencia (1 si el pasajero
sobrevivió o 0 si no lo hizo) basándose en algunas características como
la clase de servicio, el sexo, la edad, etc. Como puede ver, vamos a
utilizar variables categóricas y continuas.

\begin{verbatim}
VARIABLE DESCRIPTIONS:
pclass          Passenger Class
                (1 = 1st; 2 = 2nd; 3 = 3rd)
survival        Survival
                (0 = No; 1 = Yes)
name            Name
sex             Sex
age             Age
sibsp           Number of Siblings/Spouses Aboard
parch           Number of Parents/Children Aboard
ticket          Ticket Number
fare            Passenger Fare
cabin           Cabin
embarked        Port of Embarkation
                (C = Cherbourg; Q = Queenstown; S = Southampton)
boat            Lifeboat
body            Body Identification Number
home_dest       Home/Destination
\end{verbatim}

Descripción completa
\href{http://biostat.mc.vanderbilt.edu/wiki/pub/Main/DataSets/titanic3info.txt}{(Aquí)}

Descarga los datos
\href{http://idaejin.github.io/courses/R/data/titanic.zip}{aquí}

Leemos los datos de entreamiento \texttt{train} y \texttt{test}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{train <-}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\StringTok{'http://idaejin.github.io/courses/R/data/titanic_train.csv'}\NormalTok{,}\DataTypeTok{header=}\OtherTok{TRUE}\NormalTok{,}\DataTypeTok{row.names=}\DecValTok{1}\NormalTok{)}
\NormalTok{ test <-}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\StringTok{'http://idaejin.github.io/courses/R/data/titanic_test.csv'}\NormalTok{,}\DataTypeTok{header=}\OtherTok{TRUE}\NormalTok{,}\DataTypeTok{row.names=}\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\textbf{Questions:}

\begin{itemize}
\item
  Ajustar un modelo logístico con \texttt{pclass} como variable
  explicativa. ¿Cuál es la interpretación del modelo ajustado?
\item
  Encontrar el mejor modelo de regresión logística posible basado en
  todas las variables disponibles.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{model <-}\StringTok{ }\KeywordTok{glm}\NormalTok{(Survived }\OperatorTok{~}\NormalTok{.,}\DataTypeTok{family=}\KeywordTok{binomial}\NormalTok{(}\DataTypeTok{link=}\StringTok{'logit'}\NormalTok{),}\DataTypeTok{data=}\NormalTok{train)}
\KeywordTok{summary}\NormalTok{(model)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## glm(formula = Survived ~ ., family = binomial(link = "logit"), 
##     data = train)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.6064  -0.5954  -0.4254   0.6220   2.4165  
## 
## Coefficients:
##              Estimate Std. Error z value Pr(>|z|)    
## (Intercept)  5.137627   0.594998   8.635  < 2e-16 ***
## Pclass      -1.087156   0.151168  -7.192 6.40e-13 ***
## Sexmale     -2.756819   0.212026 -13.002  < 2e-16 ***
## Age         -0.037267   0.008195  -4.547 5.43e-06 ***
## SibSp       -0.292920   0.114642  -2.555   0.0106 *  
## Parch       -0.116576   0.128127  -0.910   0.3629    
## Fare         0.001528   0.002353   0.649   0.5160    
## EmbarkedQ   -0.002656   0.400882  -0.007   0.9947    
## EmbarkedS   -0.318786   0.252960  -1.260   0.2076    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 1065.39  on 799  degrees of freedom
## Residual deviance:  709.39  on 791  degrees of freedom
## AIC: 727.39
## 
## Number of Fisher Scoring iterations: 5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{anova}\NormalTok{(model, }\DataTypeTok{test=}\StringTok{"Chisq"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Analysis of Deviance Table
## 
## Model: binomial, link: logit
## 
## Response: Survived
## 
## Terms added sequentially (first to last)
## 
## 
##          Df Deviance Resid. Df Resid. Dev  Pr(>Chi)    
## NULL                       799    1065.39              
## Pclass    1   83.607       798     981.79 < 2.2e-16 ***
## Sex       1  240.014       797     741.77 < 2.2e-16 ***
## Age       1   17.495       796     724.28 2.881e-05 ***
## SibSp     1   10.842       795     713.43  0.000992 ***
## Parch     1    0.863       794     712.57  0.352873    
## Fare      1    0.994       793     711.58  0.318717    
## Embarked  2    2.187       791     709.39  0.334990    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mod1 <-}\StringTok{ }\KeywordTok{glm}\NormalTok{(Survived }\OperatorTok{~}\StringTok{ }\KeywordTok{as.factor}\NormalTok{(Pclass), }\DataTypeTok{family=}\NormalTok{binomial, }\DataTypeTok{data=}\NormalTok{train)}
\KeywordTok{summary}\NormalTok{(mod1)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## glm(formula = Survived ~ as.factor(Pclass), family = binomial, 
##     data = train)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.3787  -0.7515  -0.7515   0.9887   1.6747  
## 
## Coefficients:
##                    Estimate Std. Error z value Pr(>|z|)    
## (Intercept)          0.4616     0.1474   3.131  0.00174 ** 
## as.factor(Pclass)2  -0.5455     0.2138  -2.551  0.01074 *  
## as.factor(Pclass)3  -1.5816     0.1844  -8.575  < 2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 1065.39  on 799  degrees of freedom
## Residual deviance:  979.94  on 797  degrees of freedom
## AIC: 985.94
## 
## Number of Fisher Scoring iterations: 4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{anova}\NormalTok{(mod1,}\DataTypeTok{test=}\StringTok{"Chisq"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Analysis of Deviance Table
## 
## Model: binomial, link: logit
## 
## Response: Survived
## 
## Terms added sequentially (first to last)
## 
## 
##                   Df Deviance Resid. Df Resid. Dev  Pr(>Chi)    
## NULL                                799    1065.39              
## as.factor(Pclass)  2   85.452       797     979.94 < 2.2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
\end{verbatim}

efecto de interacción entre la clase de pasajero y el sexo, ya que la
clase de pasajero mostró una diferencia mucho mayor en la tasa de
supervivencia entre las mujeres en comparación con los hombres (es
decir, las mujeres de clase superior tenían muchas más probabilidades de
sobrevivir que las mujeres de clase inferior, mientras que los hombres
de primera clase tenían más probabilidades de sobrevivir que los hombres
de segunda o tercera clase, pero no por el mismo margen que las
mujeres).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mod2 <-}\StringTok{ }\KeywordTok{glm}\NormalTok{(Survived }\OperatorTok{~}\StringTok{ }\NormalTok{Pclass }\OperatorTok{+}\StringTok{ }\NormalTok{Sex  }\OperatorTok{+}\StringTok{ }\NormalTok{Age }\OperatorTok{+}\StringTok{ }\NormalTok{SibSp, }\DataTypeTok{family =} \KeywordTok{binomial}\NormalTok{(logit), }\DataTypeTok{data =}\NormalTok{ train)}
\KeywordTok{summary}\NormalTok{(mod2)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## glm(formula = Survived ~ Pclass + Sex + Age + SibSp, family = binomial(logit), 
##     data = train)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.6595  -0.6125  -0.4247   0.6149   2.4302  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(>|z|)    
## (Intercept)  5.05604    0.50130  10.086  < 2e-16 ***
## Pclass      -1.14391    0.12585  -9.089  < 2e-16 ***
## Sexmale     -2.75564    0.20471 -13.461  < 2e-16 ***
## Age         -0.03725    0.00812  -4.588 4.48e-06 ***
## SibSp       -0.33075    0.10892  -3.037  0.00239 ** 
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 1065.39  on 799  degrees of freedom
## Residual deviance:  713.43  on 795  degrees of freedom
## AIC: 723.43
## 
## Number of Fisher Scoring iterations: 5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{anova}\NormalTok{(mod2,}\DataTypeTok{test=}\StringTok{"Chisq"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Analysis of Deviance Table
## 
## Model: binomial, link: logit
## 
## Response: Survived
## 
## Terms added sequentially (first to last)
## 
## 
##        Df Deviance Resid. Df Resid. Dev  Pr(>Chi)    
## NULL                     799    1065.39              
## Pclass  1   83.607       798     981.79 < 2.2e-16 ***
## Sex     1  240.014       797     741.77 < 2.2e-16 ***
## Age     1   17.495       796     724.28 2.881e-05 ***
## SibSp   1   10.842       795     713.43  0.000992 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mod3 <-}\StringTok{  }\KeywordTok{glm}\NormalTok{(Survived }\OperatorTok{~}\StringTok{ }\NormalTok{Pclass }\OperatorTok{+}\StringTok{ }\NormalTok{Sex }\OperatorTok{+}\StringTok{ }\NormalTok{Pclass}\OperatorTok{:}\NormalTok{Sex }\OperatorTok{+}\StringTok{ }\NormalTok{Age }\OperatorTok{+}\StringTok{ }\NormalTok{SibSp, }\DataTypeTok{family =} \KeywordTok{binomial}\NormalTok{(logit), }\DataTypeTok{data =}\NormalTok{ train)}
\KeywordTok{summary}\NormalTok{(mod3)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## glm(formula = Survived ~ Pclass + Sex + Pclass:Sex + Age + SibSp, 
##     family = binomial(logit), data = train)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -3.1993  -0.6265  -0.4770   0.4485   2.3093  
## 
## Coefficients:
##                 Estimate Std. Error z value Pr(>|z|)    
## (Intercept)     7.606411   0.960804   7.917 2.44e-15 ***
## Pclass         -2.108360   0.316024  -6.672 2.53e-11 ***
## Sexmale        -5.887480   0.920417  -6.397 1.59e-10 ***
## Age            -0.038063   0.008498  -4.479 7.50e-06 ***
## SibSp          -0.310269   0.109370  -2.837 0.004556 ** 
## Pclass:Sexmale  1.254202   0.338241   3.708 0.000209 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 1065.39  on 799  degrees of freedom
## Residual deviance:  695.66  on 794  degrees of freedom
## AIC: 707.66
## 
## Number of Fisher Scoring iterations: 6
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{anova}\NormalTok{(mod3,}\DataTypeTok{test=}\StringTok{"Chisq"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Analysis of Deviance Table
## 
## Model: binomial, link: logit
## 
## Response: Survived
## 
## Terms added sequentially (first to last)
## 
## 
##            Df Deviance Resid. Df Resid. Dev  Pr(>Chi)    
## NULL                         799    1065.39              
## Pclass      1   83.607       798     981.79 < 2.2e-16 ***
## Sex         1  240.014       797     741.77 < 2.2e-16 ***
## Age         1   17.495       796     724.28 2.881e-05 ***
## SibSp       1   10.842       795     713.43  0.000992 ***
## Pclass:Sex  1   17.779       794     695.66 2.481e-05 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
\end{verbatim}

En los pasos anteriores, evaluamos brevemente el ajuste del modelo,
ahora nos gustaría ver cómo lo está haciendo el modelo al predecir \(y\)
en un nuevo conjunto de datos. Estableciendo el parámetro
\texttt{type=\textquotesingle{}response\textquotesingle{}}, \texttt{R}
producirá probabilidades en la forma de \(P(y=1|X)\). Nuestro límite de
decisión será de \(0.5\).

Si \(P(y=1|X) > 0.5\) entonces \(y = 1\) en caso contrario \(y=0\).
Tener en cuenta que para algunas aplicaciones diferentes límites de
decisión podría ser una mejor opción.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fitted.results <-}\StringTok{ }\KeywordTok{predict}\NormalTok{(mod3,}\DataTypeTok{newdata=}\NormalTok{test,}\DataTypeTok{type=}\StringTok{'response'}\NormalTok{)}
\NormalTok{fitted.results <-}\StringTok{ }\KeywordTok{ifelse}\NormalTok{(fitted.results }\OperatorTok{>}\StringTok{ }\FloatTok{0.5}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{)}

\NormalTok{misClasificError <-}\StringTok{ }\KeywordTok{mean}\NormalTok{(fitted.results }\OperatorTok{!=}\StringTok{ }\NormalTok{test}\OperatorTok{$}\NormalTok{Survived)}
\KeywordTok{print}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{'Accuracy'}\NormalTok{,}\DecValTok{1}\OperatorTok{-}\NormalTok{misClasificError))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Accuracy 0.8075"
\end{verbatim}

La precisión de 0.8075 en el conjunto de test es un buen resultado. Sin
embargo, hay que tener en cuenta que este resultado depende en cierta
medida de la división manual de los datos que hice anteriormente, por lo
tanto, si deseamos una puntuación más precisa, sería mejor realizar
algún tipo de validación cruzada, como la validación cruzada k-fold.

\textbf{Evaluar la capacidad predictiva}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(ROCR)}
\NormalTok{p <-}\StringTok{ }\KeywordTok{predict}\NormalTok{(mod3, }\DataTypeTok{newdata=}\KeywordTok{subset}\NormalTok{(test,}\DataTypeTok{select=}\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{4}\NormalTok{,}\DecValTok{5}\NormalTok{,}\DecValTok{6}\NormalTok{,}\DecValTok{7}\NormalTok{,}\DecValTok{8}\NormalTok{)), }\DataTypeTok{type=}\StringTok{"response"}\NormalTok{)}
\NormalTok{pr <-}\StringTok{ }\NormalTok{ROCR}\OperatorTok{::}\KeywordTok{prediction}\NormalTok{(p, test}\OperatorTok{$}\NormalTok{Survived)}
\NormalTok{prf <-}\StringTok{ }\KeywordTok{performance}\NormalTok{(pr, }\DataTypeTok{measure =} \StringTok{"tpr"}\NormalTok{, }\DataTypeTok{x.measure =} \StringTok{"fpr"}\NormalTok{)}
\KeywordTok{plot}\NormalTok{(prf)}
\end{Highlighting}
\end{Shaded}

\includegraphics{cursoR_files/figure-latex/ROCR2-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{auc <-}\StringTok{ }\KeywordTok{performance}\NormalTok{(pr, }\DataTypeTok{measure =} \StringTok{"auc"}\NormalTok{)}
\NormalTok{auc <-}\StringTok{ }\NormalTok{auc}\OperatorTok{@}\NormalTok{y.values[[}\DecValTok{1}\NormalTok{]]}
\NormalTok{auc}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.8543155
\end{verbatim}

\chapter{Modelos Aditivos
Generalizados}\label{modelos-aditivos-generalizados}

\section{Suavizado}\label{suavizado}

\textbf{Suavizado Scatterplot}

Consiste en resaltar la \emph{tendencia subyacente} en los datos. La
tendencia subyacente sería una función como: \[
f(x) = \mathbb{E}(y|x)
\] que también se puede escribir como: \[
y_i = f(x_i) + \epsilon_i,\qquad \mathbb{E}(\epsilon_i)=0,
\] en cuyo caso el problema se denomina a menudo como \emph{regresión
no-paramétrica}, donde \(f(\cdot)\) es una función \emph{suave} no
conocida que se estima a partir de los datos \((x_i,y_i)\) \bigskip

Existen varios métodos para suavizar una gráfica de dispersión,
incluyendo \emph{splines}, \emph{regresión kernel}, \emph{medias
móviles}, \emph{loess} o su versión ponderada \emph{lowess}.

El conjunto de datos \texttt{lidar} consta de 221 observaciones de un
experimento de detección y alcance de luz (LIDAR).

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(SemiPar)}
\CommentTok{#library(car)}
\KeywordTok{data}\NormalTok{(lidar)}
\KeywordTok{plot}\NormalTok{(logratio}\OperatorTok{~}\NormalTok{range,}\DataTypeTok{data=}\NormalTok{lidar)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/LIDAR.07-1} \end{center}

\subsection{Regresión polinomial}\label{regresiuxf3n-polinomial}

Consiste en transformar la variable explicativa \(X\), incluyendo
polinomios de grado \(p\) tales que: \[
y = \beta_0 + \beta_1 X_1 + \beta_2 X_2 + \beta_p X^p + \epsilon \quad \epsilon\sim\mathcal{N}(0,\sigma^2)
\]

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(lattice)}
\NormalTok{cols. <-}\StringTok{ }\KeywordTok{rainbow}\NormalTok{(}\DecValTok{5}\NormalTok{)}
\NormalTok{range.seq <-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\KeywordTok{min}\NormalTok{(lidar}\OperatorTok{$}\NormalTok{range),}\KeywordTok{max}\NormalTok{(lidar}\OperatorTok{$}\NormalTok{range),}\DataTypeTok{l=}\DecValTok{200}\NormalTok{)}
\KeywordTok{plot}\NormalTok{(logratio}\OperatorTok{~}\NormalTok{range,}\DataTypeTok{data=}\NormalTok{lidar,}\DataTypeTok{cex=}\NormalTok{.}\DecValTok{5}\NormalTok{,}\DataTypeTok{pch=}\DecValTok{19}\NormalTok{,}\DataTypeTok{col=}\StringTok{"grey"}\NormalTok{,}\DataTypeTok{xlim=}\KeywordTok{c}\NormalTok{(}\DecValTok{380}\NormalTok{,}\DecValTok{725}\NormalTok{),}\DataTypeTok{ylim=}\KeywordTok{c}\NormalTok{(}\OperatorTok{-}\FloatTok{0.90}\NormalTok{,}\FloatTok{0.05}\NormalTok{))}
\ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\DecValTok{5}\NormalTok{)\{}
  \KeywordTok{lines}\NormalTok{(range.seq,}\KeywordTok{predict}\NormalTok{(}\KeywordTok{lm}\NormalTok{(logratio}\OperatorTok{~}\KeywordTok{poly}\NormalTok{(range,i),}\DataTypeTok{data=}\NormalTok{lidar),}\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{range=}\NormalTok{range.seq)),}\DataTypeTok{lwd=}\DecValTok{2}\NormalTok{,}\DataTypeTok{col=}\NormalTok{cols.[i])}
\NormalTok{\}}
\KeywordTok{legend}\NormalTok{(}\StringTok{"bottomleft"}\NormalTok{,}\KeywordTok{c}\NormalTok{(}\StringTok{"p = 1"}\NormalTok{,}\StringTok{"p = 2"}\NormalTok{,}\StringTok{"p = 3"}\NormalTok{,}\StringTok{"p = 4"}\NormalTok{,}\StringTok{"p = 5"}\NormalTok{),}\DataTypeTok{col=}\NormalTok{cols.,}\DataTypeTok{lty=}\DecValTok{1}\OperatorTok{:}\DecValTok{5}\NormalTok{,}\DataTypeTok{lwd=}\DecValTok{4}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/poly-07-1} \end{center}

Podemos tratar estas relaciones no lineales de manera efectiva a través
de técnicas más flexibles.

\textbf{Regresión local:}

LOESS y LOWESS son dos métodos de regresión no-paramétrica muy
relacionados que combinan múltiples modelos de regresión en un modo
basado en k-neast-neighbor.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{attach}\NormalTok{(lidar)}
\NormalTok{span <-}\StringTok{ }\DecValTok{1}\OperatorTok{/}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{4}\NormalTok{,}\DecValTok{5}\NormalTok{)}
\KeywordTok{plot}\NormalTok{(logratio}\OperatorTok{~}\NormalTok{range,}\DataTypeTok{data=}\NormalTok{lidar,}\DataTypeTok{cex=}\NormalTok{.}\DecValTok{5}\NormalTok{,}\DataTypeTok{pch=}\DecValTok{19}\NormalTok{,}\DataTypeTok{col=}\StringTok{"grey"}\NormalTok{,}\DataTypeTok{xlim=}\KeywordTok{c}\NormalTok{(}\DecValTok{380}\NormalTok{,}\DecValTok{725}\NormalTok{),}\DataTypeTok{ylim=}\KeywordTok{c}\NormalTok{(}\OperatorTok{-}\FloatTok{0.90}\NormalTok{,}\FloatTok{0.05}\NormalTok{))}
\NormalTok{cols <-}\StringTok{ }\KeywordTok{rainbow}\NormalTok{(}\KeywordTok{length}\NormalTok{(span))}
\ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(span))\{}
  \KeywordTok{lines}\NormalTok{(}\KeywordTok{loess.smooth}\NormalTok{(range,logratio,}\DataTypeTok{span=}\NormalTok{span[i], }\DataTypeTok{degree=}\DecValTok{2}\NormalTok{),}\DataTypeTok{col=}\NormalTok{cols.[i],}\DataTypeTok{lwd=}\FloatTok{2.5}\NormalTok{,}\DataTypeTok{lty=}\NormalTok{i)}
\NormalTok{\}}
\KeywordTok{legend}\NormalTok{(}\StringTok{"bottomleft"}\NormalTok{,}\KeywordTok{paste}\NormalTok{(}\StringTok{"span = "}\NormalTok{,}\KeywordTok{round}\NormalTok{(span,}\DecValTok{3}\NormalTok{)),}\DataTypeTok{col=}\NormalTok{cols.,}\DataTypeTok{lwd=}\FloatTok{2.5}\NormalTok{,}\DataTypeTok{lty=}\DecValTok{1}\OperatorTok{:}\DecValTok{6}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/loess-07-1} \end{center}

Un suavizado \emph{kernel} es de la forma: \[
\hat{y}_i = \frac{\sum_{j=1}^n y_i K\left( \frac{x_i-x_j}{b}\right)}{\sum_{j=1}^n K\left( \frac{x_i-x_j}{b}\right)},
\] donde \(b\) es un parámetro de \emph{ancho de banda}
(\emph{bandwidth}), y \(K\) una función del núcleo/\emph{kernel}, como
en la estimación de densidad. Hay diferentes opciones para el kernel
\(K\) (por ejemplo: Gaussian), el parámetro de elección crítico es el
ancho de banda \emph{b}.

En \texttt{R} la función \texttt{ksmooth} en \texttt{library(stats)}
permite el suavizado tipo kernel (otras opciones son \texttt{locpoly} en
\texttt{library(KernSmooth)})

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{attach}\NormalTok{(lidar)}
\NormalTok{b <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{10}\NormalTok{,}\DecValTok{20}\NormalTok{,}\DecValTok{50}\NormalTok{,}\DecValTok{120}\NormalTok{,}\DecValTok{1000}\NormalTok{)}
\KeywordTok{plot}\NormalTok{(logratio}\OperatorTok{~}\NormalTok{range,}\DataTypeTok{data=}\NormalTok{lidar,}\DataTypeTok{cex=}\NormalTok{.}\DecValTok{5}\NormalTok{,}\DataTypeTok{pch=}\DecValTok{19}\NormalTok{,}\DataTypeTok{col=}\StringTok{"grey"}\NormalTok{,}\DataTypeTok{xlim=}\KeywordTok{c}\NormalTok{(}\DecValTok{380}\NormalTok{,}\DecValTok{725}\NormalTok{),}\DataTypeTok{ylim=}\KeywordTok{c}\NormalTok{(}\OperatorTok{-}\FloatTok{0.90}\NormalTok{,}\FloatTok{0.05}\NormalTok{))}
\NormalTok{cols. <-}\StringTok{ }\KeywordTok{rainbow}\NormalTok{(}\KeywordTok{length}\NormalTok{(b))}
\ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(b))\{}
  \KeywordTok{lines}\NormalTok{(}\KeywordTok{ksmooth}\NormalTok{(range,logratio,}\DataTypeTok{x.points=}\NormalTok{range,}\StringTok{"normal"}\NormalTok{, }\DataTypeTok{bandwidth=}\NormalTok{b[i]),}\DataTypeTok{col=}\NormalTok{cols.[i],}\DataTypeTok{lwd=}\FloatTok{2.5}\NormalTok{,}\DataTypeTok{lty=}\NormalTok{i)}
\NormalTok{\}}
\KeywordTok{legend}\NormalTok{(}\StringTok{"bottomleft"}\NormalTok{,}\KeywordTok{paste}\NormalTok{(}\StringTok{"bandwidth = "}\NormalTok{,b),}\DataTypeTok{col=}\NormalTok{cols.,}\DataTypeTok{lwd=}\FloatTok{2.5}\NormalTok{,}\DataTypeTok{lty=}\DecValTok{1}\OperatorTok{:}\DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{cursoR_files/figure-latex/ksmooth-07-1.pdf}

\section{GAMs}\label{gams}

Los GAMs (del inglés \emph{generalized additive models}) son una
generalización de los GLMs para incorporar formas no lineales de los
predictores (plines, Polinomios, o funciones Step, etc\ldots{}).

\[ y     \sim \mbox{ExpoFam}(\mu,\sigma^2,...)\]
\[ \mu   = \mathbb{E}[y]\]
\[ g(\mu)= \eta = \beta_0 + f(x_1) + f(x_2) + ... + f(x_p)\]

Ahora usamos las funciones \emph{suaves} \(f(\cdot)\) de nuestras
variables predictoras, que pueden tomar formas más flexibles. Se supone
que los valores observados son de alguna distribución de la familia
exponencial, y \(\mu\) está relacionado con los predictores a través de
una función \emph{enlace} (\emph{o link}).

En este curso se estudiará la implementación de GAMs en \texttt{R}
usando el paquete \texttt{mgcv} y funciones de base tipo spline.

Cargaremos la librería \texttt{mgcv}, y la función \texttt{gam}:

\textbf{La función \texttt{gam}}

La sintaxis es:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(mgcv)}
\NormalTok{fit.gam <-}\StringTok{ }\KeywordTok{gam}\NormalTok{(y }\OperatorTok{~}\StringTok{ }\KeywordTok{s}\NormalTok{(x))}
\end{Highlighting}
\end{Shaded}

En general, la sintaxis es

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{gam}\NormalTok{(formula,}\DataTypeTok{method=}\StringTok{"..."}\NormalTok{,}\DataTypeTok{select=}\StringTok{"..."}\NormalTok{,}\DataTypeTok{family=}\KeywordTok{gaussian}\NormalTok{())}
\end{Highlighting}
\end{Shaded}

Los argumentos principales para esta función se deben especificar como
una \texttt{formula}:

\begin{itemize}
\tightlist
\item
  La primera opción es la base utilizada para representar los términos
  suaves \texttt{s(x)} (ver \texttt{?s} o \texttt{?smooth.terms}). El
  tipo de función base se puede modificar utilizando \texttt{bs} dentro
  de \texttt{s(x,bs="ps")}:
\end{itemize}

El resto de argumentos es:

\begin{itemize}
\tightlist
\item
  \texttt{m} El orden de la penalización.
\item
  \texttt{k} la dimensión de la base utilizada para representar el
  término de suavizado. \texttt{k} debe ser mayor que \texttt{m}).
\item
  \texttt{by} una variable numérica o factorial de la misma dimensión
  que cada covariable.
\item
  \texttt{sp} cualquier parámetro de suavizado suministrado para el
  término de suavizado.
\item
  etc \ldots{}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{summary}\NormalTok{(fit.gam)}
\end{Highlighting}
\end{Shaded}

\texttt{gam.check} produce algunos gráficos de residuos básicos, y
proporciona información relacionada con el proceso de ajuste.

\subsection{Ejemplo: Salarios}\label{ejemplo-salarios}

Salarios y otros datos para un grupo de 3.000 trabajadores varones en la
región del Atlántico Medio.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#ISLR package contains the 'Wage' Dataset}
\KeywordTok{require}\NormalTok{(ISLR)}
\KeywordTok{attach}\NormalTok{(Wage) }\CommentTok{#Mid-Atlantic Wage Data}
\NormalTok{?Wage }\CommentTok{# To search more on the dataset}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(mgcv)}
\NormalTok{gam1 <-}\StringTok{ }\KeywordTok{gam}\NormalTok{(wage}\OperatorTok{~}\KeywordTok{s}\NormalTok{(age,}\DataTypeTok{k=}\DecValTok{6}\NormalTok{)}\OperatorTok{+}\KeywordTok{s}\NormalTok{(year,}\DataTypeTok{k=}\DecValTok{6}\NormalTok{)}\OperatorTok{+}\NormalTok{education,}\DataTypeTok{data =}\NormalTok{ Wage)}
\KeywordTok{summary}\NormalTok{(gam1)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## wage ~ s(age, k = 6) + s(year, k = 6) + education
## 
## Parametric coefficients:
##                             Estimate Std. Error t value Pr(>|t|)    
## (Intercept)                   85.456      2.153  39.692  < 2e-16 ***
## education2. HS Grad           10.978      2.428   4.521  6.4e-06 ***
## education3. Some College      23.530      2.558   9.197  < 2e-16 ***
## education4. College Grad      38.159      2.543  15.005  < 2e-16 ***
## education5. Advanced Degree   62.559      2.760  22.668  < 2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Approximate significance of smooth terms:
##           edf Ref.df     F  p-value    
## s(age)  4.435  4.840 46.69  < 2e-16 ***
## s(year) 1.101  1.195 11.11 0.000379 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## R-sq.(adj) =   0.29   Deviance explained = 29.2%
## GCV = 1240.7  Scale est. = 1236.3    n = 3000
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{)) }\CommentTok{#to partition the Plotting Window}
\KeywordTok{plot}\NormalTok{(gam1,}\DataTypeTok{se =} \OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/wage-07-1} \end{center}

Con \texttt{all.terms\ =\ TRUE} podemos representar la parte
paramétrica:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{))}
\KeywordTok{plot}\NormalTok{(gam1,}\DataTypeTok{all.terms=}\OtherTok{TRUE}\NormalTok{,}\DataTypeTok{scheme=}\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/wage-07b-1} \end{center}

Recordemos que la librería \texttt{visreg} permite visualizar modelos de
regresión:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(visreg)}
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{))}
\KeywordTok{visreg}\NormalTok{(gam1)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/gam-07c-1} \end{center}

\section{Modelos semi-paramétricos}\label{modelos-semi-paramuxe9tricos}

Los modelos semi-paramétricos permiten combinar componentes lineales
(paramétricos) y no paramétricos, por ejemplo:

\[
\boldsymbol{y} = \beta_0 + \beta_1\boldsymbol{x}_1 + ... + \beta_{j-1}\boldsymbol{x}_{j-1} + f(\boldsymbol{x}_j) + \boldsymbol{\epsilon}
\]

El procedimiento de ajuste es el mismo que se muestra en las secciones
anteriores. Simplemente los efectos paramétricos están incluidos en la
parte de efectos fijos, \(\boldsymbol{X}\). Un caso interesado es cuando
la parte paramétrica incluye una variable factorial con dos o más
niveles. Como vimos en el caso lineal, podemos considerar diferentes
situaciones: términos suaves paralelos (efecto aditivo) o términos
suaves no paralelos (efecto de interacción). Además, podemos considerar
la misma cantidad de alisamiento o una cantidad diferente.

\textbf{Datos de cebollas}

Para ilustrar un caso simple de un modelo semi-paramétrico, consideramos
los \texttt{data(onions)} en la \texttt{library(SemiPar)}. Los datos
consisten en 84 observaciones de un experimento que involucra la
producción de cebollas en dos localidades del sur de Australia. Las
variables son:

\begin{itemize}
\item
  \texttt{dens} densidad de área de las plantas (plantas por metro
  cuadrado)
\item
  \texttt{yield} rendimiento de la cebolla (gramos por planta).
\item
  \texttt{location} localización: \texttt{0=Purnong\ Landing},
  \texttt{1=Virginia}.
\end{itemize}

La siguiente figura muestra que para una mayor densidad de plantas el
rendimiento de Purnong Landing de onios es mayor.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(SemiPar)}
\KeywordTok{data}\NormalTok{(onions)}
\KeywordTok{attach}\NormalTok{(onions)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## The following objects are masked from onions (pos = 11):
## 
##     dens, location, yield
\end{verbatim}

\begin{verbatim}
## The following objects are masked from onions (pos = 28):
## 
##     dens, location, yield
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{points.cols <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"red"}\NormalTok{,}\StringTok{"blue"}\NormalTok{)}
\KeywordTok{plot}\NormalTok{(dens,}\KeywordTok{log}\NormalTok{(yield),}\DataTypeTok{col=}\NormalTok{points.cols[location}\OperatorTok{+}\DecValTok{1}\NormalTok{],}\DataTypeTok{pch=}\DecValTok{16}\NormalTok{)}
\KeywordTok{legend}\NormalTok{(}\StringTok{"topright"}\NormalTok{,}\KeywordTok{c}\NormalTok{(}\StringTok{"Purnong Landing"}\NormalTok{,}\StringTok{"Virginia"}\NormalTok{),}\DataTypeTok{col=}\NormalTok{points.cols,}\DataTypeTok{pch=}\KeywordTok{rep}\NormalTok{(}\DecValTok{16}\NormalTok{,}\DecValTok{2}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/onion-07-1} \end{center}

El modelo lineal es:

\[
\log(\text{yield}_i) = \beta_0 + \beta_1\text{location}_{ij} + \beta_2 \text{dens}_i + \epsilon_i
\]

donde

\[
\text{location}_{ij} =
\left\{
\begin{array}{cl}
0 & \mbox{si la $i$-ésima observación es de Purnong Landing} \\
1 & \mbox{si la $i$-ésima observación es de Virginia}
\end{array}
\right.
\]

La figura sugiere un término no lineal para \texttt{dens}, por lo tanto,
un modelo mejor sería:

\[
\log(\text{yield}_i) = \beta_0 + \beta_1\text{location}_{ij} + f(\text{dens}_i) + \epsilon_i
\]

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# create a factor for location}
\NormalTok{L <-}\StringTok{ }\KeywordTok{factor}\NormalTok{(location)}

\KeywordTok{levels}\NormalTok{(L) <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"Purnong Landing"}\NormalTok{,}\StringTok{"Virginia"}\NormalTok{)}

\CommentTok{# fit a gam with location factor}
\NormalTok{fit1 <-}\StringTok{ }\KeywordTok{gam}\NormalTok{(}\KeywordTok{log}\NormalTok{(yield) }\OperatorTok{~}\StringTok{ }\NormalTok{L }\OperatorTok{+}\StringTok{ }\KeywordTok{s}\NormalTok{(dens,}\DataTypeTok{k=}\DecValTok{20}\NormalTok{,}\DataTypeTok{m=}\DecValTok{2}\NormalTok{,}\DataTypeTok{bs=}\StringTok{"ps"}\NormalTok{),}
            \DataTypeTok{method=}\StringTok{"REML"}\NormalTok{, }\DataTypeTok{select=}\OtherTok{TRUE}\NormalTok{)}

\KeywordTok{summary}\NormalTok{(fit1)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## log(yield) ~ L + s(dens, k = 20, m = 2, bs = "ps")
## 
## Parametric coefficients:
##             Estimate Std. Error t value Pr(>|t|)    
## (Intercept)  4.85011    0.01688  287.39   <2e-16 ***
## LVirginia   -0.33284    0.02409  -13.82   <2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Approximate significance of smooth terms:
##           edf Ref.df     F p-value    
## s(dens) 4.568     19 72.76  <2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## R-sq.(adj) =  0.946   Deviance explained = 94.9%
## -REML = -54.242  Scale est. = 0.011737  n = 84
\end{verbatim}

La siguiente figura muestra las curvas ajustadas para cada ubicación con
el modelo \texttt{fit1}, asumimos que ambas curvas son paralelas.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{L.P <-}\StringTok{ }\KeywordTok{rep}\NormalTok{(}\KeywordTok{levels}\NormalTok{(L)[}\DecValTok{1}\NormalTok{],}\DecValTok{100}\NormalTok{)}
\NormalTok{L.V <-}\StringTok{ }\KeywordTok{rep}\NormalTok{(}\KeywordTok{levels}\NormalTok{(L)[}\DecValTok{2}\NormalTok{],}\DecValTok{100}\NormalTok{)}
\NormalTok{dens.g <-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\KeywordTok{min}\NormalTok{(dens),}\KeywordTok{max}\NormalTok{(dens),}\DataTypeTok{l=}\DecValTok{100}\NormalTok{)}
\NormalTok{fit1.P <-}\StringTok{ }\KeywordTok{predict}\NormalTok{(fit1,}\DataTypeTok{newdata=}\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{L=}\NormalTok{L.P,}\DataTypeTok{dens=}\NormalTok{dens.g),}\DataTypeTok{se.fit=}\OtherTok{TRUE}\NormalTok{)}
\NormalTok{fit1.V <-}\StringTok{ }\KeywordTok{predict}\NormalTok{(fit1,}\DataTypeTok{newdata=}\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{L=}\NormalTok{L.V,}\DataTypeTok{dens=}\NormalTok{dens.g),}\DataTypeTok{se.fit=}\OtherTok{TRUE}\NormalTok{)}

\KeywordTok{plot}\NormalTok{(dens,}\KeywordTok{log}\NormalTok{(yield),}\DataTypeTok{col=}\NormalTok{points.cols[location}\OperatorTok{+}\DecValTok{1}\NormalTok{],}\DataTypeTok{pch=}\DecValTok{16}\NormalTok{,}\DataTypeTok{cex=}\NormalTok{.}\DecValTok{55}\NormalTok{)}
\KeywordTok{lines}\NormalTok{(dens.g,fit1.P}\OperatorTok{$}\NormalTok{fit,}\DataTypeTok{col=}\DecValTok{2}\NormalTok{,}\DataTypeTok{lwd=}\DecValTok{2}\NormalTok{)}
\KeywordTok{lines}\NormalTok{(dens.g,fit1.P}\OperatorTok{$}\NormalTok{fit}\OperatorTok{+}\FloatTok{1.96}\OperatorTok{*}\NormalTok{fit1.P}\OperatorTok{$}\NormalTok{se.fit,}\DataTypeTok{col=}\DecValTok{2}\NormalTok{,}\DataTypeTok{lwd=}\DecValTok{2}\NormalTok{,}\DataTypeTok{lty=}\DecValTok{2}\NormalTok{)}
\KeywordTok{lines}\NormalTok{(dens.g,fit1.P}\OperatorTok{$}\NormalTok{fit}\OperatorTok{-}\FloatTok{1.96}\OperatorTok{*}\NormalTok{fit1.P}\OperatorTok{$}\NormalTok{se.fit,}\DataTypeTok{col=}\DecValTok{2}\NormalTok{,}\DataTypeTok{lwd=}\DecValTok{2}\NormalTok{,}\DataTypeTok{lty=}\DecValTok{2}\NormalTok{)}
\KeywordTok{lines}\NormalTok{(dens.g,fit1.V}\OperatorTok{$}\NormalTok{fit,}\DataTypeTok{col=}\DecValTok{4}\NormalTok{,}\DataTypeTok{lwd=}\DecValTok{2}\NormalTok{)}
\KeywordTok{lines}\NormalTok{(dens.g,fit1.V}\OperatorTok{$}\NormalTok{fit}\OperatorTok{+}\FloatTok{1.96}\OperatorTok{*}\NormalTok{fit1.V}\OperatorTok{$}\NormalTok{se.fit,}\DataTypeTok{col=}\DecValTok{4}\NormalTok{,}\DataTypeTok{lwd=}\DecValTok{2}\NormalTok{,}\DataTypeTok{lty=}\DecValTok{2}\NormalTok{)}
\KeywordTok{lines}\NormalTok{(dens.g,fit1.V}\OperatorTok{$}\NormalTok{fit}\OperatorTok{-}\FloatTok{1.96}\OperatorTok{*}\NormalTok{fit1.V}\OperatorTok{$}\NormalTok{se.fit,}\DataTypeTok{col=}\DecValTok{4}\NormalTok{,}\DataTypeTok{lwd=}\DecValTok{2}\NormalTok{,}\DataTypeTok{lty=}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/onion-07b-1} \end{center}

Asumir curvas paralelas para ambas localizaciones implica que la
disminución del rendimiento a medida que aumenta la densidad es la misma
en ambas localizaciones. En lugar de ajustar un modelo de efectos
aditivos, podemos ajustar un modelo de efectos con interacción, como por
ejemplo:

\[
\log(\text{yield}_i) =\beta_0 + \beta_1 \beta_1\text{location}_{ij} +  f(\text{dens}_i)_{L(j)} + \epsilon_i
\]

donde

\[
L(j) =
\left\{
\begin{array}{cl}
0 & \mbox{si la $i$-ésima observación es de Purnong Landing} \\
1 & \mbox{si la $i$-ésima observación es de Virginia}
\end{array}
\right.
\]

El opción \texttt{by=} dentro de \texttt{s()} permite incluir
interacciones curva factor:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fit2 <-}\StringTok{ }\KeywordTok{gam}\NormalTok{(}\KeywordTok{log}\NormalTok{(yield) }\OperatorTok{~}\StringTok{ }\NormalTok{L }\OperatorTok{+}\StringTok{ }\KeywordTok{s}\NormalTok{(dens,}\DataTypeTok{k=}\DecValTok{20}\NormalTok{,}\DataTypeTok{m=}\DecValTok{2}\NormalTok{,}\DataTypeTok{bs=}\StringTok{"ps"}\NormalTok{,}\DataTypeTok{by=}\NormalTok{L),}
            \DataTypeTok{method=}\StringTok{"REML"}\NormalTok{, }\DataTypeTok{select=}\OtherTok{TRUE}\NormalTok{)}
\KeywordTok{summary}\NormalTok{(fit2)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## log(yield) ~ L + s(dens, k = 20, m = 2, bs = "ps", by = L)
## 
## Parametric coefficients:
##             Estimate Std. Error t value Pr(>|t|)    
## (Intercept)  4.84407    0.01603  302.12   <2e-16 ***
## LVirginia   -0.33003    0.02271  -14.54   <2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Approximate significance of smooth terms:
##                            edf Ref.df     F p-value    
## s(dens):LPurnong Landing 3.097     18 37.62  <2e-16 ***
## s(dens):LVirginia        4.728     17 52.10  <2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## R-sq.(adj) =  0.952   Deviance explained = 95.7%
## -REML = -53.616  Scale est. = 0.01045   n = 84
\end{verbatim}

¿Qué modelo es mejor?

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{AIC}\NormalTok{(fit1)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] -125.2307
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{AIC}\NormalTok{(fit2)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] -131.1844
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fit1}\OperatorTok{$}\NormalTok{sp}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##     s(dens)1     s(dens)2 
## 164.66124239   0.00147493
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fit2}\OperatorTok{$}\NormalTok{sp}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## s(dens):LPurnong Landing1 s(dens):LPurnong Landing2 
##              4.264039e+02              1.604648e-03 
##        s(dens):LVirginia1        s(dens):LVirginia2 
##              6.437458e+01              1.053443e-03
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# plot the smooth effects}
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{))}
\KeywordTok{plot}\NormalTok{(fit2, }\DataTypeTok{se=}\OtherTok{TRUE}\NormalTok{)}

\CommentTok{# In the same plot}
\NormalTok{fit2.P <-}\StringTok{ }\KeywordTok{predict}\NormalTok{(fit2,}\DataTypeTok{newdata=}\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{L=}\NormalTok{L.P,}\DataTypeTok{dens=}\NormalTok{dens.g),}\DataTypeTok{se.fit=}\OtherTok{TRUE}\NormalTok{)}
\NormalTok{fit2.V <-}\StringTok{ }\KeywordTok{predict}\NormalTok{(fit2,}\DataTypeTok{newdata=}\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{L=}\NormalTok{L.V,}\DataTypeTok{dens=}\NormalTok{dens.g),}\DataTypeTok{se.fit=}\OtherTok{TRUE}\NormalTok{)}

\KeywordTok{plot}\NormalTok{(dens,}\KeywordTok{log}\NormalTok{(yield),}\DataTypeTok{col=}\NormalTok{points.cols[location}\OperatorTok{+}\DecValTok{1}\NormalTok{],}\DataTypeTok{pch=}\DecValTok{16}\NormalTok{,}\DataTypeTok{cex=}\NormalTok{.}\DecValTok{55}\NormalTok{)}
\KeywordTok{lines}\NormalTok{(dens.g,fit2.P}\OperatorTok{$}\NormalTok{fit,}\DataTypeTok{col=}\DecValTok{2}\NormalTok{,}\DataTypeTok{lwd=}\DecValTok{2}\NormalTok{)}
\KeywordTok{lines}\NormalTok{(dens.g,fit2.P}\OperatorTok{$}\NormalTok{fit}\OperatorTok{+}\FloatTok{1.96}\OperatorTok{*}\NormalTok{fit1.P}\OperatorTok{$}\NormalTok{se.fit,}\DataTypeTok{col=}\DecValTok{2}\NormalTok{,}\DataTypeTok{lwd=}\DecValTok{2}\NormalTok{,}\DataTypeTok{lty=}\DecValTok{2}\NormalTok{)}
\KeywordTok{lines}\NormalTok{(dens.g,fit2.P}\OperatorTok{$}\NormalTok{fit}\OperatorTok{-}\FloatTok{1.96}\OperatorTok{*}\NormalTok{fit1.P}\OperatorTok{$}\NormalTok{se.fit,}\DataTypeTok{col=}\DecValTok{2}\NormalTok{,}\DataTypeTok{lwd=}\DecValTok{2}\NormalTok{,}\DataTypeTok{lty=}\DecValTok{2}\NormalTok{)}
\KeywordTok{lines}\NormalTok{(dens.g,fit2.V}\OperatorTok{$}\NormalTok{fit,}\DataTypeTok{col=}\DecValTok{4}\NormalTok{,}\DataTypeTok{lwd=}\DecValTok{2}\NormalTok{)}
\KeywordTok{lines}\NormalTok{(dens.g,fit2.V}\OperatorTok{$}\NormalTok{fit}\OperatorTok{+}\FloatTok{1.96}\OperatorTok{*}\NormalTok{fit2.V}\OperatorTok{$}\NormalTok{se.fit,}\DataTypeTok{col=}\DecValTok{4}\NormalTok{,}\DataTypeTok{lwd=}\DecValTok{2}\NormalTok{,}\DataTypeTok{lty=}\DecValTok{2}\NormalTok{)}
\KeywordTok{lines}\NormalTok{(dens.g,fit2.V}\OperatorTok{$}\NormalTok{fit}\OperatorTok{-}\FloatTok{1.96}\OperatorTok{*}\NormalTok{fit2.V}\OperatorTok{$}\NormalTok{se.fit,}\DataTypeTok{col=}\DecValTok{4}\NormalTok{,}\DataTypeTok{lwd=}\DecValTok{2}\NormalTok{,}\DataTypeTok{lty=}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{cursoR_files/figure-latex/curves-07-1.pdf}
\caption{\label{fig:curves-07}\emph{Fitted curves by location}}
\end{figure}

\subsection{Ejemplo:}\label{ejemplo}

Continuémos con el ejemplo \texttt{Wage}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{gam2 <-}\StringTok{ }\KeywordTok{gam}\NormalTok{(wage }\OperatorTok{~}\StringTok{ }\NormalTok{jobclass }\OperatorTok{+}\StringTok{ }\KeywordTok{s}\NormalTok{(age,}\DataTypeTok{k=}\DecValTok{6}\NormalTok{)}\OperatorTok{+}\KeywordTok{s}\NormalTok{(year,}\DataTypeTok{k=}\DecValTok{6}\NormalTok{)}\OperatorTok{+}\NormalTok{education,}\DataTypeTok{data =}\NormalTok{ Wage)}
\NormalTok{gam3 <-}\StringTok{ }\KeywordTok{gam}\NormalTok{(wage }\OperatorTok{~}\StringTok{ }\NormalTok{jobclass }\OperatorTok{+}\StringTok{ }\KeywordTok{s}\NormalTok{(age,}\DataTypeTok{by=}\NormalTok{jobclass,}\DataTypeTok{k=}\DecValTok{6}\NormalTok{)}\OperatorTok{+}\KeywordTok{s}\NormalTok{(year,}\DataTypeTok{k=}\DecValTok{6}\NormalTok{)}\OperatorTok{+}\NormalTok{education,}\DataTypeTok{data =}\NormalTok{ Wage)}
\KeywordTok{summary}\NormalTok{(gam2)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## wage ~ jobclass + s(age, k = 6) + s(year, k = 6) + education
## 
## Parametric coefficients:
##                             Estimate Std. Error t value Pr(>|t|)    
## (Intercept)                   84.184      2.186  38.511  < 2e-16 ***
## jobclass2. Information         4.317      1.352   3.193  0.00142 ** 
## education2. HS Grad           10.751      2.426   4.432 9.67e-06 ***
## education3. Some College      22.741      2.567   8.861  < 2e-16 ***
## education4. College Grad      36.847      2.572  14.325  < 2e-16 ***
## education5. Advanced Degree   60.594      2.824  21.458  < 2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Approximate significance of smooth terms:
##           edf Ref.df     F p-value    
## s(age)  4.408  4.825 45.57 < 2e-16 ***
## s(year) 1.000  1.000 14.29 0.00016 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## R-sq.(adj) =  0.292   Deviance explained = 29.5%
## GCV = 1237.3  Scale est. = 1232.6    n = 3000
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{summary}\NormalTok{(gam3)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## wage ~ jobclass + s(age, by = jobclass, k = 6) + s(year, k = 6) + 
##     education
## 
## Parametric coefficients:
##                             Estimate Std. Error t value Pr(>|t|)    
## (Intercept)                   84.039      2.186  38.453  < 2e-16 ***
## jobclass2. Information         4.284      1.352   3.169  0.00154 ** 
## education2. HS Grad           10.733      2.425   4.427  9.9e-06 ***
## education3. Some College      22.796      2.564   8.892  < 2e-16 ***
## education4. College Grad      36.940      2.571  14.367  < 2e-16 ***
## education5. Advanced Degree   60.621      2.822  21.482  < 2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Approximate significance of smooth terms:
##                                 edf Ref.df     F  p-value    
## s(age):jobclass1. Industrial  2.980  3.607 33.95  < 2e-16 ***
## s(age):jobclass2. Information 4.551  4.901 20.27  < 2e-16 ***
## s(year)                       1.000  1.000 14.27 0.000162 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## R-sq.(adj) =  0.293   Deviance explained = 29.6%
## GCV = 1237.2  Scale est. = 1231.3    n = 3000
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{))}
\KeywordTok{plot}\NormalTok{(gam2,}\DataTypeTok{all.terms=}\OtherTok{TRUE}\NormalTok{,}\DataTypeTok{scheme=}\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/wage-07c-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot}\NormalTok{(gam3,}\DataTypeTok{all.terms=}\OtherTok{TRUE}\NormalTok{,}\DataTypeTok{scheme=}\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/wage-07c-2} \end{center}

\begin{center}\includegraphics{cursoR_files/figure-latex/wage-07c-3} \end{center}

\textbf{Ejercicio:} Selecciona un modelo GAM.

\section{Ejemplo: Calidad del Aire}\label{ejemplo-calidad-del-aire}

Revisemos los datos \texttt{?airquality}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{data}\NormalTok{(airquality)}
\KeywordTok{pairs}\NormalTok{(airquality, }\DataTypeTok{panel =}\NormalTok{ panel.smooth)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/airq-07-1} \end{center}

Una simple gráfica de dispersión muestra que algunas de las variables
tienen una relación no lineal.

Consideremos un modelo lineal para la variable de respuesta
\texttt{Ozone}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{airq.lm <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(Ozone }\OperatorTok{~}\StringTok{ }\NormalTok{Temp }\OperatorTok{+}\StringTok{ }\NormalTok{Wind }\OperatorTok{+}\StringTok{ }\NormalTok{Solar.R, }\DataTypeTok{data=}\NormalTok{airquality)}
\KeywordTok{summary}\NormalTok{(airq.lm)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = Ozone ~ Temp + Wind + Solar.R, data = airquality)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -40.485 -14.219  -3.551  10.097  95.619 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(>|t|)    
## (Intercept) -64.34208   23.05472  -2.791  0.00623 ** 
## Temp          1.65209    0.25353   6.516 2.42e-09 ***
## Wind         -3.33359    0.65441  -5.094 1.52e-06 ***
## Solar.R       0.05982    0.02319   2.580  0.01124 *  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 21.18 on 107 degrees of freedom
##   (42 observations deleted due to missingness)
## Multiple R-squared:  0.6059, Adjusted R-squared:  0.5948 
## F-statistic: 54.83 on 3 and 107 DF,  p-value: < 2.2e-16
\end{verbatim}

Veamos los resultados gráficamente:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{3}\NormalTok{))}
\KeywordTok{termplot}\NormalTok{(airq.lm,}\DataTypeTok{se=}\OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/term-air-1} \end{center}

También podemos graficar los residuos del modelo para comprobar las
hipótesis del modelo.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{))}
\KeywordTok{plot}\NormalTok{(airq.lm,}\DataTypeTok{which=}\DecValTok{1}\OperatorTok{:}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/airq-07b-1} \end{center}

La falta de normalidad en los residuos se debe a la asimetría de la
variable de respuesta \texttt{Ozone}, podemos aplicar una transformación
\texttt{log} para conseguir asimetría, es decir:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{))}
\KeywordTok{hist}\NormalTok{(airquality}\OperatorTok{$}\NormalTok{Ozone, }\DataTypeTok{main=}\StringTok{"Ozone"}\NormalTok{)}
\KeywordTok{hist}\NormalTok{(}\KeywordTok{log}\NormalTok{(airquality}\OperatorTok{$}\NormalTok{Ozone), }\DataTypeTok{main =}\StringTok{"log(Ozone)"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/airq-07c-1} \end{center}

Ahora podemos ajustar un modelo lineal del \(\log(Ozono)\), ¿el modelo
se ve más adecuado?

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lairq.lm <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(}\KeywordTok{log}\NormalTok{(Ozone)}\OperatorTok{~}\StringTok{ }\NormalTok{Temp }\OperatorTok{+}\StringTok{ }\NormalTok{Wind }\OperatorTok{+}\StringTok{ }\NormalTok{Solar.R, }\DataTypeTok{data=}\NormalTok{airquality)}
\KeywordTok{summary}\NormalTok{(lairq.lm)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = log(Ozone) ~ Temp + Wind + Solar.R, data = airquality)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -2.06193 -0.29970 -0.00231  0.30756  1.23578 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(>|t|)    
## (Intercept) -0.2621323  0.5535669  -0.474 0.636798    
## Temp         0.0491711  0.0060875   8.077 1.07e-12 ***
## Wind        -0.0615625  0.0157130  -3.918 0.000158 ***
## Solar.R      0.0025152  0.0005567   4.518 1.62e-05 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.5086 on 107 degrees of freedom
##   (42 observations deleted due to missingness)
## Multiple R-squared:  0.6644, Adjusted R-squared:  0.655 
## F-statistic: 70.62 on 3 and 107 DF,  p-value: < 2.2e-16
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot}\NormalTok{(lairq.lm)}
\end{Highlighting}
\end{Shaded}

\includegraphics{cursoR_files/figure-latex/airq-07d-1.pdf}
\includegraphics{cursoR_files/figure-latex/airq-07d-2.pdf}
\includegraphics{cursoR_files/figure-latex/airq-07d-3.pdf}
\includegraphics{cursoR_files/figure-latex/airq-07d-4.pdf}

Ajustando un modelo lineal podemos concluir que puede haber alguna
heterokedasticidad que no se tenga en cuenta en el modelo. Sin embargo,
la causa más posible es que la relación entre la variable de respuesta y
las covariables está lejos de ser lineal.

Ajustemos un modelo GAM, en primer lugar con una sola variable, es
decir:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(mgcv)}
\NormalTok{airq.gam1 <-}\StringTok{ }\KeywordTok{gam}\NormalTok{(}\KeywordTok{log}\NormalTok{(Ozone) }\OperatorTok{~}\StringTok{ }\KeywordTok{s}\NormalTok{(Wind,}\DataTypeTok{bs=}\StringTok{"ps"}\NormalTok{,}\DataTypeTok{m=}\DecValTok{2}\NormalTok{,}\DataTypeTok{k=}\DecValTok{10}\NormalTok{),}
                 \DataTypeTok{method=}\StringTok{"REML"}\NormalTok{, }\DataTypeTok{select=}\OtherTok{TRUE}\NormalTok{,}\DataTypeTok{data=}\NormalTok{airquality)}
\KeywordTok{summary}\NormalTok{(airq.gam1)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## log(Ozone) ~ s(Wind, bs = "ps", m = 2, k = 10)
## 
## Parametric coefficients:
##             Estimate Std. Error t value Pr(>|t|)    
## (Intercept)   3.4185     0.0655   52.19   <2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Approximate significance of smooth terms:
##           edf Ref.df     F  p-value    
## s(Wind) 2.565      9 6.453 2.76e-12 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## R-sq.(adj) =  0.336   Deviance explained =   35%
## -REML = 128.69  Scale est. = 0.49769   n = 116
\end{verbatim}

Los resultados muestran que el efecto suave \texttt{s(Wind)} es
significativo (con un valor aproximado de \(p\) cercano a cero y
\texttt{edf} \(2.56\)). La siguiente figura muestra el efecto de viento
suave. El incremento de la velocidad del viento disminuye los niveles de
ozono (dramáticamente hasta 10mph). Tener en cuenta que incluyendo el
intercepto, los efectos suaves se centran en cero.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot}\NormalTok{(airq.gam1,}\DataTypeTok{residuals=}\OtherTok{TRUE}\NormalTok{,}\DataTypeTok{scheme=}\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/airq-07e-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{gam.check}\NormalTok{(airq.gam1)}
\end{Highlighting}
\end{Shaded}

\includegraphics{cursoR_files/figure-latex/airq-07f-1.pdf}
\includegraphics{cursoR_files/figure-latex/airq-07f-2.pdf}
\includegraphics{cursoR_files/figure-latex/airq-07f-3.pdf}
\includegraphics{cursoR_files/figure-latex/airq-07f-4.pdf}

\begin{verbatim}
## 
## Method: REML   Optimizer: outer newton
## full convergence after 8 iterations.
## Gradient range [-1.455961e-06,1.183099e-06]
## (score 128.6926 & scale 0.4976891).
## Hessian positive definite, eigenvalue range [0.4379927,57.51548].
## Model rank =  10 / 10 
## 
## Basis dimension (k) checking results. Low p-value (k-index<1) may
## indicate that k is too low, especially if edf is close to k'.
## 
##           k'  edf k-index p-value    
## s(Wind) 9.00 2.56    0.69  <2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
\end{verbatim}

Nótese que, en el modelo \texttt{airq.gam1} usamos \texttt{k=10} nodos,
la variable \texttt{Wind} tiene valores únicos de \(31\), y por lo tanto
10 nodos deberían ser suficientes. Ajustamos un modelo para los residuos
del modelo gam ajustado

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{resids <-}\StringTok{ }\KeywordTok{residuals}\NormalTok{(airq.gam1)}
\NormalTok{resids.gam <-}\StringTok{ }\KeywordTok{gam}\NormalTok{(resids}\OperatorTok{~}\KeywordTok{s}\NormalTok{(Wind,}\DataTypeTok{k=}\DecValTok{20}\NormalTok{,}\DataTypeTok{m=}\DecValTok{2}\NormalTok{),}\DataTypeTok{method=}\StringTok{"REML"}\NormalTok{,}
                  \DataTypeTok{select=}\OtherTok{TRUE}\NormalTok{,}\DataTypeTok{data=}\NormalTok{airq.gam1}\OperatorTok{$}\NormalTok{model)}
\KeywordTok{summary}\NormalTok{(resids.gam)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## resids ~ s(Wind, k = 20, m = 2)
## 
## Parametric coefficients:
##              Estimate Std. Error t value Pr(>|t|)
## (Intercept) 1.137e-15  6.477e-02       0        1
## 
## Approximate significance of smooth terms:
##               edf Ref.df F p-value
## s(Wind) 7.419e-05     19 0       1
## 
## R-sq.(adj) =  -5.66e-07   Deviance explained = 7.89e-06%
## -REML = 124.14  Scale est. = 0.48659   n = 116
\end{verbatim}

Los resultados muestran que no hay una variabilidad no-explicada entre
la variable y los residuos. Por lo tanto, podemos concluir que no
necesitamos más nodos. La siguiente figura apoya esta afirmación.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot}\NormalTok{(resids.gam)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/airq-07g-1} \end{center}

Ahora añadimos la funcion \texttt{Temp}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{airq.gam2 <-}\StringTok{ }\KeywordTok{gam}\NormalTok{(}\KeywordTok{log}\NormalTok{(Ozone)}\OperatorTok{~}\KeywordTok{s}\NormalTok{(Wind,}\DataTypeTok{bs=}\StringTok{"ps"}\NormalTok{,}\DataTypeTok{m=}\DecValTok{2}\NormalTok{,}\DataTypeTok{k=}\DecValTok{10}\NormalTok{)}\OperatorTok{+}\KeywordTok{s}\NormalTok{(Temp,}\DataTypeTok{bs=}\StringTok{"ps"}\NormalTok{,}\DataTypeTok{m=}\DecValTok{2}\NormalTok{,}\DataTypeTok{k=}\DecValTok{10}\NormalTok{),}
                 \DataTypeTok{method=}\StringTok{"REML"}\NormalTok{,}\DataTypeTok{select=}\OtherTok{TRUE}\NormalTok{,}\DataTypeTok{data=}\NormalTok{airquality)}
\KeywordTok{summary}\NormalTok{(airq.gam2)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## log(Ozone) ~ s(Wind, bs = "ps", m = 2, k = 10) + s(Temp, bs = "ps", 
##     m = 2, k = 10)
## 
## Parametric coefficients:
##             Estimate Std. Error t value Pr(>|t|)    
## (Intercept)  3.41852    0.04963   68.89   <2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Approximate significance of smooth terms:
##           edf Ref.df      F  p-value    
## s(Wind) 2.068      9  1.353 0.000981 ***
## s(Temp) 3.990      9 10.496  < 2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## R-sq.(adj) =  0.619   Deviance explained = 63.9%
## -REML = 101.64  Scale est. = 0.28568   n = 116
\end{verbatim}

Por tanto el efecto de \texttt{Temp} es significativo.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{))}
\KeywordTok{plot}\NormalTok{(airq.gam2,}\DataTypeTok{residuals=}\OtherTok{TRUE}\NormalTok{,}\DataTypeTok{scheme=}\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/airq-07h-1} \end{center}

Podemos comparar ambos modelos utilizando la función \texttt{anova}:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{anova}\NormalTok{(airq.gam1,airq.gam2)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Analysis of Deviance Table
## 
## Model 1: log(Ozone) ~ s(Wind, bs = "ps", m = 2, k = 10)
## Model 2: log(Ozone) ~ s(Wind, bs = "ps", m = 2, k = 10) + s(Temp, bs = "ps", 
##     m = 2, k = 10)
##   Resid. Df Resid. Dev     Df Deviance
## 1    111.16     55.958                
## 2    105.98     31.123 5.1832   24.835
\end{verbatim}

Podemos también comparar el criterio AIC:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{AIC}\NormalTok{(airq.gam1)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 255.0315
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{AIC}\NormalTok{(airq.gam2)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 195.6561
\end{verbatim}

Incluimos la variable \texttt{Solar.R} que contiene valores faltantes
(\texttt{NA}'s).

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{sum}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(airquality}\OperatorTok{$}\NormalTok{Solar.R))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 7
\end{verbatim}

Para comparar el modelo anterior \texttt{airq.gam2} y el nuevo modelo
que incluye \texttt{Solar.R} utilizaremos los mismos datos, por lo que
omitiremos los valores que faltan y volveremos a ajustar los modelos.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{new.airquality <-}\StringTok{ }\KeywordTok{na.omit}\NormalTok{(airquality)}

\NormalTok{airq.gam22=}\KeywordTok{gam}\NormalTok{(}\KeywordTok{log}\NormalTok{(Ozone)}\OperatorTok{~}\KeywordTok{s}\NormalTok{(Wind,}\DataTypeTok{bs=}\StringTok{"ps"}\NormalTok{,}\DataTypeTok{m=}\DecValTok{2}\NormalTok{,}\DataTypeTok{k=}\DecValTok{10}\NormalTok{)}\OperatorTok{+}\KeywordTok{s}\NormalTok{(Temp,}\DataTypeTok{bs=}\StringTok{"ps"}\NormalTok{,}\DataTypeTok{m=}\DecValTok{2}\NormalTok{,}\DataTypeTok{k=}\DecValTok{10}\NormalTok{),}
               \DataTypeTok{method=}\StringTok{"REML"}\NormalTok{,}\DataTypeTok{select=}\OtherTok{TRUE}\NormalTok{,}\DataTypeTok{data=}\NormalTok{new.airquality)}

\NormalTok{airq.gam3=}\KeywordTok{gam}\NormalTok{(}\KeywordTok{log}\NormalTok{(Ozone)}\OperatorTok{~}\KeywordTok{s}\NormalTok{(Wind,}\DataTypeTok{bs=}\StringTok{"ps"}\NormalTok{,}\DataTypeTok{m=}\DecValTok{2}\NormalTok{,}\DataTypeTok{k=}\DecValTok{10}\NormalTok{)}\OperatorTok{+}\KeywordTok{s}\NormalTok{(Temp,}\DataTypeTok{bs=}\StringTok{"ps"}\NormalTok{,}\DataTypeTok{m=}\DecValTok{2}\NormalTok{,}\DataTypeTok{k=}\DecValTok{10}\NormalTok{)}\OperatorTok{+}\KeywordTok{s}\NormalTok{(Solar.R,}\DataTypeTok{bs=}\StringTok{"ps"}\NormalTok{,}\DataTypeTok{m=}\DecValTok{2}\NormalTok{,}\DataTypeTok{k=}\DecValTok{20}\NormalTok{),}
              \DataTypeTok{method=}\StringTok{"REML"}\NormalTok{,}\DataTypeTok{select=}\OtherTok{TRUE}\NormalTok{,}\DataTypeTok{data=}\NormalTok{new.airquality)}

\KeywordTok{summary}\NormalTok{(airq.gam22)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## log(Ozone) ~ s(Wind, bs = "ps", m = 2, k = 10) + s(Temp, bs = "ps", 
##     m = 2, k = 10)
## 
## Parametric coefficients:
##             Estimate Std. Error t value Pr(>|t|)    
## (Intercept)  3.41593    0.05128   66.61   <2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Approximate significance of smooth terms:
##            edf Ref.df     F  p-value    
## s(Wind) 2.1879      9 1.919    1e-04 ***
## s(Temp) 0.9874      9 8.601 7.73e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## R-sq.(adj) =  0.611   Deviance explained = 62.2%
## -REML = 95.215  Scale est. = 0.29194   n = 111
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{summary}\NormalTok{(airq.gam3)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## log(Ozone) ~ s(Wind, bs = "ps", m = 2, k = 10) + s(Temp, bs = "ps", 
##     m = 2, k = 10) + s(Solar.R, bs = "ps", m = 2, k = 20)
## 
## Parametric coefficients:
##             Estimate Std. Error t value Pr(>|t|)    
## (Intercept)  3.41593    0.04586   74.49   <2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Approximate significance of smooth terms:
##              edf Ref.df     F  p-value    
## s(Wind)    2.318      9 2.255 2.44e-05 ***
## s(Temp)    1.852      9 6.128 1.12e-12 ***
## s(Solar.R) 2.145     19 1.397 1.23e-06 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## R-sq.(adj) =  0.689   Deviance explained = 70.7%
## -REML = 86.106  Scale est. = 0.23342   n = 111
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{AIC}\NormalTok{(airq.gam22)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 185.7769
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{AIC}\NormalTok{(airq.gam3)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 166.0423
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{))}
\KeywordTok{plot}\NormalTok{(airq.gam3,}\DataTypeTok{residuals=}\OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/airq-07i-1} \end{center}

\chapter{Análisis multivariante}\label{anuxe1lisis-multivariante}

\section{Análisis de Componentes
Principales}\label{anuxe1lisis-de-componentes-principales}

El análisis de componentes principales (\emph{principal component
analysis}) o PCA es una de las técnicas de aprendizaje no supervisado,
las cuales suelen aplicarse como parte del análisis exploratorio de los
datos.

A diferencia de los métodos de aprendizaje supervisado, donde contamos
con un grupo de variables o características (\(X=X_1,X_2,...,X_p\))
medidas sobre un conjunto de observaciones \(n\), con la intención de
obtener predicciones sobre una variable respuesta \(Y\) asociada, en los
no supervisados solo contamos con un número de variables de las cuales
nos interesa conocer o de las que queremos extraer información, por
ejemplo, sobre la existencia de subgrupos entre las variables u
observaciones.

Una de las aplicaciones de PCA es la \textbf{reducción de
dimensionalidad} (variables), perdiendo la menor cantidad de información
(varianza) posible: cuando contamos con un gran número de variables
cuantitativas posiblemente correlacionadas (indicativo de existencia de
información redundante), PCA permite reducirlas a un número menor de
variables transformadas (componentes principales) que expliquen gran
parte de la variabilidad en los datos. Cada dimensión o componente
principal generada por PCA será una combinación lineal de las variables
originales, y serán además independientes o no correlacionadas entre sí.

Se utiliza para enfatizar la variación y sacar a relucir patrones
fuertes en un conjunto de datos. A menudo se utiliza para hacer que los
datos sean fáciles de explorar y visualizar. Vamos a realizar un PCA de
los resultados obtenidos en la competición de heptatlón femenino de los
Juegos Olímpicos de Seúl (1988).

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(HSAUR2)}
\KeywordTok{data}\NormalTok{(}\StringTok{"heptathlon"}\NormalTok{)}
\KeywordTok{head}\NormalTok{(heptathlon)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                     hurdles highjump  shot run200m longjump javelin
## Joyner-Kersee (USA)   12.69     1.86 15.80   22.56     7.27   45.66
## John (GDR)            12.85     1.80 16.23   23.65     6.71   42.56
## Behmer (GDR)          13.20     1.83 14.20   23.10     6.68   44.54
## Sablovskaite (URS)    13.61     1.80 15.23   23.92     6.25   42.78
## Choubenkova (URS)     13.51     1.74 14.76   23.93     6.32   47.46
## Schulz (GDR)          13.75     1.83 13.50   24.65     6.33   42.82
##                     run800m score
## Joyner-Kersee (USA)  128.51  7291
## John (GDR)           126.12  6897
## Behmer (GDR)         124.20  6858
## Sablovskaite (URS)   132.24  6540
## Choubenkova (URS)    127.90  6540
## Schulz (GDR)         125.79  6411
\end{verbatim}

Recodificamos las pruebas relativas a 3 carreras \texttt{hurdles},
\texttt{run200m} y \texttt{run800m}, restando el valor más alto en cada
carrera, cada uno de los 35 tiempos de los atletas.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{heptathlon}\OperatorTok{$}\NormalTok{hurdles <-}\StringTok{ }\KeywordTok{max}\NormalTok{(heptathlon}\OperatorTok{$}\NormalTok{hurdles) }\OperatorTok{-}\StringTok{ }\NormalTok{heptathlon}\OperatorTok{$}\NormalTok{hurdles}
\NormalTok{heptathlon}\OperatorTok{$}\NormalTok{run200m <-}\StringTok{ }\KeywordTok{max}\NormalTok{(heptathlon}\OperatorTok{$}\NormalTok{run200m) }\OperatorTok{-}\StringTok{ }\NormalTok{heptathlon}\OperatorTok{$}\NormalTok{run200m}
\NormalTok{heptathlon}\OperatorTok{$}\NormalTok{run800m <-}\StringTok{ }\KeywordTok{max}\NormalTok{(heptathlon}\OperatorTok{$}\NormalTok{run800m) }\OperatorTok{-}\StringTok{ }\NormalTok{heptathlon}\OperatorTok{$}\NormalTok{run800m}
\end{Highlighting}
\end{Shaded}

Diagrama de dispersion

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{score <-}\StringTok{ }\KeywordTok{which}\NormalTok{(}\KeywordTok{colnames}\NormalTok{(heptathlon) }\OperatorTok{==}\StringTok{ "score"}\NormalTok{)}
\KeywordTok{plot}\NormalTok{(heptathlon[,}\OperatorTok{-}\NormalTok{score])}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/hep-08-1} \end{center}

Matriz de correlación

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{round}\NormalTok{(}\KeywordTok{cor}\NormalTok{(heptathlon[,}\OperatorTok{-}\NormalTok{score]),}\DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##          hurdles highjump  shot run200m longjump javelin run800m
## hurdles    1.000    0.811 0.651   0.774    0.912   0.008   0.779
## highjump   0.811    1.000 0.441   0.488    0.782   0.002   0.591
## shot       0.651    0.441 1.000   0.683    0.743   0.269   0.420
## run200m    0.774    0.488 0.683   1.000    0.817   0.333   0.617
## longjump   0.912    0.782 0.743   0.817    1.000   0.067   0.700
## javelin    0.008    0.002 0.269   0.333    0.067   1.000  -0.020
## run800m    0.779    0.591 0.420   0.617    0.700  -0.020   1.000
\end{verbatim}

La matriz de resultados confirma que la gran mayoría de las
correlaciones entre las pruebas son positivas, con una alta correlación
entre el salto de longitud y el salto de longitud (\texttt{longjump}) y
los 100m vallas (\texttt{hurdles}). A algunos les gusta menos el salto
de altura (\texttt{highjump}) y el disparo (\texttt{shot}) y la jabalina
(\texttt{javelin}) que tiene una correlación cercana a cero con el resto
de las pruebas.

Una posible explicación para este resultado podría ser que el
entrenamiento para las otras 6 pruebas no añade mucho a la prueba de
jabalina, que es una prueba más técnica.

Puede observarse que existe un valor atípico en casi todas las pruebas
que corresponde a un atleta \texttt{Launa\ (PNG)} de Papúa Nueva Guinea
- eliminaremos esta observación para ver si la matriz de correlación es
significativamente diferente:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{heptathlon <-}\StringTok{ }\NormalTok{heptathlon[}\OperatorTok{-}\KeywordTok{which}\NormalTok{(}\KeywordTok{rownames}\NormalTok{(heptathlon)}\OperatorTok{==}\StringTok{"Launa (PNG)"}\NormalTok{),]}
\KeywordTok{plot}\NormalTok{(heptathlon[,}\OperatorTok{-}\NormalTok{score])}
\end{Highlighting}
\end{Shaded}

\includegraphics{cursoR_files/figure-latex/hepta-08a-1.pdf}

Eliminando al atleta de Papúa Nueva Guinea, las correlaciones cambian
sustancialmente y en el diagrama de dispersión matricial no se observan
valores extremos.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{round}\NormalTok{(}\KeywordTok{cor}\NormalTok{(heptathlon[,}\OperatorTok{-}\NormalTok{score]),}\DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##          hurdles highjump  shot run200m longjump javelin run800m
## hurdles    1.000    0.582 0.767   0.830    0.889   0.332   0.559
## highjump   0.582    1.000 0.465   0.391    0.663   0.348   0.152
## shot       0.767    0.465 1.000   0.669    0.784   0.343   0.408
## run200m    0.830    0.391 0.669   1.000    0.811   0.471   0.573
## longjump   0.889    0.663 0.784   0.811    1.000   0.287   0.523
## javelin    0.332    0.348 0.343   0.471    0.287   1.000   0.256
## run800m    0.559    0.152 0.408   0.573    0.523   0.256   1.000
\end{verbatim}

Para realizar el PCA, partiremos de la matriz de correlación, ya que las
7 pruebas se miden en diferentes escalas (metros, segundos). Este
procedimiento se denomina PCA normalizado (\texttt{scale=TRUE} en la
función \texttt{prcomp}).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{?prcomp}
\NormalTok{heptathlon_pca <-}\StringTok{ }\KeywordTok{prcomp}\NormalTok{(heptathlon[,}\OperatorTok{-}\NormalTok{score],}\DataTypeTok{scale=}\OtherTok{TRUE}\NormalTok{)}
\KeywordTok{head}\NormalTok{(heptathlon_pca,}\DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## $sdev
## [1] 2.0793370 0.9481532 0.9109016 0.6831967 0.5461888 0.3374549 0.2620420
## 
## $rotation
##                 PC1         PC2        PC3         PC4         PC5
## hurdles  -0.4503876  0.05772161 -0.1739345  0.04840598 -0.19889364
## highjump -0.3145115 -0.65133162 -0.2088272 -0.55694554  0.07076358
## shot     -0.4024884 -0.02202088 -0.1534709  0.54826705  0.67166466
## run200m  -0.4270860  0.18502783  0.1301287  0.23095946 -0.61781764
## longjump -0.4509639 -0.02492486 -0.2697589 -0.01468275 -0.12151793
## javelin  -0.2423079 -0.32572229  0.8806995  0.06024757  0.07874396
## run800m  -0.3029068  0.65650503  0.1930020 -0.57418128  0.31880178
##                  PC6         PC7
## hurdles   0.84665086 -0.06961672
## highjump -0.09007544  0.33155910
## shot     -0.09886359  0.22904298
## run200m  -0.33279359  0.46971934
## longjump -0.38294411 -0.74940781
## javelin   0.07193437 -0.21108138
## run800m  -0.05217664  0.07718616
## 
## $center
##   hurdles  highjump      shot   run200m  longjump   javelin   run800m 
##  2.687500  1.793750 13.173333  2.023750  6.205417 41.278333 28.516667 
## 
## $scale
##    hurdles   highjump       shot    run200m   longjump    javelin 
## 0.51456398 0.05232112 1.49714995 0.93676972 0.40165938 3.46870690 
##    run800m 
## 6.14724800 
## 
## $x
##                              PC1         PC2          PC3          PC4
## Joyner-Kersee (USA) -4.757530189 -0.13986143 -0.006040526  0.293416339
## John (GDR)          -3.147943402  0.94859029 -0.243919842  0.549171385
## Behmer (GDR)        -2.926184760  0.69534239  0.622293440 -0.554744912
## Sablovskaite (URS)  -1.288135516  0.17900713  0.250632380  0.637174187
## Choubenkova (URS)   -1.503450994  0.96177329  1.780588549  0.784035325
## Schulz (GDR)        -0.958467101  0.35121643  0.413086366 -1.113546938
## Fleming (AUS)       -0.953445060  0.49982537 -0.265135015 -0.140202490
## Greiner (USA)       -0.633239267  0.37592917 -1.140338594  0.142558348
## Lajbnerova (CZE)    -0.381571974 -0.71213459 -0.068395353  0.087212735
## Bouraga (URS)       -0.522322004  0.77688861 -0.481071429  0.283745698
## Wijnsma (HOL)       -0.217701500 -0.23369645 -1.154221444 -1.260128609
## Dimitrova (BUL)     -1.075984276  0.51552998 -0.312458252 -0.127032432
## Scheider (SWI)       0.003014986 -1.44688825  1.582739069 -1.254415325
## Braun (FRG)          0.109183759 -1.63595645  0.469577294  0.362580442
## Ruotsalainen (FIN)   0.208868056 -0.68866173  1.152140223 -0.112914470
## Yuping (CHN)         0.232507119 -1.95999641 -1.541230813  0.598325122
## Hagger (GB)          0.659520046 -0.08775813 -1.796509771 -0.182375000
## Brown (USA)          0.756854602 -2.04292201  0.451506018  0.476926314
## Mulliner (GB)        1.880932819  0.91530324 -0.359311801  0.799619094
## Hautenauve (BEL)     1.828170404  0.72629699 -1.048640439 -0.711793161
## Kytola (FIN)         2.118203163  0.39921397  0.190158154 -0.788445056
## Geremias (BRA)       2.770706272  0.03463584  0.170274969  1.385562494
## Hui-Ing (TAI)        3.901166920  1.20175472  0.943677497 -0.002429122
## Jeong-Mi (KOR)       3.896847898  0.36656804  0.390599321 -0.152299968
##                             PC5         PC6         PC7
## Joyner-Kersee (USA) -0.36183307 -0.27050283 -0.47587527
## John (GDR)           0.75364464  0.37770017 -0.05172711
## Behmer (GDR)        -0.19035037 -0.25780287  0.11054960
## Sablovskaite (URS)   0.60362153 -0.21575716  0.53075152
## Choubenkova (URS)    0.58969949  0.08014332 -0.30081842
## Schulz (GDR)         0.71483887 -0.25436956  0.03838796
## Fleming (AUS)       -0.86581530  0.03691813  0.23005943
## Greiner (USA)        0.20807431 -0.14236240 -0.06374657
## Lajbnerova (CZE)     0.67727618  0.25014881  0.35555639
## Bouraga (URS)       -1.18784299  0.39881271  0.19712215
## Wijnsma (HOL)        0.37497195 -0.20267731  0.17459647
## Dimitrova (BUL)     -0.91992929  0.26727067  0.21111846
## Scheider (SWI)      -0.20526249  0.17597425 -0.03915701
## Braun (FRG)         -0.14712208  0.26134199 -0.01334416
## Ruotsalainen (FIN)  -0.31539746  0.18351622 -0.14127555
## Yuping (CHN)         0.17451428 -0.50175724  0.04999374
## Hagger (GB)         -0.05104049  0.55058471 -0.46388534
## Brown (USA)         -0.38154294 -0.26606429 -0.11099445
## Mulliner (GB)       -0.06942955 -0.73259727 -0.31281502
## Hautenauve (BEL)     0.14092347  0.06933542 -0.07548638
## Kytola (FIN)         0.41815113 -0.03363651  0.12143219
## Geremias (BRA)       0.28541366  0.38083979  0.34574480
## Hui-Ing (TAI)       -0.67080776 -0.52756760  0.09436975
## Jeong-Mi (KOR)       0.42524426  0.37250885 -0.41055719
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a1 <-}\StringTok{ }\NormalTok{heptathlon_pca}\OperatorTok{$}\NormalTok{rotation[,}\DecValTok{1}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\texttt{summary}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{summary}\NormalTok{(heptathlon_pca)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Importance of components:
##                           PC1    PC2    PC3     PC4     PC5     PC6
## Standard deviation     2.0793 0.9482 0.9109 0.68320 0.54619 0.33745
## Proportion of Variance 0.6177 0.1284 0.1185 0.06668 0.04262 0.01627
## Cumulative Proportion  0.6177 0.7461 0.8646 0.93131 0.97392 0.99019
##                            PC7
## Standard deviation     0.26204
## Proportion of Variance 0.00981
## Cumulative Proportion  1.00000
\end{verbatim}

Comprobamos la variabilidad explicada:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{head}\NormalTok{(heptathlon_pca}\OperatorTok{$}\NormalTok{x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                            PC1        PC2          PC3        PC4
## Joyner-Kersee (USA) -4.7575302 -0.1398614 -0.006040526  0.2934163
## John (GDR)          -3.1479434  0.9485903 -0.243919842  0.5491714
## Behmer (GDR)        -2.9261848  0.6953424  0.622293440 -0.5547449
## Sablovskaite (URS)  -1.2881355  0.1790071  0.250632380  0.6371742
## Choubenkova (URS)   -1.5034510  0.9617733  1.780588549  0.7840353
## Schulz (GDR)        -0.9584671  0.3512164  0.413086366 -1.1135469
##                            PC5         PC6         PC7
## Joyner-Kersee (USA) -0.3618331 -0.27050283 -0.47587527
## John (GDR)           0.7536446  0.37770017 -0.05172711
## Behmer (GDR)        -0.1903504 -0.25780287  0.11054960
## Sablovskaite (URS)   0.6036215 -0.21575716  0.53075152
## Choubenkova (URS)    0.5896995  0.08014332 -0.30081842
## Schulz (GDR)         0.7148389 -0.25436956  0.03838796
\end{verbatim}

Gráficamente, se observa que el primer componente importante es el más
dominante.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot}\NormalTok{(heptathlon_pca)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/pca-hepta-1} \end{center}

El \emph{biplot} es una representación gráfica de datos multivariantes.
Así como una gráfica de dispersión muestra la distribución combinada de
dos variables, una \textbf{biplot} representa tres o más variables.

Si ordenamos de mayor a menor la variable ``puntuación'' tenemos las
tres medallas de oro, plata y bronce.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{head}\NormalTok{(heptathlon[}\KeywordTok{order}\NormalTok{(heptathlon}\OperatorTok{$}\NormalTok{score,}\DataTypeTok{decreasing =} \OtherTok{TRUE}\NormalTok{),],}\DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                     hurdles highjump  shot run200m longjump javelin
## Joyner-Kersee (USA)    3.73     1.86 15.80    4.05     7.27   45.66
## John (GDR)             3.57     1.80 16.23    2.96     6.71   42.56
## Behmer (GDR)           3.22     1.83 14.20    3.51     6.68   44.54
##                     run800m score
## Joyner-Kersee (USA)   34.92  7291
## John (GDR)            37.31  6897
## Behmer (GDR)          39.23  6858
\end{verbatim}

~

El biplot, nos muestra los atletas proyectados en sus dos primeros
componentes principales, pero también las flechas nos dan información
sobre las varianzas y covarianzas de las variables (direcciones de
máxima variabilidad).

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{biplot}\NormalTok{(heptathlon_pca)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/biplot-08a-1} \end{center}

Por ejemplo, el ganador \texttt{Joyner-Kersee\ (USA)} acumula
puntuaciones más altas en el \texttt{longjump},\texttt{hurdlesp} y
\texttt{run200m}.

~

Podemos analizar la correlación entre la puntuación de la variable y
PC1. Esto indica que la correlación es muy negativa y muy fuerte con el
\texttt{score}.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{cor}\NormalTok{(heptathlon}\OperatorTok{$}\NormalTok{score, heptathlon_pca}\OperatorTok{$}\NormalTok{x[,}\DecValTok{1}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] -0.9931168
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot}\NormalTok{(heptathlon}\OperatorTok{$}\NormalTok{score, heptathlon_pca}\OperatorTok{$}\NormalTok{x[,}\DecValTok{1}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/hepta-08b-1} \end{center}

objeto \texttt{prcomp}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{class}\NormalTok{(heptathlon_pca)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "prcomp"
\end{verbatim}

Podemos usar \texttt{predict}, ej.:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{new.athlete <-}\StringTok{ }\KeywordTok{as.data.frame}\NormalTok{(}\KeywordTok{t}\NormalTok{(}\KeywordTok{as.vector}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\FloatTok{3.5}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{13}\NormalTok{,}\DecValTok{5}\NormalTok{,}\DecValTok{7}\NormalTok{,}\DecValTok{41}\NormalTok{,}\DecValTok{33}\NormalTok{))))}
\KeywordTok{colnames}\NormalTok{(new.athlete) <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"hurdles"}\NormalTok{,}\StringTok{"highjump"}\NormalTok{,}
                           \StringTok{"shot"}\NormalTok{,}\StringTok{"run200m"}\NormalTok{,}\StringTok{"longjump"}\NormalTok{,}
                           \StringTok{"javelin"}\NormalTok{,}\StringTok{"run800m"}\NormalTok{)}
\KeywordTok{rownames}\NormalTok{(new.athlete) <-}\StringTok{ "Mrs XYZ (XXX)"}
\NormalTok{pp<-}\KeywordTok{predict}\NormalTok{(heptathlon_pca,}\DataTypeTok{newdata =}\NormalTok{ new.athlete)}
\NormalTok{pp}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                     PC1       PC2       PC3       PC4       PC5        PC6
## Mrs XYZ (XXX) -4.354879 -1.430366 -1.130194 -1.901377 -2.089963 -0.8654821
##                    PC7
## Mrs XYZ (XXX) 1.253643
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{biplot}\NormalTok{(heptathlon_pca)}
\KeywordTok{text}\NormalTok{(pp[,}\DecValTok{1}\NormalTok{],pp[,}\DecValTok{2}\NormalTok{],}\StringTok{"Mrs XYZ (XXX)"}\NormalTok{,}\DataTypeTok{col=}\StringTok{"blue"}\NormalTok{,}\DataTypeTok{cex=}\NormalTok{.}\DecValTok{65}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{cursoR_files/figure-latex/biplot-08b-1.pdf}

\section{K-medias}\label{k-medias}

K-means Clustering es un algoritmo de aprendizaje no supervisado que
intenta agrupar datos basados en su similitud. El aprendizaje sin
supervisión significa que no hay resultados que predecir, y el algoritmo
sólo trata de encontrar patrones en los datos. En k-means clustering,
tenemos que especificar el número de clusters en los que queremos que se
agrupen los datos. El algoritmo asigna aleatoriamente cada observación a
un cúmulo, y encuentra el centroide de cada cúmulo. Luego, el algoritmo
itera a través de dos pasos:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  Reasigne los puntos de datos al cluster cuyo centroide está más cerca.
\item
  Calcular el nuevo centroide de cada cúmulo.
\end{enumerate}

Estos dos pasos se repiten hasta que la variación dentro del
conglomerado no pueda reducirse más. La variación dentro del
conglomerado se calcula como la suma de la distancia euclídea entre los
puntos de datos y sus respectivos centros de conglomerados.

\textbf{Ejemplo:}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(rattle)}
\KeywordTok{data}\NormalTok{(wine)}
\KeywordTok{head}\NormalTok{(wine)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   Type Alcohol Malic  Ash Alcalinity Magnesium Phenols Flavanoids
## 1    1   14.23  1.71 2.43       15.6       127    2.80       3.06
## 2    1   13.20  1.78 2.14       11.2       100    2.65       2.76
## 3    1   13.16  2.36 2.67       18.6       101    2.80       3.24
## 4    1   14.37  1.95 2.50       16.8       113    3.85       3.49
## 5    1   13.24  2.59 2.87       21.0       118    2.80       2.69
## 6    1   14.20  1.76 2.45       15.2       112    3.27       3.39
##   Nonflavanoids Proanthocyanins Color  Hue Dilution Proline
## 1          0.28            2.29  5.64 1.04     3.92    1065
## 2          0.26            1.28  4.38 1.05     3.40    1050
## 3          0.30            2.81  5.68 1.03     3.17    1185
## 4          0.24            2.18  7.80 0.86     3.45    1480
## 5          0.39            1.82  4.32 1.04     2.93     735
## 6          0.34            1.97  6.75 1.05     2.85    1450
\end{verbatim}

Siempre se recomienda estandarizar las variables

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{wine.stand <-}\StringTok{ }\KeywordTok{scale}\NormalTok{(wine[}\OperatorTok{-}\DecValTok{1}\NormalTok{])  }\CommentTok{# To standarize the variables}
\CommentTok{# K-Means}
\NormalTok{k.means.fit <-}\StringTok{ }\KeywordTok{kmeans}\NormalTok{(wine.stand, }\DecValTok{3}\NormalTok{) }\CommentTok{# k = 3}
\KeywordTok{attributes}\NormalTok{(k.means.fit)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## $names
## [1] "cluster"      "centers"      "totss"        "withinss"    
## [5] "tot.withinss" "betweenss"    "size"         "iter"        
## [9] "ifault"      
## 
## $class
## [1] "kmeans"
\end{verbatim}

Una pregunta fundamental es cómo determinar el valor del parámetro
\(k\). Si consideramos el porcentaje de varianza explicado en función
del número de grupos:

Uno debe elegir un número de grupos para que la incorporación de otro
grupo no dé un mejor modelado de los datos. Más precisamente, si el
porcentaje de varianza explicado por los clusters se traza de acuerdo al
número de grupos, los primeros clusters añadirán mucha información
(explican mucha varianza), pero en algún momento la ganancia marginal
disminuirá, dando un ángulo en el gráfico. En este punto se elige el
número de racimos, de ahí el ``criterio del codo''.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{wssplot <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(data, }\DataTypeTok{nc=}\DecValTok{15}\NormalTok{, }\DataTypeTok{seed=}\DecValTok{1234}\NormalTok{)\{}
\NormalTok{  wss <-}\StringTok{ }\NormalTok{(}\KeywordTok{nrow}\NormalTok{(data)}\OperatorTok{-}\DecValTok{1}\NormalTok{)}\OperatorTok{*}\KeywordTok{sum}\NormalTok{(}\KeywordTok{apply}\NormalTok{(data,}\DecValTok{2}\NormalTok{,var))}
  \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{2}\OperatorTok{:}\NormalTok{nc)\{}
    \KeywordTok{set.seed}\NormalTok{(seed)}
\NormalTok{    wss[i] <-}\StringTok{ }\KeywordTok{sum}\NormalTok{(}\KeywordTok{kmeans}\NormalTok{(data, }\DataTypeTok{centers=}\NormalTok{i)}\OperatorTok{$}\NormalTok{withinss)\}}
  \KeywordTok{plot}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\NormalTok{nc, wss, }\DataTypeTok{type=}\StringTok{"b"}\NormalTok{, }\DataTypeTok{xlab=}\StringTok{"Number of Clusters"}\NormalTok{,}
       \DataTypeTok{ylab=}\StringTok{"Within groups sum of squares"}\NormalTok{)\}}

\KeywordTok{wssplot}\NormalTok{(wine.stand, }\DataTypeTok{nc=}\DecValTok{6}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/wsplot-1} \end{center}

La \texttt{library(cluster)} permite representar los datos en dos
dimensiones:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(cluster)}
\KeywordTok{clusplot}\NormalTok{(wine.stand, k.means.fit}\OperatorTok{$}\NormalTok{cluster,}
         \DataTypeTok{main=}\StringTok{'2D representation of the Cluster solution'}\NormalTok{,}
         \DataTypeTok{color=}\OtherTok{TRUE}\NormalTok{, }\DataTypeTok{shade=}\OtherTok{TRUE}\NormalTok{,}
         \DataTypeTok{labels=}\DecValTok{2}\NormalTok{, }\DataTypeTok{lines=}\DecValTok{0}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/clust-1} \end{center}

Sabiendo que hay tres tipos de \texttt{wine\$Type} wines, podemos
calcular la matriz de confusión.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{table}\NormalTok{(wine}\OperatorTok{$}\NormalTok{Type)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  1  2  3 
## 59 71 48
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{table}\NormalTok{(wine[,}\DecValTok{1}\NormalTok{],k.means.fit}\OperatorTok{$}\NormalTok{cluster)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    
##      1  2  3
##   1 59  0  0
##   2  3  3 65
##   3  0 48  0
\end{verbatim}

\section{Cluster jerárquico}\label{cluster-jeruxe1rquico}

Los métodos jerárquicos utilizan una matriz de distancia como entrada
para el algoritmo de agrupación. La elección de una métrica apropiada
influirá en la forma de los cúmulos, ya que algunos elementos pueden
estar próximos entre sí de acuerdo a una distancia y más separados de
acuerdo a otra.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{d <-}\StringTok{ }\KeywordTok{dist}\NormalTok{(wine.stand, }\DataTypeTok{method =} \StringTok{"euclidean"}\NormalTok{) }\CommentTok{# Euclidean distance matrix.}
\end{Highlighting}
\end{Shaded}

El criterio de desviación mínima de Ward minimiza la desviación total
dentro del grupo de empresas.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{H.fit <-}\StringTok{ }\KeywordTok{hclust}\NormalTok{(d, }\DataTypeTok{method=}\StringTok{"ward"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## The "ward" method has been renamed to "ward.D"; note new "ward.D2"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{class}\NormalTok{(H.fit)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "hclust"
\end{verbatim}

La opción \texttt{plot} devuelve un \texttt{hclust} que muestra el
dendograma:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot}\NormalTok{(H.fit) }\CommentTok{# display dendogram}
\NormalTok{groups <-}\StringTok{ }\KeywordTok{cutree}\NormalTok{(H.fit, }\DataTypeTok{k=}\DecValTok{3}\NormalTok{) }\CommentTok{# cut tree into 5 clusters}
\CommentTok{# draw dendogram with red borders around the 5 clusters}
\KeywordTok{rect.hclust}\NormalTok{(H.fit, }\DataTypeTok{k=}\DecValTok{3}\NormalTok{, }\DataTypeTok{border=}\StringTok{"red"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/dendo-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{table}\NormalTok{(wine[,}\DecValTok{1}\NormalTok{],groups)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    groups
##      1  2  3
##   1 58  1  0
##   2  7 58  6
##   3  0  0 48
\end{verbatim}

\chapter{Introduccion a las redes neuronales
artificiales}\label{introduccion-a-las-redes-neuronales-artificiales}

En esta sección describimos una clase de métodos de aprendizaje que se
desarrollaron por separado en diferentes campos: estadística e
inteligencia artificial basadas en modelos esencialmente idénticos.

Las redes neuronales artificiales se inspiran en el comportamiento
conocido del cerebro humano (principalmente el referido a las neuronas y
sus conexiones), trata de crear modelos artificiales que solucionen
problemas difíciles de resolver mediante técnicas algorítmicas
convencionales.

La idea central es extraer las combinaciones lineales de las variables
de entrada como características derivadas y, a continuación, modelar el
objetivo como una función no lineal de estas características. El
resultado es un poderoso método de aprendizaje, con amplias aplicaciones
en muchos campos.

la neurona artificial pretende mimetizar las características más
importantes de la neurona biólogica. En general, recibe las señales de
entrada de las neuronas v ecinas ponderadas por los pesos de las
conexiones. La suma de estas señales ponderadas proporciona la entrada
total o neta de la neurona y, mediante la aplicación de una función
matemática - denominada función de salida - , sobre la entrada neta, se
calcula un valor de salida, el cual es enviado a otras neuronas.

\begin{figure}
\centering
\includegraphics{figures/neurona.png}
\caption{\emph{Estructura general de una neurona biológica.}}
\end{figure}

Tanto los valores de entrada a la neurona como su salida pueden ser
señales excitatorias (cuando el valor es positivo) o inhibitorias
(cuando el valor es negativo).

\begin{figure}
\centering
\includegraphics{figures/neurona_artificial.png}
\caption{\emph{Funcionamiento general de una neurona artificial.}}
\end{figure}

\section{Arquitecturas de las RNA}\label{arquitecturas-de-las-rna}

Las neuronas que componen una RNA se organizan de forma jerárquica
formando capas. Una capa o nivel es un conjunto de neuronas cuyas
entradas de información provienen de la misma fuente (que puede ser otra
capa de neuronas) y cuyas salidas de información se dirigen al mismo
destino (que puede ser otra capa de neuronas). En este sentido, se
distinguen tres tipos de capas: la capa de entrada recibe la información
del exterior; la o las capas ocultas son aquellas cuyas entradas y
salidas se encuentran dentro del sistema y, por tanto, no tienen
contacto con el exterior; por último, la capa de salida envía la
respuesta de la red al exterior.

En función de la organización de las neuronas en la red formando capas o
agrupaciones podemos encontrarnos con dos tipos de arquitecturas
básicas: redes multicapa (multi-layer) y redes monocapa (single-layer).

\section{Ejemplo: datos Boston
housing}\label{ejemplo-datos-boston-housing}

Vamos a utilizar el conjunto de datos de \texttt{Boston} en el paquete
\texttt{MASS}. Recordemos que el conjunto de datos de \texttt{Boston} es
una colección de datos sobre valores de vivienda en los suburbios de
Boston. Nuestro objetivo es predecir el valor medio de las viviendas
ocupadas por sus propietarios (`medv) utilizando todas las demás
variables continuas disponibles.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{500}\NormalTok{)}
\KeywordTok{library}\NormalTok{(MASS)}
\NormalTok{data <-}\StringTok{ }\NormalTok{Boston}
\end{Highlighting}
\end{Shaded}

Primero tenemos que comprobar que no hay datos faltantes, de lo
contrario tenemos que arreglar el conjunto de datos.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{apply}\NormalTok{(data,}\DecValTok{2}\NormalTok{,}\ControlFlowTok{function}\NormalTok{(x) }\KeywordTok{sum}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(x)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    crim      zn   indus    chas     nox      rm     age     dis     rad 
##       0       0       0       0       0       0       0       0       0 
##     tax ptratio   black   lstat    medv 
##       0       0       0       0       0
\end{verbatim}

Hemos comprobado que no hay datos faltantes (\texttt{NA}). Procedemos
dividiendo aleatoriamente los datos en un conjunto de entrenamiento y un
conjunto de prueba, luego ajustamos un modelo de regresión lineal y lo
probamos en el conjunto de prueba. Nótese que usamos la función
\texttt{glm()} en lugar de la función \texttt{lm()} esto será útil más
tarde al validar el modelo lineal.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{index <-}\StringTok{ }\KeywordTok{sample}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\KeywordTok{nrow}\NormalTok{(data),}\KeywordTok{round}\NormalTok{(}\FloatTok{0.75}\OperatorTok{*}\KeywordTok{nrow}\NormalTok{(data)))}
\NormalTok{train <-}\StringTok{ }\NormalTok{data[index,]}
\NormalTok{test <-}\StringTok{ }\NormalTok{data[}\OperatorTok{-}\NormalTok{index,]}
\NormalTok{lm.fit <-}\StringTok{ }\KeywordTok{glm}\NormalTok{(medv}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{train)}
\KeywordTok{summary}\NormalTok{(lm.fit)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## glm(formula = medv ~ ., data = train)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -14.9143   -2.8607   -0.5244    1.5242   25.0004  
## 
## Coefficients:
##               Estimate Std. Error t value Pr(>|t|)    
## (Intercept)  43.469681   6.099347   7.127 5.50e-12 ***
## crim         -0.105439   0.057095  -1.847 0.065596 .  
## zn            0.044347   0.015974   2.776 0.005782 ** 
## indus         0.024034   0.071107   0.338 0.735556    
## chas          2.596028   1.089369   2.383 0.017679 *  
## nox         -22.336623   4.572254  -4.885 1.55e-06 ***
## rm            3.538957   0.472374   7.492 5.15e-13 ***
## age           0.016976   0.015088   1.125 0.261291    
## dis          -1.570970   0.235280  -6.677 9.07e-11 ***
## rad           0.400502   0.085475   4.686 3.94e-06 ***
## tax          -0.015165   0.004599  -3.297 0.001072 ** 
## ptratio      -1.147046   0.155702  -7.367 1.17e-12 ***
## black         0.010338   0.003077   3.360 0.000862 ***
## lstat        -0.524957   0.056899  -9.226  < 2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for gaussian family taken to be 23.26491)
## 
##     Null deviance: 33642  on 379  degrees of freedom
## Residual deviance:  8515  on 366  degrees of freedom
## AIC: 2290
## 
## Number of Fisher Scoring iterations: 2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ pr.lm <-}\StringTok{ }\KeywordTok{predict}\NormalTok{(lm.fit,test)}
\NormalTok{MSE.lm <-}\StringTok{ }\KeywordTok{sum}\NormalTok{((pr.lm }\OperatorTok{-}\StringTok{ }\NormalTok{test}\OperatorTok{$}\NormalTok{medv)}\OperatorTok{^}\DecValTok{2}\NormalTok{)}\OperatorTok{/}\KeywordTok{nrow}\NormalTok{(test)}
\end{Highlighting}
\end{Shaded}

La función \texttt{sample(x,size)} simplemente produce un vector del
tamaño especificado de muestras seleccionadas aleatoriamente desde el
vector x. Por defecto el muestreo es sin reemplazo: el índice es
esencialmente un vector aleatorio de muestras.

Como se trata de un problema de regresión, vamos a utilizar el error
cuadrático medio (ECM) como medida de lo lejos que están nuestras
predicciones de los datos reales.

\section{Ajuste de la red neuronal}\label{ajuste-de-la-red-neuronal}

Antes de entrenar una red neural, es necesario hacer algún paso previo.
Como primer paso, vamos a abordar el preprocesamiento de datos.

\begin{itemize}
\item
  Es una buena práctica normalizar los datos antes de entrenar una red
  neuronal.
\item
  Se pueden elegir diferentes métodos para escalar los datos
  (normalización-z, escala min-max, etc\ldots{}).
\item
  Elegiremos el método min-max y escalaremos los datos en el intervalo
  \([0,1]\). Por lo general, la escala en los intervalos \([0,1]\) ó
  \([-1,1]\) tiende a dar mejores resultados.
\item
  Por lo tanto, escalamos y dividimos los datos antes de seguir
  adelante:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{maxs <-}\StringTok{ }\KeywordTok{apply}\NormalTok{(data, }\DecValTok{2}\NormalTok{, max)}
\NormalTok{mins <-}\StringTok{ }\KeywordTok{apply}\NormalTok{(data, }\DecValTok{2}\NormalTok{, min)}

\NormalTok{scaled <-}\StringTok{ }\KeywordTok{as.data.frame}\NormalTok{(}\KeywordTok{scale}\NormalTok{(data, }\DataTypeTok{center =}\NormalTok{ mins, }\DataTypeTok{scale =}\NormalTok{ maxs }\OperatorTok{-}\StringTok{ }\NormalTok{mins))}

\NormalTok{train_ <-}\StringTok{ }\NormalTok{scaled[index,]}
\NormalTok{ test_ <-}\StringTok{ }\NormalTok{scaled[}\OperatorTok{-}\NormalTok{index,]}
\end{Highlighting}
\end{Shaded}

No hay una regla fija en cuanto a cuántas capas y neuronas usar, aunque
hay varias reglas generales más o menos aceptadas. Normalmente, si es
necesario, una capa oculta es suficiente para un gran número de
aplicaciones.

En cuanto al número de neuronas, debería estar entre el tamaño de la
capa de entrada y el tamaño de la capa de salida, normalmente 2/3 del
tamaño de entrada. No hay garantía de que ninguna de estas reglas se
ajuste mejor a su modelo de modo que es recomendable probar con
diferentes combinaciones.

Para este ejemplo, vamos a usar 2 capas ocultas con esta configuración:
\texttt{13:5:3:1}.

\begin{itemize}
\item
  La capa de entrada tiene 13 entradas,
\item
  las dos capas ocultas tienen 5 y 3 neuronas y
\item
  la capa de salida tiene, por supuesto, una sola salida ya que estamos
  haciendo regresión.
\end{itemize}

Vamos a entrar en la red:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(neuralnet)}
\NormalTok{n <-}\StringTok{ }\KeywordTok{names}\NormalTok{(train_)}
\NormalTok{f <-}\StringTok{ }\KeywordTok{as.formula}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{"medv ~"}\NormalTok{, }\KeywordTok{paste}\NormalTok{(n[}\OperatorTok{!}\NormalTok{n }\OperatorTok{%in%}\StringTok{ "medv"}\NormalTok{], }\DataTypeTok{collapse =} \StringTok{" + "}\NormalTok{)))}
\NormalTok{nn <-}\StringTok{ }\KeywordTok{neuralnet}\NormalTok{(f,}\DataTypeTok{data=}\NormalTok{train_,}\DataTypeTok{hidden=}\KeywordTok{c}\NormalTok{(}\DecValTok{5}\NormalTok{,}\DecValTok{3}\NormalTok{),}\DataTypeTok{linear.output=}\OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\textbf{Nota:}

\begin{itemize}
\item
  La expresión \texttt{y\textasciitilde{}.} no es aceptada por la
  función \texttt{neuralnet()}.
\item
  El argumento oculto acepta un vector con el número de neuronas para
  cada capa oculta, mientras que el argumento \texttt{linear.output} se
  usa para especificar si queremos hacer una regresión
  \texttt{linear.output=TRUE} o clasificación
  \texttt{linear.output=FALSE}.
\end{itemize}

La librería \texttt{neuralnet} proporciona una buena herramienta para
representar gráficamente el modelo con los pesos en cada conexión:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot}\NormalTok{(nn)}
\end{Highlighting}
\end{Shaded}

Las líneas negras muestran las conexiones entre cada capa y los pesos de
cada conexión, mientras que las líneas azules muestran el término de
sesgo añadido en cada paso. El sesgo puede ser pensado como el
intercepto de un modelo lineal.

La red neuronal es esencialmente una caja negra, por lo que no podemos
decir mucho sobre el ajuste, los pesos y el modelo. Basta decir que el
algoritmo de entrenamiento ha convergido y por lo tanto el modelo está
listo para ser utilizado.

\section{Predicción con una red
neuronal}\label{predicciuxf3n-con-una-red-neuronal}

Ahora podemos tratar de predecir los valores para el equipo de prueba y
calcular el ECM. Recuerda que la red producirá una predicción
normalizada, por lo que necesitamos reducirla para hacer una comparación
significativa (o simplemente una predicción simple).

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(neuralnet)}
\NormalTok{pr.nn <-}\StringTok{ }\NormalTok{neuralnet}\OperatorTok{::}\KeywordTok{compute}\NormalTok{(nn,test_[,}\DecValTok{1}\OperatorTok{:}\DecValTok{13}\NormalTok{])}

\NormalTok{pr.nn_ <-}\StringTok{ }\NormalTok{pr.nn}\OperatorTok{$}\NormalTok{net.result}\OperatorTok{*}\NormalTok{(}\KeywordTok{max}\NormalTok{(data}\OperatorTok{$}\NormalTok{medv)}\OperatorTok{-}\KeywordTok{min}\NormalTok{(data}\OperatorTok{$}\NormalTok{medv))}\OperatorTok{+}\KeywordTok{min}\NormalTok{(data}\OperatorTok{$}\NormalTok{medv)}
\NormalTok{test.r <-}\StringTok{ }\NormalTok{(test_}\OperatorTok{$}\NormalTok{medv)}\OperatorTok{*}\NormalTok{(}\KeywordTok{max}\NormalTok{(data}\OperatorTok{$}\NormalTok{medv)}\OperatorTok{-}\KeywordTok{min}\NormalTok{(data}\OperatorTok{$}\NormalTok{medv))}\OperatorTok{+}\KeywordTok{min}\NormalTok{(data}\OperatorTok{$}\NormalTok{medv)}

\NormalTok{MSE.nn <-}\StringTok{ }\KeywordTok{sum}\NormalTok{((test.r }\OperatorTok{-}\StringTok{ }\NormalTok{pr.nn_)}\OperatorTok{^}\DecValTok{2}\NormalTok{)}\OperatorTok{/}\KeywordTok{nrow}\NormalTok{(test_)}
\NormalTok{MSE.nn}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 15.75184
\end{verbatim}

Podemos ahora comparar los dos ECM:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(}\KeywordTok{paste}\NormalTok{(MSE.lm,MSE.nn))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "21.6297593507225 15.7518370200153"
\end{verbatim}

Aparentemente la red neuronal está haciendo un mejor trabajo que el
modelo lineal en la predicción de \texttt{medv}. Una vez más, hay que
tener cuidado porque este resultado depende de la división de prueba de
entrenamiento realizada anteriormente.

A continuación, vamos a realizar una rápida validación cruzada para
tener más confianza en los resultados.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{))}

\KeywordTok{plot}\NormalTok{(test}\OperatorTok{$}\NormalTok{medv,pr.nn_,}\DataTypeTok{col=}\StringTok{'red'}\NormalTok{,}\DataTypeTok{main=}\StringTok{'Real vs predicted NN'}\NormalTok{,}\DataTypeTok{pch=}\DecValTok{18}\NormalTok{,}\DataTypeTok{cex=}\FloatTok{0.7}\NormalTok{)}
\KeywordTok{abline}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DataTypeTok{lwd=}\DecValTok{2}\NormalTok{)}
\KeywordTok{legend}\NormalTok{(}\StringTok{'bottomright'}\NormalTok{,}\DataTypeTok{legend=}\StringTok{'NN'}\NormalTok{,}\DataTypeTok{pch=}\DecValTok{18}\NormalTok{,}\DataTypeTok{col=}\StringTok{'red'}\NormalTok{)}

\KeywordTok{plot}\NormalTok{(test}\OperatorTok{$}\NormalTok{medv,pr.lm,}\DataTypeTok{col=}\StringTok{'blue'}\NormalTok{,}\DataTypeTok{main=}\StringTok{'Real vs predicted lm'}\NormalTok{,}\DataTypeTok{pch=}\DecValTok{18}\NormalTok{, }\DataTypeTok{cex=}\FloatTok{0.7}\NormalTok{)}
\KeywordTok{abline}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DataTypeTok{lwd=}\DecValTok{2}\NormalTok{)}
\KeywordTok{legend}\NormalTok{(}\StringTok{'bottomright'}\NormalTok{,}\DataTypeTok{legend=}\StringTok{'LM'}\NormalTok{,}\DataTypeTok{pch=}\DecValTok{18}\NormalTok{,}\DataTypeTok{col=}\StringTok{'blue'}\NormalTok{, }\DataTypeTok{cex=}\NormalTok{.}\DecValTok{95}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{cursoR_files/figure-latex/pplot -1.pdf}

Inspeccionando visualmente podemos ver que las predicciones hechas por
la red neural están (en general) más concentradas alrededor de la línea
(una alineación perfecta con la línea indicaría un ECM de 0 y por lo
tanto una predicción perfecta ideal) que las hechas por el modelo
lineal.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot}\NormalTok{(test}\OperatorTok{$}\NormalTok{medv,pr.nn_,}\DataTypeTok{col=}\StringTok{'red'}\NormalTok{,}\DataTypeTok{main=}\StringTok{'Real vs predicted NN'}\NormalTok{,}\DataTypeTok{pch=}\DecValTok{18}\NormalTok{,}\DataTypeTok{cex=}\FloatTok{0.7}\NormalTok{)}
\KeywordTok{points}\NormalTok{(test}\OperatorTok{$}\NormalTok{medv,pr.lm,}\DataTypeTok{col=}\StringTok{'blue'}\NormalTok{,}\DataTypeTok{pch=}\DecValTok{18}\NormalTok{,}\DataTypeTok{cex=}\FloatTok{0.7}\NormalTok{)}
\KeywordTok{abline}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DataTypeTok{lwd=}\DecValTok{2}\NormalTok{)}
\KeywordTok{legend}\NormalTok{(}\StringTok{'bottomright'}\NormalTok{,}\DataTypeTok{legend=}\KeywordTok{c}\NormalTok{(}\StringTok{'NN'}\NormalTok{,}\StringTok{'LM'}\NormalTok{),}\DataTypeTok{pch=}\DecValTok{18}\NormalTok{,}\DataTypeTok{col=}\KeywordTok{c}\NormalTok{(}\StringTok{'red'}\NormalTok{,}\StringTok{'blue'}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/ppo-1} \end{center}

\section{Evaluando la predicción mediante validación
cruzada}\label{evaluando-la-predicciuxf3n-mediante-validaciuxf3n-cruzada}

La validación cruzada es otro paso muy importante en la construcción de
modelos predictivos. Aunque existen diferentes tipos de métodos de
validación cruzada, la idea básica es repetir el proceso siguiente
varias veces:

\textbf{División Entrenamiento-Prueba:}

\begin{itemize}
\tightlist
\item
  Realizar la división entre muestra de entrenamiento-prueba.
\item
  Ajustar el modelos al conjunto de entrenamiento.
\item
  Comprobar el modelo en el conjunto de prueba.
\item
  Calcular el error de predicción.
\item
  Repetir el proceso \(K\) veces.
\end{itemize}

Luego, calculando el error promedio, podemos hacernos una idea de cómo
le está yendo al modelo.

Vamos a implementar una validación cruzada usando un bucle para la red
neuronal y la función \texttt{cv.glm()} en el paquete \texttt{boot} para
el modelo lineal. Para \(K=10\).

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(boot)}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{200}\NormalTok{)}
\NormalTok{lm.fit <-}\StringTok{ }\KeywordTok{glm}\NormalTok{(medv}\OperatorTok{~}\NormalTok{.,}\DataTypeTok{data=}\NormalTok{data)}
\KeywordTok{cv.glm}\NormalTok{(data,lm.fit,}\DataTypeTok{K=}\DecValTok{10}\NormalTok{)}\OperatorTok{$}\NormalTok{delta[}\DecValTok{1}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 23.8356
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{450}\NormalTok{)}
\NormalTok{cv.error <-}\StringTok{ }\OtherTok{NULL}
\NormalTok{k <-}\StringTok{ }\DecValTok{10}


\ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\NormalTok{k)\{}
\NormalTok{    index <-}\StringTok{ }\KeywordTok{sample}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\KeywordTok{nrow}\NormalTok{(data),}\KeywordTok{round}\NormalTok{(}\FloatTok{0.9}\OperatorTok{*}\KeywordTok{nrow}\NormalTok{(data)))}
\NormalTok{    train.cv <-}\StringTok{ }\NormalTok{scaled[index,]}
\NormalTok{    test.cv <-}\StringTok{ }\NormalTok{scaled[}\OperatorTok{-}\NormalTok{index,]}

\NormalTok{    nn <-}\StringTok{ }\KeywordTok{neuralnet}\NormalTok{(f,}\DataTypeTok{data=}\NormalTok{train.cv,}\DataTypeTok{hidden=}\KeywordTok{c}\NormalTok{(}\DecValTok{5}\NormalTok{,}\DecValTok{2}\NormalTok{),}\DataTypeTok{linear.output=}\NormalTok{T)}

\NormalTok{    pr.nn <-}\StringTok{ }\NormalTok{neuralnet}\OperatorTok{::}\KeywordTok{compute}\NormalTok{(nn,test.cv[,}\DecValTok{1}\OperatorTok{:}\DecValTok{13}\NormalTok{])}
\NormalTok{    pr.nn <-}\StringTok{ }\NormalTok{pr.nn}\OperatorTok{$}\NormalTok{net.result}\OperatorTok{*}\NormalTok{(}\KeywordTok{max}\NormalTok{(data}\OperatorTok{$}\NormalTok{medv)}\OperatorTok{-}\KeywordTok{min}\NormalTok{(data}\OperatorTok{$}\NormalTok{medv))}\OperatorTok{+}\KeywordTok{min}\NormalTok{(data}\OperatorTok{$}\NormalTok{medv)}

\NormalTok{    test.cv.r <-}\StringTok{ }\NormalTok{(test.cv}\OperatorTok{$}\NormalTok{medv)}\OperatorTok{*}\NormalTok{(}\KeywordTok{max}\NormalTok{(data}\OperatorTok{$}\NormalTok{medv)}\OperatorTok{-}\KeywordTok{min}\NormalTok{(data}\OperatorTok{$}\NormalTok{medv))}\OperatorTok{+}\KeywordTok{min}\NormalTok{(data}\OperatorTok{$}\NormalTok{medv)}

\NormalTok{    cv.error[i] <-}\StringTok{ }\KeywordTok{sum}\NormalTok{((test.cv.r }\OperatorTok{-}\StringTok{ }\NormalTok{pr.nn)}\OperatorTok{^}\DecValTok{2}\NormalTok{)}\OperatorTok{/}\KeywordTok{nrow}\NormalTok{(test.cv)}

\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Calculamos el ECM promedio y graficamos los resultados como una gráfica
de caja.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{mean}\NormalTok{(cv.error)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 10.32698
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cv.error}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] 17.640653  6.310575 15.769519  5.730131 10.520947  6.121161  6.389967
##  [8]  8.004786 17.369282  9.412778
\end{verbatim}

Boxplot

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{boxplot}\NormalTok{(cv.error,}\DataTypeTok{xlab=}\StringTok{'MSE CV'}\NormalTok{,}\DataTypeTok{col=}\StringTok{'cyan'}\NormalTok{,}
        \DataTypeTok{border=}\StringTok{'blue'}\NormalTok{,}\DataTypeTok{names=}\StringTok{'CV error (MSE)'}\NormalTok{,}
        \DataTypeTok{main=}\StringTok{'CV error (MSE) for NN'}\NormalTok{,}\DataTypeTok{horizontal=}\OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/bb-1} \end{center}

Como se puede ver, la media del ECM de la red neural (10.33) es inferior
al del modelo lineal, aunque parece haber cierto grado de variación en
laos ECMs de la validación cruzada. Esto puede depender de la división
de los datos o de la inicialización aleatoria de los pesos en la red
neuronal. Al ejecutar la simulación en diferentes momentos con
diferentes semillas, puede obtener una estimación puntual más precisa
para el ECM medio.

\subsection{Comparación de modelos
RNA}\label{comparaciuxf3n-de-modelos-rna}

A continuación vamos a comparar 2 modelos:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  2 capas ocultas de 5 y 3.
\item
  1 capa oculta de 8
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Boston.nn.}\FloatTok{5.3}\NormalTok{ <-}\StringTok{ }\KeywordTok{neuralnet}\NormalTok{(f}
\NormalTok{                , }\DataTypeTok{data=}\NormalTok{train_}
\NormalTok{                , }\DataTypeTok{hidden=}\KeywordTok{c}\NormalTok{(}\DecValTok{5}\NormalTok{,}\DecValTok{3}\NormalTok{)}
\NormalTok{                , }\DataTypeTok{linear.output=}\OtherTok{TRUE}\NormalTok{)}

\NormalTok{Boston.nn.}\DecValTok{8}\NormalTok{ <-}\StringTok{ }\KeywordTok{neuralnet}\NormalTok{(f}
\NormalTok{                , }\DataTypeTok{data=}\NormalTok{train_}
\NormalTok{                , }\DataTypeTok{hidden=}\DecValTok{8}
\NormalTok{                , }\DataTypeTok{linear.output=}\OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Como alternativa a la función \texttt{plot.nn()}, la librería
\texttt{NeuralNetTools} incluye funciones gráficas más elegantes. Este
elegante gráfico resuelve el problema del desorden visual utilizando el
grosor de la línea para representar la magnitud del peso y el color de
la línea para representar el signo de peso (negro = positivo, gris =
negativo).

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(NeuralNetTools)}
\KeywordTok{plotnet}\NormalTok{(Boston.nn.}\FloatTok{5.3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/nntools-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plotnet}\NormalTok{(Boston.nn.}\DecValTok{8}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{cursoR_files/figure-latex/nntools-2} \end{center}

\bibliography{book.bib,packages.bib}


\end{document}
